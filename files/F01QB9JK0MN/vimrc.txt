function s:lsp_format() abort
  silent LspDocumentFormatSync
  LspCodeActionSync source.organizeImports
endfunction

function s:on_lsp_buffer_enabled() abort
  if &l:buftype isnot# '' || win_gettype() isnot# ''
    return
  endif
  " ... オプションとかキーマッピングとか設定したりする

  if &filetype is# 'go'
    augroup vimrc-plugin-lsp-ft-go
      autocmd! * <buffer>
      autocmd BufWritePre <buffer> call s:lsp_format()
    augroup END
  endif
endfunction

augroup vimrc-plugin-lsp
  autocmd!
  autocmd User lsp_buffer_enabled call s:on_lsp_buffer_enabled()
augroup END
