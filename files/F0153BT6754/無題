export type Process = (lines: Array<string>) => void | Promise<void>

export type Processes = {
  [key: string]: Process
}

export type SingleLineConsumer = {
  consume: (line: string) => void
  kind: "single"
}
export type BulkLineConsumer = {
  consume: (lines: Array<string>) => void
  kind: "bulk"
}
type Consumer = SingleLineConsumer | BulkLineConsumer

export type CreateProcess = (consumer: Consumer) => { consume: Process }

export const createProcess: CreateProcess = (consumer) => ({
  consume: async (lines) => {
    if (consumer.kind === "single") {
      for await (const line of lines) {
        consumer.consume(line)
      }
    } else {
      consumer.consume(lines)
    }
  }
})
