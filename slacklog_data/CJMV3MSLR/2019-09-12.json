[{"client_msg_id":"b353172c-1349-4256-b3d1-fd1010249294","type":"message","user":"UJ70JTGR3","text":"質問なんですが、submodeをつかっていて下のようなメソッド単位で移動する設定を追加したいのですが\n\n```\ncall submode#enter_with('search_method', 'n', '', '[m', '[m')\ncall submode#enter_with('search_method', 'n', '', ']m', ']m')\ncall submode#map('search_method', 'n', '', '[', '[m')\ncall submode#map('search_method', 'n', '', ']', ']m')\n```\n\nこれをrubyのファイルで使用しようとしてもサブモードが有効にならないので `:map [m` で調べてみたら `/usr/share/vim/vim81/ftplugin/ruby.vim` に\n\n```\n  nnoremap &lt;silent&gt; &lt;buffer&gt; [m :&lt;C-U&gt;call &lt;SID&gt;searchsyn('\\&lt;def\\&gt;',['rubyDefine'],'b','n')&lt;CR&gt;\n  nnoremap &lt;silent&gt; &lt;buffer&gt; ]m :&lt;C-U&gt;call &lt;SID&gt;searchsyn('\\&lt;def\\&gt;',['rubyDefine'],'','n')&lt;CR&gt;\n  nnoremap &lt;silent&gt; &lt;buffer&gt; [M :&lt;C-U&gt;call &lt;SID&gt;searchsyn('\\&lt;end\\&gt;',['rubyDefine'],'b','n')&lt;CR&gt;\n  nnoremap &lt;silent&gt; &lt;buffer&gt; ]M :&lt;C-U&gt;call &lt;SID&gt;searchsyn('\\&lt;end\\&gt;',['rubyDefine'],'','n')&lt;CR&gt;\n```\n\nが定義されていてこれのせいでサブモードが有効にならないのかなと思っています。\n具体的になってほしい動作としてはノーマルモードで `[m` を押すと、rubyのメソッドの先頭に移動するかつサブモードに入る。\nそのあとに `[` を押すと続けてrubyのメソッド単位での移動をしてほしいのですが、この場合って難しいんでしょうか？","ts":"1568274479.428800","edited":{"user":"UJ70JTGR3","ts":"1568274571.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"37176b16-2c62-40ba-b701-2d60d163b135","type":"message","user":"UAZ33BKV2","text":"なにかしらのタイミグで上書き定義して使うことは可能だとは思いますが...submodeつかったことないので、もうちょと詳しい人にさらにアドバイスもらったほうがいいかな","ts":"1568274896.430100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"d82e01d7-08f7-4cde-889f-fadfd6e8acc7","type":"message","user":"U03C71D7H","text":"これは ftplugin/ruby.vim の設計がよろしくない好例","ts":"1568274960.430700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"6d3b8f2b-202d-4f6b-88ab-9d5c46d55ec6","type":"message","user":"UJ70JTGR3","text":"おお、ruby.vimの方の設計が微妙なんですね","ts":"1568275061.431300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"9addefa1-6625-44a8-abf2-2930164d993b","type":"message","user":"UJ70JTGR3","text":"ほかのfiletypeでは起こらないのだろうか","ts":"1568275123.432100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"59d56011-db05-4e1d-91e5-aedb04f8e337","type":"message","user":"UJ70JTGR3","text":"pythonもできない…","ts":"1568275315.432300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"d4f5ad18-73f5-42af-80e7-a015f14fcf63","type":"message","user":"U03C71D7H","text":"いや、だいたいのが微妙…","ts":"1568277655.433000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"79b9811d-f85b-4d29-8759-2a84f536e61b","type":"message","user":"UJ70JTGR3","text":"そうなんですね…\nunmapして自分で書いてやろうと思いましたが消えてくれない…","ts":"1568277994.433600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"95fcb6be-62a2-4ecd-b6ca-5fe8ac2ec324","type":"message","user":"U03C71D7H","text":"`&lt;SID&gt;` が入ってるので自前 map も難しそう","ts":"1568278062.434000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"5d8c9084-3bf6-42fc-b6d9-554677b889dc","type":"message","user":"UJ70JTGR3","text":"やはり `[m` にマップするのは難しそうですね…\n別にマップをつくるしかないか","ts":"1568278148.434700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"09a8075d-54da-4a04-add7-31987092fa58","type":"message","user":"UJ70JTGR3","text":"潔く別キーでサブモード登録して、自作関数で移動しようと思います\nありがとうございました！","ts":"1568278227.435500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"41e8e5d5-6aa5-4a78-adf8-944d6879bb40","type":"message","user":"UBNPMJJGM","text":"InsertEnter あたりにフックして、バッファで1回だけ unmap するとかでも無理なんですかね？","ts":"1568278304.437100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"7f8dd2ab-fc57-4c88-bca7-b1ada3b00bd3","type":"message","user":"U03C71D7H","text":"起動が別キーで良ければそのキーから `[m` を呼び出せば同じジャンプはできますね","ts":"1568278311.437300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"ec3ba97b-38ed-4e06-b411-acadffd30e22","type":"message","user":"U03C71D7H","text":"unmap しちゃうと呼び出したい機能が消えちゃいますね","ts":"1568278344.437700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"9fdd8935-4e9d-4ca6-8569-c18cff239a5a","type":"message","user":"UJ70JTGR3","text":"unmap しようとすると `No such mapping` で怒られるんですよね","ts":"1568278381.438200","edited":{"user":"UJ70JTGR3","ts":"1568278398.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"10e4b9df-2898-40c1-bc69-1e5ab7511e4f","type":"message","user":"UBNPMJJGM","text":"あぁ、であれば unmap ではなく上書きする感じ","ts":"1568278423.439500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"e6ca1cc9-15c5-4aa2-9c63-b8a707180b2b","type":"message","user":"U03C71D7H","text":"`&lt;buffer&gt;` が必要です","ts":"1568278430.440000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"8b13ca9f-25e2-4dcf-9887-d394c5a1b6d4","type":"message","user":"UAZ33BKV2","text":"そしてsubmodeでそれをやる方法がちょっと...ない?(help見る分に)","ts":"1568278454.440700","team":"T03C4RC8V","reactions":[{"name":"eyes","count":1,"users":["UBNPMJJGM"]}],"replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"0a4d01df-361b-4224-a2cf-0724397bc99b","type":"message","user":"UJ70JTGR3","text":"&gt; ｀&lt;buffer&gt;｀ が必要です\n知らなかった","ts":"1568278508.441600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"19cac95b-de06-411b-ad00-0c02ccefe7a4","type":"message","user":"UAZ33BKV2","text":"submodeがnon bufferなマッピングが基本っぽいからなあ...","ts":"1568278515.441800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"cb4cfb4e-dd24-4070-9a32-aa68db2346c2","type":"message","user":"UJ70JTGR3","text":"&gt; 起動が別キーで良ければそのキーから ｀[m｀ を呼び出せば同じジャンプはできますね\n\nこれ試してみます","ts":"1568278533.442100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"fe5b1b22-a780-451f-8a41-b2b650fd1e3b","type":"message","user":"UAZ33BKV2","text":"あ、マップオプションのbでいけるか","ts":"1568278555.443100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"037ef80f-38df-4b44-a0de-7c85c2b7763b","type":"message","user":"U03C71D7H","text":"ruby.vim が定義している `[m` の機能が使いたい、で合ってますよね","ts":"1568278556.443200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"8a287950-d769-4494-97fd-5e53383df652","type":"message","user":"UBNPMJJGM","text":"強制的にマッピングするプラグインェ……","ts":"1568278586.444400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"f37bd7ff-f95f-40fb-b14c-2ed4ad4444e3","type":"message","user":"UJ70JTGR3","text":"&gt; ruby.vim が定義している ｀[m｀ の機能が使いたい、で合ってますよね\nそうですが、最悪無理なら `search()` でも使って `def` に飛ぶ関数作ろうかなと思ってました","ts":"1568278591.444500","edited":{"user":"UJ70JTGR3","ts":"1568278610.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"14b762da-23bb-48b3-8653-ff99cc39bf13","type":"message","user":"UJ70JTGR3","text":"```\ncall submode#enter_with('move_method', 'n', '', 'mm', '&lt;Esc&gt;')\ncall submode#map('move_method', 'n', '', '[', '[m')\ncall submode#map('move_method', 'n', '', ']', ']m')\n```\nこれで定義したんですが `{` 、 `}` にジャンプしますね…","ts":"1568278872.445400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"f2f8c725-00e2-4bf7-9d16-5e012d0448c1","type":"message","user":"UAZ33BKV2","text":"そっちも optionにbいれないとglobalなマップのというかnoremapな[m/]m 呼ぶんじゃないかな?","ts":"1568279063.446000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"383b5ff8-6858-4d9e-9bfc-60cc7f845290","type":"message","user":"UAZ33BKV2","text":"あ、オプションにremapがあるから、これか? (使ってないからダメダメだあ)","ts":"1568279168.446500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"3ebd640f-52b0-4180-ba3f-5908e89ab3e1","type":"message","user":"UJ70JTGR3","text":"```\ncall submode#enter_with('move_method', 'n', '', 'mm', '&lt;Esc&gt;')\ncall submode#map('move_method', 'n', 'r', '[', '[m')\ncall submode#map('move_method', 'n', 'r', ']', ']m')\n```\n\nでいけました！！\nありがとうございます！","ts":"1568279267.447100","team":"T03C4RC8V","reactions":[{"name":"clap::skin-tone-5","count":1,"users":["UAZ33BKV2"]}],"replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"853ec6d5-d4f4-444c-9ded-e1902f6fc3ea","type":"message","user":"UAZ33BKV2","text":"`maparg()` つかうともしかしたら上手く再マップできるかも、の可能性はありそうです\n必要そうだったら、そっちのヘルプみて考えてみるのもいいかも","ts":"1568279770.448400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"332ded61-fd8c-48e4-80c4-778f486f7365","type":"message","user":"UJ70JTGR3","text":"`echo maparg('[m', 'n')` で `:&lt;C-U&gt;call &lt;SNR&gt;90_searchsyn('\\&lt;def\\&gt;',['rubyDefine'],'b','n')&lt;CR&gt;` が取り出せました\n`maparg()` まさに欲しかったものです…","ts":"1568280576.450200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"51e73c04-c224-46a8-88b7-60d8cbccccac","type":"message","user":"ULU9ZBTJ9","text":"たびたびすみません。質問させていただきたいのですが、\nvimのmark機能でマークしたファイルのパスを取得したいのですが、どのようにすれば実現できるでしょうか。。\n`:marks`を叩いても行数やマークした行のテキストは出るのですが、ファイルパスを取得することが参照できず。。","ts":"1568290720.452100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"d8a30d79-2264-49c4-8b9a-3f56d178b185","type":"message","user":"U9S4G0LJW","text":"グローバルなマークだとファイルから抜けると `:marks` でパスが出ます、ローカルなマークはviminfoをパースするしかないんじゃないかな","ts":"1568290919.452900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"bec902de-18ce-483c-9c87-ca8e7898daf1","type":"message","user":"UBQ2H65JQ","text":"汎用的なmarkの関数は提供してないけど、`:marks` で行のテキストが出力される場合ってカレントバッファのときだからある程度は `:marks` のパースでいけるんじゃないかなー","ts":"1568291760.455600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"38ec244a-1715-4268-b3de-323c93b3eae6","type":"message","user":"U9S4G0LJW","text":"あー言われてみれば抜ける必要ないですね","ts":"1568291796.456100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"75751e6d-6d61-4b53-93f8-7fa05661687a","type":"message","user":"U03C71D7H","text":"小文字の mark はたぶんバッファローカルな気がする。大文字がグローバルなので。","ts":"1568292022.457200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"29457b05-9de2-4353-a46f-3a027a4baa9f","type":"message","user":"U03C71D7H","text":":h getpos()","ts":"1568292038.457800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U894RTUJY","text":"```\n                                                        *getpos()*\ngetpos({expr})  {expr}の位置を返す。{expr}として指定できる値については\n                |line()|を参照。カーソル位置を得るには |getcurpos()| を参照。\n                結果は次の4個の要素を持つリスト|List|:\n                    [bufnum, lnum, col, off]\n                \"bufnum\" は、'0 や 'A のようなマークが指定されたときは、その\n                マークのバッファ番号となる。それ以外では0となる。\n                \"lnum\" と \"col\" はバッファ中の位置。桁番号は1から始まる。\n                \"off\" の値は、'virtualedit' がオフのときは常に0で、オンのとき\n                はその文字の始点からの画面上の桁のオフセットである。つまり、\n                カーソルが&lt;Tab&gt;の中や、その行の最後の文字より後にあるとき意味\n                を持つ。\n                Note: ビジュアルモードの '&lt; と '&gt; について: ビジュアルモードが\n                \"V\" (行選択モード) のとき、'&lt; の桁番号はゼロ、'&gt; の桁番号は大\n                きな値になる。\n                この関数はマークの位置を保存し、復元するために使われる:  \n                        let save_a_mark = getpos(\"'a\")\n                        ...\n                        call setpos(\"'a\", save_a_mark)\n                |getcurpos()| と |setpos()|も参照。\n```","ts":"1568292038.457900","bot_id":"B894RTUCU","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null},{"client_msg_id":"55bdd440-8653-4e6b-b2ae-64083ead8fa5","type":"message","user":"UBQ2H65JQ","text":"```\nfunction! s:getmarkfile(mark) abort\n    for line in split(execute('marks'), \"\\n\")[1:]\n        let m = matchlist(line, '^\\s*\\([^ ]\\+\\)\\s\\+\\(\\d\\+\\)\\s\\+\\(\\d\\+\\)\\s\\+\\(.*\\)$')\n        if !empty(m)\n            let xs = m[1:4]\n            if a:mark == xs[0]\n                if filereadable(xs[3])\n                    return xs[3]\n                else\n                    return expand('%')\n                endif\n            endif\n        endif\n    endfor\nendfunction\n\necho s:getmarkfile('a')\n\" /path/to/a.vim\n```\nこんな感じかな","ts":"1568292047.458200","edited":{"user":"UBQ2H65JQ","ts":"1568292593.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"9f7111ad-107d-4be7-8511-ca015248b2b3","type":"message","user":"U03C71D7H","text":"これでバッファ番号が取れるのでそこからファイル名取れないかな","ts":"1568292066.458800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"1b0e28ac-d6d1-463f-a051-0d25eaa1fa82","type":"message","user":"U03C71D7H","text":"試したことはないです","ts":"1568292070.459100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"46bfa00a-c65d-4640-a98a-3df33b92bd65","type":"message","user":"UBQ2H65JQ","text":"カレントバッファがスクラッチなことも十分ありえるので、ファイルパスが必ず取れる保障はないです。","ts":"1568292788.460400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"b7b841be-23c2-46ae-a60a-a735640d477e","type":"message","user":"U0M7GCBPD","text":"`:h :delmarks` の下あたりに\n```\n'a - 'z\t\tlowercase marks, valid within one file\n'A - 'Z\t\tuppercase marks, also called file marks, valid between files\n'0 - '9\t\tnumbered marks, set from .viminfo file\n```\nとあるので、おそらく小文字 ('a - 'z) はバッファローカルですかね\n（ウィンドウローカルの可能性もあると思ったけど）","ts":"1568293850.461400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"05770764-8397-40d9-92b1-a8988938288e","type":"message","user":"ULU9ZBTJ9","text":"なるほど、ローカルとグローバルでmarksの表記の挙動が異なるのですね（表記にばらつきがあるのが気になっていました）\n\n関数の用意までしていただきありがとうございます。\nなんとなく安易に取れそうと思ったのですが思いの外大変そうな感じですね。。","ts":"1568297631.463500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"fadcafb4-b691-4f07-b4f0-a17f69cdf369","type":"message","user":"UAZ33BKV2","text":"あくまでマークであってファイル記録機能じゃないですから、それなりに工夫がいる感じですかねー","ts":"1568297755.464100","team":"T03C4RC8V","reactions":[{"name":"naruhodo","count":1,"users":["ULU9ZBTJ9"]}],"replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UMX6DK7RR","text":"<@UMX6DK7RR> has joined the channel","ts":"1568215766.428500","subtype":"channel_join","replace_original":false,"delete_original":false,"blocks":null}]
