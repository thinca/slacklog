[{"client_msg_id":"c1e7e9e6-c9e6-43b4-a289-4099541fd7eb","type":"message","user":"U776661HA","text":"これの上に denops 乗っけてテストができるといいなと","ts":"1614428558.145600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"MrXw"}]},{"client_msg_id":"b4da46d8-1244-4a81-84b8-76c07e5dddd0","type":"message","user":"U8R597E9H","text":"すごい。","ts":"1614428536.145200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"5UJ"}]},{"client_msg_id":"65a21275-df1e-47b4-9201-2b936aa00fd1","type":"message","user":"U776661HA","text":"一応こんな感じで denops 非依存で Vim/Neovim のテストが書けるようなコードができました\n\n```Deno.test(\"withNvim start nvim to communicate with\", async () =\u0026gt; {\n  await withNvim(async (reader, writer) =\u0026gt; {\n    const session = new Session(reader, writer);\n    session.listen();\n    const result = await session.call(\"nvim_eval\", \"1 + 1\");\n    assertEquals(result, 2);\n    await session.notify(\"nvim_command\", \"qall!\");\n  });\n});\n\nDeno.test(\"withVim start vim to communicate with\", async () =\u0026gt; {\n  await withVim(async (reader, writer) =\u0026gt; {\n    const session = new VimSession(reader, writer);\n    session.listen();\n    const result = await session.expr(\"1 + 1\");\n    assertEquals(result, 2);\n    await session.ex(\"qall!\");\n  });\n});```","ts":"1614428485.145000","team":"T03C4RC8V","reactions":[{"name":"sugoi","count":2,"users":["U01BY3SDBRS","U7B4ZD49X"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Q=9"}]},{"client_msg_id":"2d259b0e-939a-49ed-9ea2-f00b37809e05","type":"message","user":"UAZ33BKV2","text":":goodjob:","ts":"1614428404.144400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"x7Duz"}]},{"client_msg_id":"1bc03e99-e5b3-4647-a808-eea0b2ffeca4","type":"message","user":"U776661HA","text":"TCP を使ってサバを立てることで目的は達成できました。お騒がせしました :bow:","ts":"1614428239.144200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Py4"}]},{"client_msg_id":"baa8d823-0338-4101-a2df-92d2d0bc1731","type":"message","user":"U776661HA","text":"```let ch = ch_open('...')```\nですね","ts":"1614427805.143700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"1AQBo"}]},{"client_msg_id":"228cbceb-0ce7-4a06-af7b-c304dcbba896","type":"message","user":"U776661HA","text":":kanzenrikai:","ts":"1614427787.143300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"9Bfc"}]},{"client_msg_id":"30e9ed5d-d39a-4084-916e-ab0aada12911","type":"message","user":"U776661HA","text":"あ","ts":"1614427761.143100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"MfvL"}]},{"client_msg_id":"1f5af074-1bd7-4831-817b-1a7d7bde021d","type":"message","user":"U776661HA","text":"```const server = Deno.listen({\n  transport: \"tcp\",\n  hostname: \"127.0.0.1\",\n  port: 0,\n});\nconst addr = server.addr as Deno.NetAddr;\nconst vim = Deno.run({\n  \"cmd\": [\n    \"vim\",\n    \"--clean\",\n    \"--not-a-term\",\n    \"-nNes\",\n    \"--cmd\",\n    `call ch_open('127.0.0.1:${addr.port}')`,\n    \"--cmd\",\n    `call timer_start(5000, { -\u0026gt; execute('qall!') })`,\n  ],\n});\n\nconst encoder = new TextEncoder();\nconst decoder = new TextDecoder();\nconst conn = await server.accept();\n\nawait conn.write(encoder.encode(JSON.stringify([\"ex\", \"qall!\"])));\n\nawait vim.status();\nvim.close();```\nこれで即終了しないのは結構不思議","ts":"1614427167.142900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"xy4"}]},{"client_msg_id":"2391265d-0b47-4bb1-b88f-6e26fee6d1eb","type":"message","user":"U776661HA","text":"なかなか難しい","ts":"1614426960.142300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"0SCw1"}]},{"client_msg_id":"e215df35-dd6a-4876-9dd0-15d75fa15e35","type":"message","user":"U776661HA","text":"んーうまくいかない","ts":"1614426932.142000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"bCE"}]},{"client_msg_id":"0e804e76-89f5-443a-80e2-46b1db1fbeaa","type":"message","user":"U8R597E9H","text":"これだと deno-way なテストをキックする問題もクリアしなきゃだめか。。。 `Deno.test` を同定するところから。\nProgramatic API 提供してくれてるかと思ったけど、見当たらなかった。","ts":"1614426298.141800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"wyB9Z"}]},{"client_msg_id":"159759f8-c484-4619-ba58-f13f0b5bdf17","type":"message","user":"U8R597E9H","text":"環境変数付きで vim が起動した場合だけ初期化後になにかを投げる。というのはそこそこかんたんそうです。","ts":"1614426128.141100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"/ah2"}]},{"client_msg_id":"c10cd686-2d64-470a-b2ae-b336b1fe08a6","type":"message","user":"U8R597E9H","text":"テスト実行の主体を vim にさせるパターン（denops としては、普通に vim plugin として振る舞って、起動時に `denops#request('run-test', [...])` を vim から投げさせる。","ts":"1614426061.140400","edited":{"user":"U8R597E9H","ts":"1614426075.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"EOeI"}]},{"client_msg_id":"39c2a5d3-93af-4b24-bf0d-28ffa3cc87f3","type":"message","user":"U8R597E9H","text":"themis の wrapper のような形だとサクッとできそうな気はしました。","ts":"1614426012.139500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"NoEyy"}]},{"client_msg_id":"593e9b03-f558-487d-b034-7023d9bda0cd","type":"message","user":"U776661HA","text":"なので仮想端末経由で Vim を操作するというのは、いまやろうとしているテストの観点から少し外れる感じです。将来的にはそういうテストも作るかもしれませんが...","ts":"1614425777.139000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"kB1/"}]},{"client_msg_id":"51a3af81-6301-4f57-87b4-6395d9f19321","type":"message","user":"U776661HA","text":"テストしたいのは channel command であって Vim ではないんですよね","ts":"1614425722.138000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ji5T"}]},{"client_msg_id":"d4753862-04db-4117-b1aa-983fbcb4a5d4","type":"message","user":"U776661HA","text":"あー","ts":"1614425709.137700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"R8d6"}]},{"client_msg_id":"4f468dfd-042d-4502-b5cd-62eaea1049a3","type":"message","user":"U776661HA","text":"と、いいますと？","ts":"1614425652.137400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ILZv"}]},{"client_msg_id":"24cf8e38-1980-4b13-af2b-4bf9d3300021","type":"message","user":"U06BRP8VD","text":"VimがVimを使ってテストしてるんだから、仮想端末をユーティリティに組み込めば良いのでは?","ts":"1614425606.137100","edited":{"user":"U06BRP8VD","ts":"1614425624.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"3uK"}]},{"client_msg_id":"beb76809-9b69-470f-85cd-7c83a04a53c7","type":"message","user":"U776661HA","text":"Deno で起動するんだらか鯖立てちゃうか","ts":"1614425497.136600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"USerX"}]},{"client_msg_id":"318ed333-12d0-40a0-823d-79f4ad68b6ae","type":"message","user":"U776661HA","text":"TCP でやった方が楽そうw","ts":"1614425484.136300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"7aTt2"}]},{"client_msg_id":"8549be74-f416-4b59-9809-d25f34b1f38a","type":"message","user":"U776661HA","text":"というか","ts":"1614425473.136000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"abc5T"}]},{"client_msg_id":"7a2d4588-544e-49a8-8e93-92cdc910dfca","type":"message","user":"U776661HA","text":"可能であれば Vim を実際に起動してテストするユーティリティを作りたいんですよね。まぁ Neovim ならサクッとできるので、最悪そっちだけでもいいのですが","ts":"1614425439.135800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Omn"}]},{"client_msg_id":"44f3baa0-75b2-47ca-a0d2-3126d5e3d29c","type":"message","user":"U06BRP8VD","text":"すごい(ふくざつだ)ね。こんなツールに遭遇したら理解できる自信ないよ","ts":"1614425373.134800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"raX0+"}]},{"client_msg_id":"62dda408-fa31-425d-9134-06fb61eaf7af","type":"message","user":"U776661HA","text":"ちょっと試行錯誤してみます。ヒントありがとうございます :bow:","ts":"1614425346.134400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"WTPEe"}]},{"client_msg_id":"6afc635c-3b47-4136-b114-fb85262d2dc1","type":"message","user":"U06BRP8VD","text":"親プロセスIDがわかってprocfsあればできるかも?","ts":"1614425330.134100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"XIhU"}]},{"client_msg_id":"24c2754e-f74b-45ff-b82b-b0749b12d895","type":"message","user":"U776661HA","text":"それならいけるかもです","ts":"1614425327.134000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"lbB/"}]},{"client_msg_id":"a3b620c7-3afb-464e-8cd9-8b005cef52b6","type":"message","user":"U776661HA","text":":tenshikourin:","ts":"1614425319.133700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"tzp92"}]},{"client_msg_id":"d8483618-33ac-46ed-8eac-a5fea963da47","type":"message","user":"U776661HA","text":"あー","ts":"1614425314.133400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"VYmIk"}]},{"client_msg_id":"1743d266-1dbb-4f1a-8ce6-54143cc71b80","type":"message","user":"U06BRP8VD","text":"なかのVimでchannel開いて外のstdoutとstdinに繋ぐだけのコマンド作れないかね?","ts":"1614425303.133100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"/IDv"}]},{"client_msg_id":"c7c5d164-27f1-4bba-b751-17fcb6e2a632","type":"message","user":"U776661HA","text":"整理すると Vim 起動時に stdin/stdout をチャネルとしてハンドルする機能が欲しいという感じでしょうか？","ts":"1614425286.132900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"LOl"}]},{"client_msg_id":"a2a7ebe6-fac3-473e-acf1-54aafbe11d70","type":"message","user":"U06BRP8VD","text":"返信側はここね。","ts":"1614425261.132100","files":[{"id":"F01P5GPJFUP","created":1614425260,"timestamp":1614425260,"name":"Untitled","title":"Untitled","mimetype":"text/plain","image_exif_rotation":0,"filetype":"text","pretty_type":"プレーンテキスト","user":"U06BRP8VD","mode":"snippet","editable":true,"is_external":false,"external_type":"","size":167,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F01P5GPJFUP/untitled","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F01P5GPJFUP/download/untitled","original_h":0,"original_w":0,"thumb_64":"","thumb_80":"","thumb_160":"","thumb_360":"","thumb_360_gif":"","thumb_360_w":0,"thumb_360_h":0,"thumb_480":"","thumb_480_w":0,"thumb_480_h":0,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U06BRP8VD/F01P5GPJFUP/untitled","permalink_public":"https://slack-files.com/T03C4RC8V-F01P5GPJFUP-daf330cc08","edit_link":"https://vim-jp.slack.com/files/U06BRP8VD/F01P5GPJFUP/untitled/edit","preview":"\t\tif (json != NULL)\n\t\t{\n\t\t    channel_send(channel,\n\t\t\t\t part == PART_SOCK ? PART_SOCK : PART_IN,\n\t\t\t\t json, (int)STRLEN(json), (char *)cmd);","preview_highlight":"\u003cdiv class=\"CodeMirror cm-s-default CodeMirrorServer\" oncopy=\"if(event.clipboardData){event.clipboardData.setData('text/plain',window.getSelection().toString().replace(/\\u200b/g,''));event.preventDefault();event.stopPropagation();}\"\u003e\n\u003cdiv class=\"CodeMirror-code\"\u003e\n\u003cdiv\u003e\u003cpre\u003e        if (json != NULL)\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e        {\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e            channel_send(channel,\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e                 part == PART_SOCK ? PART_SOCK : PART_IN,\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e                 json, (int)STRLEN(json), (char *)cmd);\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","lines":7,"lines_more":2,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"4HZ"}]},{"client_msg_id":"b4acee51-91f3-4310-b674-bc389acf2cc4","type":"message","user":"U776661HA","text":"*channel* command ですし、ですよね感w","ts":"1614425238.131800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"BYks"}]},{"client_msg_id":"7f7066fe-d662-417d-8189-8ebbf4ea86bf","type":"message","user":"U06BRP8VD","ts":"1614425233.131600","files":[{"id":"F01QA4XK0DN","created":1614425231,"timestamp":1614425231,"name":"Untitled","title":"Untitled","mimetype":"text/plain","image_exif_rotation":0,"filetype":"text","pretty_type":"プレーンテキスト","user":"U06BRP8VD","mode":"snippet","editable":true,"is_external":false,"external_type":"","size":253,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F01QA4XK0DN/untitled","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F01QA4XK0DN/download/untitled","original_h":0,"original_w":0,"thumb_64":"","thumb_80":"","thumb_160":"","thumb_360":"","thumb_360_gif":"","thumb_360_w":0,"thumb_360_h":0,"thumb_480":"","thumb_480_w":0,"thumb_480_h":0,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U06BRP8VD/F01QA4XK0DN/untitled","permalink_public":"https://slack-files.com/T03C4RC8V-F01QA4XK0DN-edcf7de551","edit_link":"https://vim-jp.slack.com/files/U06BRP8VD/F01QA4XK0DN/untitled/edit","preview":"/*\n * Execute a command received over \"channel\"/\"part\"\n * \"argv[0]\" is the command string.\n * \"argv[1]\" etc. have further arguments, type is VAR_UNKNOWN if missing.\n */","preview_highlight":"\u003cdiv class=\"CodeMirror cm-s-default CodeMirrorServer\" oncopy=\"if(event.clipboardData){event.clipboardData.setData('text/plain',window.getSelection().toString().replace(/\\u200b/g,''));event.preventDefault();event.stopPropagation();}\"\u003e\n\u003cdiv class=\"CodeMirror-code\"\u003e\n\u003cdiv\u003e\u003cpre\u003e/*\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e * Execute a command received over \u0026quot;channel\u0026quot;/\u0026quot;part\u0026quot;\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e * \u0026quot;argv[0]\u0026quot; is the command string.\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e * \u0026quot;argv[1]\u0026quot; etc. have further arguments, type is VAR_UNKNOWN if missing.\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e */\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","lines":8,"lines_more":3,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":null},{"client_msg_id":"f921b121-bd5a-4465-8b93-61e64f11c495","type":"message","user":"U06BRP8VD","text":"channel/part から受け取って、channel/partに結果を返す、ように書いてあるように見える。","ts":"1614425205.131100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"diGw"}]},{"client_msg_id":"3fad82ef-32f6-427a-a581-2f27776de4d7","type":"message","user":"U06BRP8VD","text":"いまざっくりソースみたんだけども","ts":"1614425171.129800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"zSLVo"}]},{"client_msg_id":"64306d99-3248-4dd9-88b4-f5bafa77328b","type":"message","user":"U776661HA","text":"だめですね。たぶん、そもそも受け取らないですね","ts":"1614425118.129600","thread_ts":"1614425118.129600","reply_count":3,"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"NbRG2"}]},{"client_msg_id":"8dbceb91-2ab7-4da0-ad43-0647b3db16dd","type":"message","user":"U776661HA","text":"\u0026gt;  1の時点でVimは端末取りに行ってない、っていう前提は大丈夫?\nこれは `vim --clean --not-a-term -NnEs` で起動しているので、たぶん\n\n\u0026gt; あと2の時点でVimが受け取って処理が開始されていることも確認済み?\nこれは確認していません。確認自体は `[\"ex\", \"qall!\"]` とか送れば確認できると思います。","ts":"1614424927.129100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"1ew"}]},{"client_msg_id":"8dac3346-ac5c-45f5-8425-1a8286acc7dc","type":"message","user":"U06BRP8VD","text":"あと2の時点でVimが受け取って処理が開始されていることも確認済み?","ts":"1614424790.126800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"/mC"}]},{"client_msg_id":"6974fde8-e077-4729-9902-6a02b98c9e33","type":"message","user":"UAZ33BKV2","text":"専用のvimrcでechoサーバ化(処理するけど)させるとかじゃないといけないでしょうね","ts":"1614424758.126200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Znl"}]},{"client_msg_id":"5ecd6a40-dbf7-4343-8ef2-3f78c02d1024","type":"message","user":"U06BRP8VD","text":"1の時点でVimは端末取りに行ってない、っていう前提は大丈夫?","ts":"1614424747.125800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"31r1"}]},{"client_msg_id":"799de16f-b3ce-4a22-8301-182b24704289","type":"message","user":"U776661HA","text":"という感じです。3. の時に Vim が stdout に `[-1, 2]` を出してくれさえすれば通信できる（はず、ちょっと自信ないです","ts":"1614424712.124300","edited":{"user":"U776661HA","ts":"1614424742.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"pNTj"}]},{"client_msg_id":"7a8f4201-52d7-4fc6-a20f-af7046dbfb49","type":"message","user":"U776661HA","text":"1. A が Vim を起動 (stdin/stdout は PIPE)\n2. A が stdin 経由で Vim に `[\"eval\", \"1 + 1\", -1]` を送信\n3. Vim は stdout に `[-1, 2]` とは *出力しない* ので A は結果を受信できない","ts":"1614424678.123400","edited":{"user":"U776661HA","ts":"1614424686.000000"},"team":"T03C4RC8V","reactions":[{"name":"wakaru","count":1,"users":["U017BU3UZBQ"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Ok6UI"}]},{"client_msg_id":"16df5483-1e46-430d-8e34-8294d08eeb7d","type":"message","user":"U01D44KSY9Z","text":"Vimワンライナー好き","ts":"1614424661.123000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"r/7Z"}]},{"client_msg_id":"d34d44cc-eecc-4b91-87da-46ebec41272f","type":"message","user":"U017BU3UZBQ","text":"stdoutだけならこんな感じでFizzBuzz解いたりしましたが、おしゃべりできる気がしない\n`vim -es +\"for i in range(101)|cal setline(i,i%3==0?i%5==0?'*FizzBuzz*':'Fizz':i%5==0?'Buzz':i)|endfo\" +%p +q!`","ts":"1614424624.121900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"g48s"}]},{"client_msg_id":"84e0ce15-cc1a-4a13-b06b-66066de2bb85","type":"message","user":"U06BRP8VD","text":"Vimからstdoutに出すのは `vim -e` して `echo` するんじゃなかったっけ?","ts":"1614424472.119300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"o9Qw"}]},{"client_msg_id":"b6fa1aff-4bc2-49f2-8eae-b75a033ad7c6","type":"message","user":"U776661HA","text":"それ channel command でやってくれるわけない","ts":"1614424445.118800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"16F/q"}]},{"client_msg_id":"991c6fec-a039-448c-a57d-aa0c9e5e559f","type":"message","user":"U06BRP8VD","text":"ん? よくわかんなくなった。","ts":"1614424439.118500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Bl6f2"}]},{"client_msg_id":"63d92724-30e5-49fe-a88f-ceee5a618246","type":"message","user":"U776661HA","text":"Vim から stdout にダイレクトに出力する方法って確かタイトルをゴニョゴニョするしかなかった気がして...","ts":"1614424429.118200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"H7C"}]},{"client_msg_id":"4e7ec285-8afe-4de4-baaf-e2b22d3366b5","type":"message","user":"U776661HA","text":"たぶんかなり難しいんですよね","ts":"1614424401.117300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"gso8"}]},{"client_msg_id":"78456e76-1d70-45fd-8c07-fc2a91a65b20","type":"message","user":"U017BU3UZBQ","text":":eyes:まさに今やろうとして挫折してたことだ","ts":"1614424290.117000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"T+p"}]},{"client_msg_id":"01bdfe3b-3638-4792-bfe4-f654dc5f0ae2","type":"message","user":"U776661HA","text":"はい。Vimから起動したプロセスと channel command するのではなく Vim を起動したプロセスと channel command がしたい感じです","ts":"1614424162.116400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"oKB"}]},{"client_msg_id":"836672c8-ba42-42cd-a2ed-bdea6be7b910","type":"message","user":"U06BRP8VD","text":"exモードで動かすみたいな?","ts":"1614424085.115700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"f4MDj"}]},{"client_msg_id":"541631b8-fe0e-4023-8e79-9646e4635224","type":"message","user":"U776661HA","text":"Neovim の `--embed --headless` 的な動作があればいいのですが","ts":"1614422469.115400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"yGm"}]},{"client_msg_id":"48ab1d5f-e4d6-44f1-8b3d-a58cf30689ba","type":"message","user":"U776661HA","text":"stdout に結果が出力されないのでうまくいかない。。。","ts":"1614422452.115000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"=Czx"}]},{"client_msg_id":"0cc346d0-1936-446d-a312-a58e27e7b1c1","type":"message","user":"U776661HA","text":"Vim をプロセスとして立ち上げて stdin/stdout で Vim channel command で操作することってできませんか？","ts":"1614422427.114600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"XNqQ="}]},{"client_msg_id":"1d849c11-55a5-4216-93d9-7762d5cca027","type":"message","user":"U9S4G0LJW","text":"これも比較的新しいな \u003chttps://github.com/eliba2/vim-node-inspect\u003e","ts":"1614410267.113600","attachments":[{"fallback":"GitHub: eliba2/vim-node-inspect","id":1,"title":"eliba2/vim-node-inspect","title_link":"https://github.com/eliba2/vim-node-inspect","text":"Interactive node debugger for (n)vim. Contribute to eliba2/vim-node-inspect development by creating an account on GitHub.","thumb_url":"https://avatars.githubusercontent.com/u/5978522?s=400\u0026v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/80588/img/unfurl_icons/github.png","thumb_width":400,"thumb_height":400,"from_url":"https://github.com/eliba2/vim-node-inspect","original_url":"https://github.com/eliba2/vim-node-inspect"}],"team":"T03C4RC8V","reactions":[{"name":"naruhodo","count":1,"users":["U01BY3SDBRS"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"pUzD"}]},{"client_msg_id":"6dfd97ca-7868-4558-8cca-8d54a65f413a","type":"message","user":"U01BY3SDBRS","text":"ありがとうございます、ちょっとやってみます","ts":"1614410260.113400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"s58f"}]},{"client_msg_id":"951a0285-8245-41fc-8527-ff15a9341f3f","type":"message","user":"U9S4G0LJW","text":"Nodeであればこれ使えるって書いてあるな \u003chttps://github.com/puremourning/vimspector\u003e","ts":"1614410205.112700","attachments":[{"fallback":"GitHub: puremourning/vimspector","id":1,"title":"puremourning/vimspector","title_link":"https://github.com/puremourning/vimspector","text":"vimspector - A multi-language debugging system for Vim - puremourning/vimspector","thumb_url":"https://avatars.githubusercontent.com/u/10584846?s=400\u0026v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/80588/img/unfurl_icons/github.png","thumb_width":200,"thumb_height":200,"from_url":"https://github.com/puremourning/vimspector","original_url":"https://github.com/puremourning/vimspector"}],"team":"T03C4RC8V","reactions":[{"name":"grinning","count":1,"users":["U01BY3SDBRS"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"/3BND"}]},{"client_msg_id":"c8eecea0-9fcc-416b-a4b8-3a84d04a035c","type":"message","user":"U9S4G0LJW","text":"単体テストを書いてquickにrunしてるくらい？（参考にならなさそう）","ts":"1614409920.110500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"BPze"}]},{"client_msg_id":"1e132da9-3d50-4d88-b5a9-6436578ead69","type":"message","user":"U01BY3SDBRS","text":"vimでjs書いている方がいればお聞きしたいんですが、デバッグ実行ってどういったプラグイン使ってらっしゃいますか？","ts":"1614409863.109000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"lDo"}]},{"client_msg_id":"b9526ee4-179c-44aa-9846-9c606e014794","type":"message","user":"U776661HA","text":"```export async function withVim(\n  main: (\n    reader: Deno.Reader \u0026amp; Deno.Closer,\n    writer: Deno.Writer,\n  ) =\u0026gt; Promise\u0026lt;void\u0026gt;,\n  options: WithOptions = {},\n) {\n  const timeout = options.timeout ?? DEFAULT_TIMEOUT;\n  const vim = Deno.run({\n    \"cmd\": [\n      \"vim\",\n      \"--clean\",\n      \"--not-a-term\",\n      \"-NnEs\",\n      // \"--cmd\",\n      // `call timer_start(${timeout}, { -\u0026gt; execute('qall!') })`,\n    ],\n    \"stdin\": \"piped\",\n    \"stdout\": \"piped\",\n  });\n  try {\n    await main(inspectReader(vim.stdout), inspectWriter(vim.stdin));\n    await vim.status();\n  } finally {\n    vim.stdin.close();\n    vim.stdout.close();\n    vim.close();\n  }\n}```","ts":"1614425171.129900","thread_ts":"1614425118.129600","parent_user_id":"U776661HA","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Lhbw"}]},{"client_msg_id":"dfaeb5db-364c-43eb-8447-6e180c46e049","type":"message","user":"U776661HA","text":"```Deno.test(\"withVim start vim to communicate with\", async () =\u0026gt; {\n  await withVim(async (reader, writer) =\u0026gt; {\n    const session = new VimSession(reader, writer);\n    session.listen();\n    await session.ex(\"qall!\");\n    // const result = await session.expr(\"1 + 1\");\n    // assertEquals(result, 2);\n    // await session.ex(\"qall!\");\n  });\n});```","ts":"1614425182.130300","thread_ts":"1614425118.129600","parent_user_id":"U776661HA","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"gxG"}]},{"client_msg_id":"9aecb746-16c5-4b87-ab81-e3b37927e383","type":"message","user":"U776661HA","text":"```test withVim start vim to communicate with ... write 14 Uint8Array(14)\n   91, 34, 101, 120,  34,\n   44, 34, 113,  97, 108,\n  108, 33,  34,  93\n] [\"ex\",\"qall!\"]\nここで無限町```","ts":"1614425198.130800","thread_ts":"1614425118.129600","parent_user_id":"U776661HA","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"b5j+"}]}]
