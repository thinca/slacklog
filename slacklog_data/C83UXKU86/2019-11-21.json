[{"client_msg_id":"61613308-3adb-4889-afa8-e6a97d13fd56","type":"message","user":"U6XP9LZ6V","text":"READMEの韓国語訳はとりあえずリンクを入れることになりそう。","ts":"1574287875.104500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UQK71SJ1F","text":"<@UQK71SJ1F> has joined the channel","ts":"1574300844.104700","subtype":"channel_join","replace_original":false,"delete_original":false,"blocks":null},{"client_msg_id":"27cdc5a6-97d1-46d1-81ed-1ee5b6bbb94b","type":"message","user":"U03C6TEAZ","text":"vim の CompleteDone ってタイミング変じゃないです？","ts":"1574303639.105300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"R0GLI"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"bf4dd936-7349-4b30-9c08-abf5948f261b","type":"message","user":"U03C6TEAZ","text":"ポップアップを出して、ポップアップ選択中に次の文字を打つと Done が後から入る。","ts":"1574303675.105900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"G0I"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"dc99bec5-e331-469a-bcfa-0eaa2fec97e3","type":"message","user":"U03C6TEAZ","text":"例えば\n\n```$config-&gt;getSect```\nまでタイプして補完候補に `getSection` が表示されてるタイミングで `(` をタイプすると `(` が先に入ってその後に `CompleteDone` が飛んでくる。","ts":"1574303997.108400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"BBsL"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"abe7ad58-c723-44fc-9b77-74beed461168","type":"message","user":"U03C6TEAZ","text":"逆ですよね。","ts":"1574304003.108600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"pNl"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"e3692fb8-8d0c-4346-abd1-0974725b7ec9","type":"message","user":"U03C6TEAZ","text":"vim-lsp でバグってるので調べてみたらこれが原因だった。","ts":"1574304076.109000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Zp5d4"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"c2eb5b83-5499-4ada-9ef6-2b2befe90913","type":"message","user":"U8R597E9H","text":"あれ、自分は CompleteDone 時点では「CompleteDone のトリガとなった入力」がまだバッファに書き込まれていない。という前提のコードを書いてうまく動いてますね。\n結構動作確認したつもりですが、追試してみます。","ts":"1574304544.112300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"da3cbc3e-c7a8-44a0-a253-c1d61eebc384","type":"message","user":"U03C6TEAZ","text":"あれ、ちゃんと動いてるな。","ts":"1574304717.115600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"E1u"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"01b33f0e-7ddf-4ef2-91a2-cf3ac0c46143","type":"message","user":"U03C6TEAZ","text":"勘違いかも。","ts":"1574304723.116000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ID=V"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a5effca6-99c3-4a9a-85ed-3ea0d9472de5","type":"message","user":"U8R597E9H","text":"ちなみに、トリガとなった入力をキャンセルするために、CompleteDone で getline('.') を保存して、 0ms timer 後に書き戻すこみたいなことしてます。","ts":"1574304726.116200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"c1aa7a86-9a06-42a9-a9c5-005b2d21dab7","type":"message","user":"U03C6TEAZ","text":"それ厳しい感じですね...","ts":"1574304934.116600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"N9Ws"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"852580a6-07bc-436f-b4d6-2b61e5f24f41","type":"message","user":"U8R597E9H","text":"lexima の ( → () みたいな、二文字入るケースを考えるとこれしか浮かばなかったです…\n話はそれますが、lsp の textEdit をまともに動かそうとすると、\n\n1. トリガ文字列の削除\n2. 補完で入った文字列の削除（このケースでは getSection）\n\nが必要でその周りの話でした。","ts":"1574305135.121200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"c5bfa675-d8f8-4f01-a01f-0c06f75198ae","type":"message","user":"U03C6TEAZ","text":"php の language server が補完候補に `getSection($0)` みたいなのを返すけど、vim-lsp ではどう扱えばいいかなー。","ts":"1574305261.124000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"gN8"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"abcd6c92-079a-4f3a-9dcd-83d532e37ab7","type":"message","user":"U8R597E9H","text":"個人的にイベント順序で一番ビックリしたのは、pum が出ていて、pum が閉じるような入力した時に\n\n1. TextChangedP\n2. CompleteDone\n3. InsertCharPre\n\nだったことです。（書きながら、そんわけないよな…と自信なくなってきた…追試しよう）","ts":"1574305308.125000","edited":{"user":"U8R597E9H","ts":"1574305337.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"79f31f6b-0cb9-477d-ad72-512f45fa9c1e","type":"message","user":"U03C6TEAZ","text":"局所的にはこんなアドホックなパッチで直るけど `$0` はどう扱うべきかわからない。\n\n```diff --git a/autoload/lsp/omni.vim b/autoload/lsp/omni.vim\nindex 2d5ce1d..c4cfed4 100644\n--- a/autoload/lsp/omni.vim\n+++ b/autoload/lsp/omni.vim\n@@ -360,6 +360,8 @@ function! s:apply_text_edits() abort\n     \" apply textEdits\n     if !empty(l:all_text_edits)\n         call lsp#utils#text_edit#apply_text_edits(lsp#utils#get_buffer_uri(), l:all_text_edits)\n+        let oldline = getline('.')\n+        call timer_start(0, {x-&gt; [setline('.', oldline),execute('redraw', 1)] })\n     endif\n\n     let l:pos = getpos(\"'a\")```","ts":"1574305330.125500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"pJrUm"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"7f1d9ab5-dc9a-4c16-8a6c-75caf25a0490","type":"message","user":"U8R597E9H","text":"$0 は snippet なので vim-lsp の capability 的には「サーバがそれを返してくるのがバグ」と言えますが、それだと不便なのでものすごくミニマルな snippet 対応入れるのもいいかもなと今ふと思いました。","ts":"1574305468.128500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"67e9f8a5-3481-4aa3-b723-8efd7c40f6e2","type":"message","user":"U03C6TEAZ","text":"textEdit の newText からは取ってしまってもいいかもですね。","ts":"1574305527.129700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"kxIQ"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"855bbb5b-0894-4c63-8b53-56eeb64fc0df","type":"message","user":"U03C6TEAZ","text":"ただしカーソルをそこに動かした方が良さそうですけど。","ts":"1574305542.130300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"NbM/g"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"7a5b115e-3443-434a-923b-c610da640d87","type":"message","user":"U8R597E9H","text":"$[1-9] or ${[1-9].*} は削除。$0 だけそのまま入力して、挿入後に移動するイメージですかね。","ts":"1574305625.131800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"c3eda262-4233-4fcd-b732-20d94ec3d696","type":"message","user":"U8R597E9H","text":"vim-lsp のその周りはほとんど確認してないので見てみよう。","ts":"1574305756.132600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"0d59a6a2-eeee-412e-b610-fad354f5077b","type":"message","user":"U03C6TEAZ","text":"現状こんな感じなんです。","ts":"1574306021.132900","files":[{"id":"FQT7A12SH","created":1574306019,"timestamp":1574306019,"name":"terminal7.gif","title":"terminal7.gif","mimetype":"image/gif","image_exif_rotation":1,"filetype":"gif","pretty_type":"GIF","user":"U03C6TEAZ","mode":"hosted","editable":false,"is_external":false,"external_type":"","size":62221,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-FQT7A12SH/terminal7.gif","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-FQT7A12SH/download/terminal7.gif","original_h":144,"original_w":580,"thumb_64":"https://files.slack.com/files-tmb/T03C4RC8V-FQT7A12SH-40492d4e0b/terminal7_64.png","thumb_80":"https://files.slack.com/files-tmb/T03C4RC8V-FQT7A12SH-40492d4e0b/terminal7_80.png","thumb_160":"https://files.slack.com/files-tmb/T03C4RC8V-FQT7A12SH-40492d4e0b/terminal7_160.png","thumb_360":"https://files.slack.com/files-tmb/T03C4RC8V-FQT7A12SH-40492d4e0b/terminal7_360.png","thumb_360_gif":"https://files.slack.com/files-tmb/T03C4RC8V-FQT7A12SH-40492d4e0b/terminal7_360.gif","thumb_360_w":360,"thumb_360_h":89,"thumb_480":"https://files.slack.com/files-tmb/T03C4RC8V-FQT7A12SH-40492d4e0b/terminal7_480.png","thumb_480_w":480,"thumb_480_h":119,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U03C6TEAZ/FQT7A12SH/terminal7.gif","permalink_public":"https://slack-files.com/T03C4RC8V-FQT7A12SH-e1556af90f","edit_link":"","preview":"","preview_highlight":"","lines":0,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"deanimate_gif":"https://files.slack.com/files-tmb/T03C4RC8V-FQT7A12SH-40492d4e0b/terminal7_deanimate_gif.png","display_as_bot":false,"has_rich_preview":false,"thumb_480_gif":"https://files.slack.com/files-tmb/T03C4RC8V-FQT7A12SH-40492d4e0b/terminal7_480.gif","thumb_tiny":"AwALADDNT74qRvvUmAJyB0DGnMPnNCBbjRx0pRhuMZ96Qj5c09BleaYSGEc5pOnJpx7e9NwN+PWgZ//Z","username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"1kcYZ"}]},{"client_msg_id":"92836fe2-5acb-4c94-9683-2007cf9b5a3e","type":"message","user":"U03C6TEAZ","text":"ようやく分かってきたけど、これは2つ問題が混じってて、1つは↑の様に CompleteDone の後 `(` が挿入される問題、もう1つは `$0` を消さないといけない問題。","ts":"1574306073.134100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"dB8"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"8f968982-6b7a-45c0-bf8d-31d55c654db5","type":"message","user":"U8R597E9H","text":"vim-lsp に PR を適切に投げる的なニュアンスもあって自作クライアンを作りはじめたような節もあるので、自作クライアントのコードをなんとか持っていけないか考えてみます。\nただなあ、この「pum が閉じるきっかけとなった文字列を削除する」かどうかって個人的には怪しいなあと思わなくもないんですよね。\n自作クライアント的には「v:completed_item.word と、textEdit.newText or insertText が違う場合（つまり、補完確定時に何かが追加で展開される場合）だけ、削除するようにしてますが。。。","ts":"1574306297.136900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"21914389-1752-4bae-be7e-5926b93479fa","type":"message","user":"U8R597E9H","text":"_自分がリファクタしたら、`s:on_complete_done` で情報を収集し、0ms timer 後に `s:on_complete_done_after` を呼び、ほとんど `s:on_complete_done_after` で処理するみたいな感じにしそうです。結構おおごと。。。マージされる気がしない。。。_","ts":"1574306419.138500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"84104f11-b861-4a76-88db-4af70d336f19","type":"message","user":"U03C6TEAZ","text":"この挙動が動いてないので現状 php ユーザは text_edit をオフってるはずで、そうなると `\\k` を使うので `$foo` を正しく補完させる為に php ユーザは `set isk+=$` しないといけなくなる。","ts":"1574306460.139200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"lu/KN"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"aa8449e3-1c92-4b18-b742-6f87074081b3","type":"message","user":"U03C6TEAZ","text":"現状 InsertCharPre も入ってるので CompleteDone 直後の文字を入れさせないって方法でもいいかも。","ts":"1574306513.140000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"dOHOP"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"3b7c06c4-af26-420f-860f-b48ecb061ab4","type":"message","user":"U8R597E9H","text":"あー、textEdit or insertText を展開するときだけトリガ文字列を削除する感じにすれば適切に動きそうな気がしてきました。その方針でいけそうかも。","ts":"1574306739.142200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"5b87d0a5-fe8b-429d-84ad-9f89a1a248be","type":"message","user":"U8R597E9H","text":"自作クライアントでも $ 問題は完全には殺せてないんですよね。以前 mattn さんがおっしゃってましたが、lsp の思想と相性が悪い。。。","ts":"1574306792.143100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"de2361bf-4110-4913-b6c3-6e6d847b5530","type":"message","user":"U03C6TEAZ","text":"あと InsertTextFormat  が snippet かどうかを見た方が良さそう。","ts":"1574306882.143400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"z+0"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"82d0091a-1399-4784-8ea0-94585723f11d","type":"message","user":"U8R597E9H","text":"floatwin の PR も何かと大仰になってしまっているし、そっちの対応にフォーカスしてしまってもいいかもしれない。何にせよ余裕を見つけて見てみます。","ts":"1574307378.144300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"08e50a57-42c3-4124-aa92-6797e6e4b070","type":"message","user":"U03C6TEAZ","text":"僕はしばらくは補完まわりに注力します。","ts":"1574307494.144600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Fsj"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"f6443a92-e123-49f5-a1e0-e6ec34ba2b29","type":"message","user":"U03C71D7H","text":"vim-jp でも翻訳を置く機運か…","ts":"1574308255.144900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"KR1M/"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"62e356d3-5dfc-446b-96fe-ce155f245dd3","type":"message","user":"U6XP9LZ6V","text":"置くなら lang-ja かな？","ts":"1574308875.145600","team":"T03C4RC8V","reactions":[{"name":"+1","count":1,"users":["U06BRP8VD"]}],"replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"}]
