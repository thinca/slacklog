[{"client_msg_id":"a5b7dce0-6d26-488f-b444-d1620bcf9568","type":"message","user":"U6XP9LZ6V","text":"lambdaを呼ぶのに関数名から関数を探す必要ないということに気づいた。`call_func()` をいじって 1.42sec -&gt; 1.33sec","ts":"1583397486.303900","team":"T03C4RC8V","reactions":[{"name":"sokudo","count":4,"users":["U03C71D7H","U7JL1UKKL","U0M7GCBPD","U7D5LRRQD"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"HxCj/"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"7f6c7556-7cb4-4161-a53d-fe4630af4444","type":"message","user":"U6XP9LZ6V","text":"lambda、もっと速くできるんじゃねって言われちゃった。\n<https://github.com/vim/vim/pull/5727#issuecomment-594892385>","ts":"1583370783.272700","attachments":[{"fallback":"GitHub: Optimize lambda functions by k-takata · Pull Request #5727 · vim/vim","id":1,"title":"Optimize lambda functions by k-takata · Pull Request #5727 · vim/vim","title_link":"https://github.com/vim/vim/pull/5727#issuecomment-594892385","text":"Currently, lambda functions are slow. (Almost same as normal user functions.) If a lambda is used in map(), it is about 7x slower than a string expression, and about 3x slower than a built-in funct...","thumb_url":"https://avatars0.githubusercontent.com/u/11618545?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/80588/img/unfurl_icons/github.png","thumb_width":48,"thumb_height":48,"from_url":"https://github.com/vim/vim/pull/5727#issuecomment-594892385","original_url":"https://github.com/vim/vim/pull/5727#issuecomment-594892385"}],"team":"T03C4RC8V","reactions":[{"name":"sokudo","count":2,"users":["U9S4G0LJW","U7JL1UKKL"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"0/9"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"942c7e2e-4c78-44d4-b394-d713adb81c84","type":"message","user":"UAZ33BKV2","text":"おおう...","ts":"1583370898.273000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"dSV1r"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"b203228f-1d0d-407b-8a9d-590468360f52","type":"message","user":"U03C6TEAZ","text":"余計な事いっぱいやってますからねw","ts":"1583370910.273400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"mYh"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"887e2025-38a7-4159-a572-d1a6fecdd6f6","type":"message","user":"U03C6TEAZ","text":"`a:000` や `a:firstline` 、`a:lastline` などなど。","ts":"1583370923.273700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"9/us"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"922db4ad-392f-4234-9bc6-458fb6b4d087","type":"message","user":"U03C6TEAZ","text":"<@U7D5LRRQD> 期待されてるようですよ。 <https://www.reddit.com/r/vim/comments/fd91q9/template_string_in_vim_script/>","ts":"1583372893.274100","attachments":[{"fallback":"reddit: template string in Vim script","id":1,"title":"template string in Vim script","title_link":"https://www.reddit.com/r/vim/comments/fd91q9/template_string_in_vim_script/","text":"Posted in r/vim by u/aiya000 • 1 point and 3 comments","thumb_url":"https://b.thumbs.redditmedia.com/lJI6VweGCb8u7D1t0giQTQwaiHg6qhRYoPKjx1kaAqQ.jpg","blocks":null,"service_name":"reddit","service_icon":"http://www.redditstatic.com/desktop2x/img/favicon/apple-icon-57x57.png","thumb_width":140,"thumb_height":93,"from_url":"https://www.reddit.com/r/vim/comments/fd91q9/template_string_in_vim_script/","original_url":"https://www.reddit.com/r/vim/comments/fd91q9/template_string_in_vim_script/"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"4MpGR"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"0aa0a006-5cd4-44ac-94a7-bd4d625c9051","type":"message","user":"U03C6TEAZ","text":"あ、aiya さん自身だったw","ts":"1583372941.274500","thread_ts":"1583372941.274500","reply_count":1,"replies":[{"user":"U7D5LRRQD","ts":"1583377146.279800"}],"team":"T03C4RC8V","reactions":[{"name":"fuita","count":3,"users":["UAZ33BKV2","U7JL1UKKL","U7D5LRRQD"]},{"name":"aiya","count":3,"users":["U9S4G0LJW","U6XP9LZ6V","U7D5LRRQD"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"0iAfN"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"075d85c0-ff5a-47c5-be2f-25648743ae42","type":"message","user":"U6XP9LZ6V","text":"ちょっと試してみたけど、`a:` のセットアップをやめるだけじゃ大して速度変わらなそう。","ts":"1583376858.276200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"wt65z"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"1693813b-b43a-409f-b6ee-14e1975e2e70","type":"message","user":"U03C6TEAZ","text":".oO( そんな気はしていました... )","ts":"1583376916.277300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"86qy"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"ffdd1e3d-27fd-43f9-965d-2e234b32935e","type":"message","user":"U6XP9LZ6V","text":"`a:` に対して `init_var_dict()` を呼ぶのは残したまま、`a:0`, `a:000`, `a:firstline`, `a:lastline` の追加をやらない形。","ts":"1583376971.278100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ZDp"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"65a624e6-cd9e-49c4-8c14-6b2e733f826c","type":"message","user":"U6XP9LZ6V","text":"`init_var_dict()` まで削除したら、メモリ管理がごちゃごちゃになるので…","ts":"1583377031.278900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"s3Q"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"e64a212d-2894-4792-a011-cda1973b3833","type":"message","user":"U6XP9LZ6V","text":"`init_var_dict()` の処理を見てもそんなに重くはなさそうだし","ts":"1583377125.279500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"IFC7b"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"36b015d2-2176-43a5-b275-b7cf22321cce","type":"message","user":"U7D5LRRQD","text":"www","ts":"1583377146.279800","thread_ts":"1583372941.274500","subtype":"thread_broadcast","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"XltY"}],"root":{"client_msg_id":"0aa0a006-5cd4-44ac-94a7-bd4d625c9051","type":"message","user":"U03C6TEAZ","text":"あ、aiya さん自身だったw","ts":"1583372941.274500","thread_ts":"1583372941.274500","reply_count":1,"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"0iAfN"}]}},{"client_msg_id":"46fac7f8-ee35-448f-a22e-a5eab76e6394","type":"message","user":"U7D5LRRQD","text":"期待してるぞ～～あいや","ts":"1583377200.280300","team":"T03C4RC8V","reactions":[{"name":"selfie","count":1,"users":["U03C6TEAZ"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"kM23"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"07e2983b-8152-448a-b0f2-da2cca8aaec9","type":"message","user":"U6XP9LZ6V","text":"1.48sec -&gt; 1.35sec ぐらいにはなったので、まったく効果がないわけではないですが…","ts":"1583377657.281400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Wdh"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"e1edf37d-51c2-40ec-9630-b71f98cfc925","type":"message","user":"U6XP9LZ6V","text":"9%か","ts":"1583377746.281600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"5fqqy"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"148c329d-2493-498a-9959-c0f671963117","type":"message","user":"U9S4G0LJW","text":"結構そういうのが効いてくる気がする","ts":"1583377774.282300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"LAm"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"1a5ea298-f888-40e2-8735-46e6dbe93792","type":"message","user":"UAZ33BKV2","text":"1割は大きいけど難しい所?","ts":"1583377778.282400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"WCn8"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"81500847-ab0e-413b-9d2e-55d1fcb6d7cd","type":"message","user":"U6XP9LZ6V","text":"ちゃんと入れるなら `a:0`, `a:000` を使っているかどうかを判定して、使ってないときは追加しないというようにしないといけないのでかなり面倒。","ts":"1583377894.284200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"oAr"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"07e95a60-1057-4142-95b1-b19d9b657e80","type":"message","user":"U03C6TEAZ","text":"Bram がもっと速くできると言ってる。","ts":"1583377899.284400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"wOU="}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"9ceb33b4-c944-4d37-b5e9-a5c8e34341b1","type":"message","user":"UAZ33BKV2","text":"Bram御大が松岡 修造さんみたいにw","ts":"1583377942.285300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"gQJ2"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"be1e4a72-3f44-41de-8cc8-b08038d1fd3f","type":"message","user":"U6XP9LZ6V","text":"`a:firstline`, `a:lastline` は問答無用で削除でいいんだろうけど","ts":"1583377978.285800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"KkeFN"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"c24226b6-7a69-40af-89ad-312a51020d7f","type":"message","user":"U03C6TEAZ","text":"```let F = {...-&gt; execute('echo a:000', 1) }\ncall F(1,2,3)```\nこんな使い方する人いるんジャマイカ","ts":"1583378104.287000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ZA4gv"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"df736ca8-344f-455f-8ed4-52d3fe5f70f6","type":"message","user":"U6XP9LZ6V","text":"`a:firstline`, `a:lastline` 削除で、1.48sec -&gt; 1.42sec。4%ほど","ts":"1583379212.287700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"UMtrg"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"dd2b81cb-a478-4d33-9313-93bedecb63a0","type":"message","user":"U6XP9LZ6V","text":"現状、range関数ではない通常の関数でも `a:firstline`, `a:lastline` は使えるのか。意味あるんだろうか。","ts":"1583379624.288900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Qsm"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"f6c40e5b-6e53-4750-9d51-678e6578d5de","type":"message","user":"UAZ33BKV2","text":"うっかり参照書いても未定義でエラーしないくらい?","ts":"1583379676.289300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"6R3"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"e11eaa9d-8a3e-4d8e-9a57-597a461cfb01","type":"message","user":"U03C71D7H","text":"むしろエラーになってくれ","ts":"1583379743.289500","team":"T03C4RC8V","reactions":[{"name":"sorena","count":4,"users":["U6XP9LZ6V","UAZ33BKV2","U9S4G0LJW","U7D5LRRQD"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"HnR6n"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"136b67d4-cc4a-4a2c-92b4-fc55fcad8a57","type":"message","user":"UAZ33BKV2","text":"使えないときは、ランタイムエラーになってくれたほうがよさそうですよね","ts":"1583379791.290400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"KRQk"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"e7dd0440-2586-4b45-b807-93803494dc22","type":"message","user":"U03C71D7H","text":"vint が怒ってくれると良さそう","ts":"1583379842.290900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"wpVp"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"6a3062b9-926f-4141-bd13-c1b1be9903d6","type":"message","user":"U6XP9LZ6V","text":"`:1,3call Func()` で呼び出すと、range関数ならば、a:firstline = 1, a:lastline = 3, line(\".\") = 1 が設定された状態で Func() が 1回呼び出されるけど、通常の関数だと、a:firstline = 1, a:lastline = 3 が設定された状態で line(\".\") をインクリメントしながら 3回呼び出されるのか。なんだかなー","ts":"1583380365.293400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"wWp"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"f3a9620e-9b63-4ed7-819d-009798c09ac8","type":"message","user":"U03C71D7H","text":"Vim9script だと range 消すって書いてましたね","ts":"1583380402.293800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"oY8"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"df9e2af8-4c59-497e-b9a5-5496b01e92fc","type":"message","user":"U03C6TEAZ","text":"両方使えていいと思ってる派。","ts":"1583380430.294300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"zL+3k"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"e41cb9e3-4174-443c-9546-26884ce60eda","type":"message","user":"UAZ33BKV2","text":"範囲がわかることでできる事もあるだろうから、もうちょっと上手くいってほしいなあ(そしてフォールバックの行ごと呼び出しは知らずに使ってるの多そう)","ts":"1583380481.295700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"X+H90"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"d05c39e7-bf8b-40a3-b28e-1ac5e551cce2","type":"message","user":"U6XP9LZ6V","text":"vim9scriptは関数の属性が全部消えてますね。closureも無い。","ts":"1583380510.296300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"q=y90"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"27802565-9485-4127-909d-6f3945d248ea","type":"message","user":"U03C71D7H","text":"range 渡す方法が `:call` で関数呼び出すしかないのだよね","ts":"1583380537.296700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"zTK"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"c3325cc7-24e8-42bf-9f53-b5f9862d048c","type":"message","user":"U03C71D7H","text":"`:eval` だと range 渡せない。 `:eval` 完全に上位互換だと思っていたけど range 渡したい場合は `:call` 使わないとダメか","ts":"1583380721.297700","team":"T03C4RC8V","reactions":[{"name":"tiken","count":1,"users":["U6XP9LZ6V"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"lNNEn"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"4102ca5c-80fa-427c-9cab-0b088d334f6f","type":"message","user":"U6XP9LZ6V","text":"vim9scriptでlambdaはどうするんだろう。対応してほしいし、対応するならクロージャーもサポートしてほしい。（通常関数のクロージャー対応はそんなに重要じゃないかな）","ts":"1583381014.299600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"BxXD"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"94605e2c-fae5-4a78-a62b-618a714398db","type":"message","user":"U03C71D7H","text":"closure ほしい","ts":"1583381072.299800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"L/O"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"d7427698-ba67-4b97-9317-1a20d26d78a9","type":"message","user":"U6XP9LZ6V","text":"クロージャー対応するとしたらどんな実装になるんだろう。スタック上にローカル変数を持つのだとダメそうだし、現状と同じように `l:` を用意するのか？（遅くなりそう。）","ts":"1583381625.302000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"GWQ="}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UUWUXB2MN","text":"<@UUWUXB2MN> has joined the channel","ts":"1583385582.302200","subtype":"channel_join","replace_original":false,"delete_original":false,"blocks":null}]
