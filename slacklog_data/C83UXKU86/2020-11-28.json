[{"client_msg_id":"c17212ae-56f7-4767-98fb-5978ab9f26ad","type":"message","user":"U06BRP8VD","text":"ucrt.lib だけしかリンク時に指定してないのに、vcruntime.lib 使うのはどういうからくりなんだろうな? pragma lib かな?","ts":"1606570367.451500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"tzk"}]},{"client_msg_id":"5481c61b-319b-46c1-a437-b86b765a6d13","type":"message","user":"U06BRP8VD","text":"いまみたら vcruntime は memset とかアセンブラで実装してるな…","ts":"1606570019.450300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"/gEsK"}]},{"client_msg_id":"ca71d15b-baf3-4c52-9aa0-503365513dc6","type":"message","user":"U06BRP8VD","text":"Vimがリンクしているライブラリはmsvcrt.libだから、微妙に分からないんですよね。","ts":"1606570000.449700","thread_ts":"1606538506.441100","subtype":"thread_broadcast","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"=ju"}],"root":{"client_msg_id":"228a5671-b432-458e-be30-d9dc99402560","type":"message","user":"U6XP9LZ6V","text":"この辺りのライブラリを調べれば、どの関数がどのdllにリンクされるか分かりそうですが、振り分けの理由はMSに聞かないと分からないですね\n```C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Community\\VC\\Tools\\MSVC\\14.28.29333\\lib\\x64\\vcruntime.lib\nC:\\Program Files (x86)\\Windows Kits\\10\\Lib\\10.0.18362.0\\ucrt\\x64\\ucrt.lib```","ts":"1606538506.441100","thread_ts":"1606538506.441100","reply_count":1,"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Sf3"}]}},{"type":"message","user":"UGMLBL4NN","text":"\u003c@UGMLBL4NN\u003e has left the channel","ts":"1606556529.449400","subtype":"channel_leave","replace_original":false,"delete_original":false,"blocks":null},{"client_msg_id":"2ddda67d-aca2-4b6e-8a5f-e4c2a99e1372","type":"message","user":"U06ECBRTJ","text":"`OPTIMIZE` で変えれた","ts":"1606542948.449100","edited":{"user":"U06ECBRTJ","ts":"1606542960.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"BgkFj"}]},{"client_msg_id":"d4d6d4b8-4ecb-4206-8794-aae9b723178a","type":"message","user":"U06ECBRTJ","text":"```clang: error: unsupported option '-freg-struct-return' for target 'x86_64-w64-windows-gnu```\nうっ…","ts":"1606542734.448700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"5uUE"}]},{"client_msg_id":"69c912b6-2bcf-4d3e-9324-f3875132cc61","type":"message","user":"U06ECBRTJ","text":"なんと","ts":"1606542429.448400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"bgATN"}]},{"client_msg_id":"a70e8b91-8de4-4c37-b4bd-3b19e4d3b41b","type":"message","user":"U6XP9LZ6V","text":"なぜか LDFLAGS じゃない","ts":"1606542403.448200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Orw7"}]},{"client_msg_id":"5c1fd427-4fdd-4a26-8a8d-a75361e9761f","type":"message","user":"U9S4G0LJW","text":"まじか","ts":"1606542374.447800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"rDB8"}]},{"client_msg_id":"41a56fc7-4e8f-4e1c-9755-4b9b5ca5cf8f","type":"message","user":"U6XP9LZ6V","text":"`Make_cyg_ming.mak` では `LFLAGS` になってる罠","ts":"1606542368.447600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"/0YZl"}]},{"client_msg_id":"e22c75b1-8bc0-4538-8a67-1cc20270d002","type":"message","user":"U9S4G0LJW","text":"`LDFLAGS=-fuse-ld=lld` すればいけるはず","ts":"1606542263.446500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"v8tW"}]},{"client_msg_id":"5bce72fe-9451-4d34-b6e5-129e9ec48fce","type":"message","user":"U06ECBRTJ","text":"そっちか あざます","ts":"1606542254.446200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Z3le"}]},{"client_msg_id":"d82ab2a3-16c3-4366-9866-821e50b34862","type":"message","user":"U9S4G0LJW","text":"LDFLAGSじゃないとだめです","ts":"1606542239.445800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"lL=3"}]},{"client_msg_id":"2e28c265-09d7-42f8-a583-79458b5f8bbd","type":"message","user":"U06ECBRTJ","text":"なんとなく、 `CFLAGS` に足すくさいな","ts":"1606542222.445500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"3J8"}]},{"client_msg_id":"37644392-7f54-4ce2-9b2f-b0002c277385","type":"message","user":"U06ECBRTJ","text":"make のオプションにわたすにはどうすれば良いんだっけなぁ…","ts":"1606542066.445000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"14R4"}]},{"client_msg_id":"a142f359-48bd-45d1-936b-1387d2d78f98","type":"message","user":"U6XP9LZ6V","text":"上に書いたように gcc や clang から lld を使うには `-fuse-ld=lld` を指定します。","ts":"1606541998.444500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"zlbn4"}]},{"client_msg_id":"184f33e8-46d7-4a84-871e-6cfd01fba5b9","type":"message","user":"U9S4G0LJW","text":"clangは必ずしもlldとペアというわけではないけどそういうことではなく？","ts":"1606541971.444000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"/3xen"}]},{"client_msg_id":"fc4d7bc2-48c5-478c-b6c5-9dbdf5377bfa","type":"message","user":"U06ECBRTJ","text":"あれ、mingw だと lld いらない…？ リンカ使ってないんですかね","ts":"1606541935.443400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"i5n0"}]},{"client_msg_id":"5c19b538-3b8f-4b36-b9a1-96388d79fdd5","type":"message","user":"U06ECBRTJ","text":"ありましたね clang と一緒に入るかと思ってました","ts":"1606541701.442800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"kCCEt"}]},{"client_msg_id":"c4a85740-01e0-44f5-9c7c-5637dc9beb08","type":"message","user":"U6XP9LZ6V","text":"`pacboy -S lld:m` で入りますよ","ts":"1606541490.442400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"soQ"}]},{"client_msg_id":"54d154f1-28e5-462b-9c34-277c13ba27f6","type":"message","user":"U06ECBRTJ","text":"lld が msys2/mingw-x64 に無い…","ts":"1606541431.441800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"+AYu"}]},{"type":"message","user":"ULXMF1BC1","text":"\u003c@ULXMF1BC1\u003e has joined the channel","ts":"1606540512.441300","subtype":"channel_join","replace_original":false,"delete_original":false,"blocks":null},{"client_msg_id":"228a5671-b432-458e-be30-d9dc99402560","type":"message","user":"U6XP9LZ6V","text":"この辺りのライブラリを調べれば、どの関数がどのdllにリンクされるか分かりそうですが、振り分けの理由はMSに聞かないと分からないですね\n```C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Community\\VC\\Tools\\MSVC\\14.28.29333\\lib\\x64\\vcruntime.lib\nC:\\Program Files (x86)\\Windows Kits\\10\\Lib\\10.0.18362.0\\ucrt\\x64\\ucrt.lib```","ts":"1606538506.441100","thread_ts":"1606538506.441100","reply_count":1,"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Sf3"}]},{"client_msg_id":"c827bded-df81-454d-949f-ffb3aa91d9e1","type":"message","user":"U06BRP8VD","text":"まあわすれよう","ts":"1606537356.437300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"31Mq"}]},{"client_msg_id":"6c10fabc-a6f2-4c6c-b801-bff96d8203bf","type":"message","user":"U06BRP8VD","text":"とりあえず `cl /MD test.c` みたいにして何も考えずにやっただけなんだけども。","ts":"1606536723.436900","edited":{"user":"U06BRP8VD","ts":"1606536864.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"3m8"}]},{"client_msg_id":"33c083dd-1e22-4cce-8a2b-cd5c1b00b690","type":"message","user":"U06BRP8VD","text":"で、それがどの子にリンクするかは…リンカの仕事かね?","ts":"1606536706.436400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"5AqkS"}]},{"client_msg_id":"00d3e1cf-02cf-4b24-9629-9657afc55f09","type":"message","user":"U06BRP8VD","text":"memory.hとかstring.hはWinSDKのucrtに入ってるんだけど、そいつがVS2019の持ってる vcruntime_string.h を呼ぶことで memset が使えるようになってるらしい。","ts":"1606536685.435900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"tK+ZX"}]},{"client_msg_id":"2eae3ef4-9cc5-4eb9-b27b-f520af83f2e4","type":"message","user":"U06BRP8VD","text":"いまヘッダー追ってたんだけど、","ts":"1606536634.434900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"f+y"}]},{"type":"message","user":"U6XP9LZ6V","text":"forwardしてるだけ","ts":"1606536451.434500","files":[{"id":"F01FW84U4NQ","created":1606536415,"timestamp":1606536415,"name":"image.png","title":"image.png","mimetype":"image/png","image_exif_rotation":0,"filetype":"png","pretty_type":"PNG","user":"U6XP9LZ6V","mode":"hosted","editable":false,"is_external":false,"external_type":"","size":16331,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F01FW84U4NQ/image.png","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F01FW84U4NQ/download/image.png","original_h":575,"original_w":470,"thumb_64":"https://files.slack.com/files-tmb/T03C4RC8V-F01FW84U4NQ-6cd1bccc0e/image_64.png","thumb_80":"https://files.slack.com/files-tmb/T03C4RC8V-F01FW84U4NQ-6cd1bccc0e/image_80.png","thumb_160":"https://files.slack.com/files-tmb/T03C4RC8V-F01FW84U4NQ-6cd1bccc0e/image_160.png","thumb_360":"https://files.slack.com/files-tmb/T03C4RC8V-F01FW84U4NQ-6cd1bccc0e/image_360.png","thumb_360_gif":"","thumb_360_w":294,"thumb_360_h":360,"thumb_480":"https://files.slack.com/files-tmb/T03C4RC8V-F01FW84U4NQ-6cd1bccc0e/image_480.png","thumb_480_w":392,"thumb_480_h":480,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U6XP9LZ6V/F01FW84U4NQ/image.png","permalink_public":"https://slack-files.com/T03C4RC8V-F01FW84U4NQ-ade3103cbb","edit_link":"","preview":"","preview_highlight":"","lines":0,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"thumb_tiny":"AwAwACe2bePnj+dH2dBjI/ImpD3/AApW+6tO7CxGbZD2/Wk+ypj7v6mpk6GnUXYrFf7LHjO39TR9ni/u/rU5+7TaLsLDHLZIC5HHehmc4/dgf8Cpx6n6ClftQMSNm6FMD1zUh6UifdpT0pAIfu02nH7tNoAXbnnNGz3NKG4o3UAABHehlyDg4NN8wehpd/saAFPC02jeDxg0maAP/9k=","username":""}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"d8B"}]},{"client_msg_id":"544f26ca-62e6-4130-85b6-b215f5ceb374","type":"message","user":"U6XP9LZ6V","text":"あー、ほんとだ","ts":"1606536306.434200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Ceu3P"}]},{"client_msg_id":"031857b0-72fc-4e21-9058-0c21bcef5fca","type":"message","user":"U06BRP8VD","text":"api-ms-win-crt-string-l1-1-0.dll からみると memcpy_s しかないんですよ。でVimはまずこっちにリンクしてから ucrtbaseに繋がってるみたい。","ts":"1606536186.434000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Z1m=a"}]},{"client_msg_id":"012db854-2eac-46b0-8fe3-090695f2c8a2","type":"message","user":"U06BRP8VD","text":"これ普通にpathに含まれてるwhitespaceを`\\\\`でエスケープし忘れてただけだった:syobon:","ts":"1606536118.433000","thread_ts":"1606535949.432500","subtype":"thread_broadcast","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"rRmQK"}],"root":{"client_msg_id":"fba940a9-2cf4-417f-938e-05658ebbfc31","type":"message","user":"U06BRP8VD","text":"…そして gf で path にあるファイルが開けない事態になってて???ってなってるどうして","ts":"1606535949.432500","thread_ts":"1606535949.432500","reply_count":1,"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"piH"}]}},{"client_msg_id":"5496896a-1a7d-46d9-8e8e-b925e79dea9b","type":"message","user":"U6XP9LZ6V","text":"ucrtbased.dll のエクスポートされている関数名を見ると、memcpy_s も memcpy もありますね。\nvcruntime140.dll には memcpy はあるけど memcpy_s はない。","ts":"1606536006.432900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"XFgL"}]},{"client_msg_id":"fba940a9-2cf4-417f-938e-05658ebbfc31","type":"message","user":"U06BRP8VD","text":"…そして gf で path にあるファイルが開けない事態になってて???ってなってるどうして","ts":"1606535949.432500","thread_ts":"1606535949.432500","reply_count":1,"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"piH"}]},{"client_msg_id":"63eb4f5f-9044-4a67-97ef-d984c9ae3f9d","type":"message","user":"U06BRP8VD","text":"そしてmemcpy_s は UCRT にあるんですけどmemcpyはないみたい。","ts":"1606535481.430300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"KIMzk"}]},{"client_msg_id":"043622e8-8bb7-44ad-98ef-e16fc1cdc768","type":"message","user":"U06BRP8VD","text":"vimの場合でいうとmemcpyとかmemsetがVCRUTIME140.dllに繋がってるんですよね。\n\nでmemsetそのものはUCRTにもある。","ts":"1606535437.429500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"I6oP"}]},{"client_msg_id":"67acce2f-2a3a-43bd-99e7-1268f8c23868","type":"message","user":"U6XP9LZ6V","text":"一応、コンパイラのバージョンに非依存の部分はUCRTとしてOSの一部として提供されて、依存部分はvcruntimeXXX.dllとして提供されるという扱いですが、何をもってバージョン依存部分と非依存部分を分けているのかはよく分からないですね。","ts":"1606535329.428700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Jy73F"}]},{"client_msg_id":"b343b082-7127-40a3-9ade-989f466c5d37","type":"message","user":"U03C6TEAZ","text":"msvc のリンカはいろいろやってるんですよね。なんかをオフったら速くなったはず。","ts":"1606534955.425500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"tdQ"}]},{"client_msg_id":"48b035a3-4acf-4c03-989d-9cccea8d9142","type":"message","user":"U06BRP8VD","text":"提供方法が違うのはわかるんだけど、コンパイル時にどっちが使われるのか、というよりもMSVCRT(140)がいまだに必要な場合がどんなときかがわからない。","ts":"1606534807.423800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"jr3s1"}]},{"client_msg_id":"2df108c9-f500-4396-92f2-82a77c30d788","type":"message","user":"U06BRP8VD","text":"UCRTとMSVCRT(140)の関係がわからない。","ts":"1606534715.423100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"CnL0D"}]},{"client_msg_id":"32994c21-4c79-40cf-b46f-bf54cba6af0d","type":"message","user":"U6XP9LZ6V","text":"お、今試したら `-fuse-ld=lld` を付けたら gcc でも clang でも普通に lld 経由で PE 形式出力できた。\ngcc 10.2.0\nclang 11.0.0\nlld 11.0.0","ts":"1606534418.422300","thread_ts":"1606531644.404200","subtype":"thread_broadcast","reactions":[{"name":"tada","count":2,"users":["U06BRP8VD","U06ECBRTJ"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"fsQUF"}],"root":{"client_msg_id":"7c312501-49f0-449a-819e-3bcb71cdb8c0","type":"message","user":"U6XP9LZ6V","text":"gcc/clang に `-fuse-ld=lld` を指定して lld を使おうとしたら、確か lld が PE 形式の出力には対応していないみたいな文句を言ったような記憶。","ts":"1606531644.404200","thread_ts":"1606531644.404200","reply_count":2,"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"KOu"}]}},{"client_msg_id":"cbe3d5d3-bcca-4535-97e3-1adb86ced3b0","type":"message","user":"U06BRP8VD","text":"うーんわかんないな","ts":"1606534157.422200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"sTsG3"}]},{"client_msg_id":"c53d1a9c-a1a3-43d5-8ae7-9fd0b33f9509","type":"message","user":"U06BRP8VD","text":"お、memsetに限ればcrtにあるな","ts":"1606533614.421900","edited":{"user":"U06BRP8VD","ts":"1606533636.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"4ITGQ"}]},{"client_msg_id":"408d9300-3b2a-46c6-af48-849da60aeff2","type":"message","user":"U06BRP8VD","text":"memcpy_s とかは crt のほうに入ってるから、セキュアじゃない法はvcruntime140に倒してるのかしらね。","ts":"1606533581.421700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"9irfj"}]},{"client_msg_id":"169c9705-e5bd-4a05-95fa-8ba73d6dabee","type":"message","user":"UAZ33BKV2","text":"ふしぎ","ts":"1606533502.421000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"eRwT"}]},{"client_msg_id":"6c01da59-63c6-4add-beb5-70b03c1151f1","type":"message","user":"U06BRP8VD","text":"↑はvim.exeのほうだったんだけど、vim64.dllのほうみてみると memmoveとかmemcmpとかstring.hの中身がVCRUNTIME140.dllっぽいな…","ts":"1606533434.420100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Tejq"}]},{"client_msg_id":"c0cb51c5-b54c-431a-8f66-1391a777ebf3","type":"message","user":"U06BRP8VD","text":"なんでmemsetだけVCRUNTIME140.dllなんだ?","ts":"1606533312.419000","files":[{"id":"F01FM00BHGV","created":1606533311,"timestamp":1606533311,"name":"Untitled","title":"Untitled","mimetype":"text/plain","image_exif_rotation":0,"filetype":"text","pretty_type":"プレーンテキスト","user":"U06BRP8VD","mode":"snippet","editable":true,"is_external":false,"external_type":"","size":395,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F01FM00BHGV/untitled","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F01FM00BHGV/download/untitled","original_h":0,"original_w":0,"thumb_64":"","thumb_80":"","thumb_160":"","thumb_360":"","thumb_360_gif":"","thumb_360_w":0,"thumb_360_h":0,"thumb_480":"","thumb_480_w":0,"thumb_480_h":0,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U06BRP8VD/F01FM00BHGV/untitled","permalink_public":"https://slack-files.com/T03C4RC8V-F01FM00BHGV-07fcf9c053","edit_link":"https://vim-jp.slack.com/files/U06BRP8VD/F01FM00BHGV/untitled/edit","preview":"    VCRUNTIME140.dll\n             140002080 Import Address Table\n             1400028A0 Import Name Table\n                     0 time date stamp\n                     0 Index of first forwarder reference","preview_highlight":"\u003cdiv class=\"CodeMirror cm-s-default CodeMirrorServer\" oncopy=\"if(event.clipboardData){event.clipboardData.setData('text/plain',window.getSelection().toString().replace(/\\u200b/g,''));event.preventDefault();event.stopPropagation();}\"\u003e\n\u003cdiv class=\"CodeMirror-code\"\u003e\n\u003cdiv\u003e\u003cpre\u003e    VCRUNTIME140.dll\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e             140002080 Import Address Table\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e             1400028A0 Import Name Table\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e                     0 time date stamp\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e                     0 Index of first forwarder reference\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","lines":10,"lines_more":5,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"pjGLy"}]},{"client_msg_id":"b72290d2-3607-4c7d-875d-51b72569c20c","type":"message","user":"UAZ33BKV2","text":"はっやい","ts":"1606533111.418900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"jc0"}]},{"client_msg_id":"1c8987d5-2171-4a9d-a817-dbcb88d64e79","type":"message","user":"U06BRP8VD","text":"vim64.dllのサイズは3.7MB","ts":"1606532977.418700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"yvXYP"}]},{"type":"message","user":"U06BRP8VD","text":"VS2019すごい。コンパイラとリンカ、それぞれCPU使い切ってるのがくっきりわかる。所要時間はLTOありで19秒","ts":"1606532954.418200","files":[{"id":"F01FHAE0RKQ","created":1606532916,"timestamp":1606532916,"name":"image.png","title":"image.png","mimetype":"image/png","image_exif_rotation":0,"filetype":"png","pretty_type":"PNG","user":"U06BRP8VD","mode":"hosted","editable":false,"is_external":false,"external_type":"","size":92615,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F01FHAE0RKQ/image.png","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F01FHAE0RKQ/download/image.png","original_h":842,"original_w":659,"thumb_64":"https://files.slack.com/files-tmb/T03C4RC8V-F01FHAE0RKQ-3445f78370/image_64.png","thumb_80":"https://files.slack.com/files-tmb/T03C4RC8V-F01FHAE0RKQ-3445f78370/image_80.png","thumb_160":"https://files.slack.com/files-tmb/T03C4RC8V-F01FHAE0RKQ-3445f78370/image_160.png","thumb_360":"https://files.slack.com/files-tmb/T03C4RC8V-F01FHAE0RKQ-3445f78370/image_360.png","thumb_360_gif":"","thumb_360_w":282,"thumb_360_h":360,"thumb_480":"https://files.slack.com/files-tmb/T03C4RC8V-F01FHAE0RKQ-3445f78370/image_480.png","thumb_480_w":376,"thumb_480_h":480,"thumb_720":"https://files.slack.com/files-tmb/T03C4RC8V-F01FHAE0RKQ-3445f78370/image_720.png","thumb_720_w":564,"thumb_720_h":720,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U06BRP8VD/F01FHAE0RKQ/image.png","permalink_public":"https://slack-files.com/T03C4RC8V-F01FHAE0RKQ-dd2004b38d","edit_link":"","preview":"","preview_highlight":"","lines":0,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"thumb_800":"https://files.slack.com/files-tmb/T03C4RC8V-F01FHAE0RKQ-3445f78370/image_800.png","thumb_800_h":800,"thumb_800_w":626,"thumb_tiny":"AwAwACXSxjJozxQelA6UAHWkHP8A+ulXpQKAE9aWkHU0tAAehoHSg9DQOlAAvShaF6UgoAUdTRSDqaWmID0NA6UHoaO1IYL0pFpV6Ui0CAdTS0g6mlpgf//Z","username":""}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Dov"}]},{"type":"message","user":"U01AQ5BFNLX","text":"\u003c@U01AQ5BFNLX\u003e has joined the channel","ts":"1606532775.417300","subtype":"channel_join","replace_original":false,"delete_original":false,"blocks":null},{"client_msg_id":"e3f71dee-d92f-4973-91f5-14400e8ac03f","type":"message","user":"U06BRP8VD","text":"まだいってなかったのか、とのそしりを免れない","ts":"1606532761.417100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"6D7"}]},{"client_msg_id":"e9d9bf63-a00c-458b-b1c0-d15c8da37bca","type":"message","user":"U06BRP8VD","text":"んーそろそろVS2019いってみますかぁw (いまさらかん","ts":"1606532740.416800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Bwbdc"}]},{"client_msg_id":"279407e7-fe6a-4650-a976-bd39e990019e","type":"message","user":"U06BRP8VD","text":"あ、このニュースはみたことあるな。","ts":"1606532718.416500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"a1lrC"}]},{"client_msg_id":"9eda5b4f-5d30-4e81-be4a-71c1d7cc5be7","type":"message","user":"U6XP9LZ6V","text":"\u003chttps://devblogs.microsoft.com/cppblog/the-coalition-sees-27-9x-iteration-build-improvement-with-visual-studio-2019/\u003e","ts":"1606532607.416200","attachments":[{"fallback":"C++ Team Blog: The Coalition Sees 27.9X Iteration Build Improvement with Visual Studio 2019 | C++ Team Blog","id":1,"title":"The Coalition Sees 27.9X Iteration Build Improvement with Visual Studio 2019 | C++ Team Blog","title_link":"https://devblogs.microsoft.com/cppblog/the-coalition-sees-27-9x-iteration-build-improvement-with-visual-studio-2019/","text":"Visual Studio 2019 v16.8 Preview 3.2 introduces significant build and link time improvements. In this blog post, we detail how the team in The Coalition building Gears 5 tested the compile and link times in three different versions of Visual Studio. The experiment was conducted to measure not only overall end-to-end time improvements but also link time improvements in the preview compared to the current release. Using Visual Studio 2019, the team saw 2.67x faster end-to-end build times and 27.9x faster link times compared to Visual Studio 2017. ","image_url":"https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2020/11/Gears5_2020_Optimized_1920x1080_Clean.jpg","fields":[{"title":"Written by","value":"David Li","short":true},{"title":"Est. reading time","value":"4 minutes","short":true}],"blocks":null,"ts":1605560425,"service_name":"C++ Team Blog","service_icon":"https://devblogs.microsoft.com/cppblog/wp-content/uploads/sites/9/2018/10/Microsoft-Favicon.png","from_url":"https://devblogs.microsoft.com/cppblog/the-coalition-sees-27-9x-iteration-build-improvement-with-visual-studio-2019/","original_url":"https://devblogs.microsoft.com/cppblog/the-coalition-sees-27-9x-iteration-build-improvement-with-visual-studio-2019/"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Teuc"}]},{"client_msg_id":"a6b8924b-3cbe-4c78-8984-a4333a469b1f","type":"message","user":"U06BRP8VD","text":"全然使われているように見えなかった…","ts":"1606532583.415700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"quhf"}]},{"client_msg_id":"f0376932-ccfe-4ff3-9a16-4000b280b4f6","type":"message","user":"U06BRP8VD","text":"およ? lld-link にはこんなオプションあるな…\n\n```$ lld-link -help | grep thread\n  /threads:\u0026lt;value\u0026gt;        Number of threads. '1' disables multi-threading. By default all available hardware threads are used```","ts":"1606532532.414800","edited":{"user":"U06BRP8VD","ts":"1606532559.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"8ktZV"}]},{"client_msg_id":"2d833e4a-21aa-41c9-a12a-a33129dba2fb","type":"message","user":"U06BRP8VD","text":"なるほど。/MPはプロセス数でこっちはスレッド数か。なのであんま大きくてもしかたなろうと。","ts":"1606532424.414400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"vvjN+"}]},{"client_msg_id":"20a636a4-5d39-4dd4-9015-a988ef5ee45e","type":"message","user":"U06BRP8VD","text":"\u0026gt; Sets the number of cl.exe threads to use for optimization and code generation when link-time code generation is specified\nビンゴでは? 最大8なのが???だけども。","ts":"1606532316.413700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"CN3"}]},{"client_msg_id":"9ae938e1-410a-4c0d-bfef-eded39100152","type":"message","user":"U06BRP8VD","text":"ああんなんか2015からは新しいオプションがあるぅ\n\u003chttps://docs.microsoft.com/ja-jp/cpp/build/reference/cgthreads-compiler-threads?view=msvc-160\u003e","ts":"1606532294.413300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"IVU"}]},{"client_msg_id":"0c65f7de-b259-4bfc-89de-beb2f43e4789","type":"message","user":"U06BRP8VD","text":"リンカもマルチコア対応してたりしないのかなぁ。ちょっとドキュメントながめるか","ts":"1606532198.412900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"PBZ"}]},{"client_msg_id":"da3cbed1-52d9-4915-ae33-45bc235e7f54","type":"message","user":"UAZ33BKV2","text":"すごい","ts":"1606532175.412500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"LQK"}]},{"client_msg_id":"ad183375-4900-4e18-9787-a696cc15e032","type":"message","user":"U06BRP8VD","text":"ほんの数秒だけど16コア使いきったわ。","ts":"1606532165.412300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"zqq=z"}]},{"client_msg_id":"1e05aa77-cecb-4f4e-8eed-aa5dbd0a510a","type":"message","user":"U06BRP8VD","text":"linkやっぱ、シングルコアだな。clはもうマルチコアがぶん回って一瞬でコンパイル終わらせてる。","ts":"1606532140.412000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"VnIr"}]},{"client_msg_id":"533d0da2-1138-425f-8603-992664fa0706","type":"message","user":"UAZ33BKV2","text":"なるほど","ts":"1606532107.411400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"LrTE"}]},{"client_msg_id":"177ff6f6-5b15-4675-b47f-1b4a52eed529","type":"message","user":"U06BRP8VD","text":"いや2015使ったことないのでわからないのですよ。","ts":"1606532098.411100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"qgdG"}]},{"client_msg_id":"0a056f9d-844c-469e-b914-15cf7e0d8ca3","type":"message","user":"UAZ33BKV2","text":"あれ、一旦遅くなったことがある?","ts":"1606532086.410800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ejX"}]},{"client_msg_id":"91f790d4-272b-4c9a-8c0a-d2dfdd535b97","type":"message","user":"U06BRP8VD","text":"(2015で遅くなったのが元に戻っただけだったら悲しい","ts":"1606532054.410300","edited":{"user":"U06BRP8VD","ts":"1606532080.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"kNr"}]},{"client_msg_id":"91765150-ede6-47be-a933-0d0390ed17a1","type":"message","user":"U06BRP8VD","text":"VC2010と比べたら雲泥の差を体験できるかしら?","ts":"1606532046.410000","edited":{"user":"U06BRP8VD","ts":"1606532052.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"09F8"}]},{"client_msg_id":"658e3e3e-5ba7-43f3-86aa-3c58d772bfe9","type":"message","user":"U06BRP8VD","text":"まじか","ts":"1606532028.409600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ywtn"}]},{"client_msg_id":"85761d92-39a9-4884-b634-081785431eb6","type":"message","user":"U6XP9LZ6V","text":"しばらく前に VC2015 に比べて VC2019 のリンカは非常に速くなったという記事がありましたね。.pdb の生成が特に速くなったとか。","ts":"1606531973.409400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"WZtH"}]},{"client_msg_id":"1c5a121b-335e-4927-a7e0-f326e08f2f3d","type":"message","user":"U06BRP8VD","text":"そしてMSのコンパイラが謎の速さ。デフォでマルチコア使うからだとは思うけども… ただこの結論は10年以上前に確認したときと一緒のような記憶がw","ts":"1606531836.407300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ct8qV"}]},{"client_msg_id":"c4ff2454-6a8a-45d6-8720-d642e7fa9d50","type":"message","user":"U06BRP8VD","text":"そしてMSのリンカも案外速いことがわかった。まぁVimそんな大きくないからかな。","ts":"1606531774.406100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"lSBe"}]},{"client_msg_id":"b8af67fd-ad4c-4092-aaa2-6bf382dd6d7c","type":"message","user":"U06BRP8VD","text":"clang-cl はほぼclのオプションそのまま受け付けてCOFF吐いてくれるし、lld-linkもlinkのオプションそのままでPE吐いてくれて便利。","ts":"1606531752.405500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"3W3"}]},{"client_msg_id":"1fe20b7c-38e9-47f2-9da9-5fe3348a77ba","type":"message","user":"U06BRP8VD","text":"clang-cl に -flto 渡すと link ではリンクできないみたい。まぁこれは当然と言えば当然。なのでLTO完全に切ってやって1min28sec","ts":"1606531694.404600","edited":{"user":"U06BRP8VD","ts":"1606531712.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"4=V"}]},{"client_msg_id":"7c312501-49f0-449a-819e-3bcb71cdb8c0","type":"message","user":"U6XP9LZ6V","text":"gcc/clang に `-fuse-ld=lld` を指定して lld を使おうとしたら、確か lld が PE 形式の出力には対応していないみたいな文句を言ったような記憶。","ts":"1606531644.404200","thread_ts":"1606531644.404200","reply_count":2,"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"KOu"}]},{"client_msg_id":"55672c7b-6267-4411-848c-72ef021235bb","type":"message","user":"U06BRP8VD","text":"複雑になるけどなんだかんだ「LTO切ればリンクは速くなる」という当然の結果に落ち着きそうw","ts":"1606531608.403500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"gfOv"}]},{"client_msg_id":"fbafc215-ee3b-408f-b148-1c1aa53ae1fa","type":"message","user":"U06BRP8VD","text":"Vimは例によってちょっと古い版を使ってるんだけど `size = size;` っていう何をしてんだかよくわからない文が検出されてるw","ts":"1606531568.402300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Lcz4f"}]},{"client_msg_id":"1929ac4e-08e8-45b5-8aca-6dee69316a84","type":"message","user":"UAZ33BKV2","text":"組合せ表がなかなか大変なことに","ts":"1606531568.402200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"dWpLM"}]},{"client_msg_id":"0fdb8be0-4d73-44f2-9640-1bf0e9942306","type":"message","user":"U06BRP8VD","text":"ああそれを試しはじめて今は clang-cl + link でどうなるかみようとしてる","ts":"1606531451.399900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"RR8C"}]},{"client_msg_id":"4700d164-f95e-4595-8e14-ab6bfa5df727","type":"message","user":"U06BRP8VD","text":"ですです。","ts":"1606531418.399400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Yqqps"}]},{"client_msg_id":"533bf813-3e82-4087-9c90-5d63e9fa9723","type":"message","user":"U6XP9LZ6V","text":"ああ、cl の代わりに clang-cl を使って、link の代わりに lld-link ですか？","ts":"1606531412.399200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"93E"}]},{"client_msg_id":"1702046f-2608-4dd2-ae4e-07a7c0d6dea5","type":"message","user":"U06BRP8VD","text":"まぁUNIX系のアプローチのが正しいよなぁ。MSVCのclはなんかおかしいもの。","ts":"1606531404.399000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"cV/"}]},{"client_msg_id":"f9ad75e9-b1f6-467b-a492-3eb7504b9204","type":"message","user":"U06BRP8VD","text":"せっかくだからclangでコンパイルしてmsvcリンカでリンクするのもやってみますかね…","ts":"1606531283.396900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"0rjY"}]},{"client_msg_id":"ab2b604b-c3c9-48dc-bf7b-b10899886bdf","type":"message","user":"U6XP9LZ6V","text":"gcc も clang もコンパイラ自体は並列処理してくれないので、make に -j を付けて並列処理させる必要があります。","ts":"1606531266.396500","team":"T03C4RC8V","reactions":[{"name":"desune","count":1,"users":["U06BRP8VD"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"gM2"}]},{"client_msg_id":"ae4b59bc-d6ec-42ef-8413-7780a82ef8cb","type":"message","user":"U06BRP8VD","text":"基本既存ツールを差し替えるレイヤあるみたいですよ。","ts":"1606531253.396300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"XuxP"}]},{"client_msg_id":"4e80e487-9a0f-4ed8-b0e1-85aeb7d5edbf","type":"message","user":"UAZ33BKV2","text":"今はどうなんだろ","ts":"1606531236.395900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"0Fyx"}]},{"client_msg_id":"86173e94-4fc2-4878-9d12-cc17fbcf7c56","type":"message","user":"UAZ33BKV2","text":"ちょっと古い記事、そしてlldがところどころlddになってるけど\n\u003chttps://www.infoq.com/jp/news/2017/03/lld-coming-in-llvm-4/\u003e\nで\n\u0026gt; LDDのコンパイルが完了すれば、それを使用する最も確実な方法は、`ld`を`ld.lld`にシンボリックリンクすることだ。この方法ならばGCCでも動作する。あるいはLLVM `-fuse-ld=lld`オプションを使用すれば、シンボリックリンクの必要はない。\nだそうで(これ効くのか?)","ts":"1606531224.395500","attachments":[{"fallback":"InfoQ: LLVMの新しいリンカLLDがLLVM 4で導入へ","id":1,"title":"LLVMの新しいリンカLLDがLLVM 4で導入へ","title_link":"https://www.infoq.com/jp/news/2017/03/lld-coming-in-llvm-4/","text":"GCCのldを大幅に性能改善したLDDが、近くLLVM 4 rc1に組み込まれ、デフォルトで使用されるようになる。この新しいリンカは、稼働中のFreeBSD/amd64ベースのシステムではすでに使用されているが、LLVMでの利用はまだ試験段階であり、問題が発生すればrc2では保留される可能性もある。","image_url":"https://cdn.infoq.com/statics_s1_20201020-0324/styles/static/images/logo/logo-big.jpg","blocks":null,"service_name":"InfoQ","service_icon":"https://cdn.infoq.com/statics_s1_20201020-0324/apple-touch-icon.png","from_url":"https://www.infoq.com/jp/news/2017/03/lld-coming-in-llvm-4/","original_url":"https://www.infoq.com/jp/news/2017/03/lld-coming-in-llvm-4/"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"7v51a"}]},{"client_msg_id":"f1a1d861-1fc8-4e46-9de2-e671085c82d7","type":"message","user":"U06BRP8VD","text":"僕が試したのはココにあるWindows (64-bit)で、オプション調整とか要るけどMSVCの代替でうまく動いた。\n\n\u003chttps://releases.llvm.org/download.html\u003e","ts":"1606531212.394700","thread_ts":"1606531041.391300","subtype":"thread_broadcast","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Amkmq"}],"root":{"client_msg_id":"a6b12bb3-8cad-486f-84b7-3384913ce6ec","type":"message","user":"U6XP9LZ6V","text":"そういえば以前、MinGW で gcc or clang でコンパイルして、リンクには lld を使ってみようとしたが上手くいかなかった。やり方あるのかな？","ts":"1606531041.391300","thread_ts":"1606531041.391300","reply_count":1,"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"mrIc+"}]}},{"client_msg_id":"2f6ecf65-6ba0-4b20-b2a0-66fbdf92aeef","type":"message","user":"UAZ33BKV2","text":"さらに大きくなりましたー","ts":"1606531113.393400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"WR3"}]},{"client_msg_id":"ebaa7bb8-a411-4632-8d1b-3b3c6a89efde","type":"message","user":"U06BRP8VD","text":"サイズは3.9MBまで伸びた。","ts":"1606531092.392700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"VXa/"}]},{"client_msg_id":"28bfd672-95ae-4272-8ab9-cca803275489","type":"message","user":"U06BRP8VD","text":"ビルド完了まで2分かかった。","ts":"1606531064.392000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"aULs"}]},{"client_msg_id":"ffd7fc23-8541-40e0-b105-b1288c1d1c23","type":"message","user":"UAZ33BKV2","text":"最終出力サイズと実行ベンチが気になるところ","ts":"1606531053.391600","edited":{"user":"UAZ33BKV2","ts":"1606531064.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"76V"}]},{"client_msg_id":"a6b12bb3-8cad-486f-84b7-3384913ce6ec","type":"message","user":"U6XP9LZ6V","text":"そういえば以前、MinGW で gcc or clang でコンパイルして、リンクには lld を使ってみようとしたが上手くいかなかった。やり方あるのかな？","ts":"1606531041.391300","thread_ts":"1606531041.391300","reply_count":1,"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"mrIc+"}]},{"client_msg_id":"33081155-f83e-4c06-89c2-be49907e0531","type":"message","user":"U06BRP8VD","text":"まぁそれはそういうものか","ts":"1606531025.390800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"4UD"}]},{"client_msg_id":"ed575f67-0e33-4456-816f-29e72958e704","type":"message","user":"U06BRP8VD","text":"コンパイルに-flto付けるとリンクも遅くなるなぁ","ts":"1606531019.390600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"wY3db"}]},{"client_msg_id":"250320f1-a062-4c7e-ad74-26026a7ccc58","type":"message","user":"U06BRP8VD","text":"んーclangはコンパイルがシングルプロセスなのかぁ","ts":"1606530964.389500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"QY=Vh"}]},{"client_msg_id":"d2dbf997-1e12-4f2b-bd84-51b3cd2dfac7","type":"message","user":"U06BRP8VD","text":"clangにflto渡してフルでリンクまでllvm使おうとしてるけども…時間かかるw","ts":"1606530858.388200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"e51h"}]},{"client_msg_id":"71e1a19e-ee52-40fd-bf17-fc2f0ab7c8f6","type":"message","user":"U06BRP8VD","text":"つーかclangのほうにflto渡せってことですな","ts":"1606530718.387600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"jQgLy"}]},{"client_msg_id":"fae8c348-6813-4be9-ba6b-c5a4dee8e9be","type":"message","user":"U06BRP8VD","text":"\u0026gt; Link-time optimization (LTO) is supported by default. Essentially, all you have to do to do LTO is to pass the -flto option to clang. Then clang creates object files not in the native object file format but in LLVM bitcode format. LLD reads bitcode object files, compile them using LLVM and emit an output file. Because in this way LLD can see the entire program, it can do the whole program optimization.\nあるな","ts":"1606530628.387200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"HHL"}]},{"client_msg_id":"831cd5c5-10ca-4cae-bb4b-2a31f9db2a40","type":"message","user":"U6XP9LZ6V","text":"lld は binutils と違って PE ヘッダに link time stamp を埋め込むのか。\nでなぜか PE ヘッダの linker version は 14.0 になってる。VC2015 とぱっと見区別がつかない。","ts":"1606534958.425600","thread_ts":"1606531644.404200","parent_user_id":"U6XP9LZ6V","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"d6y5a"}]},{"client_msg_id":"1129cba8-340a-481e-9e1c-8ccd857ec6f5","type":"message","user":"U06BRP8VD","text":"lldはそういうの…なさそうか","ts":"1606530592.386900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"8OV"}]},{"client_msg_id":"e7ecfc57-934a-46f3-a90a-500d8432cf5d","type":"message","user":"UAZ33BKV2","text":"そっか、配置最適化とかもあるのか...(プロファイル)","ts":"1606530567.386600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Zp1OJ"}]},{"client_msg_id":"898db7e8-2f3b-4234-a3f1-d94c48402bb0","type":"message","user":"UAZ33BKV2","text":"でしょうね....そこはLTOとしては一般的というかよく知られているところですよね","ts":"1606530539.386100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"HJwb"}]},{"client_msg_id":"7709e267-fd19-4392-ba0d-1a2fbebad185","type":"message","user":"UAZ33BKV2","text":"ガイド付き最適化のプロファイルのほうはさらにいろいろあるんだな","ts":"1606530524.385700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"8K/A"}]},{"client_msg_id":"47ed9df1-e63f-4995-bca4-adc37cccb504","type":"message","user":"U06BRP8VD","text":"このモジュールって言ってるのはコンパイル単位ってことかしらね。","ts":"1606530519.385600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ejk5g"}]},{"client_msg_id":"99dbe4a8-660d-454c-a961-b4d2af6f5980","type":"message","user":"U06BRP8VD","text":"\u0026gt; * Optimize the use of registers across function boundaries.\n\u0026gt; * Do a better job of tracking modifications to global data, allowing a reduction in the number of loads and stores.\n\u0026gt; * Do a better job of tracking the possible set of items modified by a pointer dereference, reducing the numbers of loads and stores.\n\u0026gt; * Inline a function in a module even when the function is defined in another module.\n* 関数を超えてレジスタ利用の最適化\n* グローバルデータへの操作の最適化\n* ポインタデリファレンスでの操作の最適化\n* モジュールを超えての関数インライン化","ts":"1606530496.385100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"97o"}]},{"client_msg_id":"7b322793-798a-4a58-b5aa-52913b23b05d","type":"message","user":"U06BRP8VD","text":"\u003chttps://docs.microsoft.com/ja-jp/cpp/build/reference/gl-whole-program-optimization?view=msvc-160\u003e\n\u003chttps://docs.microsoft.com/ja-jp/cpp/build/reference/ltcg-link-time-code-generation?view=msvc-160\u003e","ts":"1606530248.382800","attachments":[{"fallback":"/LTCG (リンク時のコード生成)","id":1,"title":"/LTCG (リンク時のコード生成)","title_link":"https://docs.microsoft.com/ja-jp/cpp/build/reference/ltcg-link-time-code-generation?view=msvc-160","text":"MSVC リンカーオプション/LTCG は、プログラム全体の最適化のためのリンク時のコード生成を可能にします。","thumb_url":"https://docs.microsoft.com/en-us/media/logos/logo-ms-social.png","blocks":null,"service_name":"docs.microsoft.com","service_icon":"https://docs.microsoft.com/favicon.ico","thumb_width":400,"thumb_height":400,"from_url":"https://docs.microsoft.com/ja-jp/cpp/build/reference/ltcg-link-time-code-generation?view=msvc-160","original_url":"https://docs.microsoft.com/ja-jp/cpp/build/reference/ltcg-link-time-code-generation?view=msvc-160"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"F0o"}]},{"client_msg_id":"3753b583-de24-4748-b3ae-47aa326a2e68","type":"message","user":"UAZ33BKV2","text":"0.6MB増える、ううん、なんだろう","ts":"1606529598.382600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ysx"}]},{"client_msg_id":"6ba1e596-6044-4d22-a4a5-fa2649598405","type":"message","user":"U06BRP8VD","text":"ちなみに生成されるコードサイズ(vim64.dll)はだいたい 3.7MB, 3.1MB, 3.1MBってなる。まぁ後ろ2つはリンカが違うだけだから当然だけど。","ts":"1606529491.382200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"5VSp"}]},{"client_msg_id":"808bba75-b2a5-42b3-8c69-30386d814082","type":"message","user":"UAZ33BKV2","text":"8は適当ですが","ts":"1606529065.381100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"nnco/"}]},{"client_msg_id":"7b99769f-c89c-44f1-8ec4-c7ceffa40c3f","type":"message","user":"UAZ33BKV2","text":"変数のmaxでforしてるけど、リンクしたらmaxが8固定なのでunrollコードのほうが早い、とか","ts":"1606529043.380800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"xdoM"}]},{"client_msg_id":"329420c2-2474-43e6-93c4-03e5f745ddce","type":"message","user":"UAZ33BKV2","text":"Cでも、unrollになるところがある、とかそういうのかなー?","ts":"1606528997.380100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"l+3Q+"}]},{"client_msg_id":"dd5fa708-d709-4e56-a94f-ab8b35e30195","type":"message","user":"UAZ33BKV2","text":"LTOのことではないとしたら、謎ですねー","ts":"1606528962.379700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"VhOVV"}]},{"client_msg_id":"b5f3f47c-d65d-420a-bcd1-14b72acbf7df","type":"message","user":"U06BRP8VD","text":"まとめるとこんな感じ\n\nMSVCコンパイラ+MSVCリンカ+リンク時コード生成有: 33秒 (Vim標準\nMSVCコンパイラ+MSVCリンカ(+リンク時コード生成無): 12秒\nMSVCコンパイラ+LLVMリンカ(+リンク時コード生成無): 11秒 (12秒にかなり近い","ts":"1606528902.379300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"eo7x"}]},{"client_msg_id":"f4c7551e-2342-4459-8cd2-c5638699e1b7","type":"message","user":"U06BRP8VD","text":"んー「リンク時コード生成」ってどのくらいの効果があるんだろう? Vimでなにか実行してみないとわかんないよなぁ。ほぼC言語のVimにはあんま旨味はないと思うのだけれど…","ts":"1606528790.377400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"craC"}]},{"client_msg_id":"2458a549-66d1-48b1-99d5-78b3d0f0e35a","type":"message","user":"U06BRP8VD","text":"サイズは600Kくらい小さくなるな。","ts":"1606528731.376300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"=KJKf"}]},{"client_msg_id":"bff4fb06-3cc9-4e6f-9e9a-bb78921aeaea","type":"message","user":"U06BRP8VD","text":"12秒くらい。ただ誤差程度の差しかなかった。","ts":"1606528660.375900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"GBn0"}]},{"client_msg_id":"d5a8a44a-63ac-4536-bf2d-39fd89a625f1","type":"message","user":"U06BRP8VD","text":"うわはやい","ts":"1606528648.375500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"HLv"}]},{"client_msg_id":"18d59550-03f6-483b-b45a-a3488b506107","type":"message","user":"U06BRP8VD","text":"つまり「リンク時コード生成」を切った場合の標準リンカの速度もはからないとフェアではないと","ts":"1606528565.375200","edited":{"user":"U06BRP8VD","ts":"1606528726.000000"},"team":"T03C4RC8V","reactions":[{"name":"desune","count":1,"users":["UAZ33BKV2"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"m5=x"}]},{"client_msg_id":"7f54786d-2f16-4df4-8df5-f5663515b592","type":"message","user":"U06BRP8VD","text":"っていうかdiff内にも書いてあるね。","ts":"1606528542.374500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"8CCC"}]},{"client_msg_id":"304f9698-c04b-475a-8ca0-2e3ee59ac107","type":"message","user":"U06BRP8VD","text":"リンク時コード生成みたいなのがあんのかなぁ?","ts":"1606528482.374200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"LWdl5"}]},{"client_msg_id":"0dae07f5-8f24-432e-a092-3922f78180c0","type":"message","user":"U06BRP8VD","text":"lldは爆速が売りなんですけども、それにしてもMSVC標準のリンカがえらく遅いんですよね。","ts":"1606528463.373600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"vH8j"}]},{"client_msg_id":"37e4bb79-2b89-47f9-8781-206d0e8ce3e8","type":"message","user":"UDDCM376D","text":"リンカ差し替えただけで、そんなに早くなるんですね","ts":"1606528432.372900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"DV2v"}]},{"client_msg_id":"8ecfe2f1-04d4-4c4f-93ab-b346e5b647eb","type":"message","user":"U06BRP8VD","ts":"1606528381.372300","thread_ts":"1606528381.372300","reply_count":1,"files":[{"id":"F01FQ19HCE6","created":1606528379,"timestamp":1606528379,"name":"Make_mvc.mak の diff","title":"Make_mvc.mak の diff","mimetype":"text/plain","image_exif_rotation":0,"filetype":"text","pretty_type":"プレーンテキスト","user":"U06BRP8VD","mode":"snippet","editable":true,"is_external":false,"external_type":"","size":734,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F01FQ19HCE6/make_mvc.mak_____diff","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F01FQ19HCE6/download/make_mvc.mak_____diff","original_h":0,"original_w":0,"thumb_64":"","thumb_80":"","thumb_160":"","thumb_360":"","thumb_360_gif":"","thumb_360_w":0,"thumb_360_h":0,"thumb_480":"","thumb_480_w":0,"thumb_480_h":0,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U06BRP8VD/F01FQ19HCE6/make_mvc.mak_____diff","permalink_public":"https://slack-files.com/T03C4RC8V-F01FQ19HCE6-62fe926785","edit_link":"https://vim-jp.slack.com/files/U06BRP8VD/F01FQ19HCE6/make_mvc.mak_____diff/edit","preview":"diff --git a/src/Make_mvc.mak b/src/Make_mvc.mak\nindex a1cf406eb..e96d0f7a8 100644\n--- a/src/Make_mvc.mak\n+++ b/src/Make_mvc.mak\n@@ -262,6 +262,7 @@ MAKEFLAGS_GVIMEXT = DEBUG=yes","preview_highlight":"\u003cdiv class=\"CodeMirror cm-s-default CodeMirrorServer\" oncopy=\"if(event.clipboardData){event.clipboardData.setData('text/plain',window.getSelection().toString().replace(/\\u200b/g,''));event.preventDefault();event.stopPropagation();}\"\u003e\n\u003cdiv class=\"CodeMirror-code\"\u003e\n\u003cdiv\u003e\u003cpre\u003ediff --git a/src/Make_mvc.mak b/src/Make_mvc.mak\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003eindex a1cf406eb..e96d0f7a8 100644\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e--- a/src/Make_mvc.mak\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e+++ b/src/Make_mvc.mak\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e@@ -262,6 +262,7 @@ MAKEFLAGS_GVIMEXT = DEBUG=yes\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","lines":30,"lines_more":25,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":null},{"client_msg_id":"622c53b7-2c2f-4e13-a4ca-380336231bb3","type":"message","user":"U06BRP8VD","text":"コンパイル\u0026amp;リンクのフラグにいくつか使えないのがあった。Make_mvc.makの差分はります。","ts":"1606528353.372200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"T6h"}]},{"client_msg_id":"05573692-9d02-4847-a2f7-74aa8e1c0700","type":"message","user":"U06BRP8VD","text":"なんとなくWindowsでのVimのビルドにLLVMを使ってみてる。\n\nコンパイルはえらく遅くなった。\n\nコンパイラはclのまま、リンカだけをlld-linkに差し替えてコンパイルしたら ビルドにかかる時間が1/3になった。33秒かかってたのが11秒…","ts":"1606528264.371600","edited":{"user":"U06BRP8VD","ts":"1606528333.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"cWQx/"}]},{"client_msg_id":"c3f3128f-5231-440e-85f1-ead2c1e18099","type":"message","user":"U06BRP8VD","text":"1. link変数を外から変更できなかった\n2. コンパイル時の速度最適化?フラグを削除\n3. リンク時の速度最適化?フラグを削除","ts":"1606528439.373000","thread_ts":"1606528381.372300","parent_user_id":"U06BRP8VD","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"oGB"}]}]
