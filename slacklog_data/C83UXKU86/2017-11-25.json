[{"type":"message","user":"U06BRP8VD","text":"`gui_mch_draw_part_cursor()` の Flush は消します。理論上はここにFlushは不要のはずなので。要るのは画面に即座に反映させる必要のあるGDI操作の前","ts":"1511536620.000288","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"あー `clear_rect()` の `gui_is_outline_font_selected()` 悩ましい。これ、絶対ココでやるべきではないけども…","ts":"1511536872.000170","edited":{"user":"U06BRP8VD","ts":"1511536922.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"カーソル描画の時、その時に書いた文字に応じて GDI と DirectX の FillRect を呼び分けないとあかんのか…","ts":"1511537838.000272","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"絵文字の、カーソル反転、ちょっと工夫したいねぇ…","ts":"1511538195.000212","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"こんな分岐が要る…\n1. DirectX有効、DirectXで描画した → DirectXの FillRect で良い\n2. DirectX有効、でもGDIで描画した → Flush した上で GDI の FillRect (しないと不安)\n3. DirectX無効(もちろんGDIで描画) → GDI の FillRect","ts":"1511538778.000079","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"昼間にも書きましたが gui_mch_draw_string() 内の FillRect は DirectWrite で書いた場合でも、GDI の FillRect も必要でした。なぜそうなのかは未確認。","ts":"1511540047.000241","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"GDIのFillRectしないとどうなりました?","ts":"1511541048.000277","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"前に画面が残る、か。","ts":"1511541097.000085","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"なんか再現させる方法が欲しい。","ts":"1511541264.000251","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"enc_utf8 以外の時、directxをonにできないほうが良いよねぇ…まぁ、今やることじゃないか。","ts":"1511541783.000276","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"ユーザーの設定によって正しく動かなくなるケース、コード的なサポートを諦めるのはどうだろう?","ts":"1511541814.000109","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"ドキュメントに書く。","ts":"1511541823.000215","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"そしたら `font_is_ttf_or_vector` 消せないかな?","ts":"1511541873.000128","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"こんなのあったのか (；´∀｀)\n<https://msdn.microsoft.com/ja-jp/library/windows/desktop/dd144872(v=vs.85).aspx>","ts":"1511542566.000060","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"TranslateColorGlyphRun に渡す glyphRun は AdjustedGlyphRun じゃなくて良いのかな?","ts":"1511543127.000188","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"一応、差し替えておくか","ts":"1511543345.000153","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"TranslateColorGlyphRun() で取ってきた enumerator は SafeRelease しておいたほうが良いよね?","ts":"1511545642.000059","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"しておこう","ts":"1511545695.000208","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"IDWriteFactory2 が利用可能かどうかだけは、ログ(_RPT)に出しておきます。","ts":"1511545749.000273","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"コレとこの issue を関連付けて、単純化したい気持ちがある。<https://github.com/koron/vim/issues/14>","ts":"1511547155.000139","attachments":[{"color":"D0D0D0","fallback":"[November 25th, 2017 1:43 AM] koron: ユーザーの設定によって正しく動かなくなるケース、コード的なサポートを諦めるのはどうだろう?","author_id":"U06BRP8VD","author_name":"KoRoN","author_subname":"KoRoN","author_link":"https://vim-jp.slack.com/team/U06BRP8VD","author_icon":"https://secure.gravatar.com/avatar/4b5a6f711a4e22e617b74058239ade53.jpg?s=48&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0007-48.png","text":"ユーザーの設定によって正しく動かなくなるケース、コード的なサポートを諦めるのはどうだろう?","mrkdwn_in":["text"],"blocks":null,"footer":"Posted in #color-emoji","ts":1511541814.000109,"from_url":"https://vim-jp.slack.com/archives/C83UXKU86/p1511541814000109"},{"fallback":"GitHub: additional documentation · Issue #14 · koron/vim","id":1,"title":"additional documentation · Issue #14 · koron/vim","title_link":"https://github.com/koron/vim/issues/14","text":"「こういうときは見えなくなるよ」とかそういう注意事項・ノウハウ集を、ドキュメントに追記したほうが良さげ。","thumb_url":"https://avatars0.githubusercontent.com/u/468368?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/bfaba/img/unfurl_icons/github.png","thumb_width":250,"thumb_height":250,"from_url":"https://github.com/koron/vim/issues/14"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"「選択されたフォントによっては DirectX での描画不能」を救うコードを、ちゃんと作るか、ドロップして大幅に簡略化できないだろうか。","ts":"1511547239.000159","edited":{"user":"U06BRP8VD","ts":"1511547723.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"くっそ `GetPixelsPerDip` で返した値、使ってないみたいだw","ts":"1511548465.000136","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"ambiwidth-auto なパッチ、絵文字に対応してみたけど、Segoe UI Mono は文字通り mono width で記録されているらしく…w","ts":"1511553696.000040","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"フォールバックした絵文字は大丈夫みたいだけれど…","ts":"1511553720.000221","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"こんな感じ。","ts":"1511554281.000049","files":[{"id":"F85CMHU85","created":1511554279,"timestamp":1511554279,"name":"ricty+ambiwidth=auto.png","title":"ricty+ambiwidth=auto.png","mimetype":"image/png","image_exif_rotation":1,"filetype":"png","pretty_type":"PNG","user":"U06BRP8VD","mode":"hosted","editable":false,"is_external":false,"external_type":"","size":185536,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F85CMHU85/ricty_ambiwidth_auto.png","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F85CMHU85/download/ricty_ambiwidth_auto.png","original_h":371,"original_w":631,"thumb_64":"https://files.slack.com/files-tmb/T03C4RC8V-F85CMHU85-c928385655/ricty_ambiwidth_auto_64.png","thumb_80":"https://files.slack.com/files-tmb/T03C4RC8V-F85CMHU85-c928385655/ricty_ambiwidth_auto_80.png","thumb_160":"https://files.slack.com/files-tmb/T03C4RC8V-F85CMHU85-c928385655/ricty_ambiwidth_auto_160.png","thumb_360":"https://files.slack.com/files-tmb/T03C4RC8V-F85CMHU85-c928385655/ricty_ambiwidth_auto_360.png","thumb_360_gif":"","thumb_360_w":360,"thumb_360_h":212,"thumb_480":"https://files.slack.com/files-tmb/T03C4RC8V-F85CMHU85-c928385655/ricty_ambiwidth_auto_480.png","thumb_480_w":480,"thumb_480_h":282,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U06BRP8VD/F85CMHU85/ricty_ambiwidth_auto.png","permalink_public":"https://slack-files.com/T03C4RC8V-F85CMHU85-f3ac819dd0","edit_link":"","preview":"","preview_highlight":"","lines":0,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":null},{"type":"message","user":"U03C6TEAZ","text":"そいいれば ambi=auto って出したことないんでしたっけ。","ts":"1511570040.000021","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"ないかも。","ts":"1511576483.000022","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"<@U6XP9LZ6V> `font_is_ttf_or_vector` が 0 になるのって、具体的にどのフォントですかね?","ts":"1511576827.000072","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"FixedSys で良いのかな? なんか `gfn=*` で選択できなかったんだけど、あるにはあるのか。\n<http://ran2.com/post-425/>","ts":"1511577095.000028","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"使えないフォントのときは SetFont の中のどこかで失敗するっぽいから、そこで大丈夫なフォントにフォールバックするのが良さげ。で、最低限呼び出しはできるから、呼び出し側でのコントロールはしないようにします。で、フォントの方の問題はどのフォントにフォールバックするかだけ。\n\nあとフォントと rop との組み合わせで描画できなくなるのは、まだどうすればよいのかわかんない…","ts":"1511579461.000096","edited":{"user":"U06BRP8VD","ts":"1511579479.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"猫w","ts":"1511581038.000001","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"CreateFontFromLOGFONT が失敗する","ts":"1511582474.000051","edited":{"user":"U06BRP8VD","ts":"1511582483.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"os_mswin.c でデフォルトのフォントは FixedSys になっていますので `set gfn&amp;` すれば FixedSys になります。","ts":"1511582687.000011","team":"T03C4RC8V","reactions":[{"name":"bow","count":1,"users":["U06BRP8VD"]}],"replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"Windowsから、デフォルトのLOGFONT取る方法ってないですかね。","ts":"1511582723.000037","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"いま DWriteContext::SetFont が失敗した時の挙動をなんとかしようとしていて… 最悪、絶対表示できる LOGFONT を用意しておけば、と至った次第。","ts":"1511582859.000025","edited":{"user":"U06BRP8VD","ts":"1511582879.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"vim/vim でもデフォルトの FixedSys だと HiDPI で文字が小さくなるので何とかならないかという話がありましたが、固定ピッチのアウトラインフォントって何をデフォルトにすればいいのかというところで、頓挫。","ts":"1511582912.000006","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"うへぇ…","ts":"1511583057.000032","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"逆に考えれば、DWriteContextでなにか固定しちゃっても良いってことか?","ts":"1511583090.000043","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"SystemParametersInfo とかで取れないんですっけ。","ts":"1511583111.000022","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"UIフォントは取れた気がしますが、固定ピッチは取れましたっけ？","ts":"1511583164.000056","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"あー、固定かー。","ts":"1511583247.000027","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"teraterm とかってどうやってるんだろ。","ts":"1511583302.000025","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"GetStockObject + SYSTEM_FIXED_FONT かな","ts":"1511583477.000024","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"ただ SYSTEM_FIXED_FONT は Win 3.0 以前向けらしい…","ts":"1511583499.000004","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"めんどいけど…頑張るか。","ts":"1511583600.000045","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"gui_mch_draw_part_cursor() の Flush と GDI 描画は必要ですね。これがないと挿入モードやコマンドラインで入力中に、カーソルキーでカーソルを動かしたときに、カーソルが正しく描画されません。","ts":"1511584422.000066","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"DWriteContext_FillRect の方が不要なよう。","ts":"1511584630.000038","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"pushed","ts":"1511584985.000055","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"あ、DWriteContext_FillRect してから DWriteContext_Flush すれば、GDI 描画は不要か？","ts":"1511585862.000002","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"&gt; カーソルキーでカーソルを動かしたときに、カーソルが正しく描画されません\n\nあざます。こういう、チェックすべき項目、書き出しときたいねw","ts":"1511586560.000030","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"唯一、DirectXで使えるのは DEFAULT_GUI_FONT だけだったw","ts":"1511587036.000007","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"ぐぬぬ。","ts":"1511588471.000050","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"いまやってる <https://github.com/koron/vim/pull/15>","ts":"1511588721.000049","attachments":[{"fallback":"GitHub: WIP: font fallback by koron · Pull Request #15 · koron/vim","id":1,"title":"WIP: font fallback by koron · Pull Request #15 · koron/vim","title_link":"https://github.com/koron/vim/pull/15","text":"DirectX で使えないフォントが渡されたら、事前に準備したフォントにフォールバックする。 コンセプトでまだ実装途中。","thumb_url":"https://avatars0.githubusercontent.com/u/468368?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/bfaba/img/unfurl_icons/github.png","thumb_width":250,"thumb_height":250,"from_url":"https://github.com/koron/vim/pull/15"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"コレ使うと、DirectXで使える一覧がでる","ts":"1511588802.000039","files":[{"id":"F866WTYLW","created":1511588802,"timestamp":1511588802,"name":"fontenum.cpp","title":"fontenum.cpp","mimetype":"text/plain","image_exif_rotation":0,"filetype":"cpp","pretty_type":"C++","user":"U06BRP8VD","mode":"snippet","editable":true,"is_external":false,"external_type":"","size":3233,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F866WTYLW/fontenum.cpp","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F866WTYLW/download/fontenum.cpp","original_h":0,"original_w":0,"thumb_64":"","thumb_80":"","thumb_160":"","thumb_360":"","thumb_360_gif":"","thumb_360_w":0,"thumb_360_h":0,"thumb_480":"","thumb_480_w":0,"thumb_480_h":0,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U06BRP8VD/F866WTYLW/fontenum.cpp","permalink_public":"https://slack-files.com/T03C4RC8V-F866WTYLW-ee71f981f0","edit_link":"https://vim-jp.slack.com/files/U06BRP8VD/F866WTYLW/fontenum.cpp/edit","preview":"","preview_highlight":"","lines":0,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":null},{"type":"message","user":"U06BRP8VD","text":"プロポーショナルじゃないけど、Arial か Courier New あたりをフォールバックにしとけば見えないってことはないかも","ts":"1511589293.000014","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"便利 <https://helpx.adobe.com/jp/x-productkb/global/221220.html>","ts":"1511589643.000034","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"うん。とりあえず Arial か Courier New か Lucida Console だな。","ts":"1511589695.000034","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"Vista以降でよければ Consolasだったけど","ts":"1511589896.000031","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"Arial は英字すらあかん感じだ。","ts":"1511590086.000037","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","ts":"1511590253.000050","files":[{"id":"F85BZT5E0","created":1511590252,"timestamp":1511590252,"name":"courier-new.png","title":"courier-new.png","mimetype":"image/png","image_exif_rotation":1,"filetype":"png","pretty_type":"PNG","user":"U06BRP8VD","mode":"hosted","editable":false,"is_external":false,"external_type":"","size":38775,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F85BZT5E0/courier-new.png","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F85BZT5E0/download/courier-new.png","original_h":458,"original_w":663,"thumb_64":"https://files.slack.com/files-tmb/T03C4RC8V-F85BZT5E0-5f1867f19f/courier-new_64.png","thumb_80":"https://files.slack.com/files-tmb/T03C4RC8V-F85BZT5E0-5f1867f19f/courier-new_80.png","thumb_160":"https://files.slack.com/files-tmb/T03C4RC8V-F85BZT5E0-5f1867f19f/courier-new_160.png","thumb_360":"https://files.slack.com/files-tmb/T03C4RC8V-F85BZT5E0-5f1867f19f/courier-new_360.png","thumb_360_gif":"","thumb_360_w":360,"thumb_360_h":249,"thumb_480":"https://files.slack.com/files-tmb/T03C4RC8V-F85BZT5E0-5f1867f19f/courier-new_480.png","thumb_480_w":480,"thumb_480_h":332,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U06BRP8VD/F85BZT5E0/courier-new.png","permalink_public":"https://slack-files.com/T03C4RC8V-F85BZT5E0-538a0e82a9","edit_link":"","preview":"","preview_highlight":"","lines":0,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":null},{"type":"message","user":"U06BRP8VD","ts":"1511590260.000005","files":[{"id":"F85ANAY82","created":1511590258,"timestamp":1511590258,"name":"lucida-console.png","title":"lucida-console.png","mimetype":"image/png","image_exif_rotation":1,"filetype":"png","pretty_type":"PNG","user":"U06BRP8VD","mode":"hosted","editable":false,"is_external":false,"external_type":"","size":39481,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F85ANAY82/lucida-console.png","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F85ANAY82/download/lucida-console.png","original_h":452,"original_w":663,"thumb_64":"https://files.slack.com/files-tmb/T03C4RC8V-F85ANAY82-cb552a0f7b/lucida-console_64.png","thumb_80":"https://files.slack.com/files-tmb/T03C4RC8V-F85ANAY82-cb552a0f7b/lucida-console_80.png","thumb_160":"https://files.slack.com/files-tmb/T03C4RC8V-F85ANAY82-cb552a0f7b/lucida-console_160.png","thumb_360":"https://files.slack.com/files-tmb/T03C4RC8V-F85ANAY82-cb552a0f7b/lucida-console_360.png","thumb_360_gif":"","thumb_360_w":360,"thumb_360_h":245,"thumb_480":"https://files.slack.com/files-tmb/T03C4RC8V-F85ANAY82-cb552a0f7b/lucida-console_480.png","thumb_480_w":480,"thumb_480_h":327,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U06BRP8VD/F85ANAY82/lucida-console.png","permalink_public":"https://slack-files.com/T03C4RC8V-F85ANAY82-6d7e4ef41c","edit_link":"","preview":"","preview_highlight":"","lines":0,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":null},{"type":"message","user":"U06BRP8VD","text":"Courier New にしよう…","ts":"1511590291.000028","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"<@U6XP9LZ6V> とりあえず基礎実装は終わったんですが、これどう思いますかね?\n<https://github.com/koron/vim/pull/15>","ts":"1511591671.000010","attachments":[{"fallback":"GitHub: WIP: font fallback by koron · Pull Request #15 · koron/vim","id":1,"title":"WIP: font fallback by koron · Pull Request #15 · koron/vim","title_link":"https://github.com/koron/vim/pull/15","text":"DirectX で使えないフォントが渡されたら、事前に準備したフォントにフォールバックする。 フォールバック先は Courier New:h12 相当。日本語表示はアレになるが英語はそこそこ見られる。","thumb_url":"https://avatars0.githubusercontent.com/u/468368?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/bfaba/img/unfurl_icons/github.png","thumb_width":250,"thumb_height":250,"from_url":"https://github.com/koron/vim/pull/15"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"GDIへのフォールバックはやめてしまうということですか。","ts":"1511592117.000010","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"Courier New (fallback) + emoji がしっくりし過ぎててくさw","ts":"1511592127.000024","files":[{"id":"F85AQP6FL","created":1511592126,"timestamp":1511592126,"name":"emoji+fallback.png","title":"emoji+fallback.png","mimetype":"image/png","image_exif_rotation":1,"filetype":"png","pretty_type":"PNG","user":"U06BRP8VD","mode":"hosted","editable":false,"is_external":false,"external_type":"","size":44725,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F85AQP6FL/emoji_fallback.png","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F85AQP6FL/download/emoji_fallback.png","original_h":330,"original_w":414,"thumb_64":"https://files.slack.com/files-tmb/T03C4RC8V-F85AQP6FL-4fa4dbc45f/emoji_fallback_64.png","thumb_80":"https://files.slack.com/files-tmb/T03C4RC8V-F85AQP6FL-4fa4dbc45f/emoji_fallback_80.png","thumb_160":"https://files.slack.com/files-tmb/T03C4RC8V-F85AQP6FL-4fa4dbc45f/emoji_fallback_160.png","thumb_360":"https://files.slack.com/files-tmb/T03C4RC8V-F85AQP6FL-4fa4dbc45f/emoji_fallback_360.png","thumb_360_gif":"","thumb_360_w":360,"thumb_360_h":287,"thumb_480":"","thumb_480_w":0,"thumb_480_h":0,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U06BRP8VD/F85AQP6FL/emoji_fallback.png","permalink_public":"https://slack-files.com/T03C4RC8V-F85AQP6FL-31036de38e","edit_link":"","preview":"","preview_highlight":"","lines":0,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":null},{"type":"message","user":"U06BRP8VD","text":"そうです。あくまでも DirectX 側で対応する。","ts":"1511592149.000027","attachments":[{"color":"D0D0D0","fallback":"[November 25th, 2017 3:41 PM] k-takata: GDIへのフォールバックはやめてしまうということですか。","author_id":"U6XP9LZ6V","author_name":"Ken Takata","author_subname":"Ken Takata","author_link":"https://vim-jp.slack.com/team/U6XP9LZ6V","author_icon":"https://secure.gravatar.com/avatar/7817559eedcf07a777dbf9dd734cc0b1.jpg?s=48&d=https%3A%2F%2Fa.slack-edge.com%2F0180%2Fimg%2Favatars%2Fava_0001-48.png","text":"GDIへのフォールバックはやめてしまうということですか。","mrkdwn_in":["text"],"blocks":null,"footer":"Posted in #color-emoji","ts":1511592117.000010,"from_url":"https://vim-jp.slack.com/archives/C83UXKU86/p1511592117000010"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"フォールバック先のフォントサイズがHiDPI考慮されていないような。","ts":"1511592169.000016","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"ためしてみます～","ts":"1511592203.000030","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"ぱっとみ、問題ないように見えるけど…","ts":"1511592411.000068","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"いや、これだと小さいのか","ts":"1511592535.000069","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"gfn を空で起動すると、gfn=Courier_New:h12 に比べるとずいぶん小さいサイズになります。","ts":"1511592631.000003","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"日本語が半角幅扱いになってつらい。","ts":"1511592803.000014","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"AdjustedGlyphRun がうまく動いていないのかな。","ts":"1511592966.000003","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"なんか gfn=Courier_New:h12 で設定すると lfHeightが -15 で回ってきますね…","ts":"1511593011.000037","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"あと、微妙に各フラグが違いそう…","ts":"1511593024.000023","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","ts":"1511593174.000038","files":[{"id":"F86D0T31V","created":1511593173,"timestamp":1511593173,"name":"01.png","title":"fallbackしたときのlogfont","mimetype":"image/png","image_exif_rotation":1,"filetype":"png","pretty_type":"PNG","user":"U06BRP8VD","mode":"hosted","editable":false,"is_external":false,"external_type":"","size":23332,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F86D0T31V/01.png","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F86D0T31V/download/01.png","original_h":320,"original_w":487,"thumb_64":"https://files.slack.com/files-tmb/T03C4RC8V-F86D0T31V-7784cec0ae/01_64.png","thumb_80":"https://files.slack.com/files-tmb/T03C4RC8V-F86D0T31V-7784cec0ae/01_80.png","thumb_160":"https://files.slack.com/files-tmb/T03C4RC8V-F86D0T31V-7784cec0ae/01_160.png","thumb_360":"https://files.slack.com/files-tmb/T03C4RC8V-F86D0T31V-7784cec0ae/01_360.png","thumb_360_gif":"","thumb_360_w":360,"thumb_360_h":237,"thumb_480":"https://files.slack.com/files-tmb/T03C4RC8V-F86D0T31V-7784cec0ae/01_480.png","thumb_480_w":480,"thumb_480_h":315,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U06BRP8VD/F86D0T31V/01.png","permalink_public":"https://slack-files.com/T03C4RC8V-F86D0T31V-48449dd5d2","edit_link":"","preview":"","preview_highlight":"","lines":0,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":null},{"type":"message","user":"U06BRP8VD","ts":"1511593207.000036","files":[{"id":"F85C3MQ7N","created":1511593206,"timestamp":1511593206,"name":"02.png","title":"自前で設定した時の logfont","mimetype":"image/png","image_exif_rotation":1,"filetype":"png","pretty_type":"PNG","user":"U06BRP8VD","mode":"hosted","editable":false,"is_external":false,"external_type":"","size":22312,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F85C3MQ7N/02.png","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F85C3MQ7N/download/02.png","original_h":319,"original_w":483,"thumb_64":"https://files.slack.com/files-tmb/T03C4RC8V-F85C3MQ7N-723c393b30/02_64.png","thumb_80":"https://files.slack.com/files-tmb/T03C4RC8V-F85C3MQ7N-723c393b30/02_80.png","thumb_160":"https://files.slack.com/files-tmb/T03C4RC8V-F85C3MQ7N-723c393b30/02_160.png","thumb_360":"https://files.slack.com/files-tmb/T03C4RC8V-F85C3MQ7N-723c393b30/02_360.png","thumb_360_gif":"","thumb_360_w":360,"thumb_360_h":238,"thumb_480":"https://files.slack.com/files-tmb/T03C4RC8V-F85C3MQ7N-723c393b30/02_480.png","thumb_480_w":480,"thumb_480_h":317,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U06BRP8VD/F85C3MQ7N/02.png","permalink_public":"https://slack-files.com/T03C4RC8V-F85C3MQ7N-f7ee0321a8","edit_link":"","preview":"","preview_highlight":"","lines":0,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":null},{"type":"message","user":"U06BRP8VD","text":"自前 = `gfn=Courier_New:h12`","ts":"1511593242.000045","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"get_logfont 使うように変えるか。","ts":"1511593348.000049","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"くそ…LOGFONTなのか…Wじゃなくて","ts":"1511593493.000056","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"Win9xは切り捨てたので、LOGFONTWに移行してもいいかもしれません。","ts":"1511593588.000031","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"enc=utf-8のとき、日本語フォント名を正しく扱えない問題を修正したときに、そこも修正したかったけど、Win9xを捨てる前だったのでうまい具合に修正できず、結局フォント周りはANSI APIを使っています。","ts":"1511593909.000053","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"とりあえずクソ適当に変換します :sweat_smile:","ts":"1511593941.000069","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"真面目にやろうとするとかなりめんどい。","ts":"1511593960.000003","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"gui_dwrite.cpp の中に書いてあるこのURL <http://msdn.microsoft.com/en-us/library/windows/desktop/dd941783(v=vs.85).aspx> リンク切れでつらい。","ts":"1511594118.000030","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"なんでMSのサイトはURLかわるんですかね :syobon:","ts":"1511594152.000024","team":"T03C4RC8V","reactions":[{"name":"syobon","count":1,"users":["U6XP9LZ6V"]}],"replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"\"This content has been removed.\" だそうで。","ts":"1511594226.000010","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"lfFallback でフォントサイズを -12 固定にしてありますが、DPIの倍率を掛けないといけないと思います。","ts":"1511594542.000043","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"とりあえず get_logfont 使って 文字列から LOGFONT を生成してもらおうと考えて、作業中です。それなら間違いないかと。","ts":"1511594587.000003","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"…なんか微妙に幅が違うものができるぞw","ts":"1511594882.000033","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"ああ、ウィンドウの幅計算に使うフォントと、実際の描画に使うフォントが異なるからか。","ts":"1511595012.000046","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"まぁ、でもDPIの件はクリアできたっぽい。コード整理して push します","ts":"1511595028.000017","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"push した。","ts":"1511595268.000014","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"フォントサイズは大きくなりましたが、画面サイズがそれに追従していないですね。","ts":"1511595472.000032","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"↑に書いたとおり、幅計算に使うフォントと実際の描画が異なるからかなぁと。","ts":"1511595510.000047","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"で、そもそもフォールバックなんで、「そういう事態になったら設定見直してね」ってドキュメントに書けば十分かなと考えました。","ts":"1511595539.000006","edited":{"user":"U06BRP8VD","ts":"1511595626.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"あとはフォントキャッシュをやるかどうか。速度、どのくらい変わるだろうか? <https://github.com/koron/vim/issues/16>","ts":"1511595588.000022","attachments":[{"fallback":"GitHub: font cache · Issue #16 · koron/vim","id":1,"title":"font cache · Issue #16 · koron/vim","title_link":"https://github.com/koron/vim/issues/16","text":"HFONT を IDWriteTextFormat に変換するが、そのキャッシュを持ったほうが良さげ。 キャッシュは2つでも十分そうだが italic と bold を考慮するなら 4 つに、 更に gfn と gfw まで考えれば 8 個になる。","thumb_url":"https://avatars0.githubusercontent.com/u/468368?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/bfaba/img/unfurl_icons/github.png","thumb_width":250,"thumb_height":250,"from_url":"https://github.com/koron/vim/issues/16"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"<https://github.com/vim/vim/blob/2c997d76034d5294c92305108357daef6feabd95/runtime/doc/options.txt#L6160-L6161>","ts":"1511595738.000082","attachments":[{"fallback":"GitHub: vim/vim","id":1,"title":"vim/vim","title_link":"https://github.com/vim/vim/blob/2c997d76034d5294c92305108357daef6feabd95/runtime/doc/options.txt#L6160-L6161","text":"vim - The official Vim repository","thumb_url":"https://avatars0.githubusercontent.com/u/11618545?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/bfaba/img/unfurl_icons/github.png","thumb_width":48,"thumb_height":48,"from_url":"https://github.com/vim/vim/blob/2c997d76034d5294c92305108357daef6feabd95/runtime/doc/options.txt#L6160-L6161"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"ラスターフォントを指定したときはGDI描画にフォールバックすると明記してあるので、それを今更変えてもいいのかというのは気になっています。","ts":"1511595846.000047","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"ちょっとそれ too much な仕様だと思うんです。特にこの先の完全DirectX化を考えると。","ts":"1511595976.000039","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"完全に GDI にフォールバックするか、もしくはフォントを変えても DirectX で書くかって話で","ts":"1511596078.000042","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"まー、確かに邪魔ですね。","ts":"1511596106.000034","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"で gfw とか syntax で文字単位でフォントが変わるんであれば、directx 的にはフォントを変えるべき(違うフォントを使っても描画するべき)だろうと。で完全にGDIへフォールバックする仕組みは、別途あって良いと思います。","ts":"1511596155.000009","edited":{"user":"U06BRP8VD","ts":"1511596268.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"directx_enabled する際に現在のフォントをチェックして、使えたらそのままでいくし、ダメなら強制disable","ts":"1511596184.000050","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"あとは gfn を変えた際も同様かな?","ts":"1511596206.000015","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"issued <https://github.com/koron/vim/issues/18>","ts":"1511596499.000032","attachments":[{"fallback":"GitHub: fallback to GDI entirely · Issue #18 · koron/vim","id":1,"title":"fallback to GDI entirely · Issue #18 · koron/vim","title_link":"https://github.com/koron/vim/issues/18","text":"ラスタフォントについては GDI にフォールバックすると書いてある。 If select a raster font (Courier, Terminal or FixedSys) to 'guifont', it fallbacks to be drawn by GDI automatically. <https://github.com/vim/vim/blob/2c997d76034>...","thumb_url":"https://avatars0.githubusercontent.com/u/468368?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/bfaba/img/unfurl_icons/github.png","thumb_width":250,"thumb_height":250,"from_url":"https://github.com/koron/vim/issues/18"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"リンク切れのURLは、代わりにこれとかにしておくのがよいだろうか。 <https://msdn.microsoft.com/en-us/library/windows/desktop/dd742734(v=vs.85).aspx>","ts":"1511597726.000012","team":"T03C4RC8V","reactions":[{"name":"+1","count":1,"users":["U06BRP8VD"]}],"replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"もうちょっとしたら fallback-font ブランチを color-emoji にマージしますね。","ts":"1511598949.000025","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"日本語版はそのまま残ってた。 <https://msdn.microsoft.com/ja-jp/library/windows/desktop/dd941783(v=vs.85).aspx>","ts":"1511599030.000002","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"もしくはあれか","ts":"1511599350.000048","edited":{"user":"U06BRP8VD","ts":"1511599359.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"gui_dwrite.cpp のほうで GDI 使って(フォールバック)描く案もあるな。いや混ぜたくはないんだけど。","ts":"1511599395.000056","edited":{"user":"U06BRP8VD","ts":"1511599408.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"案外それはありなんじゃないかと思えてきたのは気のせいでしょうかｗ","ts":"1511600610.000021","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","ts":"1511602651.000023","files":[{"id":"F85FED677","created":1511602650,"timestamp":1511602650,"name":"fallback-to-ExtTextOut.diff","title":"fallback-to-ExtTextOut.diff","mimetype":"text/plain","image_exif_rotation":0,"filetype":"diff","pretty_type":"Diff","user":"U6XP9LZ6V","mode":"snippet","editable":true,"is_external":true,"external_type":"unknown","size":2920,"url":"","url_download":"","url_private":"https://gist.github.com/60565df2bd746800c62080767adccbec#file-fallback-to-ExtTextOut-diff","url_private_download":"https://gist.github.com/60565df2bd746800c62080767adccbec#file-fallback-to-ExtTextOut-diff","original_h":0,"original_w":0,"thumb_64":"","thumb_80":"","thumb_160":"","thumb_360":"","thumb_360_gif":"","thumb_360_w":0,"thumb_360_h":0,"thumb_480":"","thumb_480_w":0,"thumb_480_h":0,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U6XP9LZ6V/F85FED677/fallback-to-exttextout.diff","permalink_public":"","edit_link":"https://vim-jp.slack.com/files/U6XP9LZ6V/F85FED677/fallback-to-exttextout.diff/edit","preview":"","preview_highlight":"","lines":0,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"username":""}],"replace_original":false,"delete_original":false,"blocks":null},{"type":"message","user":"U6XP9LZ6V","text":"GDIへのフォールバック、こんな感じでできそう。色やフォント設定を s_hdc から持ってきていないので、表示はおかしいですが、一応文字は出ました。","ts":"1511602735.000057","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"色とフォントを修正。まだ微妙に表示がおかしいが…","ts":"1511603364.000028","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"gistを更新しても、slack側の埋め込まれたファイルは更新されないのか。 <https://gist.github.com/k-takata/60565df2bd746800c62080767adccbec>","ts":"1511603938.000034","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"とりあえず一旦font fallbackはマージしちゃいますね。","ts":"1511612221.000080","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"このさきどちらに転ばせるにせよ、dwrite側に寄せちゃったほうがやりやすくなるので。","ts":"1511612254.000012","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"BindDC のときに HDC は受け取ってるんで、それ使うんじゃダメなんですかね?","ts":"1511612879.000020","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"よっしゃやってみるべ","ts":"1511613213.000092","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"さらに先でどうするかはともかくとして、目先のマージを目指す上で既存の機能をdwrite側で綺麗に吸収できるなら、それは有利に働くなって思った次第。","ts":"1511613282.000012","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"これ、今ならCP932でもDirectX化できるのかな?","ts":"1511614309.000049","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"現在のステータスってどんなのでしょう？","ts":"1511614470.000004","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"えっと、フォントによってDWriteが表示ができない件を、gui_w32.cからgui_dwrite.cpp の責任に変更して、gui_w32.c の見た目をすっきりさせているところです。","ts":"1511614511.000081","edited":{"user":"U06BRP8VD","ts":"1511614537.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"<@U6XP9LZ6V> fallback を gui_dwrite.cpp でやる修正、入れました。 <https://github.com/koron/vim/pull/1/commits/368aa523797551c6c6b29ee89ad49886d44a48b1>","ts":"1511614613.000064","attachments":[{"fallback":"GitHub: WIP: color emoji! by koron · Pull Request #1 · koron/vim","id":1,"title":"WIP: color emoji! by koron · Pull Request #1 · koron/vim","title_link":"https://github.com/koron/vim/pull/1/commits/368aa523797551c6c6b29ee89ad49886d44a48b1","text":"./gvim -u emoji.vim -U NONE --noplugins","thumb_url":"https://avatars0.githubusercontent.com/u/468368?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/bfaba/img/unfurl_icons/github.png","thumb_width":250,"thumb_height":250,"from_url":"https://github.com/koron/vim/pull/1/commits/368aa523797551c6c6b29ee89ad49886d44a48b1"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"お、はみ出した絵文字でずれる事がなくなった？","ts":"1511614618.000031","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"<https://go-gyazo.appspot.com/3088966466cced61.png>","ts":"1511614632.000028","attachments":[{"fallback":"551x157px image","id":1,"image_url":"https://go-gyazo.appspot.com/3088966466cced61.png","blocks":null,"from_url":"https://go-gyazo.appspot.com/3088966466cced61.png"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"あ、それはどうかな。","ts":"1511614632.000041","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"<https://go-gyazo.appspot.com/0f7fce20ba52103b.png>","ts":"1511614659.000004","attachments":[{"fallback":"191x82px image","id":1,"image_url":"https://go-gyazo.appspot.com/0f7fce20ba52103b.png","blocks":null,"from_url":"https://go-gyazo.appspot.com/0f7fce20ba52103b.png"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"直ってますね","ts":"1511614661.000076","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"あと残件は2つ。","ts":"1511614811.000068","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"font cache と document","ts":"1511614820.000003","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"いま SetFont するたびに TextFormat を作っては壊してしてて、かなり無駄。","ts":"1511614844.000024","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"2つキャッシュするだけでかなり改善される(だいたいboldがあるので2つのあいだで切り替えが発生する)ことがわかってて、さらに italic との組み合わせも考えると4つあるとほぼ再生性がなくなる。","ts":"1511614922.000081","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"ただスピードにどのくらい関わってるかが微妙にわからない。","ts":"1511614941.000017","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"なるほど","ts":"1511615120.000096","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"しばらく Ricty 使ってなかったんだけど、現状一番コンディションの良いフォントが Ricty になった。","ts":"1511615158.000082","team":"T03C4RC8V","reactions":[{"name":"laughing","count":1,"users":["U06BRP8VD"]}],"replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"絵文字が入ってないからfallbackがきれいに決まる?","ts":"1511615189.000007","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"ですです。Cica は色が付かないので。","ts":"1511615207.000024","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"4つ(normal/bold/italic)作る実装が良いのか、","ts":"1511615318.000010","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"それとも LRU cache 的なのが良いのか。","ts":"1511615335.000044","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"LRUだとは思います。gui_w32.c では brush で要素2個のLRUやってるんですよね。","ts":"1511615365.000006","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"ただDirectX的には gfn + gfw +↑のパターンで8個くらいあると、あんしんできる。","ts":"1511615391.000018","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"さて…どのくらい真面目にやるかね","ts":"1511615662.000011","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"EndDrawの最適化前にフォントキャッシュ8こやってみたんですが全く体感できなかったですね。今だとどうか…","ts":"1511616701.000010","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","ts":"1511616771.000072","files":[{"id":"F859VHTQT","created":1511616771,"timestamp":1511616771,"name":"_______________________________________.cpp","title":"超適当なキャッシュ作った。","mimetype":"text/plain","image_exif_rotation":0,"filetype":"cpp","pretty_type":"C++","user":"U06BRP8VD","mode":"snippet","editable":true,"is_external":false,"external_type":"","size":1218,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F859VHTQT/_______________________________________.cpp","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F859VHTQT/download/_______________________________________.cpp","original_h":0,"original_w":0,"thumb_64":"","thumb_80":"","thumb_160":"","thumb_360":"","thumb_360_gif":"","thumb_360_w":0,"thumb_360_h":0,"thumb_480":"","thumb_480_w":0,"thumb_480_h":0,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U06BRP8VD/F859VHTQT/_______________________________________.cpp","permalink_public":"https://slack-files.com/T03C4RC8V-F859VHTQT-12d4f0bdeb","edit_link":"https://vim-jp.slack.com/files/U06BRP8VD/F859VHTQT/_______________________________________.cpp/edit","preview":"","preview_highlight":"","lines":0,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":null},{"type":"message","user":"U06BRP8VD","text":"覚えるものぜんぜん足らんかったw","ts":"1511617060.000071","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"十分速いけどなー。","ts":"1511617337.000031","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"どんな条件だと遅いんでしょう？","ts":"1511617354.000060","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"eval.txt のスクロールでも一瞬で止まる。","ts":"1511617504.000090","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"キャッシュ入れたとしても体感できないんじゃないかなー","ts":"1511617747.000024","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"これな…","ts":"1511618025.000028","attachments":[{"color":"D0D0D0","fallback":"[November 25th, 2017 10:02 PM] koron: ただスピードにどのくらい関わってるかが微妙にわからない。","author_id":"U06BRP8VD","author_name":"KoRoN","author_subname":"KoRoN","author_link":"https://vim-jp.slack.com/team/U06BRP8VD","author_icon":"https://secure.gravatar.com/avatar/4b5a6f711a4e22e617b74058239ade53.jpg?s=48&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0007-48.png","text":"ただスピードにどのくらい関わってるかが微妙にわからない。","mrkdwn_in":["text"],"blocks":null,"footer":"Posted in #color-emoji","ts":1511614941.000017,"from_url":"https://vim-jp.slack.com/archives/C83UXKU86/p1511614941000017"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"計測まではいかないまでもどこが遅いか分かるといいのだけど。(そもそも遅いとは思ってないけど)","ts":"1511618261.000003","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"昨日の時点では :help eval で :only したあとスクロールを数秒してやめると 0.5 秒ほどラグがあったけど、今日のは無い。","ts":"1511618303.000043","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"全画面でやった時の話です。","ts":"1511618319.000008","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"とりあえず、キャッシュ実装終わった。","ts":"1511618404.000196","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"どうやって測るんが良いかね?","ts":"1511619037.000024","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"SetFont 自体はかなり頻繁に呼ばれてて、1個のキャッシュ(mLastHfont)はそれなりに機能していた。","ts":"1511619196.000062","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"bold とそうでないのがごっちゃになってるテキストが好ましいのかなぁ","ts":"1511619213.000055","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"すっごいアバウトな測定で 2% 速くなってるかなってないか。一応、キャッシュの数減らしても計測してみるか。","ts":"1511619846.000024","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"ふと気になって、同じ方法でGDIとDirectXと比べたらどうなるか、測ってみたんだけどGDIのが遅そうw","ts":"1511620089.000006","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"僕もいまそれ気になって試してました。","ts":"1511620113.000034","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"フォントのレンダリングというよりも、syntax で GDI の方が若干速い気がしました。","ts":"1511620157.000057","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"少し大きい xpm ファイルを開くと差が出るかも。","ts":"1511620174.000033","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"いやー、とんとんかな。","ts":"1511620260.000075","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"eval.txt をC-Fおしっぱでのスクロール、 Ricty:h9 だと GDI が 7秒 DirectX が 5秒ってところ","ts":"1511620283.000109","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"ハードウェアレンダリングなので、僕のマシンスペックも関係するのかな。","ts":"1511620307.000037","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"koron さんとこ GPU ?","ts":"1511620327.000079","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"かも。ぼくは 古いRadeon積んでるデスクトップ","ts":"1511620334.000055","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"HD5500だったか","ts":"1511620338.000119","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"radeonじゃないかも。AMDでHD5500という型番は覚えてる。","ts":"1511620356.000032","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"僕のは intel core i5 の内臓。","ts":"1511620385.000044","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"内臓w","ts":"1511620389.000007","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"ちょっと…意地悪なファイル作ってみるか。","ts":"1511620475.000004","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"こんなの作った。ひたすらふぉんとの切り替えが必要なテスト用ファイル。","ts":"1511620829.000068","files":[{"id":"F84SMGYC9","created":1511620828,"timestamp":1511620828,"name":"cache-test.md","title":"cache-test.md","mimetype":"text/plain","image_exif_rotation":0,"filetype":"markdown","pretty_type":"Markdown (raw)","user":"U06BRP8VD","mode":"snippet","editable":true,"is_external":false,"external_type":"","size":780000,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F84SMGYC9/cache-test.md","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F84SMGYC9/download/cache-test.md","original_h":0,"original_w":0,"thumb_64":"","thumb_80":"","thumb_160":"","thumb_360":"","thumb_360_gif":"","thumb_360_w":0,"thumb_360_h":0,"thumb_480":"","thumb_480_w":0,"thumb_480_h":0,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U06BRP8VD/F84SMGYC9/cache-test.md","permalink_public":"https://slack-files.com/T03C4RC8V-F84SMGYC9-cd29c43a91","edit_link":"https://vim-jp.slack.com/files/U06BRP8VD/F84SMGYC9/cache-test.md/edit","preview":"","preview_highlight":"","lines":0,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":null},{"type":"message","user":"U03C6TEAZ","text":"CTRL-D で 20% まで進めてキーを離して 1.5 秒のラグ","ts":"1511620983.000101","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"あー、GDI だと 0.3 秒くらいか。","ts":"1511621012.000032","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"eval.txt と同じくらいの行数なのに最下段までのスクロールでキャッシュ1版で5→8秒の差がついた。","ts":"1511621018.000042","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"今からキャッシュx8版で試す。","ts":"1511621035.000017","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"キャッシュx8版で7秒だった。つまりこのくらいやると差が出てくるw","ts":"1511621126.000007","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"キャッシュx2版でも測ってみるか。","ts":"1511621132.000036","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"なるほど。","ts":"1511621133.000039","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"だいぶカリカリの段階まで来たってことすね。","ts":"1511621160.000049","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"ですね。","ts":"1511621178.000015","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"あ、やっぱx2版だとx1版と変わらんわ。","ts":"1511621193.000081","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"すぐにキャッシュアウトしちゃう。","ts":"1511621202.000025","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"フォントを小さくしてウィンドウを大きくして、1画面で大量の文字を出し、しかもフォントが頻繁に切り替わるという条件のもと、効くんだな。","ts":"1511621504.000072","edited":{"user":"U06BRP8VD","ts":"1511621723.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"せっかくだx4も試してみるか。","ts":"1511621517.000046","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"なんかPC-98とDOS/Vで、日本語文章の表示どっちが速いかっていうアレを思い出したw","ts":"1511621576.000068","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"うん。やっぱx4は x8と同じ7秒ですね。","ts":"1511621645.000014","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"ちょうど4つで回ってるはずだから。","ts":"1511621658.000012","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"せっかくなんで3もやるか。","ts":"1511621672.000080","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"おけおけ 8秒台","ts":"1511621770.000018","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"4が良いかな。gfwを考えると8だけど、なかなかそのサイズはいないだろうってことで。","ts":"1511621802.000010","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"それとも8にしておく?","ts":"1511621818.000083","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"ボトルネックで考えられるのってあとは何だろう。","ts":"1511621874.000003","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"僕は nothing 今はもう思いつかない。","ts":"1511621898.000014","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"とりあえず font cache は現行の8で、作業完了にします。","ts":"1511621917.000038","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"あ、今回作ったキャッシュ、アロケーション回数は減ったけどメモリコピーが頻発するんで、そこだけ。","ts":"1511621978.000066","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"まぁ、さっきの測定結果を考えれば忘れて良いと思う。","ts":"1511621995.000046","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"}]
