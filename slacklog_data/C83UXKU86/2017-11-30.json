[{"type":"message","user":"U6XP9LZ6V","text":"環境によっても結構変わってきそうな感じ。","ts":"1511967635.000607","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"Flushの間引きはよくわかんない。","ts":"1511967725.000221","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"ただ :hi や :ver だとフレームが飛ぶ感じはする。「感じ」","ts":"1511967743.000537","thread_ts":"1511967743.000537","reply_count":1,"replies":[{"user":"U06BRP8VD","ts":"1511967755.000071"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"ヒドイレポートw","ts":"1511967755.000071","thread_ts":"1511967743.000537","parent_user_id":"U06BRP8VD","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"RedrawWindowを今のまま入れるのは反対しておきます。確かに1画面分スクロールだと速いんですけど、1行だと間違いなく遅くなるみたい。そこを切り替える閾値いれるっていうのならありだと思います。さらに突き詰めるなら実行時に計測して適応的に閾値を決定するとか。","ts":"1511968609.000493","edited":{"user":"U06BRP8VD","ts":"1511968760.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"もしくは `rop=type:directx,scroll_redraw_line=15` みたいなオプション化とか?","ts":"1511968676.000551","edited":{"user":"U06BRP8VD","ts":"1511968691.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"flush の間引きは入れなくて良いと思います。ネタとしては面白かったけど、効果が微妙にしか出ていない割に複雑過ぎるので。","ts":"1511968841.000846","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"むしろ DirectX の Flush の呼び出しに使うべきネタかもしれない。","ts":"1511968934.000257","edited":{"user":"U06BRP8VD","ts":"1511968948.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"&gt; 1行だと間違いなく遅くなるみたい。\nこっちで試した範囲ではFlushの回数が1回減る分速い感じがします。（奇妙なデスクトップPCも含めて）","ts":"1511969564.000560","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"A:(全画面再描画) と B:(Flush + Scroll + 1行の描画) で、どっちが速いかなんですよね。AMD系かnvidia系かで違ったりするんだろうか。","ts":"1511970010.000432","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"一応 LICEcap の60FPSで取った比較、上げておきますね。 Ricty_Diminished:h10.5 で rop=type:directx,renmode5, lines=42, co=82 foldcolumn=2 という条件です。","ts":"1511970842.000090","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"ScrollWindowEx 使った方(パッチ無し)","ts":"1511970878.000121","files":[{"id":"F86L6EQLR","created":1511970865,"timestamp":1511970865,"name":"scroll-scroll.gif","title":"scroll-scroll.gif","mimetype":"image/gif","image_exif_rotation":1,"filetype":"gif","pretty_type":"GIF","user":"U06BRP8VD","mode":"hosted","editable":false,"is_external":false,"external_type":"","size":1031148,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F86L6EQLR/scroll-scroll.gif","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F86L6EQLR/download/scroll-scroll.gif","original_h":680,"original_w":574,"thumb_64":"https://files.slack.com/files-tmb/T03C4RC8V-F86L6EQLR-c31d24ed88/scroll-scroll_64.png","thumb_80":"https://files.slack.com/files-tmb/T03C4RC8V-F86L6EQLR-c31d24ed88/scroll-scroll_80.png","thumb_160":"https://files.slack.com/files-tmb/T03C4RC8V-F86L6EQLR-c31d24ed88/scroll-scroll_160.png","thumb_360":"https://files.slack.com/files-tmb/T03C4RC8V-F86L6EQLR-c31d24ed88/scroll-scroll_360.png","thumb_360_gif":"https://files.slack.com/files-tmb/T03C4RC8V-F86L6EQLR-c31d24ed88/scroll-scroll_360.gif","thumb_360_w":304,"thumb_360_h":360,"thumb_480":"https://files.slack.com/files-tmb/T03C4RC8V-F86L6EQLR-c31d24ed88/scroll-scroll_480.png","thumb_480_w":405,"thumb_480_h":480,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U06BRP8VD/F86L6EQLR/scroll-scroll.gif","permalink_public":"https://slack-files.com/T03C4RC8V-F86L6EQLR-469eee0614","edit_link":"","preview":"","preview_highlight":"","lines":0,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"deanimate_gif":"https://files.slack.com/files-tmb/T03C4RC8V-F86L6EQLR-c31d24ed88/scroll-scroll_deanimate_gif.png","display_as_bot":false,"has_rich_preview":false,"thumb_480_gif":"https://files.slack.com/files-tmb/T03C4RC8V-F86L6EQLR-c31d24ed88/scroll-scroll_480.gif","username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":null},{"type":"message","user":"U06BRP8VD","text":"RedrawWindow 使った方 (パッチあり)","ts":"1511970932.000350","files":[{"id":"F86G1ULNL","created":1511970906,"timestamp":1511970906,"name":"scroll-redraw.gif","title":"scroll-redraw.gif","mimetype":"image/gif","image_exif_rotation":1,"filetype":"gif","pretty_type":"GIF","user":"U06BRP8VD","mode":"hosted","editable":false,"is_external":false,"external_type":"","size":1696695,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F86G1ULNL/scroll-redraw.gif","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F86G1ULNL/download/scroll-redraw.gif","original_h":680,"original_w":574,"thumb_64":"https://files.slack.com/files-tmb/T03C4RC8V-F86G1ULNL-c9c19a7ba6/scroll-redraw_64.png","thumb_80":"https://files.slack.com/files-tmb/T03C4RC8V-F86G1ULNL-c9c19a7ba6/scroll-redraw_80.png","thumb_160":"https://files.slack.com/files-tmb/T03C4RC8V-F86G1ULNL-c9c19a7ba6/scroll-redraw_160.png","thumb_360":"https://files.slack.com/files-tmb/T03C4RC8V-F86G1ULNL-c9c19a7ba6/scroll-redraw_360.png","thumb_360_gif":"https://files.slack.com/files-tmb/T03C4RC8V-F86G1ULNL-c9c19a7ba6/scroll-redraw_360.gif","thumb_360_w":304,"thumb_360_h":360,"thumb_480":"https://files.slack.com/files-tmb/T03C4RC8V-F86G1ULNL-c9c19a7ba6/scroll-redraw_480.png","thumb_480_w":405,"thumb_480_h":480,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U06BRP8VD/F86G1ULNL/scroll-redraw.gif","permalink_public":"https://slack-files.com/T03C4RC8V-F86G1ULNL-513fc639b0","edit_link":"","preview":"","preview_highlight":"","lines":0,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"deanimate_gif":"https://files.slack.com/files-tmb/T03C4RC8V-F86G1ULNL-c9c19a7ba6/scroll-redraw_deanimate_gif.png","display_as_bot":false,"has_rich_preview":false,"thumb_480_gif":"https://files.slack.com/files-tmb/T03C4RC8V-F86G1ULNL-c9c19a7ba6/scroll-redraw_480.gif","username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":null},{"type":"message","user":"U03C6TEAZ","text":"下の方はﾇﾙｯって感じしますね","ts":"1511971781.000573","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"ええ。上は、ドライバあたりが意図的に落としているかのようにシュバッってでてきちゃう。","ts":"1511973222.000020","edited":{"user":"U06BRP8VD","ts":"1511973230.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"カーソル関連のflushをちょっと削れそう。FillRect等を両方用意した時点で不要になってたらしい？","ts":"1512028577.000095","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"更新ed。'rop'にscrlinesオプション追加、flushを2つ削除。","ts":"1512044241.000194","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"```\n--- a/src/gui_w32.c\n+++ b/src/gui_w32.c\n@@ -3136,6 +3136,7 @@ gui_mch_delete_lines(\n \t{\n \t    RedrawWindow(s_textArea, &amp;rc, NULL, RDW_INVALIDATE);\n \t    use_redraw = 1;\n+\t    OutputDebugString(\"redraw\");\n \t}\n \telse\n \t    DWriteContext_Flush(s_dwc);\n@@ -3143,6 +3144,7 @@ gui_mch_delete_lines(\n     if (!use_redraw)\n #endif\n     {\n+\t    OutputDebugString(\"scroll\");\n \tintel_gpu_workaround();\n \tScrollWindowEx(s_textArea, 0, -num_lines * gui.char_height,\n \t\t\t\t    &amp;rc, &amp;rc, NULL, NULL, get_scroll_flags());\n```\nこんな感じでログを入れて、DebugView で時間を計ってみたが、やはり自分の環境ではredrawの方が倍くらい速い。","ts":"1512046186.000113","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"不思議だ。","ts":"1512046736.000323","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"しかしまあ、ID2D1DCRenderTarget で HDC に描くためのレンダーターゲットを作っておいて、それにさらに ID2D1GdiInteropRenderTarget で HDC を作っているのは笑えるなー。","ts":"1512053122.000467","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"w","ts":"1512053180.000430","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"本来 ID2D1HwndRenderTarget でやるべきところ、ですかね","ts":"1512053203.000442","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"…まてよ","ts":"1512053209.000200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"実は s_hdc を差し替えれば良い?","ts":"1512053255.000515","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"のか？","ts":"1512053282.000346","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"ID2D1HwndRenderTarget ベースにして、ID2D1GdiInteropRenderTarget で HDC 作って s_hdc を置き換える。","ts":"1512053298.000296","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"GetDC と ReleaseDC とかのタイミングだけ、気をつけないといけないけど…","ts":"1512053320.000914","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"ああ、ちゃんと WM_PAINT 使っててくれれば、簡単だったのにw","ts":"1512053340.000828","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U6XP9LZ6V","text":"ｗ","ts":"1512053349.000088","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"}]
