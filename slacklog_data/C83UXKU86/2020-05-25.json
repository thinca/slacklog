[{"type":"message","user":"UB88NP1PY","text":"たくさん起きる割に再現手順がよく分かっていないのですが、これから何か分かることないでしょうか。","ts":"1590394897.382600","attachments":[{"color":"D0D0D0","fallback":"[May 25th, 2020 3:17 PM] discofli8ht: うーん、今日だけで 2 回も SIGSEGV に遭遇してしまった。。(tip: v8.2.0821)","author_id":"UB88NP1PY","author_name":"m_nishi","author_subname":"m_nishi","author_link":"https://vim-jp.slack.com/team/UB88NP1PY","author_icon":"https://avatars.slack-edge.com/2018-06-14/381543412789_c2cbce6b61aebb7e9a06_48.jpg","text":"うーん、今日だけで 2 回も SIGSEGV に遭遇してしまった。。(tip: v8.2.0821)","mrkdwn_in":["text"],"blocks":null,"footer":"Posted in #random","ts":1590387475.053000,"from_url":"https://vim-jp.slack.com/archives/C03C4RC9F/p1590387475053000"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"2/Pi"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"caf40e3c-1017-4082-a551-94f4d6ea32c6","type":"message","user":"U9S4G0LJW","text":"gdbのbacktraceを見てみたい","ts":"1590394980.383400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"BJP46"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"2f0dae49-7b4d-48b3-81c3-47363f160ed6","type":"message","user":"UB88NP1PY","text":"```#0  0x00007f929a195187 in kill () at ../sysdeps/unix/syscall-template.S:78\n#1  0x00005597c7daedd5 in may_core_dump () at os_unix.c:3408\n#2  0x00005597c7daed79 in mch_exit (r=0x1) at os_unix.c:3374\n#3  0x00005597c7f1e37e in getout (exitval=0x1) at main.c:1717\n#4  0x00005597c7d7029e in preserve_exit () at misc1.c:2189\n#5  0x00005597c7dac7d0 in deathtrap (sigarg=0xb) at os_unix.c:1099\n#6  0x00007f929a559890 in &lt;signal handler called&gt; () at /lib/x86_64-linux-gnu/libpthread.so.0\n#7  0x00005597c7edeeb0 in erase_internal (rect=..., selective=0x0, user=0x5597c8d70ca0) at libvterm/src/screen.c:286\n#8  0x00005597c7edefda in erase (rect=..., selective=0x0, user=0x5597c8d70ca0) at libvterm/src/screen.c:307\n#9  0x00005597c7ee12da in erase (state=0x5597c8cc4c20, rect=..., selective=0x0) at libvterm/src/state.c:57\n#10 0x00005597c7ee476d in on_csi (leader=0x0, args=0x5597c8cbeb38, argcount=0x1, intermed=0x0, command=0x4b, user=0x5597c8cc4c20) at libvterm/src/state.c:1165\n#11 0x00005597c7edba32 in do_csi (vt=0x5597c8cbeae0, command=0x4b) at libvterm/src/parser.c:36\n#12 0x00005597c7edc1cf in vterm_input_write (vt=0x5597c8cbeae0, bytes=0x5597c94ae670 \"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\"..., len=0x3cf) at libvterm/src/parser.c:240\n#13 0x00005597c7e643aa in term_write_job_output (term=0x5597c8d55ad0, msg=0x5597c94ae670 \"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\"..., len=0x3cf) at terminal.c:1075\n#14 0x00005597c7e645aa in write_to_term (buffer=0x5597c8d71100, msg=0x5597c94ae670 \"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\"..., channel=0x5597c8d6fe60) at terminal.c:1146\n#15 0x00005597c7f06e3b in may_invoke_callback (channel=0x5597c8d6fe60, part=PART_OUT) at channel.c:2960\n#16 0x00005597c7f09e20 in channel_parse_messages () at channel.c:4652\n#17 0x00005597c7d22b47 in parse_queued_messages () at getchar.c:2163\n#18 0x00005597c7e7c76b in inchar_loop (buf=0x5597c81d28db &lt;typebuf_init+91&gt; \"\", maxlen=0x39, wtime=0xffffffffffffffff, tb_change_cnt=0x1ba5, wait_func=0x5597c7db27e6 &lt;WaitForChar&gt;, resize_func=0x5597c7dac16d &lt;resize_func&gt;) at ui.c:290\n#19 0x00005597c7dac1d6 in mch_inchar (buf=0x5597c81d28db &lt;typebuf_init+91&gt; \"\", maxlen=0x39, wtime=0xffffffffffffffff, tb_change_cnt=0x1ba5) at os_unix.c:390\n#20 0x00005597c7e7c6a9 in ui_inchar (buf=0x5597c81d28db &lt;typebuf_init+91&gt; \"\", maxlen=0x39, wtime=0xffffffffffffffff, tb_change_cnt=0x1ba5) at ui.c:224\n#21 0x00005597c7d24a8f in inchar (buf=0x5597c81d28db &lt;typebuf_init+91&gt; \"\", maxlen=0xad, wait_time=0xffffffffffffffff) at getchar.c:3407\n#22 0x00005597c7d24637 in vgetorpeek (advance=0x1) at getchar.c:3186\n#23 0x00005597c7d21fcd in vgetc () at getchar.c:1663\n#24 0x00005597c7d22591 in safe_vgetc () at getchar.c:1889\n#25 0x00005597c7d814b4 in normal_cmd (oap=0x7ffced8a4ef0, toplevel=0x1) at normal.c:569\n#26 0x00005597c7f1df85 in main_loop (cmdwin=0x0, noexmode=0x0) at main.c:1509\n#27 0x00005597c7f1d291 in vim_main2 () at main.c:899\n#28 0x00005597c7f1c975 in main (argc=0x1, argv=0x7ffced8a50f8) at main.c:438\n\n#7  0x00005597c7edeeb0 in erase_internal (rect=..., selective=0x0, user=0x5597c8d70ca0) at libvterm/src/screen.c:286\n286           cell-&gt;chars[0] = 0;\n(gdb) info args\nrect = {\n  start_row = 0xfffffffa, \n  end_row = 0xfffffffb, \n  start_col = 0xd3, \n  end_col = 0xef\n}\nselective = 0x0\nuser = 0x5597c8d70ca0\n(gdb) info locals \ncell = 0x0\ninfo = 0x5597ca1afbe8\nscreen = 0x5597c8d70ca0\nrow = 0xfffffffa\ncol = 0xd3```\ncell が null pointer になっているっぽいです。","ts":"1590395003.383800","edited":{"user":"UB88NP1PY","ts":"1590395193.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"BWn"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"e8176a0e-24df-409d-a0d0-4b55e6368b8b","type":"message","user":"U9S4G0LJW","text":"あーターミナルか（僕使ってなかった）","ts":"1590395041.384400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"UGPOu"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"925dc08c-7855-44ea-ba1c-d2dc4d0e05b0","type":"message","user":"U9S4G0LJW","text":"libvtermのバージョンアップ繰り返してたからそれかな","ts":"1590395051.384800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ovzW"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"411185dc-8451-4fe3-91d6-4ec60f846ea5","type":"message","user":"UB88NP1PY","text":"write_to_term, term_write_job_output, vterm_input_write のとこはターミナルの内容が出てたので一応伏せて \"x\" にしてあります。","ts":"1590395064.385100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"kVwJP"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"76009c9e-6dc2-4855-8a39-0d30c0f371ce","type":"message","user":"UB88NP1PY","text":"そうですよね、「なんか修正が入っていたなー」くらいの理解ですが。","ts":"1590395136.385700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"7/KwO"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"f00c73f9-b561-4c42-a4d3-1f8f37f8108e","type":"message","user":"UAZ33BKV2","text":"ライブラリと不一致になった系で参照ミスでSEGV、とかは静的リンクなら関係ない、かな...?","ts":"1590395182.386400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"gmA"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"9b1f229a-27a3-4923-bfa0-2755665a9887","type":"message","user":"U03C6TEAZ","text":"<https://github.com/vim/vim/blob/45a1508a229b1d1d2eb79cabe55a183dc18fd040/src/libvterm/src/screen.c#L283>","ts":"1590395217.386700","attachments":[{"fallback":"GitHub: vim/vim","id":1,"title":"vim/vim","title_link":"https://github.com/vim/vim/blob/45a1508a229b1d1d2eb79cabe55a183dc18fd040/src/libvterm/src/screen.c#L283","text":"The official Vim repository. Contribute to vim/vim development by creating an account on GitHub.","thumb_url":"https://avatars0.githubusercontent.com/u/11618545?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/80588/img/unfurl_icons/github.png","thumb_width":48,"thumb_height":48,"from_url":"https://github.com/vim/vim/blob/45a1508a229b1d1d2eb79cabe55a183dc18fd040/src/libvterm/src/screen.c#L283","original_url":"https://github.com/vim/vim/blob/45a1508a229b1d1d2eb79cabe55a183dc18fd040/src/libvterm/src/screen.c#L283"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"HhyT"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"71bdf21b-f791-45d7-a51b-192c3e7efe7c","type":"message","user":"U03C6TEAZ","text":"NULL チェックがない。","ts":"1590395222.387100","team":"T03C4RC8V","reactions":[{"name":"sokudo","count":2,"users":["U9S4G0LJW","UEB17JJJE"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"SC+I"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"9864b608-67eb-4bd6-a299-17449d67d950","type":"message","user":"UB88NP1PY","text":"単に NULL チェックすればいいだけの話ですか？(コンテキストまったくわかってない)","ts":"1590395253.387900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"0mzF"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"6756e947-ce12-4880-be9a-04f4862aacd3","type":"message","user":"U03C6TEAZ","text":"ここに cell のチェック(continue)入れて直ったらビンゴ。","ts":"1590395256.388100","edited":{"user":"U03C6TEAZ","ts":"1590395299.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"uUI"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"ac4a1623-2f53-4570-8382-e07bf3f3fadc","type":"message","user":"U03C6TEAZ","text":"期待してない座標でこの csi 命令が飛んできた時に本来なら無視すべきだけど、まじめに処理して落ちてる感じ。","ts":"1590395281.388600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"LCqlR"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"feb4b222-9b4a-47fa-a395-ce90e8ac05ad","type":"message","user":"U03C6TEAZ","text":"画面を消す命令から来たケースですね。","ts":"1590395352.389000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"3WV"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"b668c7cb-d11b-4e0d-9b3a-b2d3f68ae3ff","type":"message","user":"U03C6TEAZ","text":"```      if(cell == NULL || (selective &amp;&amp; cell-&gt;pen.protected_cell))\n        continue;```","ts":"1590395486.389900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Kw+N"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"3b35e379-403f-49e0-8e84-f932d9c8a082","type":"message","user":"UB88NP1PY","text":"なるほど (分かってない\nちなみに csi 命令ってなんのことでしょうか。調べてみたけれど見つからず。。","ts":"1590395488.390000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"O/PFB"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"bfce99e3-231f-4038-bd93-06929b8fc16b","type":"message","user":"U03C6TEAZ","text":"エスケープシーケンスの一種です。","ts":"1590395522.390300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"6hK"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"4fb9efee-75c7-47b0-8338-66d3d7d7fd2e","type":"message","user":"U03C6TEAZ","text":"Control Sequence Introducer","ts":"1590395526.390500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ti3A9"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"62e5da4c-7c7b-4aff-a701-c5f9b9dc18d5","type":"message","user":"U03C6TEAZ","text":"getcell は NULL を返しうるのでチェックが必要なんですよね。","ts":"1590395605.390900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"bL9"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"e843b0f0-9a3d-45c9-a460-7e8810f4e422","type":"message","user":"U03C6TEAZ","text":"<https://github.com/vim/vim/blob/45a1508a229b1d1d2eb79cabe55a183dc18fd040/src/libvterm/src/screen.c#L79-L84>","ts":"1590395617.391300","attachments":[{"fallback":"GitHub: vim/vim","id":1,"title":"vim/vim","title_link":"https://github.com/vim/vim/blob/45a1508a229b1d1d2eb79cabe55a183dc18fd040/src/libvterm/src/screen.c#L79-L84","text":"The official Vim repository. Contribute to vim/vim development by creating an account on GitHub.","thumb_url":"https://avatars0.githubusercontent.com/u/11618545?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/80588/img/unfurl_icons/github.png","thumb_width":48,"thumb_height":48,"from_url":"https://github.com/vim/vim/blob/45a1508a229b1d1d2eb79cabe55a183dc18fd040/src/libvterm/src/screen.c#L79-L84","original_url":"https://github.com/vim/vim/blob/45a1508a229b1d1d2eb79cabe55a183dc18fd040/src/libvterm/src/screen.c#L79-L84"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"gdkR"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"0e6fbe69-f04b-4c7c-bcf8-e601987e0aee","type":"message","user":"U03C6TEAZ","text":"ただ check してないとこ山ほどあるぽい。","ts":"1590395637.391800","team":"T03C4RC8V","reactions":[{"name":"eyes","count":1,"users":["UAZ33BKV2"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"lyi5"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"e6d5992c-93fc-4dc7-a413-e929a388a6f2","type":"message","user":"UB88NP1PY","text":"oh... どうもありがとうございます。\nちょっと家の都合でしばらくパソコンから離れます。。","ts":"1590395750.392500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"vp3E"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"8c96456b-6b35-42b0-b130-d5f99e371188","type":"message","user":"UB88NP1PY","text":"全部で 13 ヶ所くらいですかね。なんとか直せるかも。","ts":"1590408807.394200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"hFI"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"0ae67473-2b9b-4336-a7bb-4bec199ad21d","type":"message","user":"UB88NP1PY","text":"再現手順が確立できていないので、検証ができない。(十中八九 null pointer 参照だろうけど。)","ts":"1590408840.394800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ELbTw"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"9de03253-e31b-49b5-a27a-d3347328b083","type":"message","user":"UAZ33BKV2","text":"チェック用のログはきつつそのままnullながしてSEGVするの観測する、とかくらいしか確証の取りかたがわからない\n再現はlibvtermの都合もあるだろうし、手順確定難しそう","ts":"1590408908.395700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ljfOC"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"6d7e2fc4-41e2-45e2-8e9d-ce7b62223d77","type":"message","user":"UB88NP1PY","text":"`if(` -&gt; `if (` の修正をしたくなったり、const を追加したくなったりしてきて、収拾がつかなくなってきた。。","ts":"1590410482.397500","team":"T03C4RC8V","reactions":[{"name":"wakaru","count":1,"users":["U9S4G0LJW"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"zftcE"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"680f5dd0-d957-42ba-adb5-0aa2d7f87ba4","type":"message","user":"UB88NP1PY","text":"まだ検証ができてないのでとりあえず draft で出してみました。<https://github.com/vim/vim/pull/6141>","ts":"1590413831.398400","thread_ts":"1590413831.398400","attachments":[{"fallback":"GitHub: Fix SIGSEGV due to null pointer reference of erase_internal by mnishz · Pull Request #6141 · vim/vim","id":1,"title":"Fix SIGSEGV due to null pointer reference of erase_internal by mnishz · Pull Request #6141 · vim/vim","title_link":"https://github.com/vim/vim/pull/6141","text":"Problem: erase_internal() doesn&amp;#39;t check the returned value of getcell() Solution: Check the returned value of getcell() This is a draft because I haven&amp;#39;t validated this fi...","thumb_url":"https://avatars0.githubusercontent.com/u/11618545?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/80588/img/unfurl_icons/github.png","thumb_width":48,"thumb_height":48,"from_url":"https://github.com/vim/vim/pull/6141","original_url":"https://github.com/vim/vim/pull/6141"}],"edited":{"user":"UB88NP1PY","ts":"1590414949.000000"},"reply_count":1,"replies":[{"user":"UB88NP1PY","ts":"1590635631.406200"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"MVS"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"}]
