[{"type":"message","user":"UFZF1SYMV","text":"<@UFZF1SYMV> has joined the channel","ts":"1551367600.001000","subtype":"channel_join","replace_original":false,"delete_original":false,"blocks":null},{"type":"message","user":"UGKTMDNA1","text":"<@UGKTMDNA1> has joined the channel","ts":"1551368878.001200","subtype":"channel_join","replace_original":false,"delete_original":false,"blocks":null},{"client_msg_id":"0b550311-16b9-4db2-b5ba-46059b780cb0","type":"message","user":"U7986PPFH","text":"<@U03C6TEAZ>\n&gt; screenchar() ってマルチバイト文字拾ってくれないのね。\nこれに関して何か作業されてますか？","ts":"1551423418.001800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"00e61fda-fe2b-4100-b3ab-dca2eb4ab595","type":"message","user":"U03C6TEAZ","text":"何も作業してないです。","ts":"1551424455.002000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"12832f30-133b-46a9-99f7-556cd3d679b1","type":"message","user":"U03C6TEAZ","text":"ScreenLinesUC の最初しか見てなくて、これ screen.c の screen_lines 等の関数を通って ui_write に書く前の状態を取らないとリアルに画面に表示されてる物か知るのは難しいなぁ、というのが昨日ソースを10分ほど見た感想でした。","ts":"1551424578.003400","edited":{"user":"U03C6TEAZ","ts":"1551424596.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"c653f88c-3e45-496b-9659-25f881b0ce5c","type":"message","user":"U03C6TEAZ","text":"ui_write を差し替えて redraw させて戻す、みたいな危なそうな方法しか思い浮かばなかった。","ts":"1551424654.004700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"5d00cc34-996d-4a58-868a-3c5078f23fff","type":"message","user":"U7986PPFH","text":"<https://github.com/vim/vim/compare/master...ichizok:feature/mbyte-screenchar>\n以前に `screenchar()` で composing characters を取れるようにしようとして放置していたんですが、 `screenchar()`, `char2nr()`, `nr2char()` も composing 対応に更新しました","ts":"1551428800.006500","attachments":[{"fallback":"GitHub: vim/vim","id":1,"title":"vim/vim","title_link":"https://github.com/vim/vim/compare/master...ichizok:feature/mbyte-screenchar","text":"The official Vim repository. Contribute to vim/vim development by creating an account on GitHub.","thumb_url":"https://avatars0.githubusercontent.com/u/11618545?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://cfr.slack-edge.com/bfaba/img/unfurl_icons/github.png","thumb_width":48,"thumb_height":48,"from_url":"https://github.com/vim/vim/compare/master...ichizok:feature/mbyte-screenchar","original_url":"https://github.com/vim/vim/compare/master...ichizok:feature/mbyte-screenchar"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"c278a1f9-17a7-4d83-92b7-8b847937f178","type":"message","user":"U7986PPFH","text":"```\n--- a/src/testdir/test_listchars.vim\n+++ b/src/testdir/test_listchars.vim\n@@ -130,7 +130,7 @@ func Test_listchars_composing()\n         \\ ]\n   redraw!\n   call cursor(1, 1)\n-  let got = ScreenLines(1, virtcol('$'))\n+  let got = ScreenLines(1, virtcol('$'), 1)\n   bw!\n   call assert_equal(expected, got)\n   let &amp;encoding=oldencoding\n--- a/src/testdir/view_util.vim\n+++ b/src/testdir/view_util.vim\n@@ -7,7 +7,7 @@ endif\n\n \" ScreenLines(lnum, width) or\n \" ScreenLines([start, end], width)\n-function! ScreenLines(lnum, width) abort\n+function! ScreenLines(lnum, width, ...) abort\n   redraw!\n   if type(a:lnum) == v:t_list\n     let start = a:lnum[0]\n@@ -16,9 +16,10 @@ function! ScreenLines(lnum, width) abort\n     let start = a:lnum\n     let end = a:lnum\n   endif\n+  let utf8 = get(a:000, 0, 0)\n   let lines = []\n   for l in range(start, end)\n-    let lines += [join(map(range(1, a:width), 'nr2char(screenchar(l, v:val))'), '')]\n+    let lines += [join(map(range(1, a:width), 'nr2char(screenchar(l, v:val, utf8), utf8)'), '')]\n   endfor\n   return lines\n endfunction\n```","ts":"1551428953.006900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"fafe74df-3315-4275-bbd2-8896a821f7cf","type":"message","user":"U7986PPFH","text":"↑で <https://github.com/vim/vim/pull/4046> のCI通るようにできました","ts":"1551429075.007600","attachments":[{"fallback":"GitHub: Fix listchars with composing character by mattn · Pull Request #4046 · vim/vim","id":1,"title":"Fix listchars with composing character by mattn · Pull Request #4046 · vim/vim","title_link":"https://github.com/vim/vim/pull/4046","text":"Repro step: test.txt ゙ ゚ # vim:set list listchars=eol\\:$,space\\:_: $ xxd test.txt 00000000: 2020 e382 9909 20e3 829a 0a0a 2320 7669 .... .....# vi 00000010: 6d3a 7365 7420 6c69 7374 20...","thumb_url":"https://avatars1.githubusercontent.com/u/10111?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://cfr.slack-edge.com/bfaba/img/unfurl_icons/github.png","thumb_width":250,"thumb_height":250,"from_url":"https://github.com/vim/vim/pull/4046","original_url":"https://github.com/vim/vim/pull/4046"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a1bed541-99de-45f6-be98-acb6fc1e661b","type":"message","user":"U03C6TEAZ","text":"おー","ts":"1551429092.007900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"4b4517f8-8e3b-452f-aa1f-268e2e2ffbaa","type":"message","user":"U7986PPFH","text":"testとdoc作ったらPR出しておきます(feature/mbyte-screenchar)","ts":"1551429173.008500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"55e326f7-5f11-40f0-bc6a-28fc3c8c8aa4","type":"message","user":"U03C6TEAZ","text":"ありがとうございます。","ts":"1551429223.008900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"c1a587c8-9a9d-4bd8-a689-4620510884ca","type":"message","user":"U03C6TEAZ","text":"screenchar はテスト以外にも使いたいユーザいると思うので皆幸せになれそう。","ts":"1551429256.009600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UGK3485DM","text":"<@UGK3485DM> has joined the channel","ts":"1551429793.009800","subtype":"channel_join","replace_original":false,"delete_original":false,"blocks":null}]
