[{"client_msg_id":"28b54ce5-e4cc-4dc4-8eaf-083a6fb20fae","type":"message","user":"U03C6TEAZ","text":"バカでかい DB があって今も尚増え続けてて、そのサーバをなるべく停止時間なく(もしくは短く)新しい OS に入れ替える(別に立ててスイッチ)となった場合、どんな案が考えられますかね。","ts":"1594962215.040300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"fmu"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a7589b1c-ee32-464b-8012-cccf9b9d77bd","type":"message","user":"U06ECBRTJ","text":"レプリケーション作るしか無いんじゃないですかね？","ts":"1594962244.040700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ewt"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"b6880c2e-f3c2-4ec7-bd38-5cd14ec95301","type":"message","user":"U06ECBRTJ","text":"レプリケーションのためのダンプに時間かかると思いますが…","ts":"1594962262.041100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"XqR"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"4d0e9d63-94ab-4c7d-8e10-e271818476a7","type":"message","user":"U03C6TEAZ","text":"そうなんすよね。その時間をなんとかしたい。","ts":"1594962296.041700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"1Xvs"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"ddded407-dbbe-45ee-af40-c6deabae518b","type":"message","user":"U06ECBRTJ","text":"ちなみにどのサービスですかね？","ts":"1594962300.041800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"fr0l"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"53bf7575-2034-4701-8b7a-d7e517b8e1e8","type":"message","user":"U03C6TEAZ","text":"クラウドサーバ上で動かしてる postgresql す。","ts":"1594962327.042300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"/7xz"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"8673048c-127f-47fb-842d-3740a5abc96a","type":"message","user":"U03C6TEAZ","text":"SLA 高いを売り文句にしてるので落としたくないなぁと。","ts":"1594962393.042900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"1/qJ"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"e833afac-0536-4e90-9ebb-2a7ea03c2a8f","type":"message","user":"U06ECBRTJ","text":"あー セルフホスティングですか","ts":"1594962469.043900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"2QTE"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"211e56da-f9bb-4947-adcf-6aa5a61069e9","type":"message","user":"U06ECBRTJ","text":"RDS とかのマネージドじゃないんですね","ts":"1594962480.044200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Br6A"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"854b2320-e7a6-43d6-9087-ca4e585e1c42","type":"message","user":"U06ECBRTJ","text":"(マネージドだったらOS入れ替え無いやろ","ts":"1594962489.044500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"S+t71"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"6942aa1b-fbef-4b90-8904-db0999a1e41d","type":"message","user":"U06ECBRTJ","text":"すでにレプリケーションしてるレプリカは無いですかね？","ts":"1594962522.045100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"x2Wu"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"68227d7e-3d61-4f6e-8840-23d3ff30c760","type":"message","user":"U06ECBRTJ","text":"(この書き方なら無いんだろうなぁ…)","ts":"1594962562.045500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"dTK3f"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"1e6839ff-91af-4e5f-bf48-1f7f4eeb2c8c","type":"message","user":"U06ECBRTJ","text":"<https://www.ydc.co.jp/solution/standby/article/postgres_2.html>","ts":"1594962638.045900","attachments":[{"fallback":"株式会社YDC: YDC | PostgreSQLのレプリケーション環境構築","id":1,"title":"YDC | PostgreSQLのレプリケーション環境構築","title_link":"https://www.ydc.co.jp/solution/standby/article/postgres_2.html","text":"ストリーミング・レプリケーションは、PostgreSQLのレプリカを作成する標準機能です。","blocks":null,"service_name":"株式会社YDC","service_icon":"https://www.ydc.co.jp/favicon.ico","from_url":"https://www.ydc.co.jp/solution/standby/article/postgres_2.html","original_url":"https://www.ydc.co.jp/solution/standby/article/postgres_2.html"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"CZlS"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"3b3e61b4-4aef-4751-987f-7e17087d9a64","type":"message","user":"U06ECBRTJ","text":"pg_basebackup ってコマンドを使うらしい","ts":"1594962660.046800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"s7+1"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"ca3f902a-bf5d-44c9-956c-53220176b279","type":"message","user":"U06ECBRTJ","text":"<https://gihyo.jp/dev/feature/01/dex_postgresql/0004#sec1_h4>","ts":"1594962682.047300","attachments":[{"fallback":"gihyo.jp: 第4章　PostgreSQL の運用に便利な機能―バックアップ，レプリケーション，パーティション，バージョンアップ","id":1,"title":"第4章　PostgreSQL の運用に便利な機能―バックアップ，レプリケーション，パーティション，バージョンアップ","title_link":"https://gihyo.jp/dev/feature/01/dex_postgresql/0004#sec1_h4","text":"最終章は運用についてです。運用でまず重要なのは，バックアップとリストアです。","image_url":"https://gihyo.jp/assets/images/ICON/2019/1740_dex_postgresql.png","blocks":null,"service_name":"gihyo.jp","from_url":"https://gihyo.jp/dev/feature/01/dex_postgresql/0004#sec1_h4","original_url":"https://gihyo.jp/dev/feature/01/dex_postgresql/0004#sec1_h4"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"WjO"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"4a444e0b-84bc-411e-aef8-9e600eea74f3","type":"message","user":"U03C6TEAZ","text":"無いんですよねー。 pgpool で立てる準備だけはしてあるんですが、複製中も増え続けるのをどうすべきかなーと。","ts":"1594962691.047900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"6Mn"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"75fd0880-e19e-4648-bef2-3b46039511e0","type":"message","user":"U06ECBRTJ","text":"pg_basebackup は停止し無くても大丈夫らしい","ts":"1594962708.048200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"2DRk"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"9e82c8a5-a1f8-4d89-804c-1b789aa7285a","type":"message","user":"U03C6TEAZ","text":"pg_basebackup でとって別のサーバに持っていって取り込んでる最中も増え続けるので。","ts":"1594962738.048800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"HYVwO"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"c9d5fd3b-4034-46ef-905c-ebba8f79348f","type":"message","user":"U06ECBRTJ","text":"取り込み終わったら、WAL で同期されますよね？","ts":"1594962820.049200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"z+F"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"369a5bd0-c6da-4104-9b96-7b63628fb316","type":"message","user":"U06ECBRTJ","text":"同期が完全になった状態で、エントリポイントを切り替える\nにしても、やっぱりダウンタイム必要になりそうな予感…","ts":"1594962876.050100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ogCX"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"8320bde3-ebfb-4b7b-8496-c7ea5ef9f0e8","type":"message","user":"U06ECBRTJ","text":"リハーサル環境用意して、やってみるしか無いんじゃないですかね…","ts":"1594962907.050600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"x7UUh"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"c9696ba6-4a3f-4d4c-b04a-5f8e71e06dc8","type":"message","user":"U03C6TEAZ","text":"ですよねー。最初からレプリカ意識しておけばよかった感。","ts":"1594963033.052000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"pAU+D"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"0acbc3cd-c6ed-4e54-9ad5-9340a678d43c","type":"message","user":"U06ECBRTJ","text":"SLA高いの目指すなら、レプリカは必須でしたね…","ts":"1594963050.052400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"f0zh"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"806df0bd-9d79-4a13-9ace-5919c8fe8b6b","type":"message","user":"U06ECBRTJ","text":"(負荷軽減にも使えるし","ts":"1594963063.052700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"VsjHW"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"adbcdbe6-d5bd-493a-8add-769f595a7c8f","type":"message","user":"U03C6TEAZ","text":"DB が巨大すぎてあまりお金掛けたくないって言われてしまって。","ts":"1594963132.053100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"xlH"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"2485b7be-c166-4505-b5f1-f509ac7a26f6","type":"message","user":"U06ECBRTJ","text":"SLA と矛盾してる気がする…","ts":"1594963328.053400","team":"T03C4RC8V","reactions":[{"name":"sorena","count":2,"users":["U03C6TEAZ","U7B4ZD49X"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"xkR"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"b1385099-aa2a-4b20-9251-97919e4dd19a","type":"message","user":"U06ECBRTJ","text":"お金をかけることで、保険をかけて、落ちないようにしてるから、SLA が高いというはずなのに…","ts":"1594963387.054200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"VzKjP"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"02602f0b-cdcf-4e7d-aeea-379ea862c6ca","type":"message","user":"U03C6TEAZ","text":"今まで人間技だけで SLA 高めてたので何も言い訳ができないw","ts":"1594963455.054900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"s1N"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"18d68bc9-1be1-43ab-9a83-c947dd2bd4b3","type":"message","user":"U06ECBRTJ","text":"mattn さんやプロジェクトのメンバーさんが人間技高いのはもちろん認めるんですが","ts":"1594963494.055500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"=vAo"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"d732b035-fd76-48ec-857b-ae8ef4640f66","type":"message","user":"U06ECBRTJ","text":"結論としてはリハーサルして、ダウンタイム考えて、お客さんに飲んで頂く\nですかね…\nセルフホスティングじゃなくて、RDS のようなマネージドに移すのもありだと思います。\nまぁ、結局高くなるんですが","ts":"1594963637.056900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"APT"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"076098a7-65cb-4b12-b83f-e5102a1ab66b","type":"message","user":"U03C6TEAZ","text":"今から数年かけて終息させるプロジェクトなのでお金使えないんですよねw","ts":"1594963725.057400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"g6JV"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"09d8b0eb-c538-4d11-a6ef-da5f7db744f8","type":"message","user":"U06ECBRTJ","text":"Oh…","ts":"1594963736.057600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"oj0H"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"3a9fa11e-2d23-42b1-99c3-d018cc3ffbc1","type":"message","user":"U06ECBRTJ","text":"~手が滑ってDB全部消して今すぐ終わらせたくなる…~","ts":"1594963772.058000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"RvP"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"77b13c5e-7ab5-4a64-a379-05aa970dad3d","type":"message","user":"U03C6TEAZ","text":"まぁちょっと止めさせてもらう、が一番正しい気がする。","ts":"1594963792.058500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"CiF"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"536af042-fb14-4b46-929e-13e146000be5","type":"message","user":"U03C6TEAZ","text":"失敗もないし。","ts":"1594963812.058800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"yHQ"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"13f5e6f0-4e34-4bf4-8361-211c5a48c567","type":"message","user":"U03C6TEAZ","text":"ちょっと、がどれくらいかはリハーサルするしかない。","ts":"1594963831.059100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"z19"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"7a2480b2-c778-40b2-aeb6-84a1ccc8754c","type":"message","user":"U06ECBRTJ","text":"ですね","ts":"1594963937.059400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ad6A"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"8b133d45-7afb-41c6-9d93-5ec5606ae6bd","type":"message","user":"U03C6TEAZ","text":"一応、日別のバックアップファイルはあるので、移行先でギリまで取り込んでおいて停止中に当日分だけ移行、みたいな事するのがいいかな。","ts":"1594964408.060500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"6Yqu7"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"ccc66339-a012-4577-9152-55dbbd13ffd1","type":"message","user":"U06ECBRTJ","text":"pg_dump のデータですかね？","ts":"1594964484.061100","edited":{"user":"U06ECBRTJ","ts":"1594964490.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"vVhO"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"71507de1-2f6b-4b15-9bc4-59777d7793d1","type":"message","user":"U06ECBRTJ","text":"<https://www.fujitsu.com/jp/products/software/resources/feature-stories/postgres/article-index/streaming-replication1/>","ts":"1594965163.061400","attachments":[{"fallback":"ストリーミングレプリケーション ～仕組み、構成のポイント～｜PostgreSQLインサイド : 富士通","id":1,"title":"ストリーミングレプリケーション ～仕組み、構成のポイント～｜PostgreSQLインサイド : 富士通","title_link":"https://www.fujitsu.com/jp/products/software/resources/feature-stories/postgres/article-index/streaming-replication1/","text":"PostgreSQLのストリーミングレプリケーションについて解説。データベースクラスタを一括して複製する仕組みと構成のポイントを説明します。","blocks":null,"service_name":"fujitsu.com","service_icon":"https://www.fujitsu.com/favicon.ico","from_url":"https://www.fujitsu.com/jp/products/software/resources/feature-stories/postgres/article-index/streaming-replication1/","original_url":"https://www.fujitsu.com/jp/products/software/resources/feature-stories/postgres/article-index/streaming-replication1/"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"SKTs"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a86a0c4a-f53c-43b0-9c04-615e23779715","type":"message","user":"U06ECBRTJ","text":"これが良かった さすが fujitsu","ts":"1594965172.061800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"zhj"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"}]
