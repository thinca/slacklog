[{"client_msg_id":"c423d37e-2d0e-4a6b-8284-08a5fc2e511b","type":"message","user":"U06BRP8VD","text":"え、じゃあ diff ないと -d 動かんのw まぁ僕の環境は入ってるけど。","ts":"1593785856.023900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"qjwUw"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"1353f411-bb03-4482-8dea-878b04760911","type":"message","user":"U06BRP8VD","text":"<https://vim-jp.slack.com/archives/CJMV3MSLR/p1593711231177500>","ts":"1593742155.009300","attachments":[{"fallback":"[July 2nd, 2020 10:33 AM] bamchoh: すみません質問なのですが、以下のようなGoのコードを書いて保存すると、`package` の行が削除されてしまうようでして、何か回避策があるのかお伺いしたいのです。\n```package main\n\nfunc main() {\n\tfmt.Println(\"test\")\n}```\n↑このようなコードを作成して保存すると、↓のようなコードに整形されます。\n```\nimport \"fmt\"\n\nfunc main() {\n\tfmt.Println(\"test\")\n}```\n私のほうでも少しだけ調べてみたのですが、<https://github.com/mattn/vim-goimports/blob/master/autoload/goimports.vim#L140> をコメントアウトすると `package` も削除されず `import` も挿入されました。","id":1,"author_id":"U78UYGX8W","author_name":"bamchoh","author_subname":"bamchoh","author_link":"https://vim-jp.slack.com/team/U78UYGX8W","author_icon":"https://secure.gravatar.com/avatar/175c2b6ed51169eb6ecb0b99ee47d5eb.jpg?s=48&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0013-48.png","text":"すみません質問なのですが、以下のようなGoのコードを書いて保存すると、`package` の行が削除されてしまうようでして、何か回避策があるのかお伺いしたいのです。\n```package main\n\nfunc main() {\n\tfmt.Println(\"test\")\n}```\n↑このようなコードを作成して保存すると、↓のようなコードに整形されます。\n```\nimport \"fmt\"\n\nfunc main() {\n\tfmt.Println(\"test\")\n}```\n私のほうでも少しだけ調べてみたのですが、<https://github.com/mattn/vim-goimports/blob/master/autoload/goimports.vim#L140> をコメントアウトすると `package` も削除されず `import` も挿入されました。","mrkdwn_in":["text"],"blocks":null,"footer":"Posted in #question","ts":1593711231.177500,"from_url":"https://vim-jp.slack.com/archives/CJMV3MSLR/p1593711231177500","original_url":"https://vim-jp.slack.com/archives/CJMV3MSLR/p1593711231177500"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"O9Uk"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"da3c133b-2d57-4acb-8f95-2277c68314bc","type":"message","user":"U06BRP8VD","text":"<https://vim-jp.slack.com/archives/CJMV3MSLR/p1593741779189100>","ts":"1593742170.009600","attachments":[{"fallback":"[July 2nd, 2020 7:02 PM] koron: done (cc <@U03C6TEAZ>\n\n<https://github.com/mattn/vim-goimports/pull/10>","id":1,"author_id":"U06BRP8VD","author_name":"KoRoN","author_subname":"KoRoN","author_link":"https://vim-jp.slack.com/team/U06BRP8VD","author_icon":"https://secure.gravatar.com/avatar/4b5a6f711a4e22e617b74058239ade53.jpg?s=48&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0007-48.png","text":"done (cc <@U03C6TEAZ>\n\n<https://github.com/mattn/vim-goimports/pull/10>","mrkdwn_in":["text"],"blocks":null,"footer":"Posted in #question","ts":1593741779.189100,"from_url":"https://vim-jp.slack.com/archives/CJMV3MSLR/p1593741779189100","original_url":"https://vim-jp.slack.com/archives/CJMV3MSLR/p1593741779189100"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"7EU"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"cae052d2-4140-4299-8500-022e7a3104d2","type":"message","user":"U06ECBRTJ","text":"8分でマージされとる","ts":"1593742457.010000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"c=aFq"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"ff8e82b4-4c34-4985-9f71-412c4d466d56","type":"message","user":"U06BRP8VD","text":"&gt; 本来goのファイルは ff=unix でソースを書くべき\nって雑に書いちゃったけど、これは真かね?","ts":"1593742496.010500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ctkz"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"32f20fd4-111f-4926-bc9b-60f191a154b7","type":"message","user":"U06BRP8VD","text":"go build とか通っちゃうから禁じてはいないってことなんだろうけれど…","ts":"1593742512.010900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"J7Sm"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"ac396c7e-7771-4f1a-bf5b-5a4653dbb837","type":"message","user":"U06ECBRTJ","text":"<https://stakiran.hatenablog.com/entry/2019/08/19/191600>","ts":"1593742557.011100","attachments":[{"fallback":"stamemo: Golang で書き込むファイルの文字コードは LF 固定であるということ(CRLF はサポートしていない) - stamemo","id":1,"title":"Golang で書き込むファイルの文字コードは LF 固定であるということ(CRLF はサポートしていない) - stamemo","title_link":"https://stakiran.hatenablog.com/entry/2019/08/19/191600","text":"Python の時はちゃんと CRLF で書いてくれていたが、Golang だと LF 固定になる模様。Go 公式も「CRLF はサポートしない」と結論を出している。 試したコード CRLF をサポートしない、の根拠は？ 試したコード func list2file(filepath string, lines []string) { fp, err := os.Create(filepath) if err != nil { abort(err.Error()) } defer fp.Close() writer := bufio.NewWriter(fp) for _, line := ra…","image_url":"https://ogimage.blog.st-hatena.com/8599973812298012193/26006613400064696/1566209760","blocks":null,"ts":1566209760,"service_name":"stamemo","service_icon":"https://cdn.image.st-hatena.com/image/apple_touch_icon/5337c11a08292808e2c604bc891daf1a82f561aa/version=1/https%3A%2F%2Fcdn.user.blog.st-hatena.com%2Fcustom_blog_icon%2F142977289%2F1514250697693284","from_url":"https://stakiran.hatenablog.com/entry/2019/08/19/191600","original_url":"https://stakiran.hatenablog.com/entry/2019/08/19/191600"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"54vCv"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"facbe7e5-ddef-4600-8368-4601811bf90b","type":"message","user":"U06BRP8VD","text":"これはos.File.WriteでGoが出力する改行の話、なんですよね。","ts":"1593742608.011700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"uKaXF"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a50a22e3-f8d7-40cb-9a62-8ea5081fed2f","type":"message","user":"U06BRP8VD","text":"Goのコードを書く時の改行に使うコードの指定があるのか、を知りたい。","ts":"1593742621.012200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"=HB"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"b6be8403-00a8-4ee6-bc0c-b96ace42ab4a","type":"message","user":"U06ECBRTJ","text":"そうでした","ts":"1593742624.012400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"h0UD"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"1a05be9c-904b-4e43-b29a-01fa351b0090","type":"message","user":"U06BRP8VD","text":"ここを見てる途中でとりあえずあのPR先にした。\n<https://golang.org/ref/spec>","ts":"1593742643.012800","attachments":[{"fallback":"The Go Programming Language Specification - The Go Programming Language","id":1,"title":"The Go Programming Language Specification - The Go Programming Language","title_link":"https://golang.org/ref/spec","text":"Go is an open source programming language that makes it easy to build simple, reliable, and efficient software.","blocks":null,"service_name":"golang.org","service_icon":"https://golang.org/favicon.ico","from_url":"https://golang.org/ref/spec","original_url":"https://golang.org/ref/spec"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"44eUC"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a015c45f-8998-4f3e-952b-e5bac507ee62","type":"message","user":"U06BRP8VD","text":"ざっくり読み取れたことを書くと以下の通り。\n\n1. newlineはLFで改行に使う\n2. CRは空白扱いでいくつかの場所では単に無視される\n\nCRLFは許容しないとは書かれてないし、単体のLFでなければならないとも書いてない。まぁそりゃそうか。","ts":"1593742996.015000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"tDIf"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"8a443108-8b99-4578-b917-f035585b8791","type":"message","user":"U03C71D7H","text":"改行コード抜きで、ファイルの先頭部分に diff が発生することはあるだろうか。あるとしたらバグるかも?","ts":"1593743784.015600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ALM4"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"0a79e999-0aca-417e-a585-12a7e8d51edc","type":"message","user":"U06BRP8VD","text":"いまはないかな","ts":"1593743804.015900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"iJB"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"bee231d5-e686-4b6c-a302-204123245f33","type":"message","user":"U03C71D7H","text":"PR 作成 &amp; マージありがとうございます！","ts":"1593743807.016100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"N7MiA"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"30654b61-98cf-4cd4-a394-478c707d504b","type":"message","user":"U03C6TEAZ","text":"マージボタンを押す準備はいつでもできています。","ts":"1593743817.016500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"0xL"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"33fa7944-a3c4-4d30-954b-ecfb9a4fc840","type":"message","user":"U06BRP8VD","text":"ああpakcage のまえに空行があるケースはそう(=ファイルの先頭に削除)なるかも","ts":"1593743848.017100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"pWc"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"0b13304b-d215-4d27-9b25-69960a8f355f","type":"message","user":"U06BRP8VD","text":"あとは `package  main` みたいに2文字空いてるケース","ts":"1593743872.017500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"x8JvZ"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"080c6e45-1456-4642-858e-5ef592dc221d","type":"message","user":"U06BRP8VD","text":"たしかめてみるかー","ts":"1593743876.017800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"R2Kg"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"b4e41bdb-035c-4a8c-a142-dbba56a007c6","type":"message","user":"U06BRP8VD","text":"ちゃんとうごいた","ts":"1593743909.018000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"IBO"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"1161f622-eeb1-4feb-b759-78bc9c1bd88d","type":"message","user":"U03C71D7H","text":"ふしぎ","ts":"1593743915.018200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"W=Ml"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"bbab35c4-8994-4ca8-af76-83ff0a61b393","type":"message","user":"U06BRP8VD","text":"全行に変更が走るこんなのも試したけど大丈夫っぽい。\n\n```package    main\nfunc main()   {\n\tfmt.Println    (\"Hello\")\n    }```","ts":"1593743983.018700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"X51vi"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"113c326e-5ba6-4ebf-8788-9eef6c80bd75","type":"message","user":"UAZ33BKV2","text":"上の仕様を考えると、厳密には受けたファイルから改行を加味した正しいdiffを返してないgoimportsが若干問題な気がしないでもない(禁止じゃないし、コンパイラが許容するファイルであかん結果出したの意味で)...?","ts":"1593745297.020300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"VF1"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"d9bdfcab-b445-46bd-96ce-81795e534a80","type":"message","user":"U06BRP8VD","text":"いや goimports は正しいんですよ。改行コードを全部 LF に統一しようとしているだけ。","ts":"1593749890.020900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"VOQC7"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"e4751086-5de1-4711-8601-5609cd07dcb1","type":"message","user":"UAZ33BKV2","text":"あー、まあそうですね、うん。","ts":"1593750338.022200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"7G3g"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"b53bbd67-8f31-4f0a-b5c4-7aa13a6389e1","type":"message","user":"U03C71D7H","text":"goimports は内部で結果のファイル作って、diff モードにした場合はシンプルに diff コマンド叩いてた","ts":"1593752945.022900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"yRVEK"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U014R220UD8","text":"<@U014R220UD8> has joined the channel","ts":"1593754153.023100","subtype":"channel_join","replace_original":false,"delete_original":false,"blocks":null}]
