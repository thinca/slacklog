[{"client_msg_id":"908b80a9-a82b-463e-a566-0b287b162ffe","type":"message","user":"U7H4TJEG0","text":"LockOSThread呼んで直るか試すよう返事してみた。ありがとございます。","ts":"1593414023.397900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"/Sz"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"8fa26638-5741-4c7a-991e-65a2e4a605af","type":"message","user":"U06BRP8VD","text":"それを呼んだ goroutine が 1 thread 占有しちゃうやつ。","ts":"1593414478.398600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"CjWW"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"7190e756-2079-4252-a49d-e01b9a53f471","type":"message","user":"U03C6TEAZ","text":"普通の goroutine (main goroutine 含め)、ランタイムの都合によってコロコロとスレッドを移り住んでしまうんですよね。","ts":"1593414520.399300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"KAE="}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a07f7851-731c-4204-b567-3c610ff43cfc","type":"message","user":"U03C6TEAZ","text":"それを止めるのが `runtime.LockOSThreads()`","ts":"1593414530.399600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"tIVM"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"24838d0c-52b8-4ad3-a41b-f5c51852e6a1","type":"message","user":"U06BRP8VD","text":"<https://golang.org/pkg/runtime/#LockOSThread>\n\n&gt; no other goroutine will execute in it\n止めるだけじゃなくて、そのスレッドでは別の goroutine を実行することもなくなっちゃうらしいんですよ。なのでまちがってたくさん LockOSThread することになると…","ts":"1593415152.400700","attachments":[{"fallback":"runtime - The Go Programming Language","id":1,"title":"runtime - The Go Programming Language","title_link":"https://golang.org/pkg/runtime/#LockOSThread","text":"Go is an open source programming language that makes it easy to build simple, reliable, and efficient software.","blocks":null,"service_name":"golang.org","service_icon":"https://golang.org/favicon.ico","from_url":"https://golang.org/pkg/runtime/#LockOSThread","original_url":"https://golang.org/pkg/runtime/#LockOSThread"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ZQU"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"b45facbb-fd3d-4e4f-a615-31ec6dcdd917","type":"message","user":"U03C6TEAZ","text":"goroutine 数 = スレッド数 に","ts":"1593415228.401100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"zD8Y"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"f43aa9f3-f7bd-49d8-bc06-f8b40f5dd72d","type":"message","user":"UAZ33BKV2","text":"いまだと最低2コアはあるからいいけど1コアだけだと死亡確定的な...","ts":"1593415367.401600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"+l4F"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"aa43f036-ee5a-4c26-827c-ead09762df91","type":"message","user":"U06BRP8VD","text":"たしか1万スレッドでgoはとまります…","ts":"1593415503.402100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"MH2W"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"0f219949-f7ec-4e8b-8b90-07c1271d51e4","type":"message","user":"U06BRP8VD","text":"スレッドコンテキストの切り替えで遅いけどたぶんうごきますよ。1コアでも。","ts":"1593415536.402700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"OCxhM"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"87fa10bd-3915-4bc4-b97b-c7a88ef0cbd2","type":"message","user":"UAZ33BKV2","text":"あいえ、そこでこのロックしたらなーと","ts":"1593415548.403000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"CBla4"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"f9b4a6eb-50fb-46f6-8868-bdc388bd98bb","type":"message","user":"U06BRP8VD","text":"これはOSスレッドを固定するだけなので、スレッドはバンバン作られるんですよ。","ts":"1593415568.403400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"hnv"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"28b9dfe6-03b6-4711-8244-bb9918090be4","type":"message","user":"UAZ33BKV2","text":"あ、いいのかOSのスレッドがあるから、なるほど了解です。","ts":"1593415579.403700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"NEE/"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"bb6a4662-3fbd-459f-8493-fc21195ec557","type":"message","user":"U06BRP8VD","text":"で1万OSスレッドでpanicですw","ts":"1593415590.404000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"dZH"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"d8387f15-bbd7-4ba3-8d52-af5594f90f3d","type":"message","user":"UAZ33BKV2","text":"あははw","ts":"1593415594.404200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"tzx"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"b0a29fd9-59fa-4085-a759-579788831b4f","type":"message","user":"U7H4TJEG0","text":"<https://github.com/itchyny/volume-go/issues/11> Windows何もわからない… 毎回CoInitializeExしてCoUninitializeするだと何かリソースリークしてるのかな…","ts":"1593402790.391500","attachments":[{"fallback":"GitHub: Win10 errors after a while · Issue #11 · itchyny/volume-go","id":1,"title":"Win10 errors after a while · Issue #11 · itchyny/volume-go","title_link":"https://github.com/itchyny/volume-go/issues/11","text":"I&amp;#39;m fetching mute status every 10 seconds and report it via MQTT. This does work fine but will fail after a while. The first error translates to CoInitialize has not been called. 2020/06/25 15:...","thumb_url":"https://avatars3.githubusercontent.com/u/375258?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/80588/img/unfurl_icons/github.png","thumb_width":400,"thumb_height":400,"from_url":"https://github.com/itchyny/volume-go/issues/11","original_url":"https://github.com/itchyny/volume-go/issues/11"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"gObuP"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"5c239d34-7c6d-4e20-b5d1-0683279632cd","type":"message","user":"U7H4TJEG0","text":"API叩いてみて失敗したときにCoInitializeEx呼ぶのがいいのかな。Uninitializeいつ呼べばいいか分からないけど。","ts":"1593402866.392300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"7nHC"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"86a8927c-1548-4929-bc5d-7cbed1435eb5","type":"message","user":"U03C6TEAZ","text":"go-wca も go-ole 使ってるから CoUninitialize されたあと CoInitializeEx 呼ばれずに COM 操作でもしてるんかなと思ったけど、違うかな？","ts":"1593406504.393100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"fcPKg"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"2b9e04ad-4493-4172-8482-2f1bd62b7a61","type":"message","user":"U7H4TJEG0","text":"go-wcaはole.CoInitializeExは自分で呼んでねみたいな感じなんですよね","ts":"1593408967.394500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ePQ"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"cb698608-6803-46c2-b5aa-3c7e6a97410c","type":"message","user":"U03C6TEAZ","text":"おそらく最初に CoInitializeEx 呼びっぱなしにしとけばよい気はします。","ts":"1593411349.395000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Cu61"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"ab399d0e-626d-4075-857c-25be2093ac36","type":"message","user":"U7H4TJEG0","text":"なんか別のスレッドになったらおかしくなったりしません？","ts":"1593411504.395500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ufB"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"fc7e5037-fb95-4a38-ae38-5ebe74190fb6","type":"message","user":"U03C6TEAZ","text":"もしかしたら runtime.LockOSThreads() でなおったり。","ts":"1593412176.395900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Xg6"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"4527c019-0941-40f5-b040-95dea951ca2c","type":"message","user":"U7H4TJEG0","text":"使ったことない関数だ…","ts":"1593412278.396100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"rCx"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"10dba6db-3ca2-4d04-8803-c89f1297effb","type":"message","user":"U03C6TEAZ","text":"issue の人、再現コード書いてくれたら後で試せるんですが。","ts":"1593413483.396500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"PcdGv"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"8540cdef-b9ff-4ad5-a963-1ae6118c9df2","type":"message","user":"U7H4TJEG0","text":"一日以上動かし続けたら突然おかしくなるとか言ってて謎い (10秒ごとにミュート状態を取得するモチベも謎)","ts":"1593413644.397400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"gp9nt"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"}]
