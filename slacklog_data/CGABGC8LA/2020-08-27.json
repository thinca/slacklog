[{"client_msg_id":"13a0dfa8-8fe8-4b2c-a62a-4d341ee387b7","type":"message","user":"U06BRP8VD","text":"I/Fの呼び出しは、関数 *変数* の呼び出しとほぼコスト一緒だった。関数そのものの呼び出しは爆速なんだけどたぶんこれはインライン展開だよな…","ts":"1598538794.257700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"tC3l"}]},{"client_msg_id":"110ab34a-0cbd-42ce-ad93-520cceb39780","type":"message","user":"UAZ33BKV2","text":"1パックにしてまるまるビルドして1実行ファイルにしちゃうとか...?","ts":"1598535193.256300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"CvxZ"}]},{"client_msg_id":"23eb1df1-5ba7-481b-92da-dcc1b678f6bb","type":"message","user":"U06BRP8VD","text":"これ以上を望むなら、I/Fを諦めるべきなのやろか…","ts":"1598535167.255900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"JHN"}]},{"client_msg_id":"c7593c85-a3f9-4908-8a99-8c53c7da8c5e","type":"message","user":"U03C6TEAZ","text":"グリグリ回すには遅いって言われますね。","ts":"1598523923.255300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"pWe"}]},{"client_msg_id":"a40ab072-93e7-4b16-828f-b0d1c2532286","type":"message","user":"U06BRP8VD","text":"いまざっくり計算したら decodeExec (でかいswitch) の1回あたりの実行時間 5.9 nano seconds で、fetchのほうは 4.0ns だった… fetch がやや大きい気がするがI/F呼び出しのオーバーヘッドってそんなもんかいねぇ?","ts":"1598521879.254300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"7VRVP"}]},{"client_msg_id":"180f8eaa-c209-4d02-b9af-3633e207a6bf","type":"message","user":"U03C6TEAZ","text":"おぉ","ts":"1598518690.250700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Q1f"}]},{"client_msg_id":"bb2036e9-b0e1-419f-b3fd-19ee3b8ae055","type":"message","user":"UNJ2DANJC","text":"ついに入った\n\u003chttps://github.com/golang/go/commit/e9ad52e46dee4b4f9c73ff44f44e1e234815800f|https://github.com/golang/go/commit/e9ad52e46dee4b4f9c73ff44f44e1e234815800f\u003e","ts":"1598516159.250400","attachments":[{"fallback":"GitHub: net: export ErrClosed · golang/go@e9ad52e","id":1,"title":"net: export ErrClosed · golang/go@e9ad52e","title_link":"https://github.com/golang/go/commit/e9ad52e46dee4b4f9c73ff44f44e1e234815800f","text":"This permits programs to reliably detect whether they are using a closed network connection. Fixes #4373 Change-Id: Ib4ce8cc82bbb134c4689f0ebc8b9b11bb8b32a22 Reviewed-on: \u003chttps://go-review.google\u003e...","thumb_url":"https://avatars3.githubusercontent.com/u/4314092?s=400\u0026v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/80588/img/unfurl_icons/github.png","thumb_width":250,"thumb_height":250,"from_url":"https://github.com/golang/go/commit/e9ad52e46dee4b4f9c73ff44f44e1e234815800f","original_url":"https://github.com/golang/go/commit/e9ad52e46dee4b4f9c73ff44f44e1e234815800f"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"u=r"}]},{"client_msg_id":"08e55dda-0a11-4c8e-bb87-da4cae0ba10e","type":"message","user":"U06BRP8VD","text":"これはむずいかも…キャッシュ部分が大きすぎて、お気楽にCPU作りまくってる単体テストが死ぬ。","ts":"1598515420.248900","team":"T03C4RC8V","reactions":[{"name":"naruhodo","count":1,"users":["UAZ33BKV2"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"7Ud"}]},{"client_msg_id":"92709ae4-4b76-48f6-ab28-1c66b50d4309","type":"message","user":"U06BRP8VD","text":"前者はL2キャッシュとかその辺のイメージ","ts":"1598513451.247900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"xGzD9"}]},{"client_msg_id":"a10221b0-ca69-49c2-bdb3-893eacddfb6e","type":"message","user":"UAZ33BKV2","text":"プリフェッチ/命令キャッシュと投機実行ですか、また大変そう","ts":"1598513409.247600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"xjyb6"}]},{"client_msg_id":"6d86cf7e-f37f-4454-ae3f-e66cae444585","type":"message","user":"U06BRP8VD","text":"キャッシュはともかく先読みは、破棄が大変そう。","ts":"1598513355.246900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"n2z"}]},{"client_msg_id":"ad8660b0-0cc7-481d-b27d-9094cf8260af","type":"message","user":"U06BRP8VD","text":"検討の結果、fetchはキャッシュ入れたら良いんじゃね? decodeExecはgoroutineで先読みすれば良いんじゃねって思いついたw\n\nほぼリアルCPUからのパクリだけど。","ts":"1598513336.246400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"dBXt"}]},{"type":"message","user":"U06BRP8VD","text":"ちなみにRyzen 9でのdecodeExecとfetchの実行時間の割合がこんな感じw Core i9だとこれが同じくらい(fetchも30secくらい)なのよね。","ts":"1598507091.244600","files":[{"id":"F019LCVNS1Z","created":1598507053,"timestamp":1598507053,"name":"image.png","title":"image.png","mimetype":"image/png","image_exif_rotation":0,"filetype":"png","pretty_type":"PNG","user":"U06BRP8VD","mode":"hosted","editable":false,"is_external":false,"external_type":"","size":39675,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F019LCVNS1Z/image.png","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F019LCVNS1Z/download/image.png","original_h":482,"original_w":386,"thumb_64":"https://files.slack.com/files-tmb/T03C4RC8V-F019LCVNS1Z-a99f3c919e/image_64.png","thumb_80":"https://files.slack.com/files-tmb/T03C4RC8V-F019LCVNS1Z-a99f3c919e/image_80.png","thumb_160":"https://files.slack.com/files-tmb/T03C4RC8V-F019LCVNS1Z-a99f3c919e/image_160.png","thumb_360":"https://files.slack.com/files-tmb/T03C4RC8V-F019LCVNS1Z-a99f3c919e/image_360.png","thumb_360_gif":"","thumb_360_w":288,"thumb_360_h":360,"thumb_480":"https://files.slack.com/files-tmb/T03C4RC8V-F019LCVNS1Z-a99f3c919e/image_480.png","thumb_480_w":384,"thumb_480_h":480,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U06BRP8VD/F019LCVNS1Z/image.png","permalink_public":"https://slack-files.com/T03C4RC8V-F019LCVNS1Z-d1a824e602","edit_link":"","preview":"","preview_highlight":"","lines":0,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"thumb_tiny":"AwAwACbSbGOelRuUAGMdafIcLUBye5oGTDaPTP0p4NQKecHNOcMTwOlAiWikXOOaWgBGOKYzgAcHrSycCom56D8xQMm3D0pSoPaoge2DU3NAhoUUu0Uwh88UfvPagB7KG603y19KfRQAzy19KfRR9aAD8KM0jdKbQB//2Q==","username":""}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"V7=Y"}]},{"client_msg_id":"86452674-2990-40e1-859c-63867a2dba0c","type":"message","user":"UAZ33BKV2","text":"そっか、実質継承的にか\nstruct、他のstructをベタに書くと含まれるようになるんでしたね...","ts":"1598506861.243900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"dhaWC"}]},{"client_msg_id":"38942267-fe7b-4de8-892f-f8c96f1cb103","type":"message","user":"U06BRP8VD","text":"`cpu.Memory.Get()` の呼び出しはこんな感じ。MemoryはどうしてもI/Fにしたかった。ROMとか混ざってるのを表現できるようにしておきたいので。","ts":"1598506838.243200","files":[{"id":"F019L6Q8SH0","created":1598506838,"timestamp":1598506838,"name":"Untitled","title":"Untitled","mimetype":"text/plain","image_exif_rotation":0,"filetype":"text","pretty_type":"プレーンテキスト","user":"U06BRP8VD","mode":"snippet","editable":true,"is_external":false,"external_type":"","size":429,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F019L6Q8SH0/untitled","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F019L6Q8SH0/download/untitled","original_h":0,"original_w":0,"thumb_64":"","thumb_80":"","thumb_160":"","thumb_360":"","thumb_360_gif":"","thumb_360_w":0,"thumb_360_h":0,"thumb_480":"","thumb_480_w":0,"thumb_480_h":0,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U06BRP8VD/F019L6Q8SH0/untitled","permalink_public":"https://slack-files.com/T03C4RC8V-F019L6Q8SH0-2de3a0de6d","edit_link":"https://vim-jp.slack.com/files/U06BRP8VD/F019L6Q8SH0/untitled/edit","preview":"\t0x0024 00036 (z80.go:112)\tMOVQ\t\"\".cpu+40(SP), AX\n\t0x0029 00041 (z80.go:112)\tMOVQ\t48(AX), CX\n\t0x002d 00045 (z80.go:112)\tMOVQ\t56(AX), DX\n\t0x0031 00049 (z80.go:112)\tMOVQ\t24(CX), CX\n\t0x0035 00053 (z80.go:112)\tMOVWLZX\t16(AX), BX","preview_highlight":"\u003cdiv class=\"CodeMirror cm-s-default CodeMirrorServer\" oncopy=\"if(event.clipboardData){event.clipboardData.setData('text/plain',window.getSelection().toString().replace(/\\u200b/g,''));event.preventDefault();event.stopPropagation();}\"\u003e\n\u003cdiv class=\"CodeMirror-code\"\u003e\n\u003cdiv\u003e\u003cpre\u003e    0x0024 00036 (z80.go:112)   MOVQ    \u0026quot;\u0026quot;.cpu+40(SP), AX\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e    0x0029 00041 (z80.go:112)   MOVQ    48(AX), CX\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e    0x002d 00045 (z80.go:112)   MOVQ    56(AX), DX\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e    0x0031 00049 (z80.go:112)   MOVQ    24(CX), CX\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e    0x0035 00053 (z80.go:112)   MOVWLZX 16(AX), BX\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","lines":10,"lines_more":5,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"FRH"}]},{"client_msg_id":"9170247c-c9b1-4a53-b50e-13dac75e5d73","type":"message","user":"U03C6TEAZ","text":"なんだろう。","ts":"1598506796.242700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"LlM"}]},{"client_msg_id":"e659066b-6d61-445b-8d4d-290d69a36588","type":"message","user":"U03C6TEAZ","text":"CPU に依存するしないとは関係ないな。","ts":"1598506790.242500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Ixy7F"}]},{"client_msg_id":"25536487-0307-4c89-9e81-79dbf4158422","type":"message","user":"U03C6TEAZ","text":"Memory が interface なので毎回 type assertion が実行されてるのかも。 `CPU.Memory.Get`","ts":"1598506763.242100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"bZZbM"}]},{"client_msg_id":"f563466b-0ff6-46c5-a2aa-3474d0a84228","type":"message","user":"U06BRP8VD","text":"PC は SPR → Status → CPU って感じで埋め込まれてるので、ちゃんとそこにあるんですよ。なお対応するアセンブラはこんな感じなので…埋め込みであることが問題になるってこと無さそう。","ts":"1598506726.241300","files":[{"id":"F019LCQ7W9Z","created":1598506724,"timestamp":1598506724,"name":"Untitled","title":"Untitled","mimetype":"text/plain","image_exif_rotation":0,"filetype":"text","pretty_type":"プレーンテキスト","user":"U06BRP8VD","mode":"snippet","editable":true,"is_external":false,"external_type":"","size":173,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F019LCQ7W9Z/untitled","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F019LCQ7W9Z/download/untitled","original_h":0,"original_w":0,"thumb_64":"","thumb_80":"","thumb_160":"","thumb_360":"","thumb_360_gif":"","thumb_360_w":0,"thumb_360_h":0,"thumb_480":"","thumb_480_w":0,"thumb_480_h":0,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U06BRP8VD/F019LCQ7W9Z/untitled","permalink_public":"https://slack-files.com/T03C4RC8V-F019LCQ7W9Z-3566a8a3dc","edit_link":"https://vim-jp.slack.com/files/U06BRP8VD/F019LCQ7W9Z/untitled/edit","preview":"\t0x0049 00073 (z80.go:113)\tMOVQ\t\"\".cpu+40(SP), CX\n\t0x004e 00078 (z80.go:113)\tMOVWLZX\t16(CX), DX\n\t0x0052 00082 (z80.go:113)\tINCL\tDX\n\t0x0054 00084 (z80.go:113)\tMOVW\tDX, 16(CX)","preview_highlight":"\u003cdiv class=\"CodeMirror cm-s-default CodeMirrorServer\" oncopy=\"if(event.clipboardData){event.clipboardData.setData('text/plain',window.getSelection().toString().replace(/\\u200b/g,''));event.preventDefault();event.stopPropagation();}\"\u003e\n\u003cdiv class=\"CodeMirror-code\"\u003e\n\u003cdiv\u003e\u003cpre\u003e    0x0049 00073 (z80.go:113)   MOVQ    \u0026quot;\u0026quot;.cpu+40(SP), CX\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e    0x004e 00078 (z80.go:113)   MOVWLZX 16(CX), DX\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e    0x0052 00082 (z80.go:113)   INCL    DX\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e    0x0054 00084 (z80.go:113)   MOVW    DX, 16(CX)\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","lines":4,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ll8"}]},{"client_msg_id":"a2350f45-42ec-4597-a15a-b15e3698d567","type":"message","user":"UAZ33BKV2","text":"あの、struct CPUにPCは定義がないっぽいですが、そこで参照のためにあれこれな処理が走ったりする可能性ってありますかね?\n(goがまだつかめてないので、初歩的なことを聞いている気がする)","ts":"1598505824.240300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"dSQ3Z"}]},{"client_msg_id":"d8d3a675-1b5a-453a-a24b-e1624dc43876","type":"message","user":"U06BRP8VD","text":"ただわからないというか腑に落ちないのは fetch のこの3行が、Core i9 で30%以上、Ryzen で50%以上を占めてるんですよね…\n\u003chttps://github.com/koron-go/z80/blob/ff74e3782ac3f6cebed404be368417afb62a90d7/z80.go#L111-L115\u003e","ts":"1598505289.239000","attachments":[{"fallback":"GitHub: koron-go/z80","id":1,"title":"koron-go/z80","title_link":"https://github.com/koron-go/z80/blob/ff74e3782ac3f6cebed404be368417afb62a90d7/z80.go#L111-L115","text":"WIP: Experimental Z80 emulator. Contribute to koron-go/z80 development by creating an account on GitHub.","thumb_url":"https://avatars3.githubusercontent.com/u/37774098?s=400\u0026v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/80588/img/unfurl_icons/github.png","thumb_width":400,"thumb_height":400,"from_url":"https://github.com/koron-go/z80/blob/ff74e3782ac3f6cebed404be368417afb62a90d7/z80.go#L111-L115","original_url":"https://github.com/koron-go/z80/blob/ff74e3782ac3f6cebed404be368417afb62a90d7/z80.go#L111-L115"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"JwmV"}]},{"client_msg_id":"742b4c51-27c7-48ea-b8bd-c4dab5617030","type":"message","user":"U06BRP8VD","text":"CPUnoクロックは Core i9のが高いんですよね。メモリクロックは Ryzen 9 なんですが、Z80エミュってシングルスレッドでキャッシュに乗るはずなのでCore i9有利にでるみたい。","ts":"1598505201.238200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"1tu"}]},{"client_msg_id":"a6d219e4-f588-43d2-ad86-796bda646ae5","type":"message","user":"UAZ33BKV2","text":"処理1セットの個別の部分にネックがあるだけで、どちらも通過する、とかですかね。ならそうか","ts":"1598505109.236500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Gh="}]},{"client_msg_id":"41f229f6-c332-445d-a45c-2c4e638a9069","type":"message","user":"U06BRP8VD","text":"Ryzen 9 の結果 (ff74e37)","ts":"1598505107.236100","thread_ts":"1598505107.236100","reply_count":1,"files":[{"id":"F019YQ8NUFK","created":1598505105,"timestamp":1598505105,"name":"Untitled","title":"Untitled","mimetype":"text/plain","image_exif_rotation":0,"filetype":"text","pretty_type":"プレーンテキスト","user":"U06BRP8VD","mode":"snippet","editable":true,"is_external":false,"external_type":"","size":2377,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F019YQ8NUFK/untitled","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F019YQ8NUFK/download/untitled","original_h":0,"original_w":0,"thumb_64":"","thumb_80":"","thumb_160":"","thumb_360":"","thumb_360_gif":"","thumb_360_w":0,"thumb_360_h":0,"thumb_480":"","thumb_480_w":0,"thumb_480_h":0,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U06BRP8VD/F019YQ8NUFK/untitled","permalink_public":"https://slack-files.com/T03C4RC8V-F019YQ8NUFK-f56a6c77e1","edit_link":"https://vim-jp.slack.com/files/U06BRP8VD/F019YQ8NUFK/untitled/edit","preview":"$ go test -bench . -benchmem\ngoos: windows\ngoarch: amd64\npkg: github.com/koron-go/z80\nBenchmark_addU8-32              418023792                2.84 ns/op            0 B/op          0 allocs/op","preview_highlight":"\u003cdiv class=\"CodeMirror cm-s-default CodeMirrorServer\" oncopy=\"if(event.clipboardData){event.clipboardData.setData('text/plain',window.getSelection().toString().replace(/\\u200b/g,''));event.preventDefault();event.stopPropagation();}\"\u003e\n\u003cdiv class=\"CodeMirror-code\"\u003e\n\u003cdiv\u003e\u003cpre\u003e$ go test -bench . -benchmem\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003egoos: windows\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003egoarch: amd64\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003epkg: github.com/koron-go/z80\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003eBenchmark_addU8-32              418023792                2.84 ns/op            0 B/op          0 allocs/op\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","lines":27,"lines_more":22,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"R1O"}]},{"client_msg_id":"01c6edc3-1382-42bd-b83b-c97a6e08a12d","type":"message","user":"U06BRP8VD","text":"Z80エミュのベンチマークはそんなかわらない印象かな。core i9(自宅)の計測結果は今手元にないけど…","ts":"1598505032.235400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"mOvH"}]},{"client_msg_id":"c58e5104-195a-4f3f-b149-846d7be4f98b","type":"message","user":"UAZ33BKV2","text":"いろんなマイクロベンチを両方ではしらせて、その傾向が実際に出るのか、は見てみたい(けど、外野が要望しちゃだめなものw)\nそんなに差がでるのも不思議だなあ","ts":"1598504918.234600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"54JOk"}]},{"client_msg_id":"3afbfc03-34ff-4a4b-befa-b983d54aecd0","type":"message","user":"U06BRP8VD","text":"Core i9とRyzen 9で、実行速度の差は減ってきたけど、時間のかかる(cpuprofileが示している)場所がずいぶん違うんだよな…","ts":"1598504768.233500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"OU7P"}]},{"client_msg_id":"f18611da-64f3-445d-98ca-e32f4290ed47","type":"message","user":"U06BRP8VD","text":"最近の作業で、関数呼び出しは1ns、条件分岐は0.5ns、みたいなざっくりとした感覚になってきた。","ts":"1598494035.231400","team":"T03C4RC8V","reactions":[{"name":"puro","count":5,"users":["U9S4G0LJW","UAZ33BKV2","UEBF2KQTD","U010WB2E7J6","UEACRCY0Z"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"BwggC"}]},{"client_msg_id":"d608ad02-8bac-416e-b07c-e60f1dd1d163","type":"message","user":"U06BRP8VD","text":"そうかCSEも実装されてるのか。BCEは知ってたけど、こっちは今知った。\n\u003chttps://golang.org/src/cmd/compile/internal/ssa/cse.go\u003e","ts":"1598489024.230200","attachments":[{"fallback":"src/cmd/compile/internal/ssa/cse.go - The Go Programming Language","id":1,"title":"src/cmd/compile/internal/ssa/cse.go - The Go Programming Language","title_link":"https://golang.org/src/cmd/compile/internal/ssa/cse.go","text":"Go is an open source programming language that makes it easy to build simple, reliable, and efficient software.","blocks":null,"service_name":"golang.org","service_icon":"https://golang.org/favicon.ico","from_url":"https://golang.org/src/cmd/compile/internal/ssa/cse.go","original_url":"https://golang.org/src/cmd/compile/internal/ssa/cse.go"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"cJvKB"}]},{"client_msg_id":"776baf47-e3ab-4c30-b957-032685363be4","type":"message","user":"U06BRP8VD","text":"いま見たら3683行だった\n\n\u003chttps://github.com/koron-go/z80/blob/b46b7b541b7ba0103879e645125b826067333f94/switch.go\u003e","ts":"1598488674.229300","attachments":[{"fallback":"GitHub: koron-go/z80","id":1,"title":"koron-go/z80","title_link":"https://github.com/koron-go/z80/blob/b46b7b541b7ba0103879e645125b826067333f94/switch.go","text":"WIP: Experimental Z80 emulator. Contribute to koron-go/z80 development by creating an account on GitHub.","thumb_url":"https://avatars3.githubusercontent.com/u/37774098?s=400\u0026v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/80588/img/unfurl_icons/github.png","thumb_width":400,"thumb_height":400,"from_url":"https://github.com/koron-go/z80/blob/b46b7b541b7ba0103879e645125b826067333f94/switch.go","original_url":"https://github.com/koron-go/z80/blob/b46b7b541b7ba0103879e645125b826067333f94/switch.go"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"tJsi0"}]},{"client_msg_id":"e2ef80df-ec13-4514-857c-233d6f782ebb","type":"message","user":"U06BRP8VD","text":"ちなみに僕のほうのスイッチは最初3000行くらいあったのを、まとめて今の行数になるようにしましたw","ts":"1598488625.229000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Cz1"}]},{"client_msg_id":"da5dd38f-247d-4bb0-9ccb-fac60fe33dc7","type":"message","user":"UDDCM376D","text":"えげつない","ts":"1598487882.228400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"yrFZ"}]},{"client_msg_id":"6a3c4981-2fe3-4844-9e49-850a2bb4e060","type":"message","user":"U6XP9LZ6V","text":"もっと身近な長～～いswitch文。（golangじゃないけど）\n\u003chttps://github.com/vim/vim/blob/6e3aeec8461cf27396b6574b5438019a00684e00/src/vim9execute.c#L945-L2604\u003e","ts":"1598484777.227900","attachments":[{"fallback":"GitHub: vim/vim","id":1,"title":"vim/vim","title_link":"https://github.com/vim/vim/blob/6e3aeec8461cf27396b6574b5438019a00684e00/src/vim9execute.c#L945-L2604","text":"The official Vim repository. Contribute to vim/vim development by creating an account on GitHub.","thumb_url":"https://avatars0.githubusercontent.com/u/11618545?s=400\u0026v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/80588/img/unfurl_icons/github.png","thumb_width":48,"thumb_height":48,"from_url":"https://github.com/vim/vim/blob/6e3aeec8461cf27396b6574b5438019a00684e00/src/vim9execute.c#L945-L2604","original_url":"https://github.com/vim/vim/blob/6e3aeec8461cf27396b6574b5438019a00684e00/src/vim9execute.c#L945-L2604"}],"team":"T03C4RC8V","reactions":[{"name":"sorena","count":1,"users":["U06BRP8VD"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"aB9c"}]},{"client_msg_id":"3B8152A4-F8CB-41D3-8427-08A632B42020","type":"message","user":"UDDCM376D","text":"こんなに長いSwitch文初めてみたw","ts":"1598464020.226900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"+j4Lw"}]},{"client_msg_id":"4972384a-fae7-4982-86c3-af61b26f9d05","type":"message","user":"U06BRP8VD","text":"一つずつってのは正確ではないか。2分探査になるように生成されているように見える。ほぼベストだ。あとは…配列くらいしか","ts":"1598462585.226400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"n6qxy"}]},{"client_msg_id":"1ef758cf-01a3-4545-a1e8-5fb6093542ab","type":"message","user":"U06BRP8VD","text":"…普通に1つずつ比較してるなw","ts":"1598462307.225400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"6c+"}]},{"client_msg_id":"9fc24a65-3afd-445a-8427-d22aad184880","type":"message","user":"U06BRP8VD","text":"…あとはOPコード毎に中身をさらに自動生成するしかないか…一応switchのアセンブリコードみとくか…","ts":"1598461765.225100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"20tv"}]},{"client_msg_id":"4a688030-a94f-4ece-a146-1d71a78c2647","type":"message","user":"U06BRP8VD","text":"全OPコードへの分岐を含んでいるので!w","ts":"1598460644.224300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"qzwx2"}]},{"client_msg_id":"fd36e3ad-5d1e-499f-bcfb-68f4234dac7e","type":"message","user":"U06ECBRTJ","text":"ファイル全部 switch だ…","ts":"1598460587.223900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"tZHTY"}]},{"client_msg_id":"4724bde0-a632-4a3e-aa24-13cc63c464d6","type":"message","user":"U06BRP8VD","text":"テーブルジャンプになるやつは、もうこれ以上はどうしたら、ってくらいの速さではある。ジャンプするんでパイプライン予想がほぼ立たないので遅くはなるけど。","ts":"1598460467.223300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"rGK"}]},{"client_msg_id":"08e5ca1a-03ec-442e-85e0-47d514236113","type":"message","user":"U06BRP8VD","text":"switchが遅いってのは内部でifの列挙になる言語ならそのとおりなんですが","ts":"1598460423.222500","edited":{"user":"U06BRP8VD","ts":"1598460487.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"jHQF"}]},{"client_msg_id":"6e713f52-1b90-4501-8f1a-8561504991b2","type":"message","user":"UERCTTT8B","text":"switch 遅いんだ…","ts":"1598460397.221800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"sTMW"}]},{"client_msg_id":"c384d8c6-9ace-4897-b1be-6a12d6cafcbe","type":"message","user":"U06BRP8VD","text":"map, arrray, 巨大switch の順に速くなってきた。","ts":"1598460365.221600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ZiO8L"}]},{"client_msg_id":"89160687-ac79-43a9-a9bf-8249413b6578","type":"message","user":"U06BRP8VD","text":"見てわかる通りディスパッチが必須な状況で、過去にはmapやarrayつかってdispatchしたこともあるんですよ…","ts":"1598460315.220600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"9Tk"}]},{"client_msg_id":"d29a56bd-e8b6-4a31-9fb6-f3508a5bc118","type":"message","user":"U03C6TEAZ","text":"switch はどの言語でも遅い印象があります。","ts":"1598459782.219800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"X4NUc"}]},{"client_msg_id":"8ba66194-87fd-4982-8f47-a2a89a952903","type":"message","user":"U03C6TEAZ","text":"ナガーーーイ","ts":"1598459762.219300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"n+8Y"}]},{"client_msg_id":"3e07d827-7f1c-4a3d-8321-11a5e990ac81","type":"message","user":"U06BRP8VD","text":"Z80のエミュ、CPUプロファイル取るとこの関数(自動生成)が一番重いことになってるんだけど、何か改善できる余地あるかな…\n\n\u003chttps://github.com/koron-go/z80/blob/54617aa8d7d4d1e299e0b32d98d18f715831e2a9/switch.go#L3\u003e","ts":"1598459643.219000","attachments":[{"fallback":"GitHub: koron-go/z80","id":1,"title":"koron-go/z80","title_link":"https://github.com/koron-go/z80/blob/54617aa8d7d4d1e299e0b32d98d18f715831e2a9/switch.go#L3","text":"WIP: Experimental Z80 emulator. Contribute to koron-go/z80 development by creating an account on GitHub.","thumb_url":"https://avatars3.githubusercontent.com/u/37774098?s=400\u0026v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/80588/img/unfurl_icons/github.png","thumb_width":400,"thumb_height":400,"from_url":"https://github.com/koron-go/z80/blob/54617aa8d7d4d1e299e0b32d98d18f715831e2a9/switch.go#L3","original_url":"https://github.com/koron-go/z80/blob/54617aa8d7d4d1e299e0b32d98d18f715831e2a9/switch.go#L3"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"cP5"}]},{"client_msg_id":"00e8c1c4-d3fb-418f-b972-cfa345e2d0f1","type":"message","user":"U06BRP8VD","text":"i9-9900K の結果","ts":"1598520589.252700","thread_ts":"1598505107.236100","parent_user_id":"U06BRP8VD","files":[{"id":"F019LHSGGKU","created":1598520588,"timestamp":1598520588,"name":"Untitled","title":"Untitled","mimetype":"text/plain","image_exif_rotation":0,"filetype":"text","pretty_type":"プレーンテキスト","user":"U06BRP8VD","mode":"snippet","editable":true,"is_external":false,"external_type":"","size":1556,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F019LHSGGKU/untitled","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F019LHSGGKU/download/untitled","original_h":0,"original_w":0,"thumb_64":"","thumb_80":"","thumb_160":"","thumb_360":"","thumb_360_gif":"","thumb_360_w":0,"thumb_360_h":0,"thumb_480":"","thumb_480_w":0,"thumb_480_h":0,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U06BRP8VD/F019LHSGGKU/untitled","permalink_public":"https://slack-files.com/T03C4RC8V-F019LHSGGKU-a79985fc9d","edit_link":"https://vim-jp.slack.com/files/U06BRP8VD/F019LHSGGKU/untitled/edit","preview":" go test -bench .\ngoos: windows\ngoarch: amd64\npkg: github.com/koron-go/z80\nBenchmark_addU8-16              509709108                2.35 ns/op","preview_highlight":"\u003cdiv class=\"CodeMirror cm-s-default CodeMirrorServer\" oncopy=\"if(event.clipboardData){event.clipboardData.setData('text/plain',window.getSelection().toString().replace(/\\u200b/g,''));event.preventDefault();event.stopPropagation();}\"\u003e\n\u003cdiv class=\"CodeMirror-code\"\u003e\n\u003cdiv\u003e\u003cpre\u003e go test -bench .\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003egoos: windows\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003egoarch: amd64\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003epkg: github.com/koron-go/z80\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003eBenchmark_addU8-16              509709108                2.35 ns/op\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","lines":27,"lines_more":22,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"45OY9"}]}]
