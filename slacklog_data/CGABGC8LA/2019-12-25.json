[{"type":"message","user":"US0V8PQQM","text":"<@US0V8PQQM> has joined the channel","ts":"1577234314.234800","subtype":"channel_join","replace_original":false,"delete_original":false,"blocks":null},{"client_msg_id":"e70388d8-e511-4c6d-a2ae-c1aa2f5b9dea","type":"message","user":"UNJ2DANJC","text":"`database/sql` の実装ドライバは基本的にstringが空文字でも普通にINSERTするんですよね。\nNOT NULL制約だけでなくCHECK制約もかけておかないとアプリケーションとしてはおかしな挙動を検出しづらいなあ。\nINSERTする前にロジックとしてempty checkをすべきですかね。\nそれともprimitive string型にaliasを作ってValuerとScannerを実装してそこでerrorを返すというほうが良いのかな。","ts":"1577241173.239700","edited":{"user":"UNJ2DANJC","ts":"1577241183.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"qVv"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"390908e5-0e67-4fc7-b4b8-e417f0af16bb","type":"message","user":"U03C6TEAZ","text":"string が未定義を示せない型なので NullString を使うとかですかね。","ts":"1577241272.240200","edited":{"user":"U03C6TEAZ","ts":"1577241315.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"oJdI6"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"37dc7c80-e4f8-4294-8d27-60bdc0e65603","type":"message","user":"UG6DF6W87","text":"DB でどこまで制約をかけるかっていうの非常に悩ましいですよね...\n私は大体アプリケーション側で validation しますね","ts":"1577241468.243600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"4SGZ"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"1a76dbeb-5d4e-4ec7-8293-91b42bd07ab7","type":"message","user":"U0M7GCBPD","text":"今の案件まだ CHECK 制約のない世界にいる…","ts":"1577241876.244700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"QVQQ"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"0b6c6cd7-4606-4459-acb1-e77227555087","type":"message","user":"U06BRP8VD","text":"Nullに関して言えば mattn さんのいうとおり NullString はじめ NullXxx な型を使うのが正義ですよ。自分で dirver.Valuerとか実装してあたらしいNullXxx作っても良い。","ts":"1577241946.246500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"jByZ"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"26cd9e0d-3a12-4977-a3f9-f86292590466","type":"message","user":"U06BRP8VD","text":"ただし↑にORMライブラリが対応してないことまれによくある。","ts":"1577241962.247000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"V9Fj"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"1dbfeb07-d847-4055-aa45-18127c18bce4","type":"message","user":"UNJ2DANJC","text":"MySQLは8.0.16で対応ですね。\n<https://dev.mysql.com/doc/refman/8.0/en/create-table-check-constraints.html>\n最近のMySQLはパッチバージョンに新機能がガンガン入ってくるポリシーらしいです。\nマネージドサービスのベンダーとか大変そう...","ts":"1577242018.247900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"DIwdd"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"11a78476-4fa5-40c1-a7b6-12af4e6c3f7c","type":"message","user":"UNJ2DANJC","text":"あ、そもそもNOT NULL制約はかけているカラムなんです。ですけど\"\"がINSERTできてしまうという仕方なのない話です。","ts":"1577242124.249400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"LnzN"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"de927fee-d381-400e-b06d-df2dabbf0e7a","type":"message","user":"UNJ2DANJC","text":"こういうの作るべきかなあ\n\n```type string NotEmptyString```","ts":"1577242239.251200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"d8zZ"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"54b3a319-2c33-420f-85d1-8b35a23cb557","type":"message","user":"UG6DF6W87","text":"Value Object 的な思考だったら、INSERT するそのカラムは何かの型になってるはずなので、そのインスタンス生成時に空文字列を弾いてしまったりします","ts":"1577242275.251800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"3SaT"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"6f5a3d90-fd6a-42f6-a654-8d8000e99f98","type":"message","user":"UG6DF6W87","text":"// あんまりやりすぎると Go っぽくない、と言われてしまいますが...","ts":"1577242300.252000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"7Fq"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"cc31a040-9b1f-446d-88a2-d82d40feb9bb","type":"message","user":"UG6DF6W87","text":"```type User struct {\n  ID ID\n  Name string\n}\n\ntype ID string\n\nfunc NewID(s string) (ID, error) {\n  if s == \"\" {\n    return ID(\"\"), errors.New(\"empty\")\n  }\n  return ID(s), nil\n}```\nみたいな書き方にしたり...","ts":"1577242511.255500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"6x4"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"6cca5611-a1de-4d3f-bdaf-cb98a406c016","type":"message","user":"U03C6TEAZ","text":"Go の database/sql ドライバって、アプリとドライバの間に database/sql の中間層が居て幾らか変換されてしまってるんですよね。","ts":"1577242565.256400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Yjejy"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"de3bfb7b-28c6-4043-9ca9-ddc3d217e40d","type":"message","user":"U03C6TEAZ","text":"例えば NullString を渡すとその中間層が判断して nil もしくは string をドライバに渡してます。","ts":"1577242597.257100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"7ZKJ"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"0260efba-ffc5-42a4-93a0-bb36da80a8ef","type":"message","user":"U06BRP8VD","text":"だいたい database/sql/driver のせい","ts":"1577242619.257400","thread_ts":"1577242619.257400","reply_count":1,"replies":[{"user":"U06BRP8VD","ts":"1577242630.257500"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"2ri"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"4c67dce9-e0f2-4cbe-b4ab-58b303d66d85","type":"message","user":"U06BRP8VD","text":"↑らんぼうすぎます","ts":"1577242630.257500","thread_ts":"1577242619.257400","parent_user_id":"U06BRP8VD","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Kdp"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"f4fe3c4f-f5e1-48ad-a493-c9f0cf93598a","type":"message","user":"UEA8T80GY","text":"全く関係ない話なんですが、sync.WaitGroupのstateメソッドの%8している計算は上に書かれている64bit,32bitの判別をしているという理解で大丈夫でしょうか。\n<https://golang.org/src/sync/waitgroup.go?s=574:929#L10>","ts":"1577258743.259800","attachments":[{"fallback":"src/sync/waitgroup.go - The Go Programming Language","id":1,"title":"src/sync/waitgroup.go - The Go Programming Language","title_link":"https://golang.org/src/sync/waitgroup.go?s=574:929#L10","text":"Go is an open source programming language that makes it easy to build simple, reliable, and efficient software.","blocks":null,"service_name":"golang.org","service_icon":"https://golang.org/favicon.ico","from_url":"https://golang.org/src/sync/waitgroup.go?s=574:929#L10","original_url":"https://golang.org/src/sync/waitgroup.go?s=574:929#L10"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"DpX"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"bd62bc91-f9b5-4d8f-97f3-aa40d149c857","type":"message","user":"U03C6TEAZ","text":"アライメントですね。","ts":"1577258825.260200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"q0n"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"9de56136-0ef6-4e34-a070-325545f5ec1b","type":"message","user":"UEA8T80GY","text":"つまり、64ビットの場合は8バイトアライメントなので、8で割り切れたら64ビットと見なすと言うことですね。","ts":"1577259551.261100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"XT0eH"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"9eac062d-0f72-4aab-bb34-733829bf78e2","type":"message","user":"UEA8T80GY","text":"ありがとうございます。","ts":"1577260146.261300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"uOEcm"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"6fab428a-fa9a-4470-a26c-cad9f91adba3","type":"message","user":"U03C6TEAZ","text":"なんだったかな。32bit OS で原状アライメントが揃ってないみたいな issue を見た事がある。","ts":"1577260435.261900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"MrWB"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"d8af773b-6f01-462b-9e85-3e225d8d6050","type":"message","user":"U03C6TEAZ","text":"<https://github.com/golang/go/issues/599>","ts":"1577260491.262100","attachments":[{"fallback":"GitHub: cmd/compile: make 64-bit fields 64-bit aligned on 32-bit systems · Issue #599 · golang/go","id":1,"title":"cmd/compile: make 64-bit fields 64-bit aligned on 32-bit systems · Issue #599 · golang/go","title_link":"https://github.com/golang/go/issues/599","text":"Even though the 386 has a 4-byte word size, some instructions move data in larger chunks. In particular float64 loads move 8 bytes and some SSE2 operations (as yet unused) move even larger amounts....","thumb_url":"https://avatars3.githubusercontent.com/u/4314092?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/80588/img/unfurl_icons/github.png","thumb_width":400,"thumb_height":400,"from_url":"https://github.com/golang/go/issues/599","original_url":"https://github.com/golang/go/issues/599"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Mzu"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"9f16e773-18a8-4d19-944e-ed90cb9246d9","type":"message","user":"U03C6TEAZ","text":"これだ。","ts":"1577260493.262300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Qepr"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"f15071c2-6814-40da-8e0e-1ba193573806","type":"message","user":"U03C6TEAZ","text":"9年前w","ts":"1577260514.262800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"bHCQK"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"bf66e3c4-8a1e-49d9-9bab-3887f8c12885","type":"message","user":"UEA8T80GY","text":"なるほど　大分昔ですね","ts":"1577260584.263300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"uix"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"}]
