[{"client_msg_id":"E8D25C3D-694E-4395-B84E-02687C44C425","type":"message","user":"UDDCM376D","text":"ありがとうございますっ","ts":"1553021598.227600","thread_ts":"1552951421.225100","parent_user_id":"UDDCM376D","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"09c2fed2-97eb-407f-a302-8f8827b07402","type":"message","user":"UDDCM376D","text":"Goってファイルのrename関数があるのに、copy関数がないんですね","ts":"1553042833.228300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a003f507-5013-43b6-af58-1cbb6a2c4f43","type":"message","user":"U06BRP8VD","text":"感覚的に rename はOSの支援の割合が大きい印象。対してcopyはアプリレイヤでやっても起こることは一緒というか、コストがかわらなさそう。","ts":"1553043083.229800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"3e42f1f6-60a8-4242-b938-1ab85658df9a","type":"message","user":"U06BRP8VD","text":"というかrenameそのものはアプリレイヤーではできない、か。copy + delete で代用はできるけど、本質的にこれは違う操作だし。","ts":"1553043126.230700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"D74BADE2-77D5-4D09-A4A9-DAB396A17938","type":"message","user":"UDDCM376D","text":"なるほど","ts":"1553043718.230900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"6BD17CDA-3DA5-4CFB-BC2B-59D3C0E47C9E","type":"message","user":"UDDCM376D","text":"renameは内部でcopy+deleteしてるって勝手に思ってたんですが、よくよく見たら内部でシステムコールしてたので、違いますね","ts":"1553043786.232800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"1d022321-a143-4ad4-a753-2baf702ca517","type":"message","user":"U03C6TEAZ","text":"copy というシステムコールはないですからね。","ts":"1553044001.233200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"c784e4ce-d6e8-4077-a054-816ad61a7384","type":"message","user":"U03C6TEAZ","text":"delete はある。rename もある。","ts":"1553044016.233500","thread_ts":"1553044016.233500","reply_count":1,"replies":[{"user":"U06BRP8VD","ts":"1553044707.239400"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"5905072e-002c-47c8-97b3-a0e0b558bf6d","type":"message","user":"U03C6TEAZ","text":"コピーが欲しいという issue は何度か見ましたが、そう簡単ではないし違う物理デバイスでやると結構大変なので議論にもなりましたけどね。","ts":"1553044082.234300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"753b7a75-78f9-4866-bb5a-eb34d29f9f3f","type":"message","user":"U03C6TEAZ","text":"ところで vim-lsp で `(lsp-definition)` すると GOCACHE の中のファイルを開くのはまぁ期待通りだからいいとして","ts":"1553044182.235000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"8a4e3f80-9d11-4fae-b3e8-73607340403d","type":"message","user":"U03C6TEAZ","text":"GOCACHE の中のファイルって拡張子を持ってないので vim が ft=go にしてくれない問題があるのだけど","ts":"1553044201.235500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"d75c9692-35ac-4907-b8ea-67d13f66885d","type":"message","user":"U03C6TEAZ","text":"```\nlet s:gocache = ''\n\nfunction! s:detect_gocache()\n  if s:gocache ==# ''\n    let s:gocache = trim(system('go env GOCACHE'))\n  endif\nendfunction\n\nfunction! s:detect_gocache_filetype()\n  if &amp;ft ==# '' &amp;&amp; s:gocache !=# '' &amp;&amp; stridx(expand('%:p'), s:gocache) !=# -1\n    setlocal ft=go\n  endif\nendfunction\n\naugroup GoCache\n  au!\n  autocmd FileType go call s:detect_gocache() \n  autocmd BufReadPost * call s:detect_gocache_filetype()\naugroup END\n```\nこういうワークアラウンドで逃げるしかないのかなぁ。","ts":"1553044215.235900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a9364213-26ce-49a0-a04e-f854ba0cfeb1","type":"message","user":"U03C6TEAZ","text":"しかもこれ cgo なファイルでやると cgo コマンドを通った後のソースになってるなw","ts":"1553044283.236300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"84b78b75-efee-4620-90a2-03c3880b1745","type":"message","user":"U03C6TEAZ","text":"こんなファイル編集できていいんかいなw というお気持ちです。","ts":"1553044302.236700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"6CCC9BE8-1069-456A-81B6-FAF16786AAB8","type":"message","user":"UDDCM376D","text":"renameってシステムコールがあるなら、copyあっても不思議ではないって思ってたんですが、結構処理違うんですか？","ts":"1553044596.237800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"1ae2ebbf-6400-42bd-9413-8de2387e96aa","type":"message","user":"U06BRP8VD","text":"ファイルシステムって実装がいくつもあるからいい感じのcopyのI/Fを切れないんスよ。","ts":"1553044632.238500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"af8b5fc5-6129-4f19-a24e-35f9d8bfbe5a","type":"message","user":"U06BRP8VD","text":"ZFSならファイルシステムに閉じてコピーする機能があるかもだけど、EXT4との間でコピーするにはやっぱいっかいメモリにコピーしないと無理なわけで。","ts":"1553044662.239200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"1dcadcf6-2055-4627-91f0-f8a0dce45684","type":"message","user":"U06BRP8VD","text":"昔、貰ったIRIXにrmdirなくて `rm -r` ができずに詰みかけて、自分で簡易なrmdirをcで書いてインストールした記憶がw","ts":"1553044707.239400","thread_ts":"1553044016.233500","edited":{"user":"U06BRP8VD","ts":"1553044726.000000"},"parent_user_id":"U03C6TEAZ","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"12e6f232-ce96-4860-a104-b22741f9c953","type":"message","user":"U06BRP8VD","text":"rename システムコールはファイルシステムを超えてはできない、っていう制限があるはず。昔はあった。","ts":"1553044789.240500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"E91495BC-ACE7-4B31-AB80-5F9E56DC8ACE","type":"message","user":"UDDCM376D","text":"ファイルシステムによって変わるんですね\n思ったよりもややこしい…","ts":"1553049897.241100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"d4893dc5-12a1-489d-9387-f96ad55bddd6","type":"message","user":"U06BRP8VD","text":"僕としてはめっちゃシンプルに見えるんですけどねw","ts":"1553054548.241500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"5f1e49cc-2e14-421c-a852-89f82dbe2611","type":"message","user":"U06BRP8VD","text":"下から考えてるから、かな。","ts":"1553054558.241700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"23e7e4c7-39cd-4ed1-a6f6-813b141cb9fa","type":"message","user":"U03C6TEAZ","text":"<https://stackoverflow.com/questions/17666316/is-there-a-posix-function-to-copy-a-file>","ts":"1553056104.242200","attachments":[{"fallback":"Stack Overflow: Is there a POSIX function to copy a file?","id":1,"title":"Is there a POSIX function to copy a file?","title_link":"https://stackoverflow.com/questions/17666316/is-there-a-posix-function-to-copy-a-file","text":"Looking now through some OS functions I find that on POSIX systems you have C function calls like unlink() to remove files, link() to create hard links to files, symlink() to create symbolic files,","thumb_url":"https://cdn.sstatic.net/Sites/stackoverflow/img/apple-touch-icon@2.png?v=73d79a89bded","blocks":null,"service_name":"Stack Overflow","service_icon":"https://cdn.sstatic.net/Sites/stackoverflow/img/favicon.ico?v=4f32ecc8f43d","thumb_width":316,"thumb_height":316,"from_url":"https://stackoverflow.com/questions/17666316/is-there-a-posix-function-to-copy-a-file","original_url":"https://stackoverflow.com/questions/17666316/is-there-a-posix-function-to-copy-a-file"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"c58aae58-b448-4974-a0b9-e179633c0431","type":"message","user":"U03C6TEAZ","text":"ちょうど同じ質問しておられる方がいますね。","ts":"1553056114.242600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"b3cd6ddd-a19d-4714-bf16-fe94fca1d055","type":"message","user":"U03C6TEAZ","text":"```\nexecl(\"/bin/cp\", \"-p\", src_file, des_file, (char *)0);\n```\nウケる","ts":"1553056161.242900","team":"T03C4RC8V","reactions":[{"name":"laughing","count":2,"users":["U06BRP8VD","U8CC7MDCL"]}],"replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"13CF37CA-B465-4181-ACC4-C903931E2034","type":"message","user":"UDDCM376D","text":"コマンド実行するのは避けたい","ts":"1553060388.243600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"5066f9cd-84ef-44ef-a881-35b1bfb2ceb0","type":"message","user":"UA4RVLHK7","text":"(copy_file_range というシステムコールはある","ts":"1553064277.244300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"c3a9295d-f26a-405a-8d40-6c386c531c75","type":"message","user":"UA4RVLHK7","text":"((あとシステムコールというかfcntlかなにかで、ファイルシステムのCoWがあればそれを利用できるようなコピーがあったはず。","ts":"1553064351.245100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"3ec76567-dae4-4cb8-a70b-684005e467a2","type":"message","user":"UA4RVLHK7","text":"((( これらは最近の話題なので、伝統的には rename は OS 側、 copy はアプリ側というのに異論があるわけではありません。","ts":"1553064398.245800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"314555f4-8c23-4041-958a-9a6f5076f6e6","type":"message","user":"UA4RVLHK7","text":"Software Design １月号の「あなたの知らないファイルシステムの世界【4】」を参照","ts":"1553064470.246300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"5c7b81ee-e36c-4696-963b-4512d29f8b70","type":"message","user":"U03C6TEAZ","text":"fd なんですよねー。sendfile と同じ感じ。","ts":"1553064607.246600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"52d44654-2130-4e37-8f07-9a60ac30c2d0","type":"message","user":"U03C6TEAZ","text":"<https://github.com/termie/go-shutil/blob/bcacb06fecaeec8dc42af03c87c6949f4a05c74c/shutil.go#L77>","ts":"1553064714.246900","attachments":[{"fallback":"GitHub: termie/go-shutil","id":1,"title":"termie/go-shutil","title_link":"https://github.com/termie/go-shutil/blob/bcacb06fecaeec8dc42af03c87c6949f4a05c74c/shutil.go#L77","text":"golang port of python's shutil - copy a directory in go - termie/go-shutil","thumb_url":"https://avatars1.githubusercontent.com/u/56459?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/bfaba/img/unfurl_icons/github.png","thumb_width":250,"thumb_height":250,"from_url":"https://github.com/termie/go-shutil/blob/bcacb06fecaeec8dc42af03c87c6949f4a05c74c/shutil.go#L77","original_url":"https://github.com/termie/go-shutil/blob/bcacb06fecaeec8dc42af03c87c6949f4a05c74c/shutil.go#L77"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"3a4f9f6c-6c56-4a40-b1aa-3dc090e6c558","type":"message","user":"U03C6TEAZ","text":"これがまだいけてそうな気がする。","ts":"1553064721.247300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"C09007B4-32EA-45EC-B4A5-FDF06BC7B5F1","type":"message","user":"UDDCM376D","text":"そっか、ライブラリ使うのも手か","ts":"1553065370.248700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"baf4a6b2-0cd9-41c4-8a4a-9a10678a0b74","type":"message","user":"U06ECBRTJ","text":"コピー、go でやるなら、新しいファイル を writable でオープンして、元ファイルのデータを書き込んであげるのでも…\nファイルサイズでかくなると辛いか","ts":"1553065607.249800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"43276966-28de-4f11-b693-4b51fbe77e66","type":"message","user":"U03C6TEAZ","text":"実際それです。","ts":"1553065702.250000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"4f71cc28-8f45-43ec-a9ff-8adf6a918219","type":"message","user":"U03C6TEAZ","text":"<https://github.com/termie/go-shutil/blob/bcacb06fecaeec8dc42af03c87c6949f4a05c74c/shutil.go#L124-L130>","ts":"1553065704.250200","attachments":[{"fallback":"GitHub: termie/go-shutil","id":1,"title":"termie/go-shutil","title_link":"https://github.com/termie/go-shutil/blob/bcacb06fecaeec8dc42af03c87c6949f4a05c74c/shutil.go#L124-L130","text":"golang port of python's shutil - copy a directory in go - termie/go-shutil","thumb_url":"https://avatars1.githubusercontent.com/u/56459?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/bfaba/img/unfurl_icons/github.png","thumb_width":250,"thumb_height":250,"from_url":"https://github.com/termie/go-shutil/blob/bcacb06fecaeec8dc42af03c87c6949f4a05c74c/shutil.go#L124-L130","original_url":"https://github.com/termie/go-shutil/blob/bcacb06fecaeec8dc42af03c87c6949f4a05c74c/shutil.go#L124-L130"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"b49ad59d-4b96-499d-a0e2-f282fcf76ac2","type":"message","user":"U06ECBRTJ","text":"そうだった","ts":"1553065708.250600","edited":{"user":"U06ECBRTJ","ts":"1553065716.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"8d312767-4c54-4a18-a0ce-18790da02c2a","type":"message","user":"U06ECBRTJ","text":"io.Copy だった","ts":"1553065721.251000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UH4HCS30U","text":"<@UH4HCS30U> has joined the channel","ts":"1553079423.251300","subtype":"channel_join","replace_original":false,"delete_original":false,"blocks":null}]
