[{"client_msg_id":"3b127a7d-d5f8-46e5-92d7-183aed2f0251","type":"message","user":"U06BRP8VD","text":"golang で書かれた Web サーバを cgroups のメモリ制限化で動かしたとき、不意にOOMされるのを防ぐには同時に捌くリクエストの上限を設定しなきゃいけないのかな?\n\n1リクエストに使うメモリ量が十分少なくても、束になって同時かかってきたら一時的にメモリをがっつり確保することになってOOMされるみたいなケースがありそうで、それにどう対処するか ??? ってなってる。","ts":"1553702119.324600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"140fee64-7bc6-48b0-94ef-80d0d35a912e","type":"message","user":"U03C6TEAZ","text":"スロットルできるのを昔どこかで見た。","ts":"1553702720.325300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"b1e4015e-2699-40a7-b4b5-2216203158ba","type":"message","user":"U03C4RC8X","text":"スロットルスロット","ts":"1553702735.325600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"d29672ed-7ace-4734-afe8-ece0fa0d9d12","type":"message","user":"U03C6TEAZ","text":"runtime.MemStat 見てくれてたかは覚えてない。","ts":"1553702765.326700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"ee9a09ab-a34b-4c56-afa8-0cf19b4514f5","type":"message","user":"U06BRP8VD","text":"理想をいえば goroutine ごとに allocate するメモリの上限を設定できたら、なのかしら?","ts":"1553702897.327700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"97772eb7-cb46-493c-a9d4-e05640378946","type":"message","user":"U03C6TEAZ","text":"<https://github.com/containerd/cgroups>","ts":"1553702996.328200","attachments":[{"fallback":"GitHub: containerd/cgroups","id":1,"title":"containerd/cgroups","title_link":"https://github.com/containerd/cgroups","text":"cgroups package for Go. Contribute to containerd/cgroups development by creating an account on GitHub.","thumb_url":"https://avatars0.githubusercontent.com/u/14037953?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/bfaba/img/unfurl_icons/github.png","thumb_width":46,"thumb_height":46,"from_url":"https://github.com/containerd/cgroups","original_url":"https://github.com/containerd/cgroups"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"6f70b843-3cb5-4039-a4e5-4ec8b83459cb","type":"message","user":"U03C6TEAZ","text":"これで何か制御できないかしら。","ts":"1553703011.328700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"f23a9d53-3d78-4336-ba9b-a44826a0f2ba","type":"message","user":"U03C6TEAZ","text":"あぁ、これは cgroups に入れる話か。","ts":"1553703059.329100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"05b9849d-884b-46a6-85e1-612b68742f0e","type":"message","user":"U03C6TEAZ","text":"たぶん昔に見たのはこれだな。 <https://github.com/throttled/throttled>","ts":"1553703114.329900","attachments":[{"fallback":"GitHub: throttled/throttled","id":1,"title":"throttled/throttled","title_link":"https://github.com/throttled/throttled","text":"Package throttled implements rate limiting access to resources such as HTTP endpoints. - throttled/throttled","thumb_url":"https://avatars1.githubusercontent.com/u/13499377?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/bfaba/img/unfurl_icons/github.png","thumb_width":250,"thumb_height":250,"from_url":"https://github.com/throttled/throttled","original_url":"https://github.com/throttled/throttled"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"63a32913-bf5a-404c-b343-226dcb2f51b0","type":"message","user":"U06BRP8VD","text":"rate limitか。","ts":"1553703135.330200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"9f5f37a5-4c56-4975-a196-cff907ebe3dc","type":"message","user":"U03C6TEAZ","text":"memstat は見て無いけど。","ts":"1553703156.330900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"923386f0-6b75-4e94-b1b8-18d09f5322ae","type":"message","user":"U06BRP8VD","text":"やっぱ実用的には、同時に走らせるリクエスト数をセマフォで制限して、かつメモリ使用量がバカでかいリクエストが同時発生しないことを祈る、しかないのかな?","ts":"1553703182.331400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"4226c4b7-980b-4c62-8b1d-92c804398011","type":"message","user":"U06BRP8VD","text":"運用的には複数台立てて、1箇所にデカいリクエストが集中する可能性を下げる。","ts":"1553703224.332100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"d2a8afd7-6199-4c28-b6da-08fe300cc42d","type":"message","user":"U06BRP8VD","text":"↑よりも良い方法があったら知りたい。","ts":"1553703244.332400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"9fbbb7e7-232b-41ad-8594-345dbf3e1335","type":"message","user":"U03C6TEAZ","text":"<https://godoc.org/golang.org/x/net/netutil>","ts":"1553703318.332600","attachments":[{"fallback":"Package netutil","id":1,"title":"Package netutil","title_link":"https://godoc.org/golang.org/x/net/netutil","text":"Package netutil provides network utility functions, complementing the more common ones in the net package.","blocks":null,"service_name":"godoc.org","service_icon":"https://godoc.org/favicon.ico","from_url":"https://godoc.org/golang.org/x/net/netutil","original_url":"https://godoc.org/golang.org/x/net/netutil"}],"team":"T03C4RC8V","reactions":[{"name":"memo","count":1,"users":["U06BRP8VD"]}],"replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"9082e7c0-ec02-4893-94f3-f7c2102a5ec2","type":"message","user":"U03C6TEAZ","text":"これ使えそう。","ts":"1553703321.332900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"6fcc7142-dbe5-459e-b265-4b92830ec306","type":"message","user":"U03C6TEAZ","text":"同時に accept する本数が絞れる。","ts":"1553703368.333300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a075a4e3-4ce4-4ea0-ba6c-4a8fe797cb45","type":"message","user":"U03C6TEAZ","text":"go は backlog が制限できないのでこういうので絞るしかない。","ts":"1553703392.333700","edited":{"user":"U03C6TEAZ","ts":"1553703598.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a70174ec-52d1-4116-acc1-adbc58d622fd","type":"message","user":"U06BRP8VD","text":"あざます! 自分で実装しなくて良くなった。","ts":"1553703448.334200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"c497d016-98e8-4d71-b119-2c03ba318814","type":"message","user":"U06BRP8VD","text":"なるほどなるほど。自前でセマフォ作って Accept 前に仕掛けてると。","ts":"1553703751.334900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"71a3f6ac-cb86-42a5-a5f7-090f6f4a8321","type":"message","user":"U06BRP8VD","text":"acquire() が false 返すときは、そもそもListenerがもう閉じてるからListener.Accept()にエラー作らせれば良いやろ、っていう整理かぁ。なるほどなぁ。","ts":"1553704020.336000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"0502f42b-f962-4182-92e7-b787315d36a8","type":"message","user":"U06BRP8VD","text":"HTTPでデカいPOSTを禁止するのって、アプリケーションレベルで制限する(golangで書く/ライブラリにやらせる)のと、前段のLBとかでやらせるのどっちが良いんだろう…","ts":"1553704440.337400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"56443772-0d10-4168-9b64-ef8aba8ccefa","type":"message","user":"U06BRP8VD","text":"いやLBでやらんとLBが死ぬか。","ts":"1553704449.337800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a2c2dfa3-2f42-4bcc-8aad-a42b9ea3e25f","type":"message","user":"U06BRP8VD","text":"どうせLBでやるならアプリ側でやるモチベーションは低くなる。","ts":"1553704469.338200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"0dee939d-9599-4336-a3e8-0772307b1fc7","type":"message","user":"U03C6TEAZ","text":"```\nr.Body = http.MaxBytesReader(w, r.Body, maxSize)\n```\nこうすると Body の読み込み途中で maxSize に達するとエラーが発生させられるっぽい。","ts":"1553705227.339000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"155ef374-7903-486b-808e-c2b0d0b9c366","type":"message","user":"U06BRP8VD","text":"ハンドラで噛ますんか。","ts":"1553705903.339300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"6fa97ab3-22ef-431e-9d5e-6dd3ef1eb901","type":"message","user":"U03C6TEAZ","text":"Go の r.Body は読まなければメモリに乗らないですね。","ts":"1553705980.339900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"3bb76551-e3d6-4be0-826c-314e350432f3","type":"message","user":"U03C6TEAZ","text":"Go は強力すぎて自爆できる可能性ありますね。","ts":"1553706103.340800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"502a1bad-147c-45c4-8b62-63f35d877f36","type":"message","user":"U03C6TEAZ","text":"G社の様にリソースのあるサーバなら問題にならないだろうけど。","ts":"1553706141.341900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"970fbe6d-a206-46fc-b6d9-471b6b5e910d","type":"message","user":"U03C6TEAZ","text":"僕とこもどちらかというとお金で倒します。","ts":"1553706175.342800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"18f54e5b-6ce7-4b13-8750-dd6966e39a92","type":"message","user":"U06BRP8VD","text":"同じOOMに殺されるやつでも、Javaよりも気分が楽なんだよなぁ…","ts":"1553706585.343600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"f425f1dc-fb2a-4a7a-a496-ac09ddc8f1ff","type":"message","user":"U06BRP8VD","text":"「本日の gopls」っていって安定しているかどうかを見せてくれるサービスが欲しい。","ts":"1553752922.000700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"6860678c-4537-4860-b75c-d617a9963784","type":"message","user":"U8CC7MDCL","text":"www","ts":"1553752957.000900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"2ec1c61d-cdf0-4598-abf8-ae01cf80e861","type":"message","user":"U8CC7MDCL","text":"「オッケーグーグル 今日のgoplsは?」","ts":"1553752979.001400","team":"T03C4RC8V","reactions":[{"name":"laughing","count":2,"users":["U06BRP8VD","UD7KQGMT6"]},{"name":"+1","count":1,"users":["U06BRP8VD"]}],"replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"779f1083-6a84-4368-a4f6-050130f8d20f","type":"message","user":"U03C6TEAZ","text":"ポンッ... Google「起動後の使用メモリは2.2GBです」","ts":"1553753195.001800","team":"T03C4RC8V","reactions":[{"name":"cold_sweat","count":2,"users":["U06BRP8VD","UD7KQGMT6"]}],"replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"48283571-e7f8-4506-b383-0e522e78352e","type":"message","user":"U8CC7MDCL","text":"「ところによりcrashするでしょう」","ts":"1553753247.002100","team":"T03C4RC8V","reactions":[{"name":"fish-fugu-haku","count":3,"users":["U06BRP8VD","U776661HA","UD7KQGMT6"]}],"replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"}]
