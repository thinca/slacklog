[{"client_msg_id":"ce2f4f4e-e139-4be8-b36e-53f708b3fcce","type":"message","user":"U06BRP8VD","text":"Stepのなかでcpuにアクセスするコストが微妙に違うような感じ。まったく未検証情報で申し訳ないけども","ts":"1598717001.399000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"3xa"}]},{"client_msg_id":"872f2ad9-42c9-4bea-ae5f-599b3d4fdbba","type":"message","user":"U06BRP8VD","text":"なのでinlineはされないんですが","ts":"1598716903.397900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"uuR"}]},{"client_msg_id":"b3e1fd18-36a1-429b-a24f-04c5b8778300","type":"message","user":"U06BRP8VD","text":"ああ、実際は3つとももっと複雑な関数です。","ts":"1598716895.397600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"/O3Rz"}]},{"client_msg_id":"c25ba61e-6158-4e4e-a4ce-a0079d515a7b","type":"message","user":"U03C6TEAZ","text":"inline されないのかな...","ts":"1598716869.397000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"kj0EM"}]},{"client_msg_id":"58494326-71e1-416d-a158-86aa21e9281b","type":"message","user":"U03C6TEAZ","text":"ほえー","ts":"1598716858.396700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"93Esq"}]},{"client_msg_id":"05ba0dfe-11ce-4536-a860-6a43d4c1b61d","type":"message","user":"U06BRP8VD","text":"↑ ここで `Step(cpu *CPU)` を `func (cpu *CPU) Step()` に変えると速くなったみたいなんだよね…","ts":"1598716372.396400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"KaR"}]},{"client_msg_id":"7fc299c8-9815-42b4-bfac-a4858be11f77","type":"message","user":"U06BRP8VD","text":"あとこれはまだ検証が足りないんだけど… メソッドコールのコールスタックの中に第1引数がそのオブジェクトの単なる関数を挟むと若干パフォーマンスが落ちるみたい。\n\nこんな感じで。","ts":"1598716318.395300","files":[{"id":"F01A3U4SA57","created":1598716317,"timestamp":1598716317,"name":"Untitled","title":"Untitled","mimetype":"text/plain","image_exif_rotation":0,"filetype":"go","pretty_type":"Go","user":"U06BRP8VD","mode":"snippet","editable":true,"is_external":false,"external_type":"","size":155,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F01A3U4SA57/untitled","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F01A3U4SA57/download/untitled","original_h":0,"original_w":0,"thumb_64":"","thumb_80":"","thumb_160":"","thumb_360":"","thumb_360_gif":"","thumb_360_w":0,"thumb_360_h":0,"thumb_480":"","thumb_480_w":0,"thumb_480_h":0,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U06BRP8VD/F01A3U4SA57/untitled","permalink_public":"https://slack-files.com/T03C4RC8V-F01A3U4SA57-429c3af932","edit_link":"https://vim-jp.slack.com/files/U06BRP8VD/F01A3U4SA57/untitled/edit","preview":"type CPU struct {}\n\nfunc (cpu *CPU) Run() {\n    Step(cpu)\n}","preview_highlight":"\u003cdiv class=\"CodeMirror cm-s-default CodeMirrorServer\" oncopy=\"if(event.clipboardData){event.clipboardData.setData('text/plain',window.getSelection().toString().replace(/\\u200b/g,''));event.preventDefault();event.stopPropagation();}\"\u003e\n\u003cdiv class=\"CodeMirror-code\"\u003e\n\u003cdiv\u003e\u003cpre\u003e\u003cspan class=\"cm-keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"cm-variable\"\u003eCPU\u003c/span\u003e \u003cspan class=\"cm-keyword\"\u003estruct\u003c/span\u003e {}\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e\u0026#8203;\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e\u003cspan class=\"cm-keyword\"\u003efunc\u003c/span\u003e (\u003cspan class=\"cm-variable\"\u003ecpu\u003c/span\u003e \u003cspan class=\"cm-operator\"\u003e*\u003c/span\u003e\u003cspan class=\"cm-variable\"\u003eCPU\u003c/span\u003e) \u003cspan class=\"cm-variable\"\u003eRun\u003c/span\u003e() {\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e    \u003cspan class=\"cm-variable\"\u003eStep\u003c/span\u003e(\u003cspan class=\"cm-variable\"\u003ecpu\u003c/span\u003e)\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e}\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","lines":13,"lines_more":8,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"I89f"}]},{"client_msg_id":"a7789efb-9456-491a-8e17-6e975206a414","type":"message","user":"U03C6TEAZ","text":"encoding/json が panic 使ってる理由でもある。","ts":"1598715909.393900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"QVuT"}]},{"client_msg_id":"611c71a2-4523-4dbf-bd8f-d346298f8732","type":"message","user":"U03C6TEAZ","text":"関数深いとパフォーマンス落ちるでしょうね。","ts":"1598715899.393600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"1oRP"}]},{"client_msg_id":"227a1846-6a5d-4fd4-8ec7-d6a5e3c74498","type":"message","user":"U06BRP8VD","text":"最終的にZ80エミュみたいなプログラムでは深いところからの `error` のプロパゲーションはパフォーマンスの敵ということがわかった。発生しない可能性の高いエラーのために `if err != nil` で各層でチェックするのはまったくの無駄なので、発生した際に呼ばれる関数(コールバック)を用意するのが正義だったよ…\n\nこれで1層につき1秒短縮できたというね。\n\n\u003chttps://twitter.com/kaoriya/status/1299729890317541376\u003e","ts":"1598715658.393100","attachments":[{"fallback":"\u003chttps://twitter.com/kaoriya|@kaoriya\u003e: んーZ80エミュのExerciser、なんか安定して2min切れるようになったかも?","id":1,"author_name":"MURAOKA Taro","author_subname":"@kaoriya","author_link":"https://twitter.com/kaoriya/status/1299729890317541376","author_icon":"https://pbs.twimg.com/profile_images/1196794099/avatar_normal.JPEG","text":"んーZ80エミュのExerciser、なんか安定して2min切れるようになったかも?","blocks":null,"footer":"Twitter","footer_icon":"https://a.slack-edge.com/80588/img/services/twitter_pixel_snapped_32.png","ts":1598714728,"service_name":"twitter","from_url":"https://twitter.com/kaoriya/status/1299729890317541376","original_url":"https://twitter.com/kaoriya/status/1299729890317541376"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"geM"}]}]
