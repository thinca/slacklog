[{"client_msg_id":"8251e417-a863-43c8-9864-6cd27af2e03a","type":"message","user":"UDDCM376D","text":"全然終わらない…","ts":"1598021727.081200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"HkE9"}]},{"client_msg_id":"c9958be7-dad8-4982-8969-7cd54ee1ef6f","type":"message","user":"U03C6TEAZ","text":"まぁそんな変わらんって話か。","ts":"1598021691.081000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"dhQC4"}]},{"client_msg_id":"675688e7-8a45-40e7-9efd-1fe911ea35a2","type":"message","user":"U03C6TEAZ","text":"あー、Decoder の方が中で bufio.Reader 使ってるからか。","ts":"1598021605.080800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"SkX"}]},{"client_msg_id":"17fac13a-e219-4bfc-8099-ce81225dc9e0","type":"message","user":"UDDCM376D","text":"やばい、全然終わらない…ｗ","ts":"1598021398.080400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Zq=A"}]},{"client_msg_id":"5985ab55-59b8-42d4-8e85-1813d0b1d6cc","type":"message","user":"UDDCM376D","text":"こうですかね","ts":"1598021340.080200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"5vG"}]},{"client_msg_id":"4270231c-5db4-4ea4-a673-6cd0754a97a4","type":"message","user":"UDDCM376D","text":"```func BenchmarkDecode(b *testing.B) {\n\tfor i := 0; i \u0026lt; b.N; i++ {\n\t\tb.ResetTimer()\n\t\tf, err := os.Open(\"a.json\")\n\t\tif err != nil {\n\t\t\tlog.Fatal(err)\n\t\t}\n\t\tvar m interface{}\n\t\td := json.NewDecoder(f)\n\t\tif _, err := f.Seek(0, os.SEEK_SET); err != nil {\n\t\t\tlog.Fatal(err)\n\t\t}\n\t\tif err := d.Decode(\u0026amp;m); err != nil {\n\t\t\tlog.Fatal(err)\n\t\t}\n\t\tf.Close()\n\t}\n}\n\nfunc BenchmarkUnmarshal(b *testing.B) {\n\tfor i := 0; i \u0026lt; b.N; i++ {\n\t\tb.ResetTimer()\n\t\tc, err := ioutil.ReadFile(\"a.json\")\n\t\tif err != nil {\n\t\t\tlog.Fatal(err)\n\t\t}\n\t\tvar m interface{}\n\t\tif err := json.Unmarshal(c, \u0026amp;m); err != nil {\n\t\t\tlog.Fatal(err)\n\t\t}\n\t}\n}```","ts":"1598021338.079900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Zqzt"}]},{"client_msg_id":"75b5bddb-436a-4220-a1a3-699e8f354fa0","type":"message","user":"UDDCM376D","text":"たしかに","ts":"1598021254.079600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"4CFY"}]},{"client_msg_id":"b62171b1-8405-4674-a3b3-a69b80f9ca9c","type":"message","user":"UDDCM376D","text":"そっか","ts":"1598021253.079400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ZzB"}]},{"client_msg_id":"d289dd66-713c-46c5-8a1c-f52929a16f15","type":"message","user":"UDDCM376D","text":"あー","ts":"1598021251.079200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"KBhi"}]},{"client_msg_id":"bb3eb569-b4c8-493c-bc0b-af5b40ca0981","type":"message","user":"U03C6TEAZ","text":"今回のベンチマークの目的は読み込みも含んでの話になるはずなので、本当はそれを入れないといけない。","ts":"1598021238.079000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"MoZWt"}]},{"client_msg_id":"b81feedb-f373-4cf5-90da-85e4e167c300","type":"message","user":"UDDCM376D","text":"```goos: linux\ngoarch: amd64\npkg: \u003chttp://github.com/skanehira/dentaku|github.com/skanehira/dentaku\u003e\nBenchmarkDecode-8             55          21340727 ns/op         7441945 B/op     145770 allocs/op\nBenchmarkDecode-8             58          20862487 ns/op         7439292 B/op     145774 allocs/op\nBenchmarkDecode-8             58          21436156 ns/op         7436700 B/op     145765 allocs/op\nBenchmarkDecode-8             57          21221228 ns/op         7439798 B/op     145772 allocs/op\nBenchmarkDecode-8             56          21002041 ns/op         7443235 B/op     145779 allocs/op\nBenchmarkDecode-8             57          21076352 ns/op         7437929 B/op     145765 allocs/op\nBenchmarkDecode-8             58          20998492 ns/op         7437827 B/op     145769 allocs/op\nBenchmarkDecode-8             61          21135281 ns/op         7431382 B/op     145759 allocs/op\nBenchmarkDecode-8             60          20971229 ns/op         7435541 B/op     145770 allocs/op\nBenchmarkDecode-8             51          21227613 ns/op         7447429 B/op     145768 allocs/op\nBenchmarkUnmarshal-8          62          20142661 ns/op         7366773 B/op     145776 allocs/op\nBenchmarkUnmarshal-8          62          20654866 ns/op         7367125 B/op     145778 allocs/op\nBenchmarkUnmarshal-8          61          20478262 ns/op         7365955 B/op     145774 allocs/op\nBenchmarkUnmarshal-8          50          21175710 ns/op         7368556 B/op     145783 allocs/op\nBenchmarkUnmarshal-8          60          19769644 ns/op         7364654 B/op     145769 allocs/op\nBenchmarkUnmarshal-8          61          19725349 ns/op         7366288 B/op     145775 allocs/op\nBenchmarkUnmarshal-8          62          21002834 ns/op         7366508 B/op     145776 allocs/op\nBenchmarkUnmarshal-8          58          20195462 ns/op         7365843 B/op     145773 allocs/op\nBenchmarkUnmarshal-8          60          20099966 ns/op         7366062 B/op     145774 allocs/op\nBenchmarkUnmarshal-8          60          21001305 ns/op         7366037 B/op     145774 allocs/op```","ts":"1598021198.078300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"6zHMh"}]},{"client_msg_id":"82a9c34c-23e1-4ebf-8639-842602831d12","type":"message","user":"UDDCM376D","text":"\u0026gt; alloc は今回のケースではそんなにパフォーマンス左右しないんじゃないすかね。 \nなるほど？","ts":"1598021127.076800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"khRoO"}]},{"client_msg_id":"5b7703f9-6c1d-424c-90f7-49c7a5784163","type":"message","user":"UDDCM376D","text":"readfileして、unmarshalするのがパフォーマンス良さそう","ts":"1598021092.076500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"LRm+G"}]},{"client_msg_id":"6b53bca4-3f62-410e-956b-4a8ece0f8fce","type":"message","user":"U03C6TEAZ","text":"alloc は今回のケースではそんなにパフォーマンス左右しないんじゃないすかね。","ts":"1598021050.075700","edited":{"user":"U03C6TEAZ","ts":"1598021071.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"UiYId"}]},{"client_msg_id":"a9b47b3a-890f-40a7-b366-cf165c93be6c","type":"message","user":"UDDCM376D","text":"1.8MBのJSONの結果\n```goos: linux\ngoarch: amd64\npkg: \u003chttp://github.com/skanehira/dentaku|github.com/skanehira/dentaku\u003e\nBenchmarkDecode-8             55          20934181 ns/op         7441080 B/op     145767 allocs/op\nBenchmarkUnmarshal-8          60          20323775 ns/op         7365949 B/op     145774 allocs/op\nPASS\nok      \u003chttp://github.com/skanehira/dentaku|github.com/skanehira/dentaku\u003e    2.422s```","ts":"1598021026.074600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"6Kv"}]},{"client_msg_id":"8158e61a-6c87-4ecd-8f92-ef0a9f31e760","type":"message","user":"UDDCM376D","text":"ですよね…","ts":"1598021018.074100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"GY="}]},{"client_msg_id":"86844c6d-fb60-4b26-85ca-4983215c896d","type":"message","user":"U03C6TEAZ","text":"フェアじゃないベンチマークはやる意味が無いので。","ts":"1598020992.073900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"IjGH"}]},{"client_msg_id":"bc4be027-2e3f-4406-bdf6-b802bac46c17","type":"message","user":"U03C6TEAZ","text":"ベンチマークはめちゃくちゃ難しいですね。","ts":"1598020940.072900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"4aJ"}]},{"client_msg_id":"a8a41e63-0c40-4649-af57-1d973e91256a","type":"message","user":"UG6DF6W87","text":"// いやまぁ普通に 1MB のファイル埋め込めばいいだけですが...w","ts":"1598020931.072600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"NM=4r"}]},{"client_msg_id":"8f664f4a-25b2-4983-9e04-d117c444dc55","type":"message","user":"UG6DF6W87","text":"でっかいファイル開いたときの LSP のログ、とかだと大きい JSON が釣れそう","ts":"1598020854.072300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Wc/"}]},{"client_msg_id":"5a579ee7-2c9d-435a-bf93-6adb4dee5f80","type":"message","user":"UDDCM376D","text":"ベンチマークのとり方意外と難しかった","ts":"1598020848.072100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"CXi"}]},{"client_msg_id":"f6ea69cc-f2e1-4f09-91d2-e43597fd1f20","type":"message","user":"UDDCM376D","text":"alloc がパフォーマンスに直接影響するかと思っていたがそうでもない…？","ts":"1598020801.071200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"C1w8Z"}]},{"client_msg_id":"23095bea-d0a9-4e9c-848c-5b145c779f6d","type":"message","user":"U03C6TEAZ","text":"パフォーマンスの方にはでないけど、alloc の方にでると思います。","ts":"1598020771.070400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"mSe"}]},{"client_msg_id":"924296ef-ae08-4a2c-a424-a8ef66e59b90","type":"message","user":"UDDCM376D","text":"どうやって生成しようかな","ts":"1598020765.070200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"e4C"}]},{"client_msg_id":"ab31ca3e-ba84-4e33-bf01-26bf3d56805b","type":"message","user":"UDDCM376D","text":"なるほど","ts":"1598020756.069700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"WOO"}]},{"client_msg_id":"d673100e-839d-493e-a553-9a233a8eed8b","type":"message","user":"U03C6TEAZ","text":"MB ある様な JSON だと差が出るかも。","ts":"1598020747.069500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"kOr8J"}]},{"client_msg_id":"a866670c-51c6-4ca5-83f9-b4611931a224","type":"message","user":"UDDCM376D","text":"もっと大きいのが良いんすね","ts":"1598020746.069400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"JnnW1"}]},{"client_msg_id":"81745fd8-921b-401f-bac3-3f061576432d","type":"message","user":"U03C6TEAZ","text":"この JSON、たかだか 89kb しかないので誤差になるでしょうね。","ts":"1598020722.068900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"EjP"}]},{"client_msg_id":"35ff441b-c7c9-4481-aeca-e67b58b48541","type":"message","user":"UDDCM376D","text":"誤差ですね","ts":"1598020608.068400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ApKPf"}]},{"client_msg_id":"f2a7e050-9feb-4f15-8421-dd6c12a20011","type":"message","user":"UDDCM376D","text":"なるほど","ts":"1598020571.068200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"QduFo"}]},{"client_msg_id":"ca4aafd7-d2b4-4293-9234-42f177c103bc","type":"message","user":"U03C6TEAZ","text":"変わらんなw","ts":"1598020514.067800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"429"}]},{"client_msg_id":"9bc01440-7806-47cc-aadc-12cf4d0cadba","type":"message","user":"U03C6TEAZ","text":"\u003chttps://gist.github.com/mattn/b66ca1df85f28ee698bca32b52b8b2fc\u003e","ts":"1598020511.067600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"w1YNS"}]},{"client_msg_id":"de6e8009-3436-436f-8c21-a3cf985205f2","type":"message","user":"U03C6TEAZ","text":"あ、reset 入れた方がいいな。フェアじゃない。","ts":"1598020463.067400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"NoaE"}]},{"client_msg_id":"98707726-e7fa-4d4c-8eb6-22446ac740aa","type":"message","user":"U03C6TEAZ","text":"誤差ですね。","ts":"1598020427.067100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"xcNz"}]},{"client_msg_id":"18694b54-7cf2-411b-898d-55b26d6cfda5","type":"message","user":"U03C6TEAZ","text":"```go test -bench . -benchmem\ngoos: linux\ngoarch: amd64\nBenchmarkDecode-2            200           6052179 ns/op          369170 B/op       7296 allocs/op\nBenchmarkUnmarshal-2         201           6025383 ns/op          368481 B/op       7300 allocs/op\nPASS\nok      _/home/mattn/dev/gori   4.376s```","ts":"1598020404.066800","team":"T03C4RC8V","reactions":[{"name":"naruhodo","count":1,"users":["UG6DF6W87"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"a09z"}]},{"client_msg_id":"841cdeb6-5644-44db-8e7d-13c3612d5da8","type":"message","user":"U03C6TEAZ","text":"わりとフェアに。","ts":"1598020376.066600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"c/u"}]},{"client_msg_id":"defcb8c6-8575-40ec-a4bd-b8babb573a82","type":"message","user":"U03C6TEAZ","text":"\u003chttps://gist.github.com/mattn/fcbc947a40b0603c812fbe4913100093\u003e","ts":"1598020367.066300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"5THk"}]},{"client_msg_id":"25c7b527-0a30-4c79-8935-e42618f53b9e","type":"message","user":"U03C6TEAZ","text":"実はベンチマークの中身が全部 err 返してて何も計測できてなかった、みたいなアルアル。","ts":"1598020356.066100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Uzcaa"}]},{"client_msg_id":"4ef7d0ed-a653-4f08-9908-633b9615e1ad","type":"message","user":"UG6DF6W87","text":"// 私もさっきおなじミスしました...","ts":"1598020355.066000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"kduX"}]},{"client_msg_id":"3703afdd-c3ac-4146-96f3-913c68098653","type":"message","user":"UDDCM376D","text":"あー","ts":"1598020351.065900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"EEB"}]},{"client_msg_id":"be834ae6-2bca-489b-ad27-0ee39c3e58d6","type":"message","user":"U03C6TEAZ","text":"f が EOF まで行ってしまうので2回目で失敗します。","ts":"1598020306.065300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"oC3"}]},{"client_msg_id":"b055e5a0-96fd-443d-bf7b-815888ca6475","type":"message","user":"U03C6TEAZ","text":"それ失敗しますね。","ts":"1598020163.065000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"bqMM9"}]},{"client_msg_id":"e549368a-a298-4116-9061-355dacf1fa11","type":"message","user":"UDDCM376D","text":"```package main\n\nimport (\n\t\"encoding/json\"\n\t\"io/ioutil\"\n\t\"os\"\n\t\"testing\"\n)\n\nfunc BenchmarkDecode(b *testing.B) {\n\tf, _ := os.Open(\"test.json\")\n\tvar m interface{}\n\tfor i := 0; i \u0026lt; b.N; i++ {\n\t\tjson.NewDecoder(f).Decode(\u0026amp;m)\n\t}\n}\n\nfunc BenchmarkUnmarshal(b *testing.B) {\n\tc, _ := ioutil.ReadFile(\"test.json\")\n\tvar m interface{}\n\tfor i := 0; i \u0026lt; b.N; i++ {\n\t\tjson.Unmarshal(c, \u0026amp;m)\n\t}\n}```","ts":"1598020150.064700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"fWr"}]},{"client_msg_id":"4dc5bb7e-9012-415f-9f15-549b82d8ed96","type":"message","user":"UG6DF6W87","text":"\u003chttps://mattn.kaoriya.net/software/lang/go/20161019124907.htm\u003e\n:sasumatsu:","ts":"1598020146.064400","attachments":[{"fallback":"Big Sky: Big Sky :: golang でパフォーマンスチューニングする際に気を付けるべきこと","id":1,"title":"Big Sky :: golang でパフォーマンスチューニングする際に気を付けるべきこと","title_link":"https://mattn.kaoriya.net/software/lang/go/20161019124907.htm","text":"システム開発屋がひっそり語るぼやき","thumb_url":"https://mattn.kaoriya.net/images/logo.png","blocks":null,"service_name":"Big Sky","service_icon":"https://mattn.kaoriya.net/favicon.ico","thumb_width":113,"thumb_height":113,"from_url":"https://mattn.kaoriya.net/software/lang/go/20161019124907.htm","original_url":"https://mattn.kaoriya.net/software/lang/go/20161019124907.htm"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"9uJ"}]},{"client_msg_id":"c8e74188-f9de-43f8-8e2b-9f4ceff1b751","type":"message","user":"UDDCM376D","text":"ベンチマークのやり方が全然なっていなかった","ts":"1598020075.064100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"H3j7a"}]},{"type":"message","user":"UDDCM376D","ts":"1598020064.063400","files":[{"id":"F01982ES669","created":1598020063,"timestamp":1598020063,"name":"image.png","title":"image.png","mimetype":"image/png","image_exif_rotation":0,"filetype":"png","pretty_type":"PNG","user":"UDDCM376D","mode":"hosted","editable":false,"is_external":false,"external_type":"","size":28257,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F01982ES669/image.png","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F01982ES669/download/image.png","original_h":190,"original_w":955,"thumb_64":"https://files.slack.com/files-tmb/T03C4RC8V-F01982ES669-724205b820/image_64.png","thumb_80":"https://files.slack.com/files-tmb/T03C4RC8V-F01982ES669-724205b820/image_80.png","thumb_160":"https://files.slack.com/files-tmb/T03C4RC8V-F01982ES669-724205b820/image_160.png","thumb_360":"https://files.slack.com/files-tmb/T03C4RC8V-F01982ES669-724205b820/image_360.png","thumb_360_gif":"","thumb_360_w":360,"thumb_360_h":72,"thumb_480":"https://files.slack.com/files-tmb/T03C4RC8V-F01982ES669-724205b820/image_480.png","thumb_480_w":480,"thumb_480_h":95,"thumb_720":"https://files.slack.com/files-tmb/T03C4RC8V-F01982ES669-724205b820/image_720.png","thumb_720_w":720,"thumb_720_h":143,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/UDDCM376D/F01982ES669/image.png","permalink_public":"https://slack-files.com/T03C4RC8V-F01982ES669-7e44152d1f","edit_link":"","preview":"","preview_highlight":"","lines":0,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"thumb_800":"https://files.slack.com/files-tmb/T03C4RC8V-F01982ES669-724205b820/image_800.png","thumb_800_h":159,"thumb_800_w":800,"thumb_tiny":"AwAJADCk3JOc5pv50rffNMpki/WjvSUUwF49aDikooA//9k=","username":""}],"replace_original":false,"delete_original":false,"blocks":null},{"client_msg_id":"1020355b-02dd-4a24-8e26-8c146c05d016","type":"message","user":"UDDCM376D","text":"なるほど？","ts":"1598019951.063300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Un5vq"}]},{"client_msg_id":"622b0e86-121a-486e-ac36-1e0786b4a999","type":"message","user":"U03C6TEAZ","text":"`b.N` で回さないとベンチマークしてる意味がないかも。","ts":"1598019922.062700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"0ay"}]},{"client_msg_id":"448bf8df-54bb-4167-acbc-953bdaccc5cc","type":"message","user":"U03C6TEAZ","text":"とんとんというか、マイクロベンチマーク過ぎません？","ts":"1598019895.062400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Hwz"}]},{"client_msg_id":"f78a613f-11bc-4b4d-9f4c-16b0342b1b77","type":"message","user":"UDDCM376D","text":"Linuxだとトントンくらいだった","ts":"1598019478.062000","edited":{"user":"UDDCM376D","ts":"1598019483.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"eVx"}]},{"client_msg_id":"99906812-3f26-4464-bd2b-2adfa25b30fa","type":"message","user":"UDDCM376D","text":"長いJSON","ts":"1598019151.061600","files":[{"id":"F0199C9GRK4","created":1598019149,"timestamp":1598019149,"name":"無題","title":"無題","mimetype":"text/plain","image_exif_rotation":0,"filetype":"javascript","pretty_type":"JavaScript/JSON","user":"UDDCM376D","mode":"snippet","editable":true,"is_external":false,"external_type":"","size":90381,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F0199C9GRK4/______","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F0199C9GRK4/download/______","original_h":0,"original_w":0,"thumb_64":"","thumb_80":"","thumb_160":"","thumb_360":"","thumb_360_gif":"","thumb_360_w":0,"thumb_360_h":0,"thumb_480":"","thumb_480_w":0,"thumb_480_h":0,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/UDDCM376D/F0199C9GRK4/______","permalink_public":"https://slack-files.com/T03C4RC8V-F0199C9GRK4-88e1b34eab","edit_link":"https://vim-jp.slack.com/files/UDDCM376D/F0199C9GRK4/______/edit","preview":"[\n  {\n    \"_id\": \"5f3f90bb1e4641892e5a5af9\",\n    \"index\": 0,\n    \"guid\": \"324c0e9f-2efa-4420-bf7d-51ae99b1ea4b\",","preview_highlight":"\u003cdiv class=\"CodeMirror cm-s-default CodeMirrorServer\" oncopy=\"if(event.clipboardData){event.clipboardData.setData('text/plain',window.getSelection().toString().replace(/\\u200b/g,''));event.preventDefault();event.stopPropagation();}\"\u003e\n\u003cdiv class=\"CodeMirror-code\"\u003e\n\u003cdiv\u003e\u003cpre\u003e[\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e  {\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e    \u003cspan class=\"cm-string cm-property\"\u003e\u0026quot;_id\u0026quot;\u003c/span\u003e: \u003cspan class=\"cm-string\"\u003e\u0026quot;5f3f90bb1e4641892e5a5af9\u0026quot;\u003c/span\u003e,\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e    \u003cspan class=\"cm-string cm-property\"\u003e\u0026quot;index\u0026quot;\u003c/span\u003e: \u003cspan class=\"cm-number\"\u003e0\u003c/span\u003e,\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv\u003e\u003cpre\u003e    \u003cspan class=\"cm-string cm-property\"\u003e\u0026quot;guid\u0026quot;\u003c/span\u003e: \u003cspan class=\"cm-string\"\u003e\u0026quot;324c0e9f-2efa-4420-bf7d-51ae99b1ea4b\u0026quot;\u003c/span\u003e,\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n","lines":3423,"lines_more":3418,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"bnxT"}]},{"client_msg_id":"4d775a91-3031-4357-ac1c-df9b032634b6","type":"message","user":"UDDCM376D","text":"コード\n```package test\n\nimport (\n\t\"encoding/json\"\n\t\"io/ioutil\"\n\t\"log\"\n\t\"os\"\n\t\"testing\"\n)\n\nfunc BenchmarkDecode(b *testing.B) {\n\tf, err := os.Open(\"a.json\")\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\n\tvar m interface{}\n\tif err := json.NewDecoder(f).Decode(\u0026amp;m); err != nil {\n\t\tlog.Fatal(err)\n\t}\n}\n\nfunc BenchmarkUnmarshal(b *testing.B) {\n\tc, err := ioutil.ReadFile(\"a.json\")\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\n\tvar m interface{}\n\tif err := json.Unmarshal(c, \u0026amp;m); err != nil {\n\t\tlog.Fatal(err)\n\t}\n}```","ts":"1598019110.061400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"AY0u"}]},{"client_msg_id":"502B39A6-2AFE-47E4-91C1-B6A12FF0D479","type":"message","user":"UDDCM376D","text":"スマホだからコード貼れない…\n後で貼ります","ts":"1598017130.059700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"/=XiT"}]},{"client_msg_id":"d9daaf2d-6c49-42b8-891e-0db5cdbed68b","type":"message","user":"U03C6TEAZ","text":"あとはまぁ、socket から読むとかだといちいち byte 配列読んでたらメモリ勿体ないってのはありますね。","ts":"1598017100.058800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"fGS+4"}]},{"client_msg_id":"c3915bf5-e8f1-4978-bbce-81509e33c55f","type":"message","user":"UG6DF6W87","text":"reader があるなら json.Decoder\n[]byte があるなら json.Unmarshal\nなんか脳死で json.Decoder のほうが早いやろ、とか言って []byte を Reader に持ってって json.Decoder に食わせる、みたいなコード書いたことある気がする...","ts":"1598017074.058200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ltM"}]},{"client_msg_id":"0AB5B888-B8F4-459D-94A5-A5E53F81057E","type":"message","user":"UDDCM376D","text":"ふむ","ts":"1598017072.058100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"4d/K"}]},{"client_msg_id":"f81bfc82-0206-471a-8f77-f3c17c8d928e","type":"message","user":"U03C6TEAZ","text":"なので Reader から読むスタイルだとだんぜん Decode が速い。","ts":"1598016913.055800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"0ME=d"}]},{"client_msg_id":"aac21ebc-8c3f-417d-893e-721aefcc6732","type":"message","user":"U03C6TEAZ","text":"bytes.NewReader の差です。","ts":"1598016896.055400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"8WGMW"}]},{"client_msg_id":"a0ec34ae-47c5-4491-a5e7-0bebc6e7e9b1","type":"message","user":"U03C6TEAZ","text":"この差は json.Decoder vs json.Unmarshal の差じゃないですね。","ts":"1598016881.055100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"W6D"}]},{"client_msg_id":"23ed8925-2956-4551-ae0e-cc76e6a4c3f2","type":"message","user":"U03C6TEAZ","text":"僕の手元 (tip) だと\n```goos: windows\ngoarch: amd64\npkg: \u003chttp://github.com/mattn/jb|github.com/mattn/jb\u003e\nBenchmarkDecord-8       341881120                3.22 ns/op\nBenchmarkUnmarshal-8      800191              1318 ns/op\nPASS\nok      \u003chttp://github.com/mattn/jb|github.com/mattn/jb\u003e     2.818s```","ts":"1598016735.053900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"td9"}]},{"client_msg_id":"AB0DE140-C7AC-4F69-87DA-A1692FE894CD","type":"message","user":"UDDCM376D","text":"測定すべきだったなぁ","ts":"1598016458.053200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"qS+k"}]},{"client_msg_id":"6E1BAC99-6544-4D16-9FEE-C9C13A7263F3","type":"message","user":"UDDCM376D","text":"decoderのが早いと思ってた","ts":"1598016453.052900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"HpA"}]},{"client_msg_id":"d93b3afc-23ab-454d-bc40-f8e9fe1e42ca","type":"message","user":"UNJ2DANJC","text":"unmarshalだと既にバイトスライスなので一気に読めるけどDecoderはio.Readerだから一旦内部バッファのバイトスライスにコピーしてるんじゃないですかね。ちらっとソース読んだ感じだとDecodeにはそういう感じの処理が書いてあった。","ts":"1598010067.052200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"EisMV"}]},{"client_msg_id":"5b358f22-a3af-46cb-aea5-4c434d0d8791","type":"message","user":"UG6DF6W87","text":"```goos: linux\ngoarch: amd64\npkg: test\nBenchmarkDecord-4      \t  761502\t      1624 ns/op\t     984 B/op\t       8 allocs/op\nBenchmarkUnmarshal-4   \t 1000000\t      1158 ns/op\t     208 B/op\t       4 allocs/op```\nおー","ts":"1598003873.046300","thread_ts":"1598003873.046300","reply_count":1,"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ZZA"}]},{"client_msg_id":"b83e4c78-c971-4075-a2b7-50f134500522","type":"message","user":"UG6DF6W87","text":"decoder の生成外したけど例えば REST API のハンドラだ、とか考えると入れたほうがフェアなんですかね...?","ts":"1598003834.045900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"gWIC"}]},{"client_msg_id":"66fab55e-10fa-4834-b360-916b8b7c93e3","type":"message","user":"UG6DF6W87","text":"```package main\n\nimport (\n  \"bytes\"\n  \"encoding/json\"\n  \"testing\"\n)\n\ntype D struct {\n  Hoge string\n  Piyo int\n}\n\nvar data = []byte(`{\"hoge\": \"fuga\", \"piyo\": 1}`)\n\nfunc BenchmarkDecord(b *testing.B) {\n  r := bytes.NewReader(data)\n  ret := D{}\n\n  d := json.NewDecoder(r)\n  for i := 0; i \u0026lt; b.N; i++ {\n    d.Decode(\u0026amp;ret)\n  }\n}\n\nfunc BenchmarkUnmarshal(b *testing.B) {\n  ret := D{}\n\n  for i := 0; i \u0026lt; b.N; i++ {\n    json.Unmarshal(data, \u0026amp;ret)\n  }\n}```\nbenchmark のコードはこれ","ts":"1598003295.044700","thread_ts":"1598003295.044700","reply_count":2,"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"YyV"}]},{"client_msg_id":"b8428468-5d09-4533-926b-77263e72b2e7","type":"message","user":"UG6DF6W87","text":"```goos: linux\ngoarch: amd64\npkg: test\nBenchmarkDecord-4      \t315608935\t         3.69 ns/op\t       0 B/op\t       0 allocs/op\nBenchmarkUnmarshal-4   \t  970028\t      1129 ns/op\t     208 B/op\t       4 allocs/op\nPASS```\n私の環境だとこんな感じ","ts":"1598003212.043900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"DzC"}]},{"client_msg_id":"e249e0b3-6c2a-4b0e-bdc6-988c276d0912","type":"message","user":"UDDCM376D","text":"json.Unmarshalのが速かった…\n```BenchmarkDecode-16              1000000000               0.00109 ns/op         0 B/op          0 allocs/op\nBenchmarkUnmarshal-16           1000000000               0.000976 ns/op        0 B/op          0 allocs/op```","ts":"1598002259.043200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"kUgzG"}]},{"type":"message","user":"U0198GMB0CT","text":"\u003c@U0198GMB0CT\u003e has joined the channel","ts":"1597974802.042700","subtype":"channel_join","replace_original":false,"delete_original":false,"blocks":null},{"client_msg_id":"262b92ba-905f-4052-84c3-e80e5cadaf25","type":"message","user":"UG6DF6W87","text":"これのコードは\n```package main\n\nimport (\n  \"bytes\"\n  \"encoding/json\"\n  \"testing\"\n)\n\ntype D struct {\n  Hoge string\n  Piyo int\n}\n\nvar data = []byte(`{\"hoge\": \"fuga\", \"piyo\": 1}`)\n\nfunc BenchmarkDecord(b *testing.B) {\n  ret := D{}\n\n  for i := 0; i \u0026lt; b.N; i++ {\n    r := bytes.NewReader(data)\n    d := json.NewDecoder(r)\n    d.Decode(\u0026amp;ret)\n  }\n}\n\nfunc BenchmarkUnmarshal(b *testing.B) {\n  ret := D{}\n  for i := 0; i \u0026lt; b.N; i++ {\n    json.Unmarshal(data, \u0026amp;ret)\n  }\n}```\n","ts":"1598017452.061100","thread_ts":"1598003873.046300","parent_user_id":"UG6DF6W87","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ISxJ"}]},{"client_msg_id":"0392864C-5C91-499E-B42F-F78B37C05D76","type":"message","user":"UFGUGBCH3","text":"Decodeのほう、NewReader毎回作らないと最初の一回でストリーム読み切ってそのあとdecodeしてないですよね？","ts":"1598004737.048100","thread_ts":"1598003295.044700","parent_user_id":"UG6DF6W87","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"sGhRy"}]},{"client_msg_id":"283b6787-142a-41ce-8f37-6b87e3c2c7d8","type":"message","user":"UG6DF6W87","text":"あ、そうか、そうですね","ts":"1598006269.048300","thread_ts":"1598003295.044700","parent_user_id":"UG6DF6W87","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"A0Mk2"}]}]
