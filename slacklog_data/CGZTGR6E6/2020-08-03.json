[{"client_msg_id":"e36050b3-1a3a-4dcd-862d-50c21138a759","type":"message","user":"U03C71D7H","text":"あれから結局いい mock の方法が思いついていない。テスト難しい","ts":"1596381043.110700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Xd3"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"da234ea2-c761-43d8-9b23-a9c30411f1dc","type":"message","user":"U03C71D7H","text":"- ライブラリ A がクラス C を提供している\n- テスト対象のコード S がライブラリ A を require し、 `new C(...)` している\n- コンストラクタに適切な値が渡されているかどうかをテストしたい","ts":"1596381128.112000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"AYapw"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"fd1ed36f-8e13-41ef-8f0b-665bb342fa6e","type":"message","user":"U78A6ESHM","text":"自分なら jest 使いますね。\n<https://jestjs.io/docs/ja/mock-functions#%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AE%E3%83%A2%E3%83%83%E3%82%AF>\nsinon でもできると思うけど。","ts":"1596382620.112500","attachments":[{"fallback":"Mock Functions · Jest","id":1,"title":"Mock Functions · Jest","title_link":"https://jestjs.io/docs/ja/mock-functions#%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AE%E3%83%A2%E3%83%83%E3%82%AF","text":"モック関数によりコード間の繋がりをテストすることができます。関数が持つ実際の実装を除去したり、関数の呼び出し（また、呼び出しに渡されたパラメータも含め）をキャプチャしたり、`new` によるコンストラクタ関数のインスタンス化をキャプチャできます。そうすることでテスト時のみの返り値の設定をすることが可能になります。","thumb_url":"https://jestjs.io/img/opengraph.png","blocks":null,"service_name":"jestjs.io","service_icon":"https://jestjs.io/img/favicon/favicon.ico","thumb_width":796,"thumb_height":416,"from_url":"https://jestjs.io/docs/ja/mock-functions#%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AE%E3%83%A2%E3%83%83%E3%82%AF","original_url":"https://jestjs.io/docs/ja/mock-functions#%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AE%E3%83%A2%E3%83%83%E3%82%AF"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Tqc"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a4df1136-eb1c-4f5d-9268-6da34ed1649a","type":"message","user":"U78A6ESHM","text":"<https://github.com/heavenshell/ts-react-static/blob/master/src/containers/__mocks__/react-static.ts#L15-L18>\nこんな感じでライブラリーも差し替えれます。","ts":"1596382943.113600","attachments":[{"fallback":"GitHub: heavenshell/ts-react-static","id":1,"title":"heavenshell/ts-react-static","title_link":"https://github.com/heavenshell/ts-react-static/blob/master/src/containers/__mocks__/react-static.ts#L15-L18","text":"My React-Static site. Contribute to heavenshell/ts-react-static development by creating an account on GitHub.","thumb_url":"https://avatars0.githubusercontent.com/u/56591?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/80588/img/unfurl_icons/github.png","thumb_width":128,"thumb_height":128,"from_url":"https://github.com/heavenshell/ts-react-static/blob/master/src/containers/__mocks__/react-static.ts#L15-L18","original_url":"https://github.com/heavenshell/ts-react-static/blob/master/src/containers/__mocks__/react-static.ts#L15-L18"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"RCtu1"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"2ef7ea59-70d4-4276-a4d2-506d1747f45d","type":"message","user":"U03C71D7H","text":"sinon を使ってます","ts":"1596382952.113900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"tJ7VX"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"79e44fb4-ce4d-44ea-85c5-513bb7926e8a","type":"message","user":"U03C71D7H","text":"jest は昔一度試したことがあるのだけど、全部入りで気持ち悪かったのでやめたんですよね","ts":"1596382971.114300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"WNQ"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"cebeadd3-7060-49ae-939e-e69a114904d4","type":"message","user":"U03C71D7H","text":"どちらにしても既存のテストが mocha + sinon で書かれていて、移行がだるすぎるので jest はできれば避けたい","ts":"1596383010.114900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"dh9"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"9d020ae0-7858-4b44-bb4a-cd2b229c70b3","type":"message","user":"U78A6ESHM","text":"<https://sinonjs.org/how-to/stub-dependency/>","ts":"1596383065.115100","attachments":[{"fallback":"How to stub a dependency of a module","id":1,"title":"How to stub a dependency of a module","title_link":"https://sinonjs.org/how-to/stub-dependency/","text":"Sinon is a stubbing library, not a module interception library. Stubbing dependencies is highly dependant on your enviroment and the implementation. For Node...","blocks":null,"service_name":"sinonjs.org","service_icon":"https://sinonjs.org/assets/images/favicon.png","from_url":"https://sinonjs.org/how-to/stub-dependency/","original_url":"https://sinonjs.org/how-to/stub-dependency/"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"PS4q"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"bb6ecf09-2d0e-40bf-9c44-7097cf570160","type":"message","user":"U78A6ESHM","text":"これは？","ts":"1596383067.115400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"40t"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"368e2a92-d1de-4a7e-bbe0-779d65b032ab","type":"message","user":"U03C71D7H","text":"cannot redefine property って言われちゃいますね","ts":"1596383148.115700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"y86K4"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"1a9a9016-1ee7-4a43-8dfc-abcfb6a79670","type":"message","user":"U03C71D7H","text":"dependencyModule.js に当たる部分が、exports に対して defineProperty していて、 `const dependencyModule = require(\"./dependencyModule\");` の `dependencyModule.getSecretNumber` は書き換え不能になっています","ts":"1596383276.117000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"CuZi"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"817bbb44-6c3d-4795-ac3d-c6a9337ef227","type":"message","user":"U03C71D7H","text":"テスト対象のコードをテストコードで直接 require していない(hubot なので hubot-test-helper 経由でロードしている)ので、proxyquire も使えなさそう","ts":"1596383681.117900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"BH1K"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"b5aaa6a2-9cd7-44bb-963a-1a4bbdbdf41c","type":"message","user":"U03C71D7H","text":"どうすればええんや…","ts":"1596383694.118100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"goHs"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"7449cfcf-015b-4fc8-a2a8-76139d299d07","type":"message","user":"U03C71D7H","text":"色々調べたけど、やはり defineProperty で作られたプロパティを mock するのは不可能っぽいな","ts":"1596385768.118700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"JsK0M"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"}]
