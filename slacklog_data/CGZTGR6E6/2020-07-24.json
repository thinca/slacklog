[{"client_msg_id":"ed9e7a65-111c-4c07-b4f2-fc58914b8330","type":"message","user":"U8996GYBF","ts":"1595575947.011400","files":[{"id":"F0177R6310X","created":1595575946,"timestamp":1595575946,"name":"無題","title":"無題","mimetype":"text/plain","image_exif_rotation":0,"filetype":"typescript","pretty_type":"TypeScript","user":"U8996GYBF","mode":"snippet","editable":true,"is_external":false,"external_type":"","size":478,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F0177R6310X/______","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F0177R6310X/download/______","original_h":0,"original_w":0,"thumb_64":"","thumb_80":"","thumb_160":"","thumb_360":"","thumb_360_gif":"","thumb_360_w":0,"thumb_360_h":0,"thumb_480":"","thumb_480_w":0,"thumb_480_h":0,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U8996GYBF/F0177R6310X/______","permalink_public":"https://slack-files.com/T03C4RC8V-F0177R6310X-c52fb5a291","edit_link":"https://vim-jp.slack.com/files/U8996GYBF/F0177R6310X/______/edit","preview":"","preview_highlight":"","lines":0,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":null},{"client_msg_id":"42a781b4-1a96-4dd9-b4a8-a7173a20b1b6","type":"message","user":"U8996GYBF","text":"こんなコード書いてたんですけど、これってdataをneverに推論はしてくれないんですかね・・・？","ts":"1595575983.012200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"r1=B"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"24518046-af86-4443-a94c-d72036f3660c","type":"message","user":"U8996GYBF","text":"`data.action` が neverなら `data` がneverであるのは自明に感じるんですけど","ts":"1595576005.012700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"qK54R"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"614f46e3-d3ea-496c-8822-237e920c023d","type":"message","user":"U8996GYBF","text":"reduxのactionを `action.type` でswitchしたときはdefaultで `action` をneverに推論してくれてる気がする、何か間違えてるのか・・・？","ts":"1595576539.013600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"g886"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a9444672-321f-4ae6-ad1f-368cd1e05d28","type":"message","user":"U03C71D7H","text":"そもそも型チェック通ってたら default に行かなそうな気もする","ts":"1595577993.014500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"2ibm6"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"90fdf1a6-65f4-446f-a108-2da5d1bfe812","type":"message","user":"U8996GYBF","text":"あ、いかないんですけど\ndefaultでneverであることをチェックすることでswitchが網羅してることを検知できるんですよ","ts":"1595578038.015000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"iQ9"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"d4bad034-a8d4-4c59-a068-0fb9d5babc68","type":"message","user":"U03C71D7H","text":"チェックしないと網羅していることが検知できない…? (TypeScript わからん)","ts":"1595578118.016100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"AGP"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"e029eb91-4499-4620-8c31-f9a98fa012be","type":"message","user":"U8996GYBF","text":"あ、例が悪かった","ts":"1595578209.016800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ze0"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"f7dabe46-4a7c-4f4f-845c-7ee1a37d82fe","type":"message","user":"U8996GYBF","text":"ちょっと待ってください、いい例出したい","ts":"1595578265.017000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"CBk"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a82a71fb-9b43-4edb-a54e-b87a4c80d809","type":"message","user":"U8996GYBF","text":"```const unreachable = (_: never): never =&gt; _\n\nswitch (data.action) {\n  case \"diff\": {\n    break\n  }\n  case \"yank\": {\n    break\n  }\n  default: {\n    unreachable(data.action)\n  }\n}```\n```const unreachable = (_: never): never =&gt; _\n\nswitch (data.action) {\n  case \"diff\": {\n    break\n  }\n  default: {\n    unreachable(data.action)\n  }\n}```","ts":"1595578383.017200","edited":{"user":"U8996GYBF","ts":"1595578451.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"L2g8"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"41c5491b-e9b8-4042-84f9-b8d3d3864974","type":"message","user":"U8996GYBF","text":"こうやっとくと下はdata.actionがnever型に代入できないんで `unreachable` に渡そうとしたときに型エラー吐いてくれます","ts":"1595578434.018100","edited":{"user":"U8996GYBF","ts":"1595578516.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"0qBo0"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"2851ce91-5ab4-40b5-88f6-06337e971d02","type":"message","user":"U8996GYBF","text":"上は `data.action` がswitchで網羅されててneverであることが保証されてるから通る\ndefaultのなかでneverであることを保証する式がなかったらどっちも通っちゃいます","ts":"1595578493.019000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"5ixq"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"bd0ab7b9-f29f-40d0-bb3d-f52f58d9b586","type":"message","user":"U03C71D7H","text":"ああ、なるほど。網羅してない場合にコンパイルエラーにしたいわけか","ts":"1595578631.019800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"knl"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"36dfd33c-7d1a-431c-a390-9c4d5611e83b","type":"message","user":"U8996GYBF","text":"はい、その上でdata.actionがneverなんだからdataがneverになってほしい","ts":"1595578646.020200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"tFR9Q"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"2f84a898-401c-494e-a367-3bac39e67e9c","type":"message","user":"U03C71D7H","text":"しかしそうはならない気が","ts":"1595578679.021000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"HT7C3"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"9853de4a-3609-42d9-8606-2230f115cc27","type":"message","user":"U8996GYBF","text":"というか以前ほぼ同じ実装でReduxのreducer書いたときはneverに推論してくれたはずなんですけど・・・","ts":"1595578680.021100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Y5sqH"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"fb4e9318-0179-4802-aad4-e1f52e9555ca","type":"message","user":"UAZ33BKV2","text":"じゃあ、TypeScriptがなにかアレなんじゃなく、型の違いによる特性がありそうかを調べる、というほうがいいかな...と","ts":"1595578710.021600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"GZA"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"e7da02a4-ee04-46fd-944e-f3f80397e156","type":"message","user":"U8R597E9H","text":"オブジェクト全体を union で定義しないとタグ付き扱いにならないかも","ts":"1595578741.022600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"lhj"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"af4ab72c-0302-410e-9f97-1cc2d5549b67","type":"message","user":"U8996GYBF","text":"ちょっと調べてみてます\n```export type ResourceData =\n  | FileData\n  | LineData\n  | BufferData\n  | GitActionData\n  | GitStatusData\n  | GitBranchData\n  | GitBranchActionData\n  | RegisterData\n  | GitPrData```\nってやって引数で受け取る型をResourceDataにしてはいるんですが","ts":"1595578979.023500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"qR7Ah"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a6b16e6a-e170-4f98-bcb2-b0ae81ff2d6d","type":"message","user":"U8R597E9H","text":"action 型は絞り込まれてるが、data には絞り込みが関係ない扱いになってそうかな。面倒かもですが、全体を union で定義すればいけると思います。\nなにかいい方法ないのかな。とは自分も思う","ts":"1595579071.025600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"SR+7"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"b759ea67-ccaa-4496-a586-c50062cbb029","type":"message","user":"U8996GYBF","text":"ですね、dataが何故か絞り込まれてない","ts":"1595579136.025800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"=UfG"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"d4d297bb-527b-4c07-a541-7163191516be","type":"message","user":"U8996GYBF","ts":"1595579174.025900","files":[{"id":"F0177TDH82K","created":1595579173,"timestamp":1595579173,"name":"無題","title":"無題","mimetype":"text/plain","image_exif_rotation":0,"filetype":"typescript","pretty_type":"TypeScript","user":"U8996GYBF","mode":"snippet","editable":true,"is_external":false,"external_type":"","size":839,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F0177TDH82K/______","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F0177TDH82K/download/______","original_h":0,"original_w":0,"thumb_64":"","thumb_80":"","thumb_160":"","thumb_360":"","thumb_360_gif":"","thumb_360_w":0,"thumb_360_h":0,"thumb_480":"","thumb_480_w":0,"thumb_480_h":0,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U8996GYBF/F0177TDH82K/______","permalink_public":"https://slack-files.com/T03C4RC8V-F0177TDH82K-71cfdf6a5f","edit_link":"https://vim-jp.slack.com/files/U8996GYBF/F0177TDH82K/______/edit","preview":"","preview_highlight":"","lines":0,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":null},{"client_msg_id":"a4c448a6-fc92-4bf5-b74e-8d68a1a947c3","type":"message","user":"U8996GYBF","text":"ちょっと長いんですけど、以前書いたReducerのボイラープレートでこれなら推論してくれてるんですよね、どこが違うのかな・・・","ts":"1595579194.026600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"P61"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"825f2dbd-98f0-446c-b9e9-f92f6699a9f3","type":"message","user":"U8996GYBF","text":"今のTSのバージョンなら推論されないとかはあるかもしれないです","ts":"1595579276.026900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"t1r"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"d30fa3b5-f1f3-45af-b99d-bbb8275b77d2","type":"message","user":"UAZ33BKV2","text":"なんとなくだと、全体のUnionだと絞れるけど、ある型の中のメンバのUnionでswitchで絞っても、その上位がneverにならないことが推測できないんじゃないかな?","ts":"1595579395.027900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"P0ai"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"326ec3ae-0b57-46b7-a28e-435df0a2747f","type":"message","user":"U8996GYBF","text":"Reducerの例の場合、 `Actions` （これAction型の方が名前良かったんですけど）の中の `action.type` でswitchで絞り込んでaction自体がneverになっていたはずで、なんかここって違いあります・・・？\n全体のUnionってのが分かってないかもしれない","ts":"1595579482.029100","edited":{"user":"U8996GYBF","ts":"1595579706.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"W=xUF"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"56a50ea7-f93e-4974-9721-e0e6a1f06189","type":"message","user":"UAZ33BKV2","text":"```export type Actions = ReturnType&lt;typeof action1&gt; | ReturnType&lt;typeof action2&gt;```\nとしてから\n\n```export const reducer: Reducer&lt;State, Actions&gt; = (state = initialState, action) ```\nと戻りの型をテンプレート/ジェネリクス? 型指定して強制しているっぽいから? そこから逆に推論されるとか?","ts":"1595579720.030800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"POKi"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"35375bd5-521e-4768-babc-f9fb8e8647b4","type":"message","user":"U8996GYBF","text":"あー、なるほど・・・","ts":"1595579750.031100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"1=b="}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"04ffb04a-3bda-4b26-9589-4b0eb59b7ab2","type":"message","user":"U8996GYBF","text":"Reducer型が何かやってる可能性とかもあるのか、理解しました","ts":"1595579764.031600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ECw"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"c97e6ee7-099b-41d3-941a-029be239fdb7","type":"message","user":"UAZ33BKV2","text":"あ、全体のUnionは若干自分の誤解で、Actionが固定的に型が決まってそう、的なことが言いたかっただけです","ts":"1595579771.031900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"4Mia"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"057db193-4b70-44f9-8faa-c4f00541143e","type":"message","user":"U8996GYBF","text":"うーん、いい感じに推論してくれて欲しいなぁ\nただ一旦仕方なさそうなのでこれでやろうと思います、ありがとうございます","ts":"1595579809.032500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"vsm"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"0d6d1cb9-d3c4-48fc-bcbe-788788c1ad30","type":"message","user":"U06BRP8VD","text":"FooData の型ってどうなってるんです?","ts":"1595580482.032800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"CnwV"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"2f3f50fb-0705-4ca5-83eb-ac8226a85e29","type":"message","user":"U8996GYBF","text":"長くなっちゃいますけどこうなってて、この関数はResourceDataを受け取るようになっています","ts":"1595580636.033300","files":[{"id":"F017USB3NCC","created":1595580635,"timestamp":1595580635,"name":"無題","title":"無題","mimetype":"text/plain","image_exif_rotation":0,"filetype":"typescript","pretty_type":"TypeScript","user":"U8996GYBF","mode":"snippet","editable":true,"is_external":false,"external_type":"","size":1192,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F017USB3NCC/______","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F017USB3NCC/download/______","original_h":0,"original_w":0,"thumb_64":"","thumb_80":"","thumb_160":"","thumb_360":"","thumb_360_gif":"","thumb_360_w":0,"thumb_360_h":0,"thumb_480":"","thumb_480_w":0,"thumb_480_h":0,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U8996GYBF/F017USB3NCC/______","permalink_public":"https://slack-files.com/T03C4RC8V-F017USB3NCC-4be28e528a","edit_link":"https://vim-jp.slack.com/files/U8996GYBF/F017USB3NCC/______/edit","preview":"","preview_highlight":"","lines":0,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"OmqvB"}]},{"client_msg_id":"9ec98354-5af9-422d-a334-a18d1167ac36","type":"message","user":"U06BRP8VD","text":"type みて絞っただけでは data が GitBranchActionData として絞れてない可能性はないですかね?","ts":"1595580868.034200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"FE8"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"49dd6ac1-72bd-4aa3-adcf-7ee7b7a6a61c","type":"message","user":"U8996GYBF","text":"いや、そこまでは推論で絞れてます","ts":"1595580904.034500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"vQjn"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"d6457297-cf56-4396-98d8-7380c2dbd664","type":"message","user":"U8996GYBF","text":"LSPで型確認したらそこでは絞り込まれてる","ts":"1595580930.035000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"dNl"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"4eecc49f-36c2-436b-96e8-8a524e793478","type":"message","user":"U06BRP8VD","text":"だとすれば data の型は確定しちゃってるから、内側の switch のなかでそれを否定することはできないのでは。","ts":"1595581002.035800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"B6L"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"5600551b-2461-4641-bce1-248393b3388b","type":"message","user":"U8996GYBF","text":"うーん、そうなんですかね\n`data.action` が `\"diff\" | 'yank\"` から `never` に推論されてるからイメージ的には `data` 側も頑張って欲しかったんですけど\n型システムあんまり詳しくないから細かいところは何とも言えないです・・・","ts":"1595581137.037700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"YkFI"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"e3cf7199-88ea-4d98-8ee5-b6cf5f102852","type":"message","user":"U06BRP8VD","text":"data は確定してて action の型をみたときに never なんですよね。それを上(data)に伝搬するのはちょっとアクロバティックに思えますね。","ts":"1595581245.038800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Kte"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"820b70a4-e1cb-46f4-a3c2-564a1cc480b1","type":"message","user":"U8996GYBF","text":"なるほど、確かに大分難しそうな部分ではあるんで一旦そういうものとして覚えてやっていくしかない感じですかね\nありがとうございます","ts":"1595581310.039500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"TAcy"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"380e4863-dce6-465c-9e17-2957a20d9324","type":"message","user":"U8996GYBF","text":"`unreachable(data.action)` が書けるだけでも大分助かりはするので","ts":"1595581362.039900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ot=R"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"}]
