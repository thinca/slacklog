[{"client_msg_id":"052d0700-d685-4e0b-b37f-bc93905e97b0","type":"message","user":"U8996GYBF","text":"```import { createDraft } from \"immer\"```\nして\n```    restore: (state, { payload }: PayloadAction\u0026lt;State | undefined\u0026gt;) =\u0026gt; {\n      if (payload != null) {\n        const { sessions, currentSession } = createDraft(payload)\n        state.sessions = sessions\n        state.currentSession = currentSession\n      }\n    },```\nなら通った、State型がそのまま渡って来たときはプロパティがdraftになっていない・・・？\n全く分からん・・・","ts":"1600751146.086400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"9z3O"}]},{"client_msg_id":"6085c6f8-78ac-4b1b-aa81-4e89fe4b0f69","type":"message","user":"U8996GYBF","text":"上のコードダメだった、エラー吐く・・・\n```    restore: (state, { payload }: PayloadAction\u0026lt;State | undefined\u0026gt;) =\u0026gt; {\n      if (payload != null) {\n        state = payload\n      }\n    },```\nなら通る理由を誰か教えてください・・・","ts":"1600749296.085600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Nt="}]},{"client_msg_id":"6dae01e1-21ad-4597-8089-6b053d9a215f","type":"message","user":"U8996GYBF","text":"```    restore: (state, { payload }: PayloadAction\u0026lt;State | undefined\u0026gt;) =\u0026gt; {\n      if (payload != null) {\n        const { sessions, currentSession } = payload\n        state.sessions = sessions\n        state.currentSession = currentSession\n      }\n    },```\nが丸い気がしてきた、なんか違うけど・・・","ts":"1600749058.084900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Ej=9H"}]},{"client_msg_id":"6faf7ea6-16f0-4072-a24c-c5df5e46786e","type":"message","user":"U8996GYBF","text":"```const { a, b, c } = obj\nstate.a = a\nstate.b = b\nstate.c = c```\nって短く書けましたっけ・・・？","ts":"1600748886.084500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"H499W"}]},{"client_msg_id":"f54172da-635d-433f-a32e-f2816f4eceaf","type":"message","user":"U8996GYBF","text":"`return castDraft(payload)` もダメ、つらい","ts":"1600748818.083800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"QUqVY"}]},{"client_msg_id":"b0550eb1-6876-430e-b6b2-b5c02d742047","type":"message","user":"U8996GYBF","text":"そもそも\n```state = payload```\nって書くの相当辛いんですけど、これなんか他の書き方ないんですかね・・・","ts":"1600748246.083200","edited":{"user":"U8996GYBF","ts":"1600748745.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"0up"}]},{"client_msg_id":"0a657073-1600-4b13-bca5-be39eabdfe29","type":"message","user":"U8996GYBF","text":"immerがeslintと相性悪すぎてキレそう","ts":"1600748195.082600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Bgzg"}]},{"client_msg_id":"0c5190cc-0d46-4b30-8eea-5f85543c21ff","type":"message","user":"U8996GYBF","text":"return stateはぶっ壊れるなやっぱり・・・","ts":"1600748052.082300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"LlJDQ"}]},{"client_msg_id":"3af9fabb-24e3-42a0-9fd2-35f606513fcd","type":"message","user":"U8996GYBF","text":"返してよさそう \u003chttps://github.com/immerjs/immer/blob/master/docs/return.md\u003e","ts":"1600747809.081900","attachments":[{"fallback":"GitHub: immerjs/immer","id":1,"title":"immerjs/immer","title_link":"https://github.com/immerjs/immer/blob/master/docs/return.md","text":"Create the next immutable state by mutating the current one - immerjs/immer","thumb_url":"https://avatars2.githubusercontent.com/u/45853199?s=400\u0026v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/80588/img/unfurl_icons/github.png","thumb_width":255,"thumb_height":255,"from_url":"https://github.com/immerjs/immer/blob/master/docs/return.md","original_url":"https://github.com/immerjs/immer/blob/master/docs/return.md"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"UvY"}]},{"client_msg_id":"7fcd92de-2929-4b00-87b7-7ba67302378a","type":"message","user":"U8996GYBF","text":"ついさっきreturnでdraft以外返してぶっ壊してたとこなんで書きたくない気持ちがあったのもあります","ts":"1600747485.081700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"X/Q"}]},{"client_msg_id":"7bb838e4-c991-45db-93b7-417ec3ed1c63","type":"message","user":"U8996GYBF","text":"分からないです、こういう場合は書いてもいいのかも","ts":"1600747403.081200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"aFc9"}]},{"client_msg_id":"5c6e69d1-7a57-4f47-9f17-d1ef8282c3da","type":"message","user":"U78A6ESHM","text":"おーなるほど。","ts":"1600747392.081000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"FqyT2"}]},{"client_msg_id":"4682d728-15a3-417c-91a9-aa450799f62c","type":"message","user":"U8996GYBF","text":"あー、それでもいいんですけど（見てる感じ）immerの中でreturn書かない気がするんですよね","ts":"1600747379.080600","edited":{"user":"U8996GYBF","ts":"1600747386.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"+r9"}]},{"client_msg_id":"371af245-75f3-474f-8e49-ace635e28a26","type":"message","user":"U78A6ESHM","text":"よく理解してないけど、\n```if (payload) {\n  state = payload\n  return\n}\nreturn state```\nとかじゃダメな感じですか？\n初見で何もしてない state を見たら混乱しそうw","ts":"1600747345.080100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"mtR"}]},{"client_msg_id":"d8a00909-7829-4e1d-8af3-222e65c90500","type":"message","user":"U8996GYBF","text":"意味は分かりやすいし一旦後者にするか・・・","ts":"1600747273.079000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"30F"}]},{"client_msg_id":"99ab7e12-edf4-46e7-8899-d78858976e7c","type":"message","user":"U8996GYBF","text":"```    restore: (state, { payload }: PayloadAction\u0026lt;State | undefined\u0026gt;) =\u0026gt; {\n      if (payload) {\n        state = payload\n      }\n    },```\nってコードで\n```[tsserver 6133] [I] 'state' is declared but its value is never read.```\nが出てしまうんですが、回避方法ってあるでしょうか\n```    restore: (state, { payload }: PayloadAction\u0026lt;State | undefined\u0026gt;) =\u0026gt; {\n      if (payload) {\n        state = payload\n      } else {\n        state\n      }\n    },```\nこう・・・？","ts":"1600747224.078800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"1uC"}]},{"client_msg_id":"11ebf11e-4982-4078-8c43-caf05f1e0195","type":"message","user":"U8996GYBF","text":"Draft以外をreturnした時点で型で怒って欲しかった","ts":"1600743849.078200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"uieVO"}]},{"client_msg_id":"bb20ed25-86b7-4736-a00d-28f2b5380221","type":"message","user":"U8996GYBF","text":"```    restore: (state, { payload }: PayloadAction\u0026lt;State | undefined\u0026gt;) =\u0026gt; {\n      if (payload) {\n        state = payload\n      }\n      state\n    },\n    setSession: (state, { payload }: PayloadAction\u0026lt;{ sessionToken: string; session: Session }\u0026gt;) =\u0026gt; {\n      state.sessions[payload.sessionToken] = payload.session\n      state.currentSession = undefined\n    },```\nこうしたら多分動いてます\n```    \"no-param-reassign\": [\n      \"error\",\n      {\n        props: false,\n        ignorePropertyModificationsFor: [\"draft\", \"state\"],\n      },\n    ],```\nしないとですけど","ts":"1600743742.077800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"YKMfx"}]},{"client_msg_id":"02d49d49-8ba2-4dba-b4fd-6f6e9f8a3bf6","type":"message","user":"U8996GYBF","text":"色々やってて多分これが原因でした \u003chttps://github.com/yuki-ycino/fzf-preview.vim/blob/master/src/module/session.ts#L25\u003e\nここでJSのオブジェクト返しちゃうとぶっ壊れちゃうんですね多分","ts":"1600743610.077200","attachments":[{"fallback":"GitHub: yuki-ycino/fzf-preview.vim","id":1,"title":"yuki-ycino/fzf-preview.vim","title_link":"https://github.com/yuki-ycino/fzf-preview.vim/blob/master/src/module/session.ts#L25","text":"Dark powered fzf plugin. Contribute to yuki-ycino/fzf-preview.vim development by creating an account on GitHub.","thumb_url":"https://avatars1.githubusercontent.com/u/5423775?s=400\u0026v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/80588/img/unfurl_icons/github.png","thumb_width":400,"thumb_height":400,"from_url":"https://github.com/yuki-ycino/fzf-preview.vim/blob/master/src/module/session.ts#L25","original_url":"https://github.com/yuki-ycino/fzf-preview.vim/blob/master/src/module/session.ts#L25"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"0nE"}]},{"client_msg_id":"8562462d-57ac-475a-abef-ee34c81d11b4","type":"message","user":"U8996GYBF","text":"reduxとかimmer分かる人に聞きたいです\n\u003chttps://github.com/yuki-ycino/fzf-preview.vim/blob/master/src/module/session.ts#L29-L32\u003e\n```    setSession: (state, { payload }: PayloadAction\u0026lt;{ sessionToken: string; session: Session }\u0026gt;) =\u0026gt; {\n      state.sessions[payload.sessionToken] = payload.session\n      state.currentSession = undefined\n    },```\nで\n```[coc.nvim] Command error: Invariant failed: A state mutation was detected inside a dispatch, in the path: session.sessions.39875042-aff6-4da8-858d-ca93a2451277. Take a look at the reducer(s) handling the action {\"type\":\"session/setSession\",\"payload\":{\"session\":{\"gitStatusDataList\":[{\"command\":\"FzfPreviewGitStatus\",\"type\":\"git-status\",\"file\":\".vimrc\",\"status\":\" M\"}]},\"sessionToken\n\":\"39875042-aff6-4da8-858d-ca93a2451277\"}}. (\u003chttps://redux.js.org/troubleshooting#never-mutate-reducer-arguments\u003e)```\nってエラーが出ちゃうんですが、原因分かる方いらっしゃるでしょうか。\n```      const sessions = { ...state.sessions, [payload.sessionToken]: payload.session }\n      state.sessions = sessions\n      state.currentSession = undefined```\nなら出ないはず","ts":"1600736790.076200","attachments":[{"fallback":"GitHub: yuki-ycino/fzf-preview.vim","id":1,"title":"yuki-ycino/fzf-preview.vim","title_link":"https://github.com/yuki-ycino/fzf-preview.vim/blob/master/src/module/session.ts#L29-L32","text":"Dark powered fzf plugin. Contribute to yuki-ycino/fzf-preview.vim development by creating an account on GitHub.","thumb_url":"https://avatars1.githubusercontent.com/u/5423775?s=400\u0026v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/80588/img/unfurl_icons/github.png","thumb_width":400,"thumb_height":400,"from_url":"https://github.com/yuki-ycino/fzf-preview.vim/blob/master/src/module/session.ts#L29-L32","original_url":"https://github.com/yuki-ycino/fzf-preview.vim/blob/master/src/module/session.ts#L29-L32"}],"edited":{"user":"U8996GYBF","ts":"1600740895.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"gCR/B"}]},{"type":"message","user":"UM8040TQW","text":"\u003c@UM8040TQW\u003e has joined the channel","ts":"1600703516.075200","subtype":"channel_join","replace_original":false,"delete_original":false,"blocks":null}]
