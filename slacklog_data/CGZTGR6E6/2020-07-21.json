[{"client_msg_id":"6f538d72-b627-44b2-a54d-af6ea610f168","type":"message","user":"U776661HA","text":"亀ですが僕なら\n\n```export const getDiagnostics = async (): Promise&lt;Array&lt;string&gt;&gt; =&gt; {\n  const diagnosticItems = (await pluginCall(\"CocAction\", [\"diagnosticList\"])) as Array&lt;DiagnosticItem&gt;;\n  const diagnosticLines = await Promise.all(diagnosticItems.map(diagnosticItemToLine));\n  return diagnosticLines.filter(v =&gt; v !== '');\n}```","ts":"1595304672.425600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"UKU"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"e29ec705-872c-4436-8861-3e3e172619ca","type":"message","user":"U8996GYBF","text":"あ、同じ書き方してました\nありがとうございます","ts":"1595304776.425900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"AuM"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"31ea12f0-e0ca-4746-abcf-a96d8098710a","type":"message","user":"U776661HA","text":":+1:","ts":"1595304784.426100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"+DLw"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"9d27c22c-e8c5-45ba-88c4-7c0104b9d8b8","type":"message","user":"U8996GYBF","text":"ちなみにasyncが波及しまくった背景なんですが、Nodeがvimが起動したディレクトリしか読まない（cdに追従しない）せいで末端のexistsFile関数をVim script経由で叩く必要が出てきたからでした・・・","ts":"1595305122.427300","edited":{"user":"U8996GYBF","ts":"1595305177.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"lC3E"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"52097472-95da-4757-a19e-3c97c5d3d44a","type":"message","user":"U8996GYBF","text":"`plugin.call` がasync","ts":"1595305140.427600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"UyXEI"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"09b9898b-3f7c-4ce8-92f1-70845c09b907","type":"message","user":"U8996GYBF","text":"そもそもPromise&lt;boolean&gt;を返す関数がexistsって名前なのはどうなのかという感じが少ししてます","ts":"1595305286.428300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Twlh"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"d0e3224b-6ebb-402a-baaf-7cfee38f8387","type":"message","user":"U8996GYBF","text":"asyncFilterを使わないといけないって言うのが明示的に分かるようにexistsFileAsyncとかにするべきかもしれない","ts":"1595305438.428900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"5bj"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"37760624-f298-49b7-b5c8-fe9ce82a7799","type":"message","user":"U776661HA","text":"型情報あるのに関数名で表すの dwFlag とかあの辺に通じるものがある気がする","ts":"1595305577.429500","edited":{"user":"U776661HA","ts":"1595305592.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"J4ifc"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"9ad4f8e0-d74b-4483-a1e0-c63fff1e1c75","type":"message","user":"U8996GYBF","text":"確かに","ts":"1595305593.429800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"MCbqb"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"adafc45a-59f4-4898-b67c-1e4c858a43de","type":"message","user":"U776661HA","text":"あと node は Sync を明示する文化な気がします","ts":"1595305636.430900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"SxNw"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"ccbdfda3-ffc8-4e75-82e9-e2095b136f32","type":"message","user":"U8996GYBF","text":"`arr.fileter(v =&gt; existsFile(v))` が警告で落ちてくれたらいいんですけど","ts":"1595305637.431000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ewr"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"87152a71-ca7b-4139-bc67-8061bd04d2a5","type":"message","user":"U8996GYBF","text":"ですね、Nodeでコマンドを叩くときはSyncが後ろに付いてたりした","ts":"1595305657.431500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"VGYNI"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"081b7826-b037-48bd-a5c1-2b8e13b539ed","type":"message","user":"U776661HA","text":"&gt; が警告で落ちてくれたらいいんですけど\nPromise 消費されてないよ警告って出せませんでしたっけ？","ts":"1595305681.432000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"OSj"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"cbdb7cc3-aa7c-4a67-9398-0b4714e8b121","type":"message","user":"U8996GYBF","text":"一応確認したんですが、async付けたら出るんですけど付けなかったら出ないです","ts":"1595305812.432400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"EdgZs"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"8f3208e6-cca3-4474-882b-b7211b022be7","type":"message","user":"U8996GYBF","text":"`arr.fileter(async (v) =&gt; existsFile(v))`\nこれなら出る","ts":"1595305834.432800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Nk2+n"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"783267c7-dfee-4cdc-ab5a-ddab2a4331d3","type":"message","user":"U8996GYBF","text":"今適当に書いたけど多分ミスってないはず・・・？\nなんか書き方ミスってたり設定あったらすみません","ts":"1595305886.433300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"HMfm4"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"699becbc-de6f-423e-af96-60839f997646","type":"message","user":"UAZ33BKV2","text":"async付いてないと同期な関数ってことで解決待ちになったりする?","ts":"1595305938.433900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ctR"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"8bd2ca4c-f6b3-4b5b-8813-4327bf71a9d1","type":"message","user":"U776661HA","text":"実行時警告は出そう","ts":"1595305941.434000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"CAoV"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"07397e1a-90f7-48b4-a45c-a7c67ae3f8f6","type":"message","user":"U8996GYBF","text":"実行時はありそう（vimのプラグインで基本的に見なさそう）","ts":"1595305962.434400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"irl"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"450bc6a3-518e-4dbe-ba70-6c4f65ecbec0","type":"message","user":"U776661HA","text":"あ、いやないか","ts":"1595305990.434600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"BkCPs"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"464388b0-52f8-4af6-95c8-7402c41d77b9","type":"message","user":"U776661HA","text":"あったらまずい","ts":"1595306000.435100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Q7M"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"80c02bfe-5e5e-4afa-9bf5-847a7c118ed2","type":"message","user":"U8996GYBF","text":"Promiseオブジェクトが返った時点でfilter関数としては多分正として判定して終わって、関心持ってないですよね？","ts":"1595306005.435300","edited":{"user":"U8996GYBF","ts":"1595306033.000000"},"team":"T03C4RC8V","reactions":[{"name":"desune","count":1,"users":["U776661HA"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"yPwii"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"c1339d7f-c4ff-4cc1-8ecb-9e194ac1e7cd","type":"message","user":"U776661HA","text":"Lint レベルですね","ts":"1595306005.435400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"heJb"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"8515a8dc-8644-4e6d-bc1b-2e4f1e336eeb","type":"message","user":"U776661HA","text":"<https://wiki.developer.mozilla.org/ja/docs/Web/API/Window/unhandledrejection_event>\n\nを思いながらコンテキストミスった","ts":"1595306061.436200","attachments":[{"fallback":"MDN Web Docs: Window: unhandledrejection イベント","id":1,"title":"Window: unhandledrejection イベント","title_link":"https://wiki.developer.mozilla.org/ja/docs/Web/API/Window/unhandledrejection_event","text":"unhandledrejection イベントは、 JavaScript の拒否ハンドラーを持たない Promise が拒否されたときにスクリプトのグローバルスコープに送られます。 通常、これは window ですが、 Worker であることもあります。","thumb_url":"https://wiki.developer.mozilla.org/static/img/opengraph-logo.72382e605ce3.png","blocks":null,"service_name":"MDN Web Docs","service_icon":"https://wiki.developer.mozilla.org/static/img/favicon144.e7e21ca263ca.png","thumb_width":600,"thumb_height":600,"from_url":"https://wiki.developer.mozilla.org/ja/docs/Web/API/Window/unhandledrejection_event","original_url":"https://wiki.developer.mozilla.org/ja/docs/Web/API/Window/unhandledrejection_event"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ECCQd"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"142a6951-fd41-4e28-ad98-8737b1b2116b","type":"message","user":"U8996GYBF","text":"なるほどこういうのが","ts":"1595306108.436500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"wro"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"ba2e3542-fc82-44b6-b48e-074ac61027b6","type":"message","user":"U8996GYBF","text":"で、この場合に限ってはAsyncを付けといた方が親切なのかなーと\n型で守り切れなくて潜在的バグの温床感ある","ts":"1595306138.437100","team":"T03C4RC8V","reactions":[{"name":"naruhodo","count":1,"users":["U776661HA"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"DXhf"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"336821a9-1f6d-497a-a3fa-5d1fedd6fe0c","type":"message","user":"U8996GYBF","text":"使う各所でちゃんとテストを書けというのはそう・・・","ts":"1595306169.437400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"L43"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"06a2ab6a-b1a1-4a3b-89b4-a83a5e6a5349","type":"message","user":"U8R597E9H","text":"sync オプションとかないんですかねえ。。。","ts":"1595306291.438300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"lKM"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"b68f543e-d3c1-426d-83da-0ec01efb5793","type":"message","user":"U8996GYBF","text":"<https://github.com/yuki-ycino/fzf-preview.vim/blob/b8c80c51933f29f47424c41bda27cfc1dbbe3fd0/src/fzf/resource/buffers.ts#L35-L55>\nこの辺にテストがないの、そろそろ割とあれ感","ts":"1595306360.438700","edited":{"user":"U8996GYBF","ts":"1595306384.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"9MC"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"7d7a6330-7015-4548-a092-064ca7bd8818","type":"message","user":"U8996GYBF","text":"`plugin.call` 側にsyncオプション欲しすぎますね・・・","ts":"1595306402.439400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"aQG0+"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"429422a0-9d7f-4ae0-b044-25c40e265f60","type":"message","user":"U776661HA","text":"ちなみに sync にこだわるのであれば Node の statSync で存在確認していないのはどうしてなんでしょう？","ts":"1595306832.440700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Ep2Zk"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"1b7b7d36-6448-4af9-bc99-a62cdfec3989","type":"message","user":"U8996GYBF","text":"&gt; Nodeがvimが起動したディレクトリしか読まない（cdに追従しない）せいで末端のexistsFile関数をVim script経由で叩く\n主にこれですね","ts":"1595306904.441000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"A+Mk"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"08f826af-beb9-45a1-aac6-0c6e22daa0e2","type":"message","user":"U8996GYBF","text":"ファイルパスの展開も含めて頑張ってNode側に全部持たせればできそうだから、変更の規模を考えるとそっちだったかもしれない","ts":"1595306936.441700","edited":{"user":"U8996GYBF","ts":"1595306958.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Nkk+"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"11a6c0be-ba6d-41df-b6ce-13f05455f55b","type":"message","user":"U776661HA","text":"Vim script 側からカレントディレクトリを渡せば良い気が","ts":"1595306969.442300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"iapn="}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"22c86372-689e-472a-bfd8-0d03b2af1bd3","type":"message","user":"U776661HA","text":"&gt; ファイルパスの展開も含めて頑張ってNode側に全部持たせればできそうだから、変更の規模を考えるとそっちだったかもしれない (edited)\nあ、たぶんそういうことですね","ts":"1595307000.443100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"AgRD"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"8c5369af-ec8e-4195-9339-c352922e46ca","type":"message","user":"U8996GYBF","text":"です、起動の初期タイミングでそれを挟めばよかったんですけど\n色んなところでパスがぶっ壊れる問題が発生していて、一旦existsFile自体をVim scriptにぶん投げた方が新しいバグを埋め込まずに直せそうだったんですよね","ts":"1595307060.444100","edited":{"user":"U8996GYBF","ts":"1595307090.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"0u1dc"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"12486242-d744-42ab-a6e3-3ed92d5bbb02","type":"message","user":"U8996GYBF","text":"ただ結局変更量があれだったから判断ミスった感じはします","ts":"1595307069.444500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ymZpD"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a71ef981-aaf2-43e2-afb8-7768c5896b2a","type":"message","user":"U776661HA","text":"パス面倒なのわかる","ts":"1595307094.444900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"pBc2c"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"ed5a1789-ea8a-4551-8f9b-0d7224d27adc","type":"message","user":"U8996GYBF","text":"Vim scriptから取得して文字列ごちゃるよりも、vimのコンテキストで実行した方が一旦確実ではあったので・・・","ts":"1595307122.445900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"NcG"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"687a8831-b4eb-4e25-b85e-6d678d1fd7a2","type":"message","user":"U776661HA","text":"内部は全部フルパスで持って表示時にいい感じに縮めるとミスが少ないという経験則","ts":"1595307122.446000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"SG9"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"37732788-416f-4320-9589-94d0cc55599c","type":"message","user":"U8996GYBF","text":"わかる、直すとしたらそれですね","ts":"1595307136.446300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"fGd"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"3d4985a8-7f9c-4187-9019-cd3269d23641","type":"message","user":"U8996GYBF","text":"fzfから返ってくるのが文字列だからそこからフルパスに再展開とかがあってだるいのはあるんですよねー","ts":"1595307164.446700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"8f8K"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"6f099b44-653c-4ee7-b0b9-580b98217910","type":"message","user":"U8R597E9H","text":"内部で相対で持っているとしたら相当つらそうですね。。。","ts":"1595307174.447000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"b3uI5"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"493ddba2-bc80-4d36-a985-515d85914ce7","type":"message","user":"U8996GYBF","text":"相対で持たざるをえないのはfzfの都合でそこがあれなんですよね","ts":"1595307200.447500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"G5H"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"99d84448-e61c-4228-b95f-6a9801ae144f","type":"message","user":"UAZ33BKV2","text":"fzfがabspathモードみたいなのがあればよかったけど...","ts":"1595307231.448100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"LL6f"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"3b6c3bca-9688-4c06-9936-68f8fd29d087","type":"message","user":"U8996GYBF","text":"あー、いや不可能ではないか","ts":"1595307305.449700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"3GL"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"437d476c-e056-453b-a8d4-606c4f8d5960","type":"message","user":"U8996GYBF","text":"--with-nthオプションを使えばいける、ただパース部分がスクラッチで書き直しになりそう","ts":"1595307328.450500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"IEvVd"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"551fc8d8-2072-43a6-969e-5f90a0d41ad0","type":"message","user":"U8R597E9H","text":"const session = createSession({ cwd: %cwd% });\nconst lines = session.decorateItems([ items ]);\nconst result = runFZF({ lines: lines });\nconst items = session.undecorateLines({ lines: result });\n\nこんなイメージしていました。","ts":"1595307337.450800","edited":{"user":"U8R597E9H","ts":"1595307421.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"X1Z"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a462db1a-f22b-45f3-9ed0-fd02142b8bb5","type":"message","user":"U8R597E9H","text":"fzf に渡すために decorate して渡して、戻ってきたものを undecorate するみたいな。\nでもよく考えるとこれも辛いですね。fzf がフィルタしたあとの行しか返さないから、decorate したアイテムと、undecorate するときのアイテムの一致性を index から解決できない。。。","ts":"1595307387.452100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"rE53"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"28c52c94-e7ad-4033-8ee0-eb99287676a7","type":"message","user":"U8996GYBF","text":"これはどうにかできるっちゃできるんですけど、decorateしたときの情報がundecorate時に別プロセスだから永続化しないといけないみたいなあれな問題もあります","ts":"1595307456.453200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Pup"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"07648bfc-26dc-49bf-955d-b2102eabf5d3","type":"message","user":"U8996GYBF","text":"なんで、どのタイミングでキャッシュ的に永続化するかミスったら爆発するのも一応怖いですね","ts":"1595307480.453800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"FL2cs"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"5b71899f-1620-4e2a-a485-aaa05b5b814a","type":"message","user":"U8996GYBF","text":"Redux経由でVim側にReduxのstoreを保存してrestoreするって実装挟んでます・・・","ts":"1595307515.454400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Pljv"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"6e8b3b9f-69d9-444c-8f3d-c8db12917630","type":"message","user":"U8R597E9H","text":"nth オプションで unique な id 触れれば割となんでもできそうですね。","ts":"1595307560.455000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"yUIIU"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"54554eb1-58c5-4d69-a032-17e1d65b1bc2","type":"message","user":"U8996GYBF","text":"ですねー、やるとしたら絶対被らないフォーマット決め打ちして--with-nthオプション","ts":"1595307580.455500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"G5EcC"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"8bfb1bf4-4f0b-40ca-9a55-43c3b2247059","type":"message","user":"U8996GYBF","text":"最初からそこまで考えてればよかったな、TSだから手を入れるのは不可能じゃないだろうけどかなりの規模になる","ts":"1595307637.456400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"dhS"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"77d49c70-8e4c-45d9-b74f-786fad3d6d1a","type":"message","user":"U8996GYBF","text":"--with-nthオプションをユーザが上書きし辛くなる問題は一応発生しますね","ts":"1595307708.456800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"BEA6"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"757abaa6-9190-4583-9f34-30d4361a7688","type":"message","user":"U8R597E9H","text":"自分なら禁止しちゃいますねｗ","ts":"1595307723.457000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"EBFX"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"3cfb39b5-003b-4fba-81df-3e3ca63afae5","type":"message","user":"U8996GYBF","text":"--nthを使いたいって状況、一応ありはするんですよね・・・","ts":"1595307746.457400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"e2Kd/"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"f5556c12-2430-40b5-b679-2871c96c37d1","type":"message","user":"U8996GYBF","text":"grepでファイル名一致を無視したいから追加でオプション指定したい人とか","ts":"1595307766.457900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"MBMP"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"4a13bd5f-4aeb-4d93-9ca8-555772ef0187","type":"message","user":"U8996GYBF","text":"やっぱりfzfがこの辺CLIだからDeniteとかに比べてユーザフレンドリーじゃない","ts":"1595307810.458600","edited":{"user":"U8996GYBF","ts":"1595307817.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ZyX"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"96bc54f6-1e3f-4f79-8bb7-f9fd671cf0f0","type":"message","user":"U8R597E9H","text":"なるほど。。。とはいえ、コア側が要求しているなら、grep ソース側にオプション追加するとかになりそうですね。。。","ts":"1595307812.458700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"gQ1g"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a11995fb-5dc7-4479-8fc7-11014194111b","type":"message","user":"U8996GYBF","text":"一応 `--add-fzf-arg` で任意のオプション追加できるようにしてるんですけど、そっちでは弾くようにするとかそういうのですねぇ\nあとはparse側で指定した値に暗黙で1追加するとか・・・？","ts":"1595307876.459700","team":"T03C4RC8V","reactions":[{"name":"+1","count":1,"users":["U8R597E9H"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"SoH"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"2ead8cda-adf3-48e6-8ea0-12c4a19ea25c","type":"message","user":"U8996GYBF","text":"流石にoptionのparseとかgenerateにはテスト書いてるんですけど、そこが結構肥大化していきそう","ts":"1595307958.460400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"qSqJ"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"2da6319d-6a89-4745-a3b3-54e4d3391acc","type":"message","user":"U8996GYBF","text":"<@U8R597E9H>\n```type BaseData = {\n  type: typeof RESOURCE_TYPE[number]\n}\n\ntype FooData = Merge&lt;BaseData, {\n  file: string\n}&gt;\n\ntype BarData = Merge&lt;BaseData, {\n  file: string\n  lineNumber: number\n}&gt;```\nみたいなのがいいんですかね・・・？","ts":"1595337594.461800","thread_ts":"1595337594.461800","edited":{"user":"U8996GYBF","ts":"1595337616.000000"},"reply_count":26,"replies":[{"user":"U8R597E9H","ts":"1595337714.463600"},{"user":"U8996GYBF","ts":"1595337766.464100"},{"user":"U8996GYBF","ts":"1595337881.464400"},{"user":"U8R597E9H","ts":"1595337959.464600"},{"user":"U8996GYBF","ts":"1595337990.464800"},{"user":"U8996GYBF","ts":"1595338167.465000"},{"user":"U8996GYBF","ts":"1595343248.465200"},{"user":"U8R597E9H","ts":"1595343380.465500"},{"user":"U8996GYBF","ts":"1595343436.465700"},{"user":"U8996GYBF","ts":"1595343487.465900"},{"user":"U8R597E9H","ts":"1595343497.466100"},{"user":"U8996GYBF","ts":"1595343558.466300"},{"user":"U8996GYBF","ts":"1595343574.466500"},{"user":"U8996GYBF","ts":"1595414418.490500"},{"user":"U8R597E9H","ts":"1595415707.490700"},{"user":"U8R597E9H","ts":"1595415780.490900"},{"user":"U8996GYBF","ts":"1595415874.491100"},{"user":"U8R597E9H","ts":"1595416095.491500"},{"user":"U8996GYBF","ts":"1595416803.491700"},{"user":"U8996GYBF","ts":"1595416964.491900"},{"user":"U8R597E9H","ts":"1595417030.492200"},{"user":"U8R597E9H","ts":"1595417049.492400"},{"user":"U8996GYBF","ts":"1595417199.492600"},{"user":"U8R597E9H","ts":"1595422863.492900"},{"user":"U8996GYBF","ts":"1595423580.493100"},{"user":"U8996GYBF","ts":"1595423618.493300"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ZkDX"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"fb187802-243d-430b-ac38-7b7df3f2c38a","type":"message","user":"U8R597E9H","text":"ちょっと汚しすぎかなと思ったのでスレッドで :bow:\n\n```type Resource = {\n  type: 'file';\n  filepath: string;\n} | {\n  type: 'grep';\n  line: number;\n  col?: number;\n  filepath: string;\n} | {\n  type: 'buffer';\n  bufnr: number;\n  filepath: string;\n}```\nこんな感じに定義すると、switch-case で type だけチェックすれば他のプロパティも絞り込まれます。","ts":"1595337714.463600","thread_ts":"1595337594.461800","parent_user_id":"U8996GYBF","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"e0u"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a51eeca0-6729-45f3-95dc-6c627515f8c7","type":"message","user":"U8996GYBF","text":"あー、ですよね\n継承的なのでtypeが `typeof RESOURCE_TYPE[number]` であることの制約ってできます・・・？","ts":"1595337766.464100","thread_ts":"1595337594.461800","parent_user_id":"U8996GYBF","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"IGjb4"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a4ea644d-a912-44f5-8248-cc301ec498b4","type":"message","user":"U8996GYBF","text":"type-festのMergeでうまく動作するのかな\nちょっと試してみます","ts":"1595337881.464400","thread_ts":"1595337594.461800","parent_user_id":"U8996GYBF","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"z5f"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"4a675049-2bf1-4aca-8308-0d031b8bd417","type":"message","user":"U8R597E9H","text":"`type RESOURCE_TYPE = Resource['type']` で逆算すればいいかもですね。","ts":"1595337959.464600","thread_ts":"1595337594.461800","parent_user_id":"U8996GYBF","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"nOjm"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"7d369efc-e7eb-498c-9548-dd2b9dd9e181","type":"message","user":"U8996GYBF","text":"あー、確かに\n簡単に書けるならそっちのがいいですね","ts":"1595337990.464800","thread_ts":"1595337594.461800","parent_user_id":"U8996GYBF","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"xS8U"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"7330f8b2-8a81-44b5-b6b8-e72850273a15","type":"message","user":"U8996GYBF","text":"constする必要なかったですね、ありがとうございます","ts":"1595338167.465000","thread_ts":"1595337594.461800","parent_user_id":"U8996GYBF","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"nfDi"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"efeb6835-9b8c-4950-95da-9b1a35a6b4be","type":"message","user":"U8996GYBF","text":"うわー\n```encodeURIComponent(JSON.stringify(obj))\nJSON.parse(decodeURIComponent(uri))```\nしてそのままJSONオブジェクト渡して動いてしまった、完全に発想が天才だった","ts":"1595343248.465200","thread_ts":"1595337594.461800","parent_user_id":"U8996GYBF","team":"T03C4RC8V","reactions":[{"name":"+1","count":1,"users":["U8R597E9H"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"J0J"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"bf015e12-469b-4861-8f5d-50f98f4dd4ba","type":"message","user":"U8R597E9H","text":"JSON ない歩のタブは \\t になるはず(確認はしてくださいw)ので、タブとかで区切れば誤爆しないかと","ts":"1595343380.465500","thread_ts":"1595337594.461800","parent_user_id":"U8996GYBF","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"t+I"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"9b844bc8-a6c6-4aba-b02b-a3ed8dd7fa57","type":"message","user":"U8996GYBF","text":"これってURIエンコードかけてるから現時点で死ぬことないかと思ったんですが、危ないことあります？","ts":"1595343436.465700","thread_ts":"1595337594.461800","parent_user_id":"U8996GYBF","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"+xWPG"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"096a5e6c-25c6-4dce-a1a7-129db15fb6fa","type":"message","user":"U8996GYBF","text":"あ、タブで区切るって意図がちょっと取れなかったので、URIエンコード不要そうです？","ts":"1595343487.465900","thread_ts":"1595337594.461800","parent_user_id":"U8996GYBF","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"k2U"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"b8a90731-8132-4ab9-9edb-e750ad0382b1","type":"message","user":"U8R597E9H","text":"URL エンコいらないんじゃないかなぁと思いましたが、かかっててもいいかもですね。","ts":"1595343497.466100","thread_ts":"1595337594.461800","parent_user_id":"U8996GYBF","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Tsl"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"fc47a9c9-7af2-4cb7-8348-dee7838aa2bb","type":"message","user":"U8996GYBF","text":"あー、ユーザがdelimiter指定したときに100%安全に倒したいではあるか・・・","ts":"1595343558.466300","thread_ts":"1595337594.461800","parent_user_id":"U8996GYBF","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"IsKDs"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"b91793fc-0ec7-4215-8f78-5722c5643d04","type":"message","user":"U8996GYBF","text":"まぁURIエンコードが比較的安全性高い気はします","ts":"1595343574.466500","thread_ts":"1595337594.461800","parent_user_id":"U8996GYBF","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"=BA+"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"}]
