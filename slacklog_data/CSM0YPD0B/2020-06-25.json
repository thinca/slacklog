[{"client_msg_id":"2fc91e81-f301-43c4-9654-48263f45ed25","type":"message","user":"U03C71D7H","text":"Docker がストレージ容量結構食ってて、ファイルを見てみると vfs と devicemapper が結構食ってることがわかったんですが、今は overlay2 を使ってます。\nこいつらの容量を削るのってどうすればいいかわかる方いたら教えてください :pray:","ts":"1593051662.200900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"eupB"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"1e40a666-418d-47ab-b9ac-ff3532825e3c","type":"message","user":"UAZ33BKV2","text":"`docker volume prune` で消す、とかw(わからんので、とりあえず言っただけです)","ts":"1593051752.201500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"lddCq"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"f1643884-f740-4c87-a459-b9b71b9ba7ab","type":"message","user":"UAZ33BKV2","text":"もっとでっかく system でもいいかも","ts":"1593051815.201800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"heA"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"9d9c5444-e8d3-40ea-8585-3959d1f5ba77","type":"message","user":"U03C71D7H","text":"volume は使ってないんですよね","ts":"1593051857.202100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"DKtOR"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"5db9f8ef-64e7-4046-92a4-e822702cb2d5","type":"message","user":"U03C71D7H","text":"そもそも vfs と devicemapper の中身に何が入っているのかもよくわかっていない…","ts":"1593051884.202700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"jEc"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"378da8cb-7980-462f-b346-8b75cff4dce3","type":"message","user":"U06ECBRTJ","text":"`docker system df` でDiskの使用状況を出せるらしい","ts":"1593051927.203600","team":"T03C4RC8V","reactions":[{"name":"+1","count":1,"users":["UJVL3UBC6"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Xjm"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"7d2b6d3e-4fcd-4fd9-b352-2f6a164f39c0","type":"message","user":"U03C71D7H","text":"実は今回調べててストレージドライバが選択可能なものなのを初めて知った","ts":"1593051949.203800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"AXJz"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"53d32fb5-feb4-49b6-b3f8-66c3004203ed","type":"message","user":"U03C71D7H","text":"<http://docs.docker.jp/engine/userguide/storagedriver/selectadriver.html>","ts":"1593051953.204000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"RaG"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"96349937-81a8-42fd-9cc5-b910d650c7d3","type":"message","user":"U03C71D7H","text":"で、今は overlay2 で動いている。vfs と devicemapper は選択していないからなのか、認識もされておらず、 `docker system df` にも容量として出てこない","ts":"1593051995.204800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ssGZ"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"c61e93fd-c1fa-4350-a096-7d79c8f66d6b","type":"message","user":"U06ECBRTJ","text":"nrhd","ts":"1593052049.205000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"EmIH"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"8087513a-493c-4d64-9daa-7d94517b78fc","type":"message","user":"U06ECBRTJ","text":"```$ sudo ls /var/lib/docker/\nbuilder  buildkit  containerd  containers  image  network  overlay2  plugins  runtimes  swarm  tmp  trust  volumes```","ts":"1593052111.205200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"0=2P"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"31333aa2-e3c1-4dc4-af36-b4abcbaa4da1","type":"message","user":"U06ECBRTJ","text":"手元には、vfs や devicemapper が無いな","ts":"1593052128.205600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"=Q/"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"0d51a6ce-f974-4416-874a-4a9912fb65be","type":"message","user":"U03C71D7H","text":"私のところだとそれぞれ 12GB 13GB とか食ってて、使ってないなら消したいわけです","ts":"1593052153.206100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"jjT6"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"64311996-7beb-453b-8d7a-c6e947f198dd","type":"message","user":"U03C71D7H","text":"昔は使ってたけどどこかのバージョンアップで overlay2 に移行したとかな気がしているけどよくわかってない…","ts":"1593052183.206600","edited":{"user":"U03C71D7H","ts":"1593052212.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"R5c1"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"b42665c6-7322-476e-8a3b-06854a751006","type":"message","user":"UNJ2DANJC","text":"docker system prune -f -a\nで何もかも消えた気がする\nvolume使ってるつもりなくても止まったままのコンテナが掴んだままで残ってたりして意外と消費してたりするのかな","ts":"1593052517.209200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"rJ9X"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"c006b04c-0d19-446c-b82d-0ab33e163b7e","type":"message","user":"U03C71D7H","text":"`docker system prune -a` やってみたけど消えないですね。dockerd が vfs や devicemapper を認識していなさそう","ts":"1593052710.209800","team":"T03C4RC8V","reactions":[{"name":"totemoturai","count":1,"users":["UNJ2DANJC"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"IxO"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"8d6228a4-404f-4ca4-879c-569c644d46f6","type":"message","user":"U03C71D7H","text":"直接消しても問題ないなら消しちゃうんだが…確証がほしいところ","ts":"1593052734.210300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"DTqc"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"075e4b1b-449a-490b-bc08-27c040bbf507","type":"message","user":"UNJ2DANJC","text":"パッケージマネージャってdockerをアンインストールするときに/var/lib/のあたりってきれいにしてくれないんですっけ...\nしてくれなさそうな気がしてきた。","ts":"1593052908.212500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"tSO4"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"3db34bd4-dff3-4a97-a12b-168f77e9a195","type":"message","user":"U03C71D7H","text":"別にアンインストールはしてないので…","ts":"1593053016.213400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"01jxs"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"33af0a19-9f3c-448b-a7f5-26fbc402150c","type":"message","user":"UDDCM376D","text":"prune 系はdokcerで管理しているコンテナやイメージ、ボリュームなどを削除するのですが、ストレージが減らないのはなんでだろう","ts":"1593053021.213600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"npR"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"54736534-b16b-4752-8806-719c67626836","type":"message","user":"U03C71D7H","text":"あとこれストレージドライバが変わっただけで戻せば使える? 気がするので勝手に消すわけにもいかなそうな","ts":"1593053061.214400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"899TJ"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"f26f8a23-21b2-48a0-b88a-8a574c6726ad","type":"message","user":"U03C71D7H","text":"ストレージドライバ変更して dockerd 再起動すればいいんかなぁ。いくつか動いてるコンテナ止めないといけないけど","ts":"1593053102.215300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"lME"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"9465b243-6711-4dc7-a219-b7c84317afd8","type":"message","user":"UNJ2DANJC","text":"バージョンアップのときにストレージドライバが変わったとか...？\n私は頻繁にOSクリーンインストールする派だから長い期間バージョンアップしながら使ったときにどういう挙動になるか全然わからないな...","ts":"1593053301.218900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"XX1J"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"e3f49804-c44e-411b-aa7d-bd4979f768ac","type":"message","user":"U03C71D7H","text":"そんな予感がしてます。今ストレージドライバを切り替えて再起動する方法を調べている","ts":"1593053429.219300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"szh=B"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"081d6365-976d-4f13-910c-8aea7d0e28cd","type":"message","user":"U03C71D7H","text":"systemd の unit ファイルがどこにあるか未だに覚えられない","ts":"1593053442.219600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"rgZ"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"7e33eeb7-7d59-45a5-a39b-f5d52455b73f","type":"message","user":"U9S4G0LJW","text":"dockerのデータ、毎回100%飛ばしてる","ts":"1593053808.221300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"WvI"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"5ab4c56f-6783-401e-87c3-f272b95f8fdb","type":"message","user":"U9S4G0LJW","text":"イメージimportする手間と時間が発生するけど","ts":"1593053828.222000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Wq+P"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"1c83aa8a-5b4b-461f-bc40-18eeb70ac04d","type":"message","user":"UNJ2DANJC","text":"`/etc/docker/daemon.json` だったかな\n昔パラメータいじった記憶がある\n<https://docs.docker.com/engine/reference/commandline/dockerd/#daemon-configuration-file|https://docs.docker.com/engine/reference/commandline/dockerd/#daemon-configuration-file>","ts":"1593053842.222200","attachments":[{"fallback":"Docker Documentation: dockerd","id":1,"title":"dockerd","title_link":"https://docs.docker.com/engine/reference/commandline/dockerd/#daemon-configuration-file","text":"daemon Usage: dockerd COMMAND A self-sufficient runtime for containers. Options: --add-runtime runtime Register an additional OCI compatible runtime (default []) --allow-nondistributable-artifacts list Allow push of nondistributable artifacts to registry --api-cors-header...","thumb_url":"https://docs.docker.com/favicons/docs@2x.ico","blocks":null,"ts":1593006802,"service_name":"Docker Documentation","service_icon":"https://docs.docker.com/favicons/docs@2x.ico","thumb_width":129,"thumb_height":128,"from_url":"https://docs.docker.com/engine/reference/commandline/dockerd/#daemon-configuration-file","original_url":"https://docs.docker.com/engine/reference/commandline/dockerd/#daemon-configuration-file"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"okfrR"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"4539a2a0-52a7-400d-bd14-f35f381e2592","type":"message","user":"U03C71D7H","text":"ストレージドライバを vfs にして dockerd を再起動、 `docker system prune -a -f` で vfs のデータをほぼ全て削除できた","ts":"1593054415.223100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"GZ/"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a7815c7d-4215-4136-965e-b1f8e9250c73","type":"message","user":"U03C71D7H","text":"devicemapper はドライバが入ってなかった… USE フラグ(Gentoo) 立てて docker を再インストール中…","ts":"1593054435.223600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"x14"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"47cfa2d3-6b8d-4b9a-8b44-ea66cd71ca6f","type":"message","user":"U03C71D7H","text":"にしても、ストレージドライバってデーモン単位なのね。イメージ単位で変えたいとかはできないんかな…","ts":"1593054506.224300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"mAI/B"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"96c60533-83dc-45ac-858b-a786e7c5d7ce","type":"message","user":"U06ECBRTJ","text":"<http://docs.docker.jp/engine/installation/gentoolinux.html#id4>","ts":"1593055170.224800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"pWv"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"543138b7-a504-40be-8b94-34615f279773","type":"message","user":"U06ECBRTJ","text":"&gt; イメージ、コンテナ、ボリュームやホスト上の設定ファイルを削除しません。イメージ、コンテナ、ボリュームを削除するには次のコマンドを実行します。","ts":"1593055180.225000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"nQ4"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"4c51a536-7e17-4f55-bdd4-69757133b1a9","type":"message","user":"U03C71D7H","text":"ストレージドライバを devicemapper にして system prune したのに `/var/lib/docker/devicemapper/` の容量減らない","ts":"1593055196.225300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"GQFix"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"b525330f-740a-4462-a774-61f03b60e052","type":"message","user":"U03C71D7H","text":"それは完全にアンインストールする場合ですね","ts":"1593055248.225600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"qP90H"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"d5f23121-9865-4573-a592-4d486fa536eb","type":"message","user":"U03C71D7H","text":"まあ実際のところ一旦まっさらにした方が速いのかもしれん","ts":"1593055288.226100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"dUg"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"eb54adb5-8da6-4929-b634-9d11c7a742c9","type":"message","user":"U03C71D7H","text":"やってみるか","ts":"1593055306.226300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ho6y"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"778d69a5-edaf-4282-a025-74e3f8beb81a","type":"message","user":"U03C71D7H","text":"普通に動いたな。これでいいかw (今までのはなんだったのか)","ts":"1593055390.226700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"dee"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"17cd3ea5-c5de-406a-a127-b8d09806a307","type":"message","user":"UNJ2DANJC","text":"<http://doc.docker.jp|doc.docker.jp> 最近またメンテされるようになったっぽい\n<https://github.com/zembutsu/docs.docker.jp|https://github.com/zembutsu/docs.docker.jp>\nこういうのとにかく追従が大変そうなイメージがある","ts":"1593057784.228500","attachments":[{"fallback":"GitHub: zembutsu/docs.docker.jp","id":1,"title":"zembutsu/docs.docker.jp","title_link":"https://github.com/zembutsu/docs.docker.jp","text":"Dockerドキュメント日本語化プロジェクト ,Docker Documentation Translate Project for ja-jp - zembutsu/docs.docker.jp","thumb_url":"https://avatars1.githubusercontent.com/u/393940?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/80588/img/unfurl_icons/github.png","thumb_width":400,"thumb_height":400,"from_url":"https://github.com/zembutsu/docs.docker.jp","original_url":"https://github.com/zembutsu/docs.docker.jp"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"oOXqb"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"}]
