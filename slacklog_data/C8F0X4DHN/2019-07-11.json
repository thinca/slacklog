[{"client_msg_id":"97165e23-420c-4da0-af7a-72afe963e308","type":"message","user":"UDDCM376D","text":"vital.web.httpの非同期実行する仕組みほしい","ts":"1562838282.266200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"4499de6d-ce16-4d10-9d69-735a5b1b3f89","type":"message","user":"U03C71D7H","text":"みんなほしいと思っている","ts":"1562838329.267100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"fd58a955-c553-4c2c-97ad-20cc2b8597c0","type":"message","user":"UDDCM376D","text":"よくわからないけど、ガンバってPRしようか悩み中","ts":"1562838362.267800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"622173a5-fe74-4689-b380-8fd9a48e8039","type":"message","user":"U03C71D7H","text":"設計は割としっかりしないといけななさそう","ts":"1562838393.268700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"09d96746-697c-42b4-85b3-c579d79d7d17","type":"message","user":"UDDCM376D","text":"curlちょっとわかる、wgetよくわかない、python全く無知","ts":"1562838396.269000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"4edd6020-60ab-4614-81b9-7f67231ad6a5","type":"message","user":"UDDCM376D","text":"ツライ","ts":"1562838399.269200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"ab1cc922-8317-4391-a19b-79a6ff16e3ce","type":"message","user":"U0M7GCBPD","text":"とりあえずは Async.Promise で解決しそう？","ts":"1562838405.269500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"434eec60-2297-4fa7-9a04-079a8cdb47ef","type":"message","user":"U0M7GCBPD","text":"あ、汎用的な解決策という事だとつらそう","ts":"1562838414.270100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"3506dfd9-b9e9-47f5-a4de-b20dedaa80bc","type":"message","user":"UDDCM376D","text":"Async.Promise","ts":"1562838414.270200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"809fe25c-2ced-4923-8151-04f1b63fe380","type":"message","user":"U03C71D7H","text":"そこよりも非同期の仕組みの辺りですかねぇ","ts":"1562838420.270400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"b6d1f8fb-bd12-40e3-a2ab-3e2df492865f","type":"message","user":"UDDCM376D","text":"そんな便利なのがあったんだ","ts":"1562838425.270600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"dfc7dea0-07a7-46e8-b185-4664097630a4","type":"message","user":"U0M7GCBPD","text":"あ、全然ちがった。すみません","ts":"1562838479.271200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"5cf0c154-624c-4288-9b84-ab643ede3a4f","type":"message","user":"U0M7GCBPD","text":"Async.Promise は timer,job とかの wrapper なので\ntimer で同期的な処理を非同期にはできない以上無理ですね (文字通りタイマーなのでn秒後に呼び出すだけ)","ts":"1562838555.272800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"d3a4939b-076d-4f42-b4f7-730a76bf5d66","type":"message","user":"UDDCM376D","text":"`Vital.Async.Promise-example-rest-api` で一応できそう？","ts":"1562838572.273000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"634a6b86-9ff7-4af2-81c6-54846bbc5841","type":"message","user":"U0M7GCBPD","text":"(あれ？)","ts":"1562838591.273200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"048da43d-d2e7-47a9-ad5c-908f095c5a3e","type":"message","user":"U0M7GCBPD","text":"あ、 `curl` コマンドの例か、なるほど","ts":"1562838622.273600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"535918cc-0425-4b72-afd7-6d15dc672302","type":"message","user":"U0M7GCBPD","text":"外部コマンドなら job が使えるので非同期にできますね","ts":"1562838631.274000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"2bf71737-6970-411f-953f-4883ed1c5438","type":"message","user":"UDDCM376D","text":"apiを非同期で呼びたいんですよね","ts":"1562838654.274500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"8f8ac4ce-edbd-4eda-abfb-58fe565a1b4c","type":"message","user":"UDDCM376D","text":"組み合わせれば行けそう","ts":"1562838665.274700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"39917f60-eb97-402e-bcdb-f50308d0dd3e","type":"message","user":"U0M7GCBPD","text":"Web.HTTP の curl 版なら job 使って対応する機能とか入れればいけそう (Python 版とか他のは別対応にはなりますが)","ts":"1562838706.275300","edited":{"user":"U0M7GCBPD","ts":"1562838748.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"d31bd7d9-1551-4e73-a174-3d197b2c0006","type":"message","user":"U0M7GCBPD","text":"現状だと `s:Process.system()` 使ってて、これは `vimproc#system()` か `system()` を呼び出すので vimproc 使わない限り非同期実行は無理です (そして vimproc はもう…)\n<https://github.com/vim-jp/vital.vim/blob/6ba634458b1b776aa8bea97f9f8c4d1064f4e14a/autoload/vital/__vital__/Web/HTTP.vim#L540>","ts":"1562838970.276300","attachments":[{"fallback":"GitHub: vim-jp/vital.vim","id":1,"title":"vim-jp/vital.vim","title_link":"https://github.com/vim-jp/vital.vim/blob/6ba634458b1b776aa8bea97f9f8c4d1064f4e14a/autoload/vital/__vital__/Web/HTTP.vim#L540","text":"A comprehensive Vim utility functions for Vim plugins - vim-jp/vital.vim","thumb_url":"https://avatars2.githubusercontent.com/u/1051958?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/bfaba/img/unfurl_icons/github.png","thumb_width":400,"thumb_height":400,"from_url":"https://github.com/vim-jp/vital.vim/blob/6ba634458b1b776aa8bea97f9f8c4d1064f4e14a/autoload/vital/__vital__/Web/HTTP.vim#L540","original_url":"https://github.com/vim-jp/vital.vim/blob/6ba634458b1b776aa8bea97f9f8c4d1064f4e14a/autoload/vital/__vital__/Web/HTTP.vim#L540"}],"edited":{"user":"U0M7GCBPD","ts":"1562838986.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"5ed4e7fa-da73-42e2-92d7-628961677a4e","type":"message","user":"UDDCM376D","text":"vimprocつかっているんですね","ts":"1562839342.277000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"70958f47-a8e0-453a-9646-30a359af5374","type":"message","user":"UDDCM376D","text":"なるほど","ts":"1562839350.277200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"6792b273-d1ab-475a-ba79-912c3f643c85","type":"message","user":"UDDCM376D","text":"ということはやはりPR投げるしかないのか","ts":"1562839365.277600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"5077274e-3d9e-465c-ab19-e72ab5a87ef6","type":"message","user":"U03C6TEAZ","text":"wget は chunked response はサポートしてないですね。","ts":"1562839694.278000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"465eee3a-b87f-4e70-b39e-529476931307","type":"message","user":"U03C6TEAZ","text":"なので curl か if_python しか無理です。","ts":"1562839712.278300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"09478a10-834b-4077-a396-89f8a3a5bf77","type":"message","user":"U0M7GCBPD","text":"chunked response というより非同期で実行したいという事なので、ブロックしたくない？という事かなーと","ts":"1562839991.278900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"100c51bd-9d9d-49be-b467-055a7308c937","type":"message","user":"U03C6TEAZ","text":"それは出来ますね。","ts":"1562840060.279300","team":"T03C4RC8V","reactions":[{"name":"exclamation","count":1,"users":["U0M7GCBPD"]}],"replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"529ebfa2-c818-4359-be37-0e0180d20309","type":"message","user":"U0M7GCBPD","text":"オッ まじですか。 (mattn さん来るの待てばよかった感)","ts":"1562840374.280200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"55d50513-8b1b-419f-9242-c860c255d56f","type":"message","user":"UDDCM376D","text":"お","ts":"1562840381.280400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"aea4013d-a53a-4f4d-b0b5-1c0a8ffdf236","type":"message","user":"UDDCM376D","text":"どうやるんですか？","ts":"1562840411.280800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"19b56502-bf6f-446a-b9a7-a0997779f6bb","type":"message","user":"U03C6TEAZ","text":"ん？ job-channel という話ではなくですか？","ts":"1562840482.281100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"b9cfab04-3511-48d2-99da-cb6b034e809c","type":"message","user":"UDDCM376D","text":"現行のvital.web.httpは非同期できるって話の認識です","ts":"1562840554.282100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"d39b2891-3fc5-4994-aec7-7e57d035756e","type":"message","user":"U03C6TEAZ","text":"どういう意味の非同期ですか？","ts":"1562840618.282300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"f598fc67-e65b-43a3-aaf5-487b705671af","type":"message","user":"UDDCM376D","text":"操作をブロックしない、という意味です","ts":"1562840634.282600","edited":{"user":"UDDCM376D","ts":"1562840642.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"4f7152de-8933-40c8-b31a-76796cdc51c2","type":"message","user":"U03C6TEAZ","text":"job-channel でいいですよね？","ts":"1562840654.283000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a5bab6f5-e0e8-40ed-9bb6-59f043c799a4","type":"message","user":"UDDCM376D","text":"jobって外部コマンドを実行する認識ですが、\nvitalのhttpモジュールをjobを使って実行させるってことですか？","ts":"1562840704.284000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"f8210b4c-5819-4abe-b416-1743ceaffb21","type":"message","user":"UDDCM376D","text":"あまりわかっていないのですが、要はhttpのモジュールでAPIを叩く時Vimが固まるのを避けたい\nというのが目的です","ts":"1562840792.284900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"488c8ea5-c3f5-4a4c-a2c4-b99a46029100","type":"message","user":"U03C6TEAZ","text":"えと、async promise の話をされてますかね。","ts":"1562840952.285200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"3b99fead-78d7-4b96-97d9-b8b82a96bf31","type":"message","user":"U03C6TEAZ","text":"今の Web.HTTP は純粋な HTTP client なので何をしようがブロックすると思います。","ts":"1562840995.286000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"410a6ad9-a12a-4ded-9d8c-6281cb45f2e2","type":"message","user":"UDDCM376D","text":"すいません、話が少しややこしくなっていみたいです。。\n\n`async promise` は `vimproc` を使うという話なので、\n`job_start('curl xxx'. {})` って感じで非同期で外部コマンドを実行できるるんじゃないかなと。\n\nそう考えていたら、\n`chunked response というより非同期で実行したいという事なので、ブロックしたくない？という事かなーと` に対して それはできるという話なので、\nどうやるんだろ？っていうふうになっている状態です","ts":"1562841316.289600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"91c9e7bf-8241-4830-8a93-b75fecd63c3b","type":"message","user":"U0M7GCBPD","text":"すみません、Async.Promise を自分が勘違いして持ち出したためにややこしくしてしまった…","ts":"1562841380.290600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"c43ce897-72b0-4415-ba6c-4dadbd07bb2b","type":"message","user":"U03C6TEAZ","text":"job-channel base の API を足せば出来ると思います。","ts":"1562841386.290800","team":"T03C4RC8V","reactions":[{"name":"+1","count":1,"users":["U0M7GCBPD"]}],"replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"12319894-ab56-4f30-a8d3-dfad2587a00b","type":"message","user":"U03C6TEAZ","text":"今は `let response = <http://client.post|client.post>(request)` という形式だと思いますが","ts":"1562841443.291500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"9fd33178-8eb1-48da-851c-0cfd78d0c739","type":"message","user":"U03C6TEAZ","text":"```\nclient.post_async(request, {resp -&gt; ...})\n```\nこんな感じのを足せばいいかなーと。","ts":"1562841487.292300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"6f9f12f3-c291-47b0-b196-304247c80382","type":"message","user":"U03C6TEAZ","text":"で、curl であれば channel の out_cb で読み取って、区切りの良い所で指定されたコールバックを呼び出す。","ts":"1562841577.293000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"7c7fcb0e-fc3c-4238-89fc-a70e90cd1444","type":"message","user":"U03C6TEAZ","text":"python の場合はスレッドを使うか、timer で監視しにいく。","ts":"1562841619.293400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"51b7c6e4-42de-4825-81d9-0aa19a52e708","type":"message","user":"U03C6TEAZ","text":"前者はちょっと危ない。","ts":"1562841629.293600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a350684b-2b86-4d9f-ad75-155e6d728411","type":"message","user":"UDDCM376D","text":"&gt;で、curl であれば channel の out_cb で読み取って、区切りの良い所で指定されたコールバックを呼び出す。\nout_cbでレスポンスをためて、exit_cbでコールバックを呼ぶイメージでいましたが、それはあまり良くないんですか？\n\n&gt;python の場合はスレッドを使うか、timer で監視しにいく。\npythonってout_cbでレスポンス取れないからですか？","ts":"1562841769.294900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"6cc7a7d3-b26c-46db-91a9-5f0ae4daa5aa","type":"message","user":"U03C6TEAZ","text":"前者の話、そうすると chunk にならないですよね。","ts":"1562841794.295300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"843b7590-89ba-4017-86f0-af294013e296","type":"message","user":"U03C6TEAZ","text":"chunked response って","ts":"1562841819.295600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"8ac31969-28a8-49cc-872a-03b8459ea663","type":"message","user":"U03C6TEAZ","text":"```\n78\naaaaa......aaaaa\n1e\nbbb....bbbbbbb\n9\nccccccccc\n0\n```\nこういう奴です。なので1行読んでサイズ取得、その分まで out_cb が溜まれば分割しつつ(残りを次回用に蓄えつつ)コールバックを呼び出す、という動きになるはず。","ts":"1562841872.296600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"e22507f2-695b-4fb1-9c68-ff4538d04c89","type":"message","user":"U03C6TEAZ","text":"vim で非同期が実現できているのは、vim がメインループで","ts":"1562841928.297100","edited":{"user":"U03C6TEAZ","ts":"1562841937.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"17957aff-deab-453e-899f-b1ce354f6470","type":"message","user":"U03C6TEAZ","text":"• キー入力ある？\n• タイマーは発火する？\n• channel に何か溜まった？\n• ~あなたご飯にする？お風呂にする？~\nをグルグル回しながら実行してるから実現できていて、この中に python のオブジェクトの状態は含まれないんです。","ts":"1562842005.298600","edited":{"user":"U03C6TEAZ","ts":"1562842140.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"5eebd779-c0b6-44e7-a10e-40bec103ccf7","type":"message","user":"U03C6TEAZ","text":"なので python のオブジェクトの状態を見ようと思うと、タイマーの中で見に行くか、python 自らがスレッドを起動して、vim の関数を非同期に呼び出す。","ts":"1562842103.299300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"9d95e1f7-8d70-4d73-9970-cacc55ae6e15","type":"message","user":"U03C6TEAZ","text":"が、これは完全な race condition なので下手すると死亡する。","ts":"1562842119.299700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"12c708e9-0d45-4364-b028-ae33fdd9591f","type":"message","user":"U03C6TEAZ","text":"↑の部分、なんでそんなめんどくさい事するかというと","ts":"1562842188.300400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"7bc17575-1f2d-4b37-96dc-ac07d3de9c79","type":"message","user":"U03C6TEAZ","text":"```\n78\naaaaa......aaaaa\n33\nba\n```\nみたいな途中結果を読み込んでしまう事があるんですよね。これを\n```\n78\naaaaa......aaaaa\n```\nここで発火、さらにもうちょっと待って\n```\n33\nba.....\n```\nで発火させる。","ts":"1562842230.301800","edited":{"user":"U03C6TEAZ","ts":"1562842250.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"c38c4c6a-6bae-4730-be6f-1661260462b0","type":"message","user":"U0M7GCBPD","text":"<@UDDCM376D>\n&gt; out_cbでレスポンスをためて、exit_cbでコールバックを呼ぶイメージ\nWeb.HTTP 側でそれやっちゃうと chunked response って形式をサポートする旨味がなくなってしまうので (少しずつデータを受け取りたい)、\nWeb.HTTP 側では out_cb, exit_cb でそれぞれ呼び出すコールバックを受け取れるようにして、\nゴリラさんのプラグインとかでそれをやる風にした方が良さそうです。","ts":"1562842294.303200","thread_ts":"1562842294.303200","reply_count":3,"replies":[{"user":"UDDCM376D","ts":"1562842733.311900"},{"user":"U0M7GCBPD","ts":"1562842787.313500"},{"user":"UDDCM376D","ts":"1562842819.314200"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"8e15fc23-3730-4b44-8296-73344ab4e6e2","type":"message","user":"U0M7GCBPD","text":"いい機会なので MDN の解説置いときますね <https://developer.mozilla.org/ja/docs/Web/HTTP/Headers/Transfer-Encoding#Chunked_encoding>","ts":"1562842315.304200","attachments":[{"fallback":"MDN Web Docs: Transfer-Encoding","id":1,"title":"Transfer-Encoding","title_link":"https://developer.mozilla.org/ja/docs/Web/HTTP/Headers/Transfer-Encoding#Chunked_encoding","text":"Transfer-Encoding ヘッダーは、エンティティをユーザーに安全に転送するために使われる符号化方式を指定します。","thumb_url":"https://developer.mozilla.org/static/img/opengraph-logo.72382e605ce3.png","blocks":null,"service_name":"MDN Web Docs","service_icon":"https://developer.mozilla.org/static/img/favicon144.e7e21ca263ca.png","thumb_width":600,"thumb_height":600,"from_url":"https://developer.mozilla.org/ja/docs/Web/HTTP/Headers/Transfer-Encoding#Chunked_encoding","original_url":"https://developer.mozilla.org/ja/docs/Web/HTTP/Headers/Transfer-Encoding#Chunked_encoding"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"6f857461-8080-44c7-a960-59bdb0894389","type":"message","user":"UAZ33BKV2","text":"ありすえさんのvital-Wisky の Async.process(だっけ？)は解決とは違うかなぁ…","ts":"1562842322.304500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"525977db-c1d5-4e4b-ac24-6048e89ecff5","type":"message","user":"U0M7GCBPD","text":"(といっても mattn さんの説明とほぼ同じだった)","ts":"1562842368.304900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"c8f395ac-abc6-49b8-9461-c7ae0f2599ee","type":"message","user":"U0M7GCBPD","text":"&gt; チャンク化の符号化は、大量のデータをクライアントに送り、リクエストが完了するまでレスポンスの合計の長さが分からない場合に便利です。例えば、巨大な HTML の表をデータベースのクエリの結果として作成したり、大きな画像を転送したりする場合などです。","ts":"1562842378.305100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"68453146-58d8-4971-829d-663718d71d62","type":"message","user":"U776661HA","text":"(Observableで作りたいと思い始めて早数年）","ts":"1562842418.306000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"8ca80255-80a3-49f6-9e6b-5929ad60cd45","type":"message","user":"U776661HA","text":"(Observable まではつくった)","ts":"1562842432.306600","team":"T03C4RC8V","reactions":[{"name":"sugoi","count":1,"users":["U0M7GCBPD"]}],"replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"17fa0105-56ec-4328-9c11-3ab474d53ddc","type":"message","user":"U03C6TEAZ","text":"まぁとは行っても curl のソケット受信時にウィンドウサイズとかバッファリングしっかりやってて\n```\n78\naaa....bb\n```\nで flush してくれてるので、殆どのケースでは途中で読み取る事は無いと思いますけどね。","ts":"1562842447.306900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"29287cae-d477-4a63-8b6c-5a9bef2a2f8c","type":"message","user":"U03C6TEAZ","text":"エンジニアであれば作っておいた方が良いお題、オレオレ言語の他に HTTP Client もありますね。","ts":"1562842500.307600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"2070eb99-0e56-4e58-8b4e-96d906386a80","type":"message","user":"UDDCM376D","text":"chnunked responseの用途と読み取り方は理解しました\n\n&gt;なので python のオブジェクトの状態を見ようと思うと、タイマーの中で見に行くか、python 自らがスレッドを起動して、vim の関数を非同期に呼び出す。\nout_cbって標準出力を読み取る認識です。\nでpytyonわかっていないのです、pythonでhttp通信する時、レスポンスは標準出力されないんですか？\n↑の部分、なぜ pythonのオブジェクトの状態を見に行かないといけないのかがわかっていないです","ts":"1562842684.311100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"1f6447a7-385d-4c99-a7b5-f56f3b468b8c","type":"message","user":"UDDCM376D","text":"読みました\nありがとうございますm(_ _)m","ts":"1562842733.311900","thread_ts":"1562842294.303200","parent_user_id":"U0M7GCBPD","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"eff79782-9802-4a09-b86f-af3e21363e20","type":"message","user":"U03C6TEAZ","text":"python を外部コマンドとして利用するなら、python コマンドが出力する標準出力を利用して curl 代わりに利用すれば良いですね。↑で話しているのは `if_python` といって、vim に組み込まれた python の話です。","ts":"1562842753.312500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"819c8fa4-f787-48d5-93d0-77531b2dab27","type":"message","user":"UDDCM376D","text":"あー、 `if_python` 全くわからないのでイメージがすらできていない。。","ts":"1562842781.313400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"bc3652cf-7814-4a4e-84f7-a450c88e5a2f","type":"message","user":"U0M7GCBPD","text":"ゴリラさんからしたらなぜ chunked response の話が出てきたんだろうって感じだと思いますがw\n現状 chunked response をサポートしているので、それを活かすためには↑のようなインターフェースにした方がいいんじゃないか、って事ですね","ts":"1562842787.313500","thread_ts":"1562842294.303200","subtype":"thread_broadcast","replace_original":false,"delete_original":false,"blocks":null,"root":{"client_msg_id":"c38c4c6a-6bae-4730-be6f-1661260462b0","type":"message","user":"U0M7GCBPD","text":"<@UDDCM376D>\n&gt; out_cbでレスポンスをためて、exit_cbでコールバックを呼ぶイメージ\nWeb.HTTP 側でそれやっちゃうと chunked response って形式をサポートする旨味がなくなってしまうので (少しずつデータを受け取りたい)、\nWeb.HTTP 側では out_cb, exit_cb でそれぞれ呼び出すコールバックを受け取れるようにして、\nゴリラさんのプラグインとかでそれをやる風にした方が良さそうです。","ts":"1562842294.303200","thread_ts":"1562842294.303200","reply_count":3,"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null}},{"client_msg_id":"a041d172-5f7f-4b79-96af-cd09ee45b5a9","type":"message","user":"U03C6TEAZ","text":"```\n:python print(1)\n```\nとすると実際には python の print 関数から vim の ex_echo が呼び出され、vim が画面に出力してます。","ts":"1562842789.313900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"e52a5120-1411-4edf-b1f5-d1cb05100032","type":"message","user":"UDDCM376D","text":"あ、はい\nそうなんだろうなと思いました\n補足ありがとうございますm(_ _)m","ts":"1562842819.314200","thread_ts":"1562842294.303200","parent_user_id":"U0M7GCBPD","team":"T03C4RC8V","reactions":[{"name":"+1","count":1,"users":["U0M7GCBPD"]}],"replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"4b770a8a-7f2b-4af0-be56-a0206c070972","type":"message","user":"U03C6TEAZ","text":"通常の http client は content-length が指定されていない場合は body が閉じられるまで読み取るので、現状既に chunked resopnse をサポートしていると言えば、サポートしています。","ts":"1562842845.315000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a91e3a99-0063-4755-96a4-5f09cbd8bcd8","type":"message","user":"U03C6TEAZ","text":"言ってしまえば小刻みにコールバックを実行する仕組みがない。","ts":"1562842861.315600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"095ab786-5f1f-4285-a192-70254aec4611","type":"message","user":"U0M7GCBPD","text":"(まぁまずとりあえずは curl だけ対応 (他クライアントでは例外を投げる) でいいと思いますが)","ts":"1562842920.316400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"c6d72fb3-c8bd-4919-b76a-edc14d1db1cd","type":"message","user":"UDDCM376D","text":"&gt;とすると実際には python の print 関数から vim の ex_echo が呼び出され、vim が画面に出力してます。\n逆だと思っていました\nVim から pythonの関数を呼び出して実行した結果を画面に描写する流れかと","ts":"1562842985.317700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"de055ac2-50ac-41d8-8cce-59a70059ff66","type":"message","user":"UDDCM376D","text":"&gt;(まぁまずとりあえずは curl だけ対応 (他クライアントでは例外を投げる) でいいと思いますが)\nたしかにそれもありですね","ts":"1562843008.318200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"0005ed7b-dfba-44f8-92fa-51d901ef80af","type":"message","user":"U03C6TEAZ","text":"vim が python の print 関数を乗っ取ってるんです。","ts":"1562843021.318500","team":"T03C4RC8V","reactions":[{"name":"naruhodo","count":1,"users":["U0M7GCBPD"]}],"replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"fbe4cf6d-9e0f-4a59-af72-2eefabc267e2","type":"message","user":"U0M7GCBPD","text":"しらなかった","ts":"1562843066.318800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"0f459d2e-ab6e-43b6-8c66-98e2e12dd438","type":"message","user":"U0M7GCBPD","text":"<@U03C6TEAZ> 現状って if_python 側でブロックして戻ってこない状態になるんですか？ &gt;body が閉じられるまで読み取る","ts":"1562843078.319200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"978e8ed0-1665-457f-bd5b-1604722fdfda","type":"message","user":"U03C6TEAZ","text":"そうなります。","ts":"1562843098.319400","team":"T03C4RC8V","reactions":[{"name":"naruhodo","count":1,"users":["U0M7GCBPD"]}],"replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"c710957f-bf5d-4586-8ca7-04c5f1664b5d","type":"message","user":"U03C6TEAZ","text":"なのでものすごーーーーーーーーーーーーくレスポンスが遅いウェブサーバがあると、curl は外部コマンドなので固まりませんが、python は(スレッドを実装しない場合は)固まるでしょうね。","ts":"1562843144.320300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"96ad50ca-bbbd-4504-acf2-4d1dd30297bd","type":"message","user":"U03C6TEAZ","text":"ぶっちゃけ最近 if_python いる？って気がしてる。","ts":"1562843454.321200","team":"T03C4RC8V","reactions":[{"name":"wakaru","count":2,"users":["U0M7GCBPD","UEBF2KQTD"]}],"replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"bd091891-bc74-49ab-af6a-00ebc07c255e","type":"message","user":"U03C6TEAZ","text":"if_python が動くって事は /usr/bin/python は入ってるわけで、であれば外部コマンドとして python 使っても同じよなーと。","ts":"1562843537.321900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"5d7d5893-2cd5-4bcc-8bbb-d8edbba579c5","type":"message","user":"UDDCM376D","text":"if_python ってどんなメリットがあるんですか？\n触ったことがないので全くわからない","ts":"1562843641.322700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"6210e5e0-f5c3-475a-8716-8c873e175ab5","type":"message","user":"U03C6TEAZ","text":"外部コマンドを呼び出さずに python が使える。python から Vim のオブジェクト、例えばウィンドウとかバッファが触れる。","ts":"1562843684.323400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"6ec93597-5ece-48c9-94db-a5fa92bb6720","type":"message","user":"UDDCM376D","text":"便利そう","ts":"1562843706.324000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"dcbe5850-0266-4fd8-8ebf-994e8ef198db","type":"message","user":"U03C6TEAZ","text":"が、それって外部コマンドとして python を使って、その結果で Vim script でウィンドウとかバッファを扱ったらいいだけ、という話でもあります。","ts":"1562843711.324200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"1264aed3-b21a-402c-b4de-5d28a74bdbe6","type":"message","user":"UDDCM376D","text":"それもそうですね","ts":"1562843725.324400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"ea967836-fba0-42df-b385-ac53af5ac656","type":"message","user":"U03C6TEAZ","text":"最近の python は virtualenv とか conda とか、複数の環境が入ってる事がおおく、if_python が使うライブラリがバージョン固定せずに落ちる場合があるんです。","ts":"1562843782.325300","team":"T03C4RC8V","reactions":[{"name":"tashikani","count":1,"users":["UEBF2KQTD"]}],"replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"4f180a21-7a08-4412-a333-0a743730f65e","type":"message","user":"U03C6TEAZ","text":"そういう点であまり「安定」ではない。","ts":"1562843792.325700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"900c76c6-2aa0-47a1-8020-cdf2df49e6f3","type":"message","user":"UDDCM376D","text":"pythonは環境面ちゃんとしていないと行けない印象があるので、なんとなく想像つきます","ts":"1562843836.326200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"}]
