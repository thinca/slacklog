[{"type":"message","user":"UA4RVLHK7","text":"リンクしていた Python が消えた段階で動かなくなるハズだったのが、別のバージョンの Python のモジュールを参照していたので、偶然動いていた。","ts":"1523430098.000370","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"そうなんですよね。なんとかして abort せずに済ます API が欲しい。 Python 側の課題です。","ts":"1523430178.000174","thread_ts":"1523428197.000341","parent_user_id":"UA4RVLHK7","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"今できるのは、 Python のコードから prefix をチェックするコードをコピペしてくるくらい。","ts":"1523430200.000400","thread_ts":"1523428197.000341","parent_user_id":"UA4RVLHK7","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"この件、状況共有の為にひとまず slack にしましたが、議論に発展しそうであれば github の issues に移動する予定です。その際に発言内容をコピペさせて貰いますのでご留意ください。","ts":"1523430240.000151","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"9785699d-3c5a-4922-8daa-d29d35c81b81","type":"message","user":"U06BRP8VD","text":"エラーで帰ってくれれば良いんですけどね…","ts":"1523430282.000212","thread_ts":"1523428197.000341","parent_user_id":"UA4RVLHK7","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"<https://github.com/python/cpython/blob/c4b695f85e141f57d22d8edf7bc2c756da136918/Modules/getpath.c#L420>","ts":"1523430355.000362","thread_ts":"1523428197.000341","attachments":[{"fallback":"GitHub: python/cpython","id":1,"title":"python/cpython","title_link":"https://github.com/python/cpython/blob/c4b695f85e141f57d22d8edf7bc2c756da136918/Modules/getpath.c#L420","text":"cpython - The Python programming language","thumb_url":"https://avatars2.githubusercontent.com/u/1525981?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/bfaba/img/unfurl_icons/github.png","thumb_width":250,"thumb_height":250,"from_url":"https://github.com/python/cpython/blob/c4b695f85e141f57d22d8edf7bc2c756da136918/Modules/getpath.c#L420"}],"parent_user_id":"UA4RVLHK7","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"PYTHONHOME を指定された場合は無条件に信じていて、","ts":"1523430367.000472","thread_ts":"1523428197.000341","parent_user_id":"UA4RVLHK7","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"B5F70116-2930-4A12-8B60-62E91AC4029F","type":"message","user":"U776661HA","text":"すみません途中ですが離脱します","ts":"1523430413.000185","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"<https://github.com/python/cpython/blob/c4b695f85e141f57d22d8edf7bc2c756da136918/Modules/getpath.c#L342-L362>","ts":"1523430497.000392","thread_ts":"1523428197.000341","attachments":[{"fallback":"GitHub: python/cpython","id":1,"title":"python/cpython","title_link":"https://github.com/python/cpython/blob/c4b695f85e141f57d22d8edf7bc2c756da136918/Modules/getpath.c#L342-L362","text":"cpython - The Python programming language","thumb_url":"https://avatars2.githubusercontent.com/u/1525981?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/bfaba/img/unfurl_icons/github.png","thumb_width":250,"thumb_height":250,"from_url":"https://github.com/python/cpython/blob/c4b695f85e141f57d22d8edf7bc2c756da136918/Modules/getpath.c#L342-L362"}],"parent_user_id":"UA4RVLHK7","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"先日一旦取り込まれたパッチの問題点って何になるんですかね。","ts":"1523430504.000123","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"それ以外の場合は、 `prefix/lib/pythonX.Y/os.py` の存在をチェックしているようなので、","ts":"1523430573.000156","thread_ts":"1523428197.000341","parent_user_id":"UA4RVLHK7","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"SetPythonHome() をする前に同じチェックをすれば一部の問題（古いバージョンを参照している時に、それが消えたらabortする）は、 vim を巻き込まなくなる。","ts":"1523430636.000235","thread_ts":"1523428197.000341","parent_user_id":"UA4RVLHK7","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"でも本来 SetPythonHome() したくないから、それでも abort() しない方法が必要だよなぁ。","ts":"1523430653.000173","thread_ts":"1523428197.000341","parent_user_id":"UA4RVLHK7","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"Bram の信頼を得ていないこと。。。","ts":"1523430674.000008","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"w","ts":"1523430723.000266","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"-DPYTHON_HOME で解決できる問題が十分にレアケースで、本当に必要な時にビルドする人が自分で指定するか、\n利用者が set pythonhome すればいいと説得が必要。","ts":"1523430750.000239","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"個人的には、問題がややこしくなるので、 -DPYTHON_HOME はデフォルトで指定しないだけじゃなくて完全になくしてもいいくらいに思ってる。","ts":"1523430856.000328","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"python ライブラリに埋め込まれた prefix がデフォルトで利用され、 PYTHONHOME 環境変数か set pythonhome で上書きできる、というのが自然。","ts":"1523430906.000236","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"これ virtualenv ユーザにも同じ事が起きうるんでしょうか？","ts":"1523430911.000507","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"virtualenv ユーザーがどうやって virtualenv 使ってるかなんですよねぇ。","ts":"1523430943.000201","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"virtualenv なら、元になった Python と、プライベートAPIも含めて完全にバイナリ互換性がある（というかただのコピー）なので、","ts":"1523430973.000024","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"set pythonhome で別の virtualenv に切り替えたり、","ts":"1523430989.000354","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"-DPYTHON_HOME で、特定の virtualenv を使うようにバイナリレベルでカスタマイズした vim を作ることも一応合法。","ts":"1523431022.000031","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"でも、 -DPYTHON_HOME でそこまでしたいというユースケースが個人的には思いつかない。 set pythonhome でいいじゃん。","ts":"1523431037.000264","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"<https://github.com/plytophogy/vim-virtualenv/blob/master/autoload/virtualenv.vim>","ts":"1523431132.000083","attachments":[{"fallback":"GitHub: plytophogy/vim-virtualenv","id":1,"title":"plytophogy/vim-virtualenv","title_link":"https://github.com/plytophogy/vim-virtualenv/blob/master/autoload/virtualenv.vim","text":"vim-virtualenv - Vim plugin for working with python virtualenvs","thumb_url":"https://avatars2.githubusercontent.com/u/33200?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/bfaba/img/unfurl_icons/github.png","thumb_width":250,"thumb_height":250,"from_url":"https://github.com/plytophogy/vim-virtualenv/blob/master/autoload/virtualenv.vim"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"実際には、 PYTHONHOME を切り替えるという強引な手法ではなくて、 activate() メソッドを使って sys.path だけ上書きする方法が利用されていると思います。","ts":"1523431166.000027","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"なるほど","ts":"1523431181.000211","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"どこかに、 if_python(3) が動かないときのトラブルシューティングをまとめれば、、、","ts":"1523431405.000255","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"+python(3)  が dynamic link か static link かを区別するには、 ldd / otool -L を使えばいい","ts":"1523431483.000208","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"vim をノンインタラクティブに、特定のコマンドだけ実行するのってどうするんでしょうか。","ts":"1523431553.000026","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"`:version` の結果を grep したいとか。","ts":"1523431560.000394","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"--version で CFLAGS は出たと思います。","ts":"1523431651.000181","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"`:py import sys; print(sys.version)` なんかも見たいナァ","ts":"1523431678.000181","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"あと、 import の問題で死ぬときって、 macvim ならコンソールに残ると思うんだけど、","ts":"1523431815.000279","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"```\n$ ./vim\nVim: Caught deadly signal ABRT\nVim: Finished.\nAbort trap: 6\n```","ts":"1523431819.000087","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"vim の中で、 `:py3 import sys` したら、一瞬何かが表示された気がして、すぐに vim の画面が消えてしまうので、 encoding モジュールが読めない的なエラーが見えない。","ts":"1523431867.000424","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"macvim をコンソールからじゃなくて GUI から起動した場合も多分同じ。","ts":"1523431900.000130","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"<https://github.com/macvim-dev/macvim/issues/669>","ts":"1523431902.000197","attachments":[{"fallback":"GitHub: Pressing 'o' in normal mode closes the window · Issue #669 · macvim-dev/macvim","id":1,"title":"Pressing 'o' in normal mode closes the window · Issue #669 · macvim-dev/macvim","title_link":"https://github.com/macvim-dev/macvim/issues/669","text":"similar to the issue in #586. os: macOS 10.13.4 python: 3.6.3 MacVim: Snapshot 146 Errorlog: Process: Vim [1316] Path: /Applications/MacVim.app/Contents/MacOS/Vim Ide...","thumb_url":"https://avatars1.githubusercontent.com/u/13108255?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/bfaba/img/unfurl_icons/github.png","thumb_width":250,"thumb_height":250,"from_url":"https://github.com/macvim-dev/macvim/issues/669"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"この人も多分 import で死んでる。","ts":"1523431911.000328","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"```\nvim --cmd 'py import sys; print(sys.version)' --cmd q\n```","ts":"1523431921.000319","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"とかでどうでしょう","ts":"1523431924.000185","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"ありがとうございます。行けました。","ts":"1523431957.000344","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"```\n$ ./vim --cmd 'py3 import sys; print(sys.version)' --cmd q\nFatal Python error: Py_Initialize: unable to load the file system codec\nModuleNotFoundError: No module named 'encodings'\n\nCurrent thread 0x00007fffbc6a23c0 (most recent call first):\nVim: Caught deadly signal ABRT\nVim: Finished.\nAbort trap: 6\n```","ts":"1523431963.000043","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"stderr に出てる？ `2&gt;&amp;1` いるのかな","ts":"1523431997.000509","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"stderr に出てますね。 2&gt;&amp;1 なくても標準エラー出力なのでそのまま表示されます。","ts":"1523432112.000077","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"grep するなら、ですね。","ts":"1523432191.000067","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"あぁ、そうですね。","ts":"1523432403.000445","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"エンドユーザー向けにトラブルシューティングを書こうとすると、全部のパターンでどういうエラーになるか書かないといけなくなってつらたん。","ts":"1523433717.000272","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"当面の目的を Bram の説得に費やすなら、やっぱり vim がどうビルドされているか別で、エラーケースを列挙する方が良さそう。","ts":"1523433795.000351","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"まず +python3 (static link)","ts":"1523433812.000187","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"対象の Python 3 が消え、別のバージョンの Python 3 がビルドされた場合、新しい Python 3 を使って vim をビルドし直すしかない。","ts":"1523433854.000453","edited":{"user":"UA4RVLHK7","ts":"1523434419.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"対象の Python 3 が、 Python のビルド後に移動した場合、 移動先の prefix を `set pythonthreehome` する。","ts":"1523433893.000117","edited":{"user":"UA4RVLHK7","ts":"1523434157.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"この場合、 `-DPYTHON_HOME` に `python -c 'import sys; print(sys.prefix)'` を設定することは役に立つ。","ts":"1523434005.000376","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"Python executable を利用する場合、 `sys.prefix` は、ビルド時の prefix ではなく実行ファイルからの相対パスを探すから。","ts":"1523434038.000151","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"libpython.a はビルド時の prefix しか知らない。","ts":"1523434083.000349","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"```\ninada-n@rinrin:~$ pyenv/versions/3.6.4/bin/python -c 'import sys; print(sys.prefix)'\n/home/inada-n/pyenv/versions/3.6.4\ninada-n@rinrin:~$ mv pyenv/versions/3.6.4 pyenv/versions/moved\ninada-n@rinrin:~$ pyenv/versions/moved/bin/python -c 'import sys; print(sys.prefix)'\n/home/inada-n/pyenv/versions/moved\n```","ts":"1523434105.000097","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"Python が移動したのが、 vim のビルド後だった場合は、対処法は `set pythonthreehome` だけ","ts":"1523434204.000339","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"対象の Python 3 が消えて、バイナリ互換性のある (micro version まで一致した) Python 3 が別のディレクトリにビルドされた時","ts":"1523434283.000284","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"vim のビルド後なら、 `set pythonthreehome` で対処可能。 vim のビルド前なら、何も問題ない (`-DPYTHON_HOME` は役に立たない)","ts":"1523434325.000152","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"書くのが面倒だから、やっぱり Python 2 で書いたほうが良いな。。。","ts":"1523434356.000045","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"次は +python (dynamic link)","ts":"1523434369.000185","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"* 対象の Python が消え、別のバージョンの Python がビルドされた場合","ts":"1523434440.000233","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"vim のリビルドは不要。 対象の Python の DLL がちゃんとリンクされていれば動く。","ts":"1523434482.000112","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"この場合、 別のバージョンの Python のインストール prefix が、古い Python のものと異なると、\n`-DPYTHON_HOME` が問題を起こす。","ts":"1523434510.000498","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"せっかく DLL に含まれている正しい prefix を無視して、古い Python の prefix を見に行って死ぬ。","ts":"1523434530.000498","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"起きうる事象、パッチのメリット、パッチを当てても救えない話を一気に説明しないと理解されそうにないですね。","ts":"1523434533.000021","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"英語むずい。","ts":"1523434539.000058","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"* vim のバイナリパッケージ提供者とその利用者で Python のインストール場所が違う場合","ts":"1523434729.000004","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"vim の利用者は pythondll と pythonhome の両方を指定しなければならない。\n`-DPYTHON_HOME` がなければ pythondll だけ設定すれば済む。","ts":"1523434766.000399","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"* Python がビルド後に移動された場合","ts":"1523434830.000003","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"Python DLL に格納されている prefix が無効なので、利用者は pythonhome の両方を設定しなければならない。","ts":"1523434864.000624","edited":{"user":"UA4RVLHK7","ts":"1523436101.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"この場合も、 vim を後からビルドするなら、 `-DPYTHON_HOME` がメリットになるケースはある。 (pythonhome の指定が不要になる)","ts":"1523434904.000539","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"`-DPYTHON_HOME` のメリットがあるケースは、検出可能。","ts":"1523435093.000568","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"移動してない場合\n```\n$ python2\nPython 2.7.14 (default, Sep 23 2017, 22:06:14)\n[GCC 7.2.0] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n&gt;&gt;&gt; import sys, sysconfig\n&gt;&gt;&gt; sys.prefix\n'/usr'\n&gt;&gt;&gt; sysconfig.get_config_var('prefix')\n'/usr'\n```","ts":"1523435108.000076","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"移動している場合\n```\ninada-n@rinrin:~$ pyenv/versions/moved/bin/python -c 'import sys, sysconfig; print(sys.prefix); print(sysconfig.get_config_var(\"prefix\"))'\n/home/inada-n/pyenv/versions/moved\n/home/inada-n/pyenv/versions/3.6.4\n```","ts":"1523435178.000545","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"ただ、、この場合も、 symlink が挟まってるとかで実行ファイルのフルパスが異なるだけで、実際には同一のパス（移動してない）可能性もあるな","ts":"1523435215.000014","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"そしてもう一つの問題は、 `-DPYTHON_HOME` を `:version` で確認できないこと。トラブルシューティングが難しくなる。","ts":"1523435264.000081","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"CFLAGS=-DPYTHON_HOME=/path/to/python/prefix なら、 `:version` に残る。","ts":"1523435438.000441","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","ts":"1523442799.000361","files":[{"id":"FA5MYC5HU","created":1523442799,"timestamp":1523442799,"name":"proposal_md.md","title":"proposal.md","mimetype":"text/plain","image_exif_rotation":0,"filetype":"markdown","pretty_type":"Markdown (raw)","user":"UA4RVLHK7","mode":"snippet","editable":true,"is_external":false,"external_type":"","size":3084,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-FA5MYC5HU/proposal_md.md","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-FA5MYC5HU/download/proposal_md.md","original_h":0,"original_w":0,"thumb_64":"","thumb_80":"","thumb_160":"","thumb_360":"","thumb_360_gif":"","thumb_360_w":0,"thumb_360_h":0,"thumb_480":"","thumb_480_w":0,"thumb_480_h":0,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/UA4RVLHK7/FA5MYC5HU/proposal_md.md","permalink_public":"https://slack-files.com/T03C4RC8V-FA5MYC5HU-e32855c0fd","edit_link":"https://vim-jp.slack.com/files/UA4RVLHK7/FA5MYC5HU/proposal_md.md/edit","preview":"","preview_highlight":"","lines":0,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":null},{"type":"message","user":"UA4RVLHK7","text":"草稿","ts":"1523442806.000310","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"python-config --cflags とかって、いつから使えたんだろうなぁ。","ts":"1523443730.000247","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"--with-config-dir を捨てて、 python-config を使うようにしたい。","ts":"1523443744.000126","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"今は config-dir の Makefile を使ってるんだけど、 python-config --cflags に比べると余計なものが入ってる。","ts":"1523443770.000469","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"config-dir/Makefile から LIBS を取り出すの、     AC_CACHE_VAL(vi_cv_path_python_plibs, でやってるから、\nPYTHON_CFLAGS もそっから作るのは面倒だな。","ts":"1523445012.000438","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"似たようなことをする AC_CACHE_VAL(vi_cv_path_python_cflags, とかすれば良いのかもしれないけれど、 autoconf 力が低いし、 -DPYTHON_PATH からズレてくる。","ts":"1523445058.000428","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"```\n    PYTHON_SRC=\"if_python.c\"\n    PYTHON_OBJ=\"objects/if_python.o\"\n    if test \"${vi_cv_var_python_version}\" = \"1.4\"; then\n       PYTHON_OBJ=\"$PYTHON_OBJ objects/py_getpath.o\"\n    fi\n```","ts":"1523445904.000254","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"Python 1.4 ってまだサポートする必要ありますかね…","ts":"1523445915.000078","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"db273e6b-809c-4e8d-9c8b-6eca0345987d","type":"message","user":"U03C6TEAZ","text":"ないかとw","ts":"1523445980.000365","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U9S4G0LJW","text":"Python2すら死のうとしてるというのに…","ts":"1523445994.000339","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"試しにこのへん削るプルリク出してみるか。。。","ts":"1523446006.000260","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"<https://github.com/vim/vim/pull/2794>","ts":"1523446365.000042","attachments":[{"fallback":"GitHub: Drop Python 1.4 support from configure by methane · Pull Request #2794 · vim/vim","id":1,"title":"Drop Python 1.4 support from configure by methane · Pull Request #2794 · vim/vim","title_link":"https://github.com/vim/vim/pull/2794","thumb_url":"https://avatars1.githubusercontent.com/u/199592?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/bfaba/img/unfurl_icons/github.png","thumb_width":250,"thumb_height":250,"from_url":"https://github.com/vim/vim/pull/2794"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"<http://configure.ac|configure.ac>, インデントにTABとスペースが入り混じってるなぁ。","ts":"1523446473.000271","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"なにをしたいかというと、 -L が config-dir から計算されていて -I が python の実行ファイルから計算されているので、 --with-config-dir 使うと -I と -L が別々の Python を示す可能性があって、 --with-python-config-dir オプションと共に config-dir 依存自体削れないかなーと。","ts":"1523447525.000368","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"python コマンドと違う場所にある Python を利用して vim をビルドしたい場合は、今のところ PATH=/path/to/python:$PATH が唯一の正しい方法。","ts":"1523447565.000326","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"configure オプションで PATH の先頭以外の python を利用できるようにしたいなら、 --with-python-exe=/path/to/python みたいに実行ファイルのパスを直接指定させるほうが良さそうだなーと。","ts":"1523447614.000521","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"ということで config-dir 使ってる場所が他にも無いかチェックしてみた所、 Python 1.4 でだけ使われてた。","ts":"1523447655.000400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U9S4G0LJW","text":"repeatが結構速くて不思議に思ったのでソース見てたけどVimのリストって連結リストなのか…","ts":"1523451664.000103","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"b43f6646-8ecd-467e-85d4-5c82a871801b","type":"message","user":"U8CC7MDCL","text":"補完できるとかそういうあれなのかな？","ts":"1523403803.000105","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"terminal から起動されるプロセスはどの vim から起動されたか知る事ができるのと、Tapi があるので普通のコマンドラインアプリケーションとして親の vim と喋って bash 補完をさせるくらいなら出来そう。","ts":"1523409870.000047","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","ts":"1523415605.000009","files":[{"id":"FA4LA2TPC","created":1523415602,"timestamp":1523415602,"name":"terminal4.gif","title":":terminal API","mimetype":"image/gif","image_exif_rotation":1,"filetype":"gif","pretty_type":"GIF","user":"U03C6TEAZ","mode":"hosted","editable":false,"is_external":false,"external_type":"","size":30490,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-FA4LA2TPC/terminal4.gif","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-FA4LA2TPC/download/terminal4.gif","original_h":378,"original_w":642,"thumb_64":"https://files.slack.com/files-tmb/T03C4RC8V-FA4LA2TPC-f152e105d2/terminal4_64.png","thumb_80":"https://files.slack.com/files-tmb/T03C4RC8V-FA4LA2TPC-f152e105d2/terminal4_80.png","thumb_160":"https://files.slack.com/files-tmb/T03C4RC8V-FA4LA2TPC-f152e105d2/terminal4_160.png","thumb_360":"https://files.slack.com/files-tmb/T03C4RC8V-FA4LA2TPC-f152e105d2/terminal4_360.png","thumb_360_gif":"https://files.slack.com/files-tmb/T03C4RC8V-FA4LA2TPC-f152e105d2/terminal4_360.gif","thumb_360_w":360,"thumb_360_h":212,"thumb_480":"https://files.slack.com/files-tmb/T03C4RC8V-FA4LA2TPC-f152e105d2/terminal4_480.png","thumb_480_w":480,"thumb_480_h":283,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U03C6TEAZ/FA4LA2TPC/terminal4.gif","permalink_public":"https://slack-files.com/T03C4RC8V-FA4LA2TPC-e16fd23018","edit_link":"","preview":"","preview_highlight":"","lines":0,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"deanimate_gif":"https://files.slack.com/files-tmb/T03C4RC8V-FA4LA2TPC-f152e105d2/terminal4_deanimate_gif.png","display_as_bot":false,"has_rich_preview":false,"thumb_480_gif":"https://files.slack.com/files-tmb/T03C4RC8V-FA4LA2TPC-f152e105d2/terminal4_480.gif","username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":null},{"type":"message","user":"U03C6TEAZ","text":"Tapi、レスポンスを返したいな。","ts":"1523415608.000124","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"端末側と vim で専用のテンポラリファイルとかで共有すれば情報の受け渡しも出来なくないけど、綺麗じゃないね。","ts":"1523415650.000222","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U78A6ESHM","text":"おーこれって Tapi を使えば terminal から 呼び出した Vim の方にデータ渡せるようになるってことでしょうか。","ts":"1523415938.000136","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"渡せますね。ただ逆が欲しい。","ts":"1523416279.000306","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"まぁ sendkey すればいいんだけど","ts":"1523416293.000109","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"とりあえず好きな関数を呼ぶという事は出来なくなってるので (Tapi_ か drop)、信頼してるプラグインだけ入れるなら問題は起きない。","ts":"1523416345.000218","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C71D7H","text":"Vim にエスケープシーケンスを送る時点でターミナル上で動くプログラムだし、悪いことしたいならそっち側でいくらでもできそうだ","ts":"1523416464.000195","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","ts":"1523416675.000030","files":[{"id":"FA4DLM4QL","created":1523416670,"timestamp":1523416670,"name":"terminal4.gif","title":"terminal API","mimetype":"image/gif","image_exif_rotation":1,"filetype":"gif","pretty_type":"GIF","user":"U03C6TEAZ","mode":"hosted","editable":false,"is_external":false,"external_type":"","size":103454,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-FA4DLM4QL/terminal4.gif","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-FA4DLM4QL/download/terminal4.gif","original_h":600,"original_w":642,"thumb_64":"https://files.slack.com/files-tmb/T03C4RC8V-FA4DLM4QL-ed7ce7b396/terminal4_64.png","thumb_80":"https://files.slack.com/files-tmb/T03C4RC8V-FA4DLM4QL-ed7ce7b396/terminal4_80.png","thumb_160":"https://files.slack.com/files-tmb/T03C4RC8V-FA4DLM4QL-ed7ce7b396/terminal4_160.png","thumb_360":"https://files.slack.com/files-tmb/T03C4RC8V-FA4DLM4QL-ed7ce7b396/terminal4_360.png","thumb_360_gif":"https://files.slack.com/files-tmb/T03C4RC8V-FA4DLM4QL-ed7ce7b396/terminal4_360.gif","thumb_360_w":360,"thumb_360_h":336,"thumb_480":"https://files.slack.com/files-tmb/T03C4RC8V-FA4DLM4QL-ed7ce7b396/terminal4_480.png","thumb_480_w":480,"thumb_480_h":449,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U03C6TEAZ/FA4DLM4QL/terminal4.gif","permalink_public":"https://slack-files.com/T03C4RC8V-FA4DLM4QL-5e4181d9d8","edit_link":"","preview":"","preview_highlight":"","lines":0,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"deanimate_gif":"https://files.slack.com/files-tmb/T03C4RC8V-FA4DLM4QL-ed7ce7b396/terminal4_deanimate_gif.png","display_as_bot":false,"has_rich_preview":false,"thumb_480_gif":"https://files.slack.com/files-tmb/T03C4RC8V-FA4DLM4QL-ed7ce7b396/terminal4_480.gif","username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":null},{"type":"message","user":"U03C6TEAZ","text":"term_sendkeys で返すと端末の状態によってはひどいことなるので、やっぱり Vim script とコマンド側で同じ認識のテンポラリファイル名で共有するのが良さそう。","ts":"1523416857.000032","thread_ts":"1523416857.000032","reply_count":5,"replies":[{"user":"U06BRP8VD","ts":"1523418084.000054"},{"user":"U03C6TEAZ","ts":"1523418347.000073"},{"user":"U06BRP8VD","ts":"1523418408.000230"},{"user":"U03C6TEAZ","ts":"1523418508.000076"},{"user":"U06BRP8VD","ts":"1523418530.000005"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","ts":"1523417646.000194","files":[{"id":"FA4QJHUAH","created":1523417642,"timestamp":1523417642,"name":"terminal4.gif","title":"vimdrop","mimetype":"image/gif","image_exif_rotation":1,"filetype":"gif","pretty_type":"GIF","user":"U03C6TEAZ","mode":"hosted","editable":false,"is_external":false,"external_type":"","size":62521,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-FA4QJHUAH/terminal4.gif","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-FA4QJHUAH/download/terminal4.gif","original_h":382,"original_w":642,"thumb_64":"https://files.slack.com/files-tmb/T03C4RC8V-FA4QJHUAH-2fce761570/terminal4_64.png","thumb_80":"https://files.slack.com/files-tmb/T03C4RC8V-FA4QJHUAH-2fce761570/terminal4_80.png","thumb_160":"https://files.slack.com/files-tmb/T03C4RC8V-FA4QJHUAH-2fce761570/terminal4_160.png","thumb_360":"https://files.slack.com/files-tmb/T03C4RC8V-FA4QJHUAH-2fce761570/terminal4_360.png","thumb_360_gif":"https://files.slack.com/files-tmb/T03C4RC8V-FA4QJHUAH-2fce761570/terminal4_360.gif","thumb_360_w":360,"thumb_360_h":214,"thumb_480":"https://files.slack.com/files-tmb/T03C4RC8V-FA4QJHUAH-2fce761570/terminal4_480.png","thumb_480_w":480,"thumb_480_h":286,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U03C6TEAZ/FA4QJHUAH/terminal4.gif","permalink_public":"https://slack-files.com/T03C4RC8V-FA4QJHUAH-f01450e045","edit_link":"","preview":"","preview_highlight":"","lines":0,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"deanimate_gif":"https://files.slack.com/files-tmb/T03C4RC8V-FA4QJHUAH-2fce761570/terminal4_deanimate_gif.png","display_as_bot":false,"has_rich_preview":false,"thumb_480_gif":"https://files.slack.com/files-tmb/T03C4RC8V-FA4QJHUAH-2fce761570/terminal4_480.gif","username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":null},{"type":"message","user":"U03C6TEAZ","text":"ソースです。","ts":"1523417651.000142","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"```\n#!/bin/bash\n\necho -e \"\\x1b]51;$(jo -a drop $@)\\x07\"\n```","ts":"1523417654.000041","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"jo コマンド必須","ts":"1523417659.000110","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"<https://github.com/jpmens/jo>","ts":"1523417671.000022","attachments":[{"fallback":"GitHub: jpmens/jo","id":1,"title":"jpmens/jo","title_link":"https://github.com/jpmens/jo","text":"jo - JSON output from a shell","thumb_url":"https://avatars2.githubusercontent.com/u/60706?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/bfaba/img/unfurl_icons/github.png","thumb_width":250,"thumb_height":250,"from_url":"https://github.com/jpmens/jo"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C71D7H","text":"j で始まる 2 文字の JSON 関連コマンド結構ありそう","ts":"1523417812.000133","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C71D7H","text":"何をするかわからないけど jr とか jt とか作ろう","ts":"1523417830.000090","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"とりあえず --remote 使わずにこれが出来る様になったのは喜ばしい。","ts":"1523417848.000102","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C71D7H","text":"※ただし Vim 内のターミナルに限る","ts":"1523417879.000004","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C71D7H","text":"Vim 外からは相変わらず --remote 的なのが必要","ts":"1523417895.000124","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"コマンド側にUNIXソケットとかでサーバ開いてもらって、そこにJSONとか送ったりするのが正着かしら?","ts":"1523418084.000054","thread_ts":"1523416857.000032","parent_user_id":"U03C6TEAZ","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U78A6ESHM","text":"jr はすでにある模様w <https://github.com/yuya-takeyama/jr>","ts":"1523418125.000183","attachments":[{"fallback":"GitHub: yuya-takeyama/jr","id":1,"title":"yuya-takeyama/jr","title_link":"https://github.com/yuya-takeyama/jr","text":"jr - jq like JSON processor for Rubyists","thumb_url":"https://avatars3.githubusercontent.com/u/241542?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/bfaba/img/unfurl_icons/github.png","thumb_width":250,"thumb_height":250,"from_url":"https://github.com/yuya-takeyama/jr"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C71D7H","text":"ww","ts":"1523418132.000177","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"そうすね。もしくは Tapi の引数で「ここに書け」を渡すか。","ts":"1523418347.000073","thread_ts":"1523416857.000032","parent_user_id":"U03C6TEAZ","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"内側のコマンドを起動する時に、書く場所を指定させるのもありか。webdriverとかでよく見る。","ts":"1523418408.000230","thread_ts":"1523416857.000032","parent_user_id":"U03C6TEAZ","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"ただ前提として tapi のレスポンスを受け取る前に echo が終わってるとめんどくさそう。","ts":"1523418508.000076","thread_ts":"1523416857.000032","parent_user_id":"U03C6TEAZ","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06BRP8VD","text":"ここでも非同期か…","ts":"1523418530.000005","thread_ts":"1523416857.000032","parent_user_id":"U03C6TEAZ","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U8996GYBF","text":"起動時間を計ってみたらGinaのcleaning screenが結構重そう？\nどうにかできないかなー","ts":"1523421847.000112","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C71D7H","text":"<@U776661HA> ↑","ts":"1523422888.000194","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"6ABF6A7C-5ED6-4697-A013-C32A63E57B0D","type":"message","user":"U776661HA","text":"cleaning screen????","ts":"1523424473.000183","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"<https://go-gyazo.appspot.com/1bf0f53784a455e4.png>","ts":"1523424745.000039","attachments":[{"fallback":"617x467px image","id":1,"image_url":"https://go-gyazo.appspot.com/1bf0f53784a455e4.png","blocks":null,"from_url":"https://go-gyazo.appspot.com/1bf0f53784a455e4.png"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"429C50FA-5649-4E5E-9FE3-63EA423648F2","type":"message","user":"U03C4RC8X","text":"なるほどなあ&gt;terminal","ts":"1523426080.000039","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"C758C94F-6D3D-43D1-8027-F6750E8FF7AD","type":"message","user":"U03C4RC8X","text":"jk作ろう","ts":"1523426087.000009","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"0A0D28E6-C284-4014-BBAC-1DF009E079A0","type":"message","user":"U776661HA","text":"それしか思い浮かばなかったw","ts":"1523426123.000253","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U78A6ESHM","text":"jk?w","ts":"1523426171.000303","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"E398C53F-5C8A-4471-B468-D925970B460F","type":"message","user":"U03C4RC8X","text":"ターミナルで前のプロンプトや後のプロンプトにカーソルを移動させる命令をvimに投げてくれるだけのコマンド","ts":"1523426430.000190","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"良く考えたら↑の vimdrop コマンド、フルパスで扱わないと駄目だな。","ts":"1523426847.000011","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C71D7H","text":"realpath かまそう","ts":"1523426878.000251","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U8996GYBF","text":"あ、startuptime.vimってプラグインで計測してみててその項目が何を示すかはよく分からないまま書いてしまいました、すみません","ts":"1523427263.000228","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"@methane","ts":"1523427658.000166","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"予め打っておいて後からリンクになるか確かめるメソッド","ts":"1523427673.000025","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"<@UA4RVLHK7> has joined the channel","ts":"1523428075.000119","subtype":"channel_join","replace_original":false,"delete_original":false,"blocks":null},{"type":"message","user":"U03C6TEAZ","text":"<https://twitter.com/mattn_jp/status/983944956757737472>","ts":"1523428096.000283","attachments":[{"fallback":"<https://twitter.com/mattn_jp|@mattn_jp>: <https://twitter.com/methane|@methane> if_python/if_python3 の件ですが、あの方は configure で PYTHON3_HOME を指定しなくなっけど --with-config-dir を指定してしまってたから問題になっただけで、特に指定しなければよろしく動くはずという認識で良いでしょうか？","id":1,"author_name":"mattn","author_subname":"@mattn_jp","author_link":"https://twitter.com/mattn_jp/status/983944956757737472","author_icon":"https://pbs.twimg.com/profile_images/660456466315276288/yJ8Buj60_normal.png","text":"<https://twitter.com/methane|@methane> if_python/if_python3 の件ですが、あの方は configure で PYTHON3_HOME を指定しなくなっけど --with-config-dir を指定してしまってたから問題になっただけで、特に指定しなければよろしく動くはずという認識で良いでしょうか？","blocks":null,"footer":"Twitter","footer_icon":"https://a.slack-edge.com/80588/img/services/twitter_pixel_snapped_32.png","ts":1523425733,"service_name":"twitter","from_url":"https://twitter.com/mattn_jp/status/983944956757737472"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"このツイートから続く件です。","ts":"1523428106.000253","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"こんにちは","ts":"1523428122.000370","team":"T03C4RC8V","reactions":[{"name":"slow-loris","count":1,"users":["U06BRP8VD"]}],"replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"if_python2/if_python3 を使ってる方、ご意見いただければ。","ts":"1523428124.000177","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"ちょっと僕は小一時間レスが遅くなります。仕事で VM 挙げてる最中なので。","ts":"1523428158.000018","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"背景として、 Homebrew のせいで、 python や python3 が (site や encoding が読めなくて) vim を巻き込んで abort するという痛ましい事故が多発しております。","ts":"1523428197.000341","thread_ts":"1523428197.000341","reply_count":10,"replies":[{"user":"U06BRP8VD","ts":"1523429620.000187"},{"user":"UA4RVLHK7","ts":"1523430178.000174"},{"user":"UA4RVLHK7","ts":"1523430200.000400"},{"user":"U06BRP8VD","ts":"1523430282.000212"},{"user":"UA4RVLHK7","ts":"1523430355.000362"},{"user":"UA4RVLHK7","ts":"1523430367.000472"},{"user":"UA4RVLHK7","ts":"1523430497.000392"},{"user":"UA4RVLHK7","ts":"1523430573.000156"},{"user":"UA4RVLHK7","ts":"1523430636.000235"},{"user":"UA4RVLHK7","ts":"1523430653.000173"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"homebrewはPythonの各バージョンや、Homebrew独自にリビジョンを上げたとき、毎回 Python をインストールするパス (prefix) を変更します。ですが python の実行ファイルや libpython などにはリンクを貼るので、本来はバージョンアップしても利用可能なはずです。","ts":"1523428275.000052","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"Python の prefix は、 python の実行ファイルや libpython に埋め込まれていて、普通に使えば site や encoding が読めなくて死ぬことは無いです。","ts":"1523428329.000030","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U06ECBRTJ","text":"if_python{2,3} は dyn 付きでしょうか","ts":"1523428395.000328","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"ちなみに、 Python 2 が最初に読みに行くライブラリが site モジュールで、 Python 3 は (ioモジュールが標準入出力に使われるなどの関係で) site モジュールよりも先に encoding モジュールが読み込まれます。\nどちらにしろ、Pythonにとって非常に重要なモジュールが読み込めないので abort() しています。","ts":"1523428420.000187","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"いいえ、 /dyn の場合の挙動は未調査です。","ts":"1523428431.000267","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"もし /dyn のときも同じだとしたら、Vimのバイナリ配布を使うユーザーは、Vimをビルドしたユーザーと Python の prefix が異なる場合、 pythondll / pythonthreedll と pythonhome / pythonthreehome の両方を指定しないといけないということになる。","ts":"1523428539.000281","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"話を元に戻すと、 vim が configure 時に python -c 'import sys; print sys.prefix' して得た prefix を -DPYTHON_HOME で if_python.c に渡し、 if_python.c が Py_SetPythonHome() を呼び出しているので、 vim をコンパイルしたときの、 python コマンドの sys.prefix を prefix にするように Python に強制していました。","ts":"1523428735.000024","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"そのため、 Homebrew が Python を更新するたびに、 vim もリビジョン更新して配布しないと、 vim が死にます。","ts":"1523428762.000039","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"ちなみに、この前の Python 3.6.5 の更新で、 vim はリビジョン更新されましたが、 macvim はリビジョン更新されなかったので、現在 homebrew の macvim が死にます。","ts":"1523428801.000008","edited":{"user":"UA4RVLHK7","ts":"1523428830.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"macvim 本家のリリースも同じ理由で死にます。","ts":"1523428816.000111","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"macvim 本家は /dyn だったような。。。。","ts":"1523428857.000313","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"54EF1BA0-A897-4842-A9D7-03222DDA44F4","type":"message","user":"U776661HA","text":"リンクしてるpythonと利用するモジュールのバージョン不一致という認識で正しいですかる","ts":"1523428902.000223","team":"T03C4RC8V","reactions":[{"name":"skull","count":1,"users":["U03C6TEAZ"]}],"replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"不一致と言うか、前のバージョンが消えるので。","ts":"1523428920.000321","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"BB11ECC2-E8F2-45B8-910B-FE7B7316CBD1","type":"message","user":"U776661HA","text":"s/る/?","ts":"1523428921.000091","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"brew upgrade python したら、 3.6.4_2 (だったかな?) が消えて、 3.6.5 が（別のディレクトリに）インストールされるので、","ts":"1523428948.000024","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"3.6.4_2 のときの prefix を SetPythonHome したら、そんなディレクトリ無いので読めません。","ts":"1523428969.000067","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"ということで、最近 homebrew の macvim を使っていた私は、この度めでたく（？）以前から目についていた vim が死ぬ状況を手元に発生させたので、調査して上の原因を突き止めました。","ts":"1523429047.000204","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"<https://github.com/vim/vim/pull/2787>","ts":"1523429059.000346","attachments":[{"fallback":"GitHub: Remove -DPYTHON_HOME and -DPYTHON3_HOME by default by methane · Pull Request #2787 · vim/vim","id":1,"title":"Remove -DPYTHON_HOME and -DPYTHON3_HOME by default by methane · Pull Request #2787 · vim/vim","title_link":"https://github.com/vim/vim/pull/2787","text":"Use Python prefix when python is built, instead of vim is built. This allows upgrading Python without rebuilding Vim, when Python is dynamically linked.","thumb_url":"https://avatars1.githubusercontent.com/u/199592?s=400&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/bfaba/img/unfurl_icons/github.png","thumb_width":250,"thumb_height":250,"from_url":"https://github.com/vim/vim/pull/2787"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U776661HA","ts":"1523429063.000075","files":[{"id":"FA5PFVDDM","created":1523429059,"timestamp":1523429059,"name":"[No Name] - VIM 2018-04-11 15-44-06.png","title":"[No Name] - VIM 2018-04-11 15-44-06.png","mimetype":"image/png","image_exif_rotation":1,"filetype":"png","pretty_type":"PNG","user":"U776661HA","mode":"hosted","editable":false,"is_external":false,"external_type":"","size":336871,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-FA5PFVDDM/_no_name__-_vim_2018-04-11_15-44-06.png","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-FA5PFVDDM/download/_no_name__-_vim_2018-04-11_15-44-06.png","original_h":606,"original_w":1806,"thumb_64":"https://files.slack.com/files-tmb/T03C4RC8V-FA5PFVDDM-33b3caee00/_no_name__-_vim_2018-04-11_15-44-06_64.png","thumb_80":"https://files.slack.com/files-tmb/T03C4RC8V-FA5PFVDDM-33b3caee00/_no_name__-_vim_2018-04-11_15-44-06_80.png","thumb_160":"https://files.slack.com/files-tmb/T03C4RC8V-FA5PFVDDM-33b3caee00/_no_name__-_vim_2018-04-11_15-44-06_160.png","thumb_360":"https://files.slack.com/files-tmb/T03C4RC8V-FA5PFVDDM-33b3caee00/_no_name__-_vim_2018-04-11_15-44-06_360.png","thumb_360_gif":"","thumb_360_w":360,"thumb_360_h":121,"thumb_480":"https://files.slack.com/files-tmb/T03C4RC8V-FA5PFVDDM-33b3caee00/_no_name__-_vim_2018-04-11_15-44-06_480.png","thumb_480_w":480,"thumb_480_h":161,"thumb_720":"https://files.slack.com/files-tmb/T03C4RC8V-FA5PFVDDM-33b3caee00/_no_name__-_vim_2018-04-11_15-44-06_720.png","thumb_720_w":720,"thumb_720_h":242,"thumb_960":"https://files.slack.com/files-tmb/T03C4RC8V-FA5PFVDDM-33b3caee00/_no_name__-_vim_2018-04-11_15-44-06_960.png","thumb_960_w":960,"thumb_960_h":322,"thumb_1024":"https://files.slack.com/files-tmb/T03C4RC8V-FA5PFVDDM-33b3caee00/_no_name__-_vim_2018-04-11_15-44-06_1024.png","thumb_1024_w":1024,"thumb_1024_h":344,"permalink":"https://vim-jp.slack.com/files/U776661HA/FA5PFVDDM/_no_name__-_vim_2018-04-11_15-44-06.png","permalink_public":"https://slack-files.com/T03C4RC8V-FA5PFVDDM-0c1f978fa1","edit_link":"","preview":"","preview_highlight":"","lines":0,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"thumb_800":"https://files.slack.com/files-tmb/T03C4RC8V-FA5PFVDDM-33b3caee00/_no_name__-_vim_2018-04-11_15-44-06_800.png","thumb_800_h":268,"thumb_800_w":800,"username":""}],"upload":true,"replace_original":false,"delete_original":false,"blocks":null},{"type":"message","user":"UA4RVLHK7","text":"そして、 -DPYTHON_HOME を消すというプルリクを送り、一度は取り込まれました。","ts":"1523429083.000067","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U776661HA","text":"とくに何も設定していない状態ですが昔のバージョンが消えることはなさそうなのと macvim は普通に動きました","ts":"1523429087.000245","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"<https://github.com/vim/vim/commit/3a21d9c7bb4d58cccd2152e319daa8f8ffa2e664>\nしかしその後、 一部リバートされました。原因は上のプルリクに動かないという報告をした人が現れたからです。","ts":"1523429136.000444","attachments":[{"fallback":"GitHub: patch 8.0.1692: Python may not work when using statically linked library · vim/vim@3a21d9c","id":1,"title":"patch 8.0.1692: Python may not work when using statically linked library · vim/vim@3a21d9c","title_link":"https://github.com/vim/vim/commit/3a21d9c7bb4d58cccd2152e319daa8f8ffa2e664","text":"Problem: Python may not work when using statically linked library . Solution: Do not define PYTHON_HOME and PYTHON3_HOME in configure if the Python library is linked statically.","thumb_url":"https://avatars1.githubusercontent.com/u/8530623?s=200&v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/bfaba/img/unfurl_icons/github.png","thumb_width":200,"thumb_height":200,"from_url":"https://github.com/vim/vim/commit/3a21d9c7bb4d58cccd2152e319daa8f8ffa2e664"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"昨晩〜今朝にかけてその人を質問攻めにして、その人が --with-python-config-dir に間違った指定をしていたため、\n`-DPYTHON_HOME` ありの状態だと偶然動いていたのが、正常に動かなくなったというところまで突き止めたところです。","ts":"1523429209.000206","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"あぁ、なるほど。","ts":"1523429259.000097","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"僕は `brew upgrade --cleanup` していました。貧乏性なので。","ts":"1523429281.000391","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U776661HA","text":"なるほど","ts":"1523429287.000425","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U776661HA","text":"ただ消えないにせよ不一致する可能性はありますね","ts":"1523429312.000074","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"はい。 Python の標準ライブラリは、ABI互換性が保証されていない Python の内部APIを利用しているので、\n標準ライブラリの一部のモジュールが symbol not found で import できないとか、 segv するとか、\nいろんな問題の原因になりえます。","ts":"1523429355.000106","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U776661HA","text":"というか `PYTHON_HOME` を矯正してるの凄いという感想。行儀が悪い・・・","ts":"1523429384.000260","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U776661HA","text":"（このへんが面倒臭すぎて neovim に移った）","ts":"1523429477.000383","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U776661HA","text":"個人的には最初の修正が正しい気がします。 `PYTHON_HOME` をデフォルトで強制するというのが間違っている感が強いですね","ts":"1523429527.000099","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"個人的には、 -DPYTHON_HOME する必要があるのはごくごく限られたレアケースだと思います。","ts":"1523429535.000063","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"例を挙げると、ビルド済みのPythonを、ビルド時とは違うディレクトリに配置して、それをリンクして利用する場合","ts":"1523429577.000025","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U03C6TEAZ","text":"brew は latest みたいなシンボリックリンクを張ってくれたりしないんですか？","ts":"1523429579.000265","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"91c69bba-032e-4be7-9a09-129034d88966","type":"message","user":"U06BRP8VD","text":"過去にWinでも似たようなことが起こせて、ただレジストリか環境変数で置き場所指定できて回避できた。pythonがライブラリでexitシちゃうのが痛かった。","ts":"1523429620.000187","thread_ts":"1523428197.000341","parent_user_id":"UA4RVLHK7","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"いや、張ってくれますよ。でも vim の configure が `python -c 'import sys; print sys.prefix'` みたいなことしているので、無関係です。","ts":"1523429621.000174","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U776661HA","text":"dyn の場合は python 自体が最新でモジュールが古いままになる。という感じですよね？","ts":"1523429668.000213","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"U776661HA","text":"static なら問題はなさそうですが。そもそも `PYTHON_HOME` を強制上書きしなければ dyn/static どちらでも通常動くという認識ですが正しいですか？","ts":"1523429750.000087","edited":{"user":"U776661HA","ts":"1523429779.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"lrwxr-xr-x  1 inada-n  admin  22  3 30 17:22 /usr/local/opt/python@ -&gt; ../Cellar/python/3.6.5\nlrwxr-xr-x  1 inada-n  admin  34  3 30 17:22 /usr/local/bin/python3@ -&gt; ../Cellar/python/3.6.5/bin/python3","ts":"1523429755.000161","edited":{"user":"UA4RVLHK7","ts":"1523429773.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"&gt; dyn の場合は python 自体が最新でモジュールが古いままになる。という感じですよね？\n\nはい。そして古いバージョンを消したタイミングで abort","ts":"1523429832.000108","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"static なら、 vim と libpython が同一バイナリに共存しているので、本来なら PYTHON_HOME と prefix は同一のはずです。","ts":"1523429875.000223","attachments":[{"color":"D0D0D0","fallback":"[April 11th, 2018 3:55 PM] lambdalisue: static なら問題はなさそうですが。そもそも `PYTHON_HOME` を強制上書きしなければ dyn/static どちらでも通常動くという認識ですが正しいですか？","author_id":"U776661HA","author_name":"lambdalisue","author_subname":"lambdalisue","author_link":"https://vim-jp.slack.com/team/U776661HA","author_icon":"https://secure.gravatar.com/avatar/2be992d8a8cd8b523ca0b1467e165376.jpg?s=48&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0010-48.png","text":"static なら問題はなさそうですが。そもそも `PYTHON_HOME` を強制上書きしなければ dyn/static どちらでも通常動くという認識ですが正しいですか？","mrkdwn_in":["text"],"blocks":null,"footer":"Posted in #random","ts":1523429750.000087,"from_url":"https://vim-jp.slack.com/archives/C03C4RC9F/p1523429750000087"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UA4RVLHK7","text":"ただ、今回の報告者の場合は、 --with-config-dir でリンクする Python を指定していて、 python コマンド経由で PYTHON_HOME が決定されたので、ミスマッチが起きていました。","ts":"1523429942.000313","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"}]
