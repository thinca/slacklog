[{"client_msg_id":"4b9c54e2-8cf5-47a1-8018-f49fe3f6dd93","type":"message","user":"U7EEZ4LMR","text":"Ruby書いててcursorlineを有効にするとめっちゃ遅くて、いろいろ探したら↑の記事にたどり着きました","ts":"1575647116.326400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"r2R"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"86f40869-4a38-4713-ba98-b9ca6d264907","type":"message","user":"UGJG6S9JM","text":"言われるまで mattn 脱却って読んでた","ts":"1575661842.326700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"GpJH"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"21a4a86f-94fa-4f12-a673-8985dd57b332","type":"message","user":"U03C6TEAZ","text":"<@UG6DF6W87> vimtips_ac ?","ts":"1575686802.327400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"KjHID"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"2534e60f-3d82-4546-bce5-892b50e01e3a","type":"message","user":"UG6DF6W87","text":"はいー 12時過ぎ位にかきます!","ts":"1575686882.328600","thread_ts":"1575686882.328600","reply_count":1,"replies":[{"user":"UG6DF6W87","ts":"1575688768.329000"}],"team":"T03C4RC8V","reactions":[{"name":"banjaku","count":1,"users":["U03C6TEAZ"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"BhNFt"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"1f810022-1edc-472c-99fe-d562d6f095b8","type":"message","user":"UG6DF6W87","text":"どね!","ts":"1575688768.329000","thread_ts":"1575686882.328600","parent_user_id":"UG6DF6W87","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"v5=W"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"66aed730-fb34-4a70-96fc-f0774fbb36de","type":"message","user":"UG6DF6W87","text":"ネタが被ってたことに気付いた顔","ts":"1575689032.329800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"yjEx"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"d5282a7b-6333-4602-9758-d20ecdc91065","type":"message","user":"UG6DF6W87","text":"まぁええやろ!!ｶﾞﾊﾊ","ts":"1575689065.330300","thread_ts":"1575689065.330300","reply_count":4,"replies":[{"user":"UG6DF6W87","ts":"1575689258.330700"},{"user":"U7B4ZD49X","ts":"1575689314.331100"},{"user":"UL6CFN8NR","ts":"1575689941.331900"},{"user":"UG6DF6W87","ts":"1575690102.332100"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"G/iqb"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"URFM61BQX","text":"<@URFM61BQX> has joined the channel","ts":"1575689245.330500","subtype":"channel_join","replace_original":false,"delete_original":false,"blocks":null},{"client_msg_id":"367ef503-caf6-4176-8988-eac6973623ee","type":"message","user":"UG6DF6W87","text":"つらひ...","ts":"1575689258.330700","thread_ts":"1575689065.330300","parent_user_id":"UG6DF6W87","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"QpBjg"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"4fdb5d40-fe4c-440c-8dd5-17650d8bba93","type":"message","user":"U03C71D7H","text":"welcome","ts":"1575689312.331000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ECq/"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a50ce49d-9547-4dd7-b91b-a50ef59b21df","type":"message","user":"U7B4ZD49X","text":"コマンドラインモード推しな12/7","ts":"1575689314.331100","thread_ts":"1575689065.330300","parent_user_id":"UG6DF6W87","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"wfe"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"10575ae0-38a0-443e-ab2b-7f15708abcd1","type":"message","user":"U7B4ZD49X","text":"hi","ts":"1575689349.331800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"0oYY"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"003167a6-dc07-4f94-a273-6e6e82f03400","type":"message","user":"UL6CFN8NR","text":"おお...すいません...","ts":"1575689941.331900","thread_ts":"1575689065.330300","parent_user_id":"UG6DF6W87","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"9ev"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"8d3f4035-dad0-4dd1-b582-1e76987cb6b1","type":"message","user":"UG6DF6W87","text":"いえこちらこそすいません...\n今日の更新分確認してから書けばよかった","ts":"1575690102.332100","thread_ts":"1575689065.330300","parent_user_id":"UG6DF6W87","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"DjO07"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"E031A0C7-8BC7-4C6D-B214-FF6D6C9FA08F","type":"message","user":"URFM61BQX","text":"Vim好きです、よろしくお願い致します。","ts":"1575691177.333100","team":"T03C4RC8V","reactions":[{"name":"yokoso","count":20,"users":["U9S4G0LJW","U782D5DF1","UL6CFN8NR","UG6DF6W87","U06BRP8VD","UFP0GQZ4K","U77U7B85A","UEB130KJN","U03C6TEAZ","U7B4ZD49X","U72TB62UF","UGYM5NT2T","UQL6475CG","UK37RG2VC","UGMLBL4NN","U03C71D7H","U8CC7MDCL","U0M7GCBPD","UJQ0V9SJW","U7X6YCBAM"]}],"replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"1880751b-fac0-49dc-8ffb-fbda9ae16570","type":"message","user":"U782D5DF1","text":"hi","ts":"1575691201.333300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"D/So4"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"03687702-0270-45fe-bc6e-db17257fe91b","type":"message","user":"UAZ33BKV2","text":"hi","ts":"1575691229.333700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"r13J"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"URFMYGANB","text":"<@URFMYGANB> has joined the channel","ts":"1575694490.334500","subtype":"channel_join","reactions":[{"name":"blob_tada","count":3,"users":["URFM61BQX","U03C6TEAZ","U7X6YCBAM"]}],"replace_original":false,"delete_original":false,"blocks":null},{"type":"message","user":"UR13L3VT4","text":"<@UR13L3VT4> has joined the channel","ts":"1575697845.335300","subtype":"channel_join","replace_original":false,"delete_original":false,"blocks":null},{"type":"message","user":"URG3C6014","text":"<@URG3C6014> has joined the channel","ts":"1575698213.335700","subtype":"channel_join","replace_original":false,"delete_original":false,"blocks":null},{"type":"message","user":"URDDANJBE","text":"<@URDDANJBE> has joined the channel","ts":"1575698974.336000","subtype":"channel_join","replace_original":false,"delete_original":false,"blocks":null},{"client_msg_id":"25AA2027-7B70-4ED2-AC64-2BCA9AC7CE46","type":"message","user":"UBQ2H65JQ","text":"readfile()の第三引数、blobの場合もmax行数なのか。","ts":"1575715603.338000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"E0F47C1A-06C9-4571-B584-4F7DFC50D077","type":"message","user":"UBQ2H65JQ","text":"最大bytesにしたいなぁ","ts":"1575715618.338500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"ecf93a33-885e-420e-b554-fe0911b14ca8","type":"message","user":"UAZ33BKV2","text":"bつかっちゃってますしフラグ追加も微妙でしょうかね...","ts":"1575716483.339000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ZL7"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"B653053B-876D-4ABF-9420-A68176EE3D87","type":"message","user":"UBQ2H65JQ","text":":h readfile()","ts":"1575716524.339400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null,"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"UPZHKAM7W","text":"```\n                                                        *readfile()*\nreadfile({fname} [, {type} [, {max}]])\n                ファイル{fname}を読み込み、各行を要素とするリスト|List|を返す。\n                行はNL文字で終わるものとする。改行文字がCRであるMacintoshのファ\n                イルは単一の長い行となる(どこかにNLが現れない限り)。\n                すべての NUL 文字は NL 文字に置換される。\n                {type}が \"b\" を含む場合、次のようにバイナリモードになる:\n                - 最後の行がNLで終わるときは、リストの末尾に余分な空文字列が追\n                  加される。\n                - CR文字を除去しない。\n                {type}が \"B\" を含む場合、ファイルのバイナリデータは変更せずに\n                |Blob| が返される。\n                その他の場合:\n                - NLの前に現れるCR文字を除去する。\n                - 最後の行がNLで終わるかどうかは関係ない。\n                - 'encoding' がUnicodeのときは UTF-8 のバイトオーダーマークは\n                  取り除かれる。\n                {max}を指定すると、読み込む行数の最大値となる。ファイルの最初\n                の10行をチェックするときに役に立つ:  \n                        :for line in readfile(fname, '', 10)\n                        :  if line =~ 'Date' | echo line | endif\n                        :endfor\n                {max}が負の場合は、ファイルの最後から-{max}行を読み込んで返す。\n                ファイルが{max}行以下の場合は全行を返す。\n                {max}が0の場合は空リストを返す。\n                Note {max}を指定しない場合はファイル全体をメモリに読み込む。エ\n                ンコーディング判定も行わないことに注意。必要ならバッファに読み\n                込むこと。\n                ファイルを開けないときはエラーメッセージを表示し、空リストを返\n                す。\n                |writefile()|も参照。\n \n                |method| としても使用できる:  \n                        GetFileName()-&gt;readfile()\n```","ts":"1575716525.339500","bot_id":"BPM858KEE","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null},{"type":"message","user":"UR16921R8","text":"<@UR16921R8> has joined the channel","ts":"1575717212.339700","subtype":"channel_join","replace_original":false,"delete_original":false,"blocks":null},{"type":"message","user":"URE0NT893","text":"<@URE0NT893> has joined the channel","ts":"1575721026.340100","subtype":"channel_join","replace_original":false,"delete_original":false,"blocks":null},{"type":"message","user":"UR2G934FM","text":"<@UR2G934FM> has joined the channel","ts":"1575722581.340400","subtype":"channel_join","replace_original":false,"delete_original":false,"blocks":null},{"client_msg_id":"c401177b-c4e1-4e7c-abdc-8c9b1ba353da","type":"message","user":"U03C6TEAZ","text":"contribute チャンス","ts":"1575723200.340700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"XPm6"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a2881f01-2234-4e94-9e09-cfbeb7923259","type":"message","user":"U03C6TEAZ","text":"多分意識してない。","ts":"1575723205.340900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"+sz"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"db0e92f6-e5a9-4d71-9c11-3b10a0df8edf","type":"message","user":"U03C6TEAZ","text":"blob の時は行数見てないと思う。","ts":"1575723352.341200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"+X2"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"6f6eb776-55fa-4b67-ad08-67aed74a0de0","type":"message","user":"U03C6TEAZ","text":"ソースより。","ts":"1575723355.341400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"KzjML"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"d2972222-51ac-4d21-b409-165e953854e2","type":"message","user":"UBQ2H65JQ","text":"見てないですね。こうなってくると読み込むオフセットも欲しくなってくるw","ts":"1575724341.342200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"L/k"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"22970e98-67a0-4c36-8110-80cc64c76c91","type":"message","user":"U03C71D7H","text":"ch_read 系も読み込むバイト数とか指定できないな","ts":"1575724575.342600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Pap"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"324af46d-54a1-4ab8-ae63-c442bbbf5441","type":"message","user":"UBQ2H65JQ","text":"いまさらreadfile()の第三引数の仕様を変えるわけにもいかないし、blobの場合、読み込む最大bytes数はありかな？","ts":"1575724803.343800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"4k9"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"6ada6687-c5b9-4763-8e72-5a1acba48c83","type":"message","user":"U03C71D7H","text":"`'B'` の場合に第3引数が無視されてるとかであればワンチャンだけど","ts":"1575724840.344200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"EFIax"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"5b549ab5-a092-4630-90ad-0d7ecda498fb","type":"message","user":"UBQ2H65JQ","text":"いまは無視されてますね","ts":"1575724858.344500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"wkv"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a1c56c05-9cfb-451f-a7ce-5f644710d3a8","type":"message","user":"UBQ2H65JQ","text":"`'B'`  (Blob)の場合","ts":"1575724877.344900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"SWd"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"ba4e48a8-16de-4eb1-8b45-ce1851df6265","type":"message","user":"UBQ2H65JQ","text":"個人的に投げるかどうか迷うところ。でもヘルプに現状無視しているよって記載は欲しいですね","ts":"1575724951.346000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"wER"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"51a51e16-09bf-42b9-9632-4c8589b5404d","type":"message","user":"U03C6TEAZ","text":"getfsize() であらかじめサイズ調べておくとかではだめ？","ts":"1575725413.346500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"j9+"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"8205f417-bf21-4924-94a0-c92607829235","type":"message","user":"U03C6TEAZ","text":"それとも少しずつ読みたいとか？","ts":"1575725433.346900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"n3Not"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"825b9ef2-1e94-4891-adc0-7ecdeed5481d","type":"message","user":"UBQ2H65JQ","text":"今のところ、特に使う理由はないから迷っている感じです。\n```--- a/src/proto/blob.pro\n+++ b/src/proto/blob.pro\n@@ -9,7 +9,7 @@ long blob_len(blob_T *b);\n int blob_get(blob_T *b, int idx);\n void blob_set(blob_T *b, int idx, char_u c);\n int blob_equal(blob_T *b1, blob_T *b2);\n-int read_blob(FILE *fd, blob_T *blob);\n+int read_blob(FILE *fd, blob_T *blob, long maxbytes);\n int write_blob(FILE *fd, blob_T *blob);\n char_u *blob2string(blob_T *blob, char_u **tofree, char_u *numbuf);\n blob_T *string2blob(char_u *str);\n--- a/src/filepath.c\n+++ b/src/filepath.c\n@@ -1413,6 +1413,7 @@ f_readfile(typval_T *argvars, typval_T *rettv)\n     long\tprevlen  = 0;\t\t// length of data in prev\n     long\tprevsize = 0;\t\t// size of prev buffer\n     long\tmaxline  = MAXLNUM;\n+    long\tmaxbytes  = -1;\n     long\tcnt\t = 0;\n     char_u\t*p;\t\t\t// position in buf\n     char_u\t*start;\t\t\t// start of current line\n@@ -1425,7 +1426,10 @@ f_readfile(typval_T *argvars, typval_T *rettv)\n \t    blob = TRUE;\n \n \tif (argvars[2].v_type != VAR_UNKNOWN)\n-\t    maxline = (long)tv_get_number(&amp;argvars[2]);\n+\t    if (blob)\n+\t\tmaxbytes = (long)tv_get_number(&amp;argvars[2]);\n+\t    else\n+\t\tmaxline = (long)tv_get_number(&amp;argvars[2]);\n     }\n \n     if (blob)\n@@ -1450,7 +1454,7 @@ f_readfile(typval_T *argvars, typval_T *rettv)\n \n     if (blob)\n     {\n-\tif (read_blob(fd, rettv-&gt;vval.v_blob) == FAIL)\n+\tif (read_blob(fd, rettv-&gt;vval.v_blob, maxbytes) == FAIL)\n \t{\n \t    emsg(\"cannot read file\");\n \t    blob_free(rettv-&gt;vval.v_blob);\n--- a/src/blob.c\n+++ b/src/blob.c\n@@ -163,7 +163,7 @@ blob_equal(\n  * Return OK or FAIL.\n  */\n     int\n-read_blob(FILE *fd, blob_T *blob)\n+read_blob(FILE *fd, blob_T *blob, long maxbytes)\n {\n     struct stat\tst;\n \n@@ -171,7 +171,10 @@ read_blob(FILE *fd, blob_T *blob)\n \treturn FAIL;\n     if (ga_grow(&amp;blob-&gt;bv_ga, st.st_size) == FAIL)\n \treturn FAIL;\n-    blob-&gt;bv_ga.ga_len = st.st_size;\n+    if (-1 != maxbytes)\n+\tblob-&gt;bv_ga.ga_len = maxbytes;\n+    else\n+\tblob-&gt;bv_ga.ga_len = st.st_size;\n     if (fread(blob-&gt;bv_ga.ga_data, 1, blob-&gt;bv_ga.ga_len, fd)\n \t\t\t\t\t\t  &lt; (size_t)blob-&gt;bv_ga.ga_len)\n \treturn FAIL;```","ts":"1575725725.348100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"fqr/k"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"e77075fb-4f73-48c3-884c-0c5140032cc5","type":"message","user":"UBQ2H65JQ","text":"だれかが必要になった時までほっておいてもいいかなぁーっと","ts":"1575725783.348600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"SbZ"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"type":"message","user":"USLACKBOT","text":"Reminder: vimrc読書会はじまるのでは <https://gitter.im/vim-jp/reading-vimrc>","ts":"1575726631.348700","bot_id":"B01","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":null}]
