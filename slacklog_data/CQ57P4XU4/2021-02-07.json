[{"client_msg_id":"69459e72-8d8d-44a2-a158-fb1928cdbf67","type":"message","user":"U7H4TJEG0","text":"\u003chttps://github.com/mattn/vim-lsp-settings/pull/387\u003e とりあえずPR投げた","ts":"1612706552.076700","attachments":[{"fallback":"GitHub: Fix duplicate command error on re-sourcing settings scripts by itchyny · Pull Request #387 · mattn/vim-lsp-settings","id":1,"title":"Fix duplicate command error on re-sourcing settings scripts by itchyny · Pull Request #387 · mattn/vim-lsp-settings","title_link":"https://github.com/mattn/vim-lsp-settings/pull/387","text":"Recently in the commit 90d5216, gopls setting file is sourced on both *.go and go.mod. But when I open a go.mod file open a example.go file, I get the following error. Error detected while proces...","thumb_url":"https://avatars.githubusercontent.com/u/10111?s=400\u0026v=4","blocks":null,"service_name":"GitHub","service_icon":"https://a.slack-edge.com/80588/img/unfurl_icons/github.png","thumb_width":400,"thumb_height":400,"from_url":"https://github.com/mattn/vim-lsp-settings/pull/387","original_url":"https://github.com/mattn/vim-lsp-settings/pull/387"}],"team":"T03C4RC8V","reactions":[{"name":"+1","count":1,"users":["U78A6ESHM"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Mwb"}]},{"client_msg_id":"27b754b7-928a-40e7-bd56-fcbb37967308","type":"message","user":"U7H4TJEG0","text":"同じファイルをsourceしたらスクリプト変数再度初期化されちゃうからかな\n```diff\ndiff --git a/settings/gopls.vim b/settings/gopls.vim\nindex bca59da..8dc69bc 100644\n--- a/settings/gopls.vim\n+++ b/settings/gopls.vim\n@@ -22,9 +22,8 @@ augroup vim_lsp_settings_gopls\n   autocmd User lsp_setup call s:register_command()\n augroup END\n \n-let s:setup = 0\n function! s:register_command() abort\n-    if s:setup == 1 | return | endif\n+    if get(s:, 'setup') | return | endif\n     let s:setup = 1\n     call lsp#register_command('gopls.test', function('s:gopls_test'))\n     call lsp#register_command('gopls.generate', function('s:gopls_generate'))```\nこれで手元では直る (が同じスクリプトをsourceしないほうが良いのかな？)","ts":"1612691028.076100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"KnX"}]},{"client_msg_id":"EB55B102-937E-458C-9AF0-71FBF7BFF0E7","type":"message","user":"UJV04G927","text":"同じエラー出てます…\ngo.modでgopls使うようになったタイミングから出てる気はしてます","ts":"1612690592.074300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"tA8kk"}]},{"client_msg_id":"0248d72b-40b2-4276-982b-34ac7a51c9c8","type":"message","user":"U7H4TJEG0","text":"vim-lsp-settingsがおかしいのか自分の設定がおかしいのか調査中…","ts":"1612690094.072700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"tB3Vh"}]},{"client_msg_id":"203dfc46-e043-4399-a875-c70eaad91523","type":"message","user":"U7H4TJEG0","text":"最近 go.mod を開いてから .go のファイルを開くと以下のようなエラーが出る気がする\n```Error detected while processing function \u0026lt;lambda\u0026gt;62[1]..BufRead Autocommands for \"*.go\"..FileType Autocommands for \"go\"..function \u0026lt;SNR\u0026gt;76_vim_lsp_load_or_suggest[105]..User Autocommands for \"lsp_setup\"..function \u0026lt;SNR\u0026gt;134_register_command[5]..lsp#register_command[1]..lsp#ui#vim#execute_command#_register[2]..function \u0026lt;lambda\u0026gt;62[1]..BufRead Autocommands for \"*.go\"..FileType Autocommands for \"go\"..function \u0026lt;SNR\u0026gt;76_vim_lsp_load_or_suggest[105]..User Autocommands for \"lsp_setup\"..function \u0026lt;SNR\u0026gt;134_register_command[5]..lsp#register_command[1]..lsp#ui#vim#execute_command#_register:\nline    2:\nE605: Exception not caught: lsp#ui#vim#execute_command#_register_command: gopls.test already registered.```","ts":"1612690057.072400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"uB8s"}]}]
