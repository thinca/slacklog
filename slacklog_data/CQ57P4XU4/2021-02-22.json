[{"client_msg_id":"9037c140-7413-436e-b248-4f5e83bd1e9d","type":"message","user":"U01BY3SDBRS","text":"うわ、普通に読みこんだら結構待つじゃん、みたいな\n高速なwasmのjsonパーサをご存知の方とかいらしたらそれでまたトライしてみたいなあとは思っているんですが","ts":"1613972145.102700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"c2bUk"}]},{"client_msg_id":"f68df667-2001-4bfa-a5d1-45a1c582bd73","type":"message","user":"U01BY3SDBRS","text":"そのあたりのファイルの読み込みの高速化の技術が無い人間なのでそこで諦めてしまいました","ts":"1613971898.100200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Y4PB"}]},{"client_msg_id":"2a22ecba-4879-4302-b06c-cc3d07773871","type":"message","user":"U06BRP8VD","text":"JSONでもJSONL的にしてソートしてあれば、ざっくり二分探査はできるんですけど、まぁそれでもなかなかねw","ts":"1613971492.096600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"AnP0"}]},{"client_msg_id":"bd3488ab-a176-4576-a0c2-7009c1ffa232","type":"message","user":"U01BY3SDBRS","text":"出力にdbをつかってるのもあった気がしますがlsifの拡張子のファイルはまんまjsonでした、一度全部読みこんでTreeを作ってから処理しないといけない気がしますがどうなんでしょう？","ts":"1613971234.095400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"R7g"}]},{"client_msg_id":"2c1a697d-ca59-4f80-941c-3696bc126065","type":"message","user":"U07UN10M8","text":"lsifのコードジャンプ、まさにsourcegraphあたりがそのために作ったんじゃなかったかな？\u003chttps://docs.sourcegraph.com/code_intelligence/explanations/precise_code_intelligence|https://docs.sourcegraph.com/code_intelligence/explanations/precise_code_intelligence\u003e","ts":"1613960063.092600","team":"T03C4RC8V","reactions":[{"name":"eyes","count":3,"users":["U06BRP8VD","UEB0VGD7E","U01BY3SDBRS"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"T2A=h"}]},{"client_msg_id":"f9556271-19b0-40cc-a1c3-707ad64afeba","type":"message","user":"U06BRP8VD","text":"もしかして…これってJSONまんま入ってるだけでRDBMS的なindexはないの?","ts":"1613958391.091600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"6ayR"}]},{"client_msg_id":"139beabe-07e2-4ad0-8225-d81dcf9a08de","type":"message","user":"U06BRP8VD","text":"インデックスとしてちゃんと機能する(部分的にseekで読める)のか、それを取り扱うライブラリが各言語にあるのか、のほうが重要。極論、高速に部分的に読めるならファイルサイズは数GBになっても良いのですよ。","ts":"1613958314.091100","team":"T03C4RC8V","reactions":[{"name":"naruhodo","count":1,"users":["U01BY3SDBRS"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"qNhw2"}]},{"client_msg_id":"e379beca-36be-4b06-99f5-ffba53c86da7","type":"message","user":"U06BRP8VD","text":"ぶっちゃけ行数にあんま意味はない。","ts":"1613958199.089400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"txeOR"}]},{"client_msg_id":"17812f4c-300a-4545-99cd-d3c185d83c19","type":"message","user":"U06BRP8VD","text":"10万行だとサイズ的には数百KB～数MBでしょ? LSPサーバが抱えるメモリ量に比べて大きいとも言えないよ。","ts":"1613958161.089200","team":"T03C4RC8V","reactions":[{"name":"naruhodo","count":1,"users":["U01BY3SDBRS"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Ygo5"}]},{"client_msg_id":"b6aae087-9a80-478a-b7f5-34323db2bb2d","type":"message","user":"U01BY3SDBRS","text":"lsif興味があって「これとlsifの処理系があればgithubのコードジャンプとかできそう」って思っていたんですが、lsif-goかなにかで生成したlsifファイルの大きさが10万行とかになってぐんにゃりした記憶があります","ts":"1613957518.088000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"z/PY"}]},{"client_msg_id":"3567eade-6739-4e00-ba30-98a223a42471","type":"message","user":"U06BRP8VD","text":"genericなtagsファイルみたいなものをLSPの一部(?)として定義しようとしてる。","ts":"1613926471.084200","edited":{"user":"U06BRP8VD","ts":"1613926479.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"o3lsI"}]},{"client_msg_id":"3aa0b0ae-3040-4d1a-96a8-723ade48bec7","type":"message","user":"U06BRP8VD","text":"さっき犬さんがtwitterで紹介してたLSIFがちょっと面白そう。\n\u003chttps://microsoft.github.io/language-server-protocol/specifications/lsif/0.5.0/specification/\u003e","ts":"1613926393.083500","attachments":[{"fallback":"LSIF Specification","id":1,"title":"LSIF Specification","title_link":"https://microsoft.github.io/language-server-protocol/specifications/lsif/0.5.0/specification/","text":"Under ConstructionThe 0.5.0 version of LSIF is currently under construction.Language Server Index FormatThe purpose of the Language Server Index Format (LSIF...","blocks":null,"service_name":"microsoft.github.io","service_icon":"https://microsoft.github.io/language-server-protocol/img/favicon.png","from_url":"https://microsoft.github.io/language-server-protocol/specifications/lsif/0.5.0/specification/","original_url":"https://microsoft.github.io/language-server-protocol/specifications/lsif/0.5.0/specification/"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"8=g"}]},{"type":"message","user":"UDPT2BZ6E","text":"Content-Lengthに沿って標準入力から入力が取れるようになりました :tada:","ts":"1613924688.082600","files":[{"id":"F01P0BYQ3FE","created":1613924663,"timestamp":1613924663,"name":"Screenshot_2021-02-22_01-24-06.png","title":"Screenshot_2021-02-22_01-24-06.png","mimetype":"image/png","image_exif_rotation":0,"filetype":"png","pretty_type":"PNG","user":"UDPT2BZ6E","mode":"hosted","editable":false,"is_external":false,"external_type":"","size":29126,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F01P0BYQ3FE/screenshot_2021-02-22_01-24-06.png","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F01P0BYQ3FE/download/screenshot_2021-02-22_01-24-06.png","original_h":468,"original_w":590,"thumb_64":"https://files.slack.com/files-tmb/T03C4RC8V-F01P0BYQ3FE-a0c07e3732/screenshot_2021-02-22_01-24-06_64.png","thumb_80":"https://files.slack.com/files-tmb/T03C4RC8V-F01P0BYQ3FE-a0c07e3732/screenshot_2021-02-22_01-24-06_80.png","thumb_160":"https://files.slack.com/files-tmb/T03C4RC8V-F01P0BYQ3FE-a0c07e3732/screenshot_2021-02-22_01-24-06_160.png","thumb_360":"https://files.slack.com/files-tmb/T03C4RC8V-F01P0BYQ3FE-a0c07e3732/screenshot_2021-02-22_01-24-06_360.png","thumb_360_gif":"","thumb_360_w":360,"thumb_360_h":286,"thumb_480":"https://files.slack.com/files-tmb/T03C4RC8V-F01P0BYQ3FE-a0c07e3732/screenshot_2021-02-22_01-24-06_480.png","thumb_480_w":480,"thumb_480_h":381,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/UDPT2BZ6E/F01P0BYQ3FE/screenshot_2021-02-22_01-24-06.png","permalink_public":"https://slack-files.com/T03C4RC8V-F01P0BYQ3FE-3292cc111f","edit_link":"","preview":"","preview_highlight":"","lines":0,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"thumb_tiny":"AwAmADCpk+35Uhz1zSjGOTzSGgAyfWjJ9aSigAooooAd+B/Kk/D9KUcjNIaADP0ozRikoAXNJRRQA4/KxGTwaTj3pX/1jfU02gBePejikooAXj3o496SigD/2Q==","username":""}],"reactions":[{"name":"wa-wa-1","count":4,"users":["U78A6ESHM","U9S4G0LJW","UFHQ7TNT0","U01BY3SDBRS"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"pemJ"}]},{"type":"message","user":"UDPT2BZ6E","text":"ヘッダーの解釈ができるようになりました :tada:","ts":"1613923474.082000","files":[{"id":"F01NU6LABGA","created":1613923458,"timestamp":1613923458,"name":"Screenshot_2021-02-22_01-04-00.png","title":"Screenshot_2021-02-22_01-04-00.png","mimetype":"image/png","image_exif_rotation":0,"filetype":"png","pretty_type":"PNG","user":"UDPT2BZ6E","mode":"hosted","editable":false,"is_external":false,"external_type":"","size":23114,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F01NU6LABGA/screenshot_2021-02-22_01-04-00.png","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F01NU6LABGA/download/screenshot_2021-02-22_01-04-00.png","original_h":360,"original_w":510,"thumb_64":"https://files.slack.com/files-tmb/T03C4RC8V-F01NU6LABGA-e87bdb03cc/screenshot_2021-02-22_01-04-00_64.png","thumb_80":"https://files.slack.com/files-tmb/T03C4RC8V-F01NU6LABGA-e87bdb03cc/screenshot_2021-02-22_01-04-00_80.png","thumb_160":"https://files.slack.com/files-tmb/T03C4RC8V-F01NU6LABGA-e87bdb03cc/screenshot_2021-02-22_01-04-00_160.png","thumb_360":"https://files.slack.com/files-tmb/T03C4RC8V-F01NU6LABGA-e87bdb03cc/screenshot_2021-02-22_01-04-00_360.png","thumb_360_gif":"","thumb_360_w":360,"thumb_360_h":254,"thumb_480":"https://files.slack.com/files-tmb/T03C4RC8V-F01NU6LABGA-e87bdb03cc/screenshot_2021-02-22_01-04-00_480.png","thumb_480_w":480,"thumb_480_h":339,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/UDPT2BZ6E/F01NU6LABGA/screenshot_2021-02-22_01-04-00.png","permalink_public":"https://slack-files.com/T03C4RC8V-F01NU6LABGA-f71ef47dec","edit_link":"","preview":"","preview_highlight":"","lines":0,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"thumb_tiny":"AwAhADCofqaTPvS5PvRz70AJn0NGT60ZzSUALk+tJRRQA7I9DRx6Glx2wfzpDz0z+dACYHoaMD0NHP8Ak0c/5NAB9AaKORSUAOl/1r/U02nS/wCtf6mm0AFFFFABRRRQB//Z","username":""}],"reactions":[{"name":"sugoi","count":3,"users":["U78A6ESHM","U9S4G0LJW","U01BY3SDBRS"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"vG0R4"}]},{"client_msg_id":"0dd6e219-4e50-4299-809b-924f4c51ae8f","type":"message","user":"U03C71D7H","text":"(まああくまで ※個人の感想です)","ts":"1613923226.081800","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"jZUmj"}]},{"client_msg_id":"43079c50-851f-4d89-9c5f-6eb7d09fd9a2","type":"message","user":"U03C71D7H","text":"事前にメモリの確保ができないという点では `\\r\\n\\r\\n` を受け取るまで受信し続けなさいとそこまで変わらないんですよね。\n仕様を独自拡張するのであれば、「JSON には改行を含めてはならず、改行でメッセージを区切ることとする」の方が実装者からするとよほど親切。","ts":"1613923041.081500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"n4B"}]},{"client_msg_id":"7b199e7a-69fa-4822-964a-90250a6d959b","type":"message","user":"U03C6TEAZ","text":"JSON 的に valid になるまで受信し続けなさいというのは、ちょっと不親切な仕様。","ts":"1613921754.079700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"SyX6"}]},{"client_msg_id":"6c8f8325-70a3-4c86-b0b0-0b2cda84b087","type":"message","user":"U03C6TEAZ","text":"\u003chttp://json.org|json.org\u003e では whitespace はこう定義されてる。","ts":"1613921719.079300","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Or8Z"}]},{"type":"message","user":"U03C6TEAZ","ts":"1613921712.078800","files":[{"id":"F01NR3CAEN9","created":1613921710,"timestamp":1613921710,"name":"image.png","title":"image.png","mimetype":"image/png","image_exif_rotation":0,"filetype":"png","pretty_type":"PNG","user":"U03C6TEAZ","mode":"hosted","editable":false,"is_external":false,"external_type":"","size":4929,"url":"","url_download":"","url_private":"https://files.slack.com/files-pri/T03C4RC8V-F01NR3CAEN9/image.png","url_private_download":"https://files.slack.com/files-pri/T03C4RC8V-F01NR3CAEN9/download/image.png","original_h":200,"original_w":254,"thumb_64":"https://files.slack.com/files-tmb/T03C4RC8V-F01NR3CAEN9-737a7ccb51/image_64.png","thumb_80":"https://files.slack.com/files-tmb/T03C4RC8V-F01NR3CAEN9-737a7ccb51/image_80.png","thumb_160":"https://files.slack.com/files-tmb/T03C4RC8V-F01NR3CAEN9-737a7ccb51/image_160.png","thumb_360":"https://files.slack.com/files-tmb/T03C4RC8V-F01NR3CAEN9-737a7ccb51/image_360.png","thumb_360_gif":"","thumb_360_w":254,"thumb_360_h":200,"thumb_480":"","thumb_480_w":0,"thumb_480_h":0,"thumb_720":"","thumb_720_w":0,"thumb_720_h":0,"thumb_960":"","thumb_960_w":0,"thumb_960_h":0,"thumb_1024":"","thumb_1024_w":0,"thumb_1024_h":0,"permalink":"https://vim-jp.slack.com/files/U03C6TEAZ/F01NR3CAEN9/image.png","permalink_public":"https://slack-files.com/T03C4RC8V-F01NR3CAEN9-998ebd7d26","edit_link":"","preview":"","preview_highlight":"","lines":0,"lines_more":0,"is_public":true,"public_url_shared":false,"channels":null,"groups":null,"ims":null,"initial_comment":{},"comments_count":0,"num_stars":0,"is_starred":false,"shares":{"public":null,"private":null},"display_as_bot":false,"has_rich_preview":false,"thumb_tiny":"AwAlADC//wAth/un+YqQkDqcVH/y2H+6f5insqt94A4oAXrRSHjABAFLketABRRRQBH/AMth/un+YqSo/wDlsP8AdP8AMVJQA1xkfd3e1NQYP3NvvmnSDK9CfpTEX5vuEfU0wFjXDH5Nv41JUcYAY/Kw+tSUgI2BDBlIHGORSbpPVf8Avn/69Oam0hhuk9V/75/+vRuk9V/75/8Ar0UUAG6T1X/vn/69G6T1X/vn/wCvRRQB/9k=","username":""}],"replace_original":false,"delete_original":false,"blocks":null},{"client_msg_id":"efcb79c1-facd-4a56-93c3-28ba9dcad92d","type":"message","user":"U03C6TEAZ","text":"JSON 自体がトークン間に改行を含められるので、Content-Length が無いと受取側はどんだけ受け取ったらいいか分からないし、謎仕様ではないですね。","ts":"1613921685.078600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"ahM8P"}]},{"client_msg_id":"84230854-5fca-488c-9718-896cc0097bd6","type":"message","user":"U78A6ESHM","text":"payload に入れるみたいですね。\nvim-lsp だとこう送ってます。\n```let l:payload = 'Content-Length: ' . len(l:json) . \"\\r\\n\\r\\n\" . l:json\n\n    call lsp#utils#job#send(a:id, l:payload)```","ts":"1613920462.077400","team":"T03C4RC8V","reactions":[{"name":"kanzenrikai","count":1,"users":["UDPT2BZ6E"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"XLoQ2"}]},{"client_msg_id":"182cc4a9-a4cb-4436-b2b2-70f2ea622bac","type":"message","user":"UDPT2BZ6E","text":"リクエストは必ず「Content-Length」から始まる。。？\n\u003chttps://microsoft.github.io/language-server-protocol/specifications/specification-current/#contentPart\u003e","ts":"1613920281.076800","attachments":[{"fallback":"Specification","id":1,"title":"Specification","title_link":"https://microsoft.github.io/language-server-protocol/specifications/specification-current/#contentPart","text":"Language Server Protocol Specification - 3.16","blocks":null,"service_name":"microsoft.github.io","service_icon":"https://microsoft.github.io/language-server-protocol/img/favicon.png","from_url":"https://microsoft.github.io/language-server-protocol/specifications/specification-current/#contentPart","original_url":"https://microsoft.github.io/language-server-protocol/specifications/specification-current/#contentPart"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"rr2"}]},{"client_msg_id":"8cce09f1-09e5-42a7-aa7a-d46cdf8d9fa4","type":"message","user":"UDPT2BZ6E","text":"\u003chttps://www.simple-is-better.org/json-rpc/transport_http.html\u003e :eyes:","ts":"1613919925.076600","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"wWP8Q"}]},{"client_msg_id":"65dd61fe-da6d-4d71-af96-63ef8ad3cadf","type":"message","user":"UDPT2BZ6E","text":"POSTリクエストっぽいものを標準入力で待ち受けるプログラムになる感じでしょうか。。？","ts":"1613919898.076400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"xfjns"}]},{"client_msg_id":"6f34d8f7-4327-487f-b6f4-bb0dcb6af96e","type":"message","user":"UDPT2BZ6E","text":"どうやってつけるのでしょう。ヘッダーでしょうか？","ts":"1613919855.076100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"MeQbE"}]},{"client_msg_id":"23f5253e-e76b-4627-ad3f-f4b85f79cd34","type":"message","user":"U03C71D7H","text":"LSP の謎仕様の1つ","ts":"1613919842.075900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"C1q"}]},{"client_msg_id":"6692ed7b-8b0e-40c1-9993-c94c89a68c98","type":"message","user":"U03C6TEAZ","text":"content-length が付きます。","ts":"1613919748.075700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"=W4N"}]}]
