[{"client_msg_id":"a90bd76d-0df7-4764-80db-76c3e128b036","type":"message","user":"UEACRCY0Z","text":"これは関係ありませんでした。失礼しました\n~こんなコマンド作って設定してみたらうまく動作したので環境変数を渡せれば大丈夫そう。環境は macOS です。~\n\n```#!/bin/bash\n\nCGO_LDFLAGS=$(mecab-config --libs) CGO_CFLAGS=\"-I$(mecab-config --inc-dir)\" gopls $@```","ts":"1586822318.421900","edited":{"user":"UEACRCY0Z","ts":"1586835103.000000"},"team":"T03C4RC8V","reactions":[{"name":"tiken","count":1,"users":["UAZ33BKV2"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"OMiVA"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"a98f5e77-03cc-45f2-8aec-b2bbfd49b05b","type":"message","user":"U03C6TEAZ","text":"gopls も vim が起動してるので vim がその環境変数設定してるならいけそうなんだけどなぁ。","ts":"1586825535.422500","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"EO1"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"2a22d510-e731-4db5-8c2c-8a2f0315da63","type":"message","user":"UAZ33BKV2","text":"vim上での変数設定がされてるか、確認したほうがよさそう?","ts":"1586825652.423200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"gU4"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"e2eba988-2275-4654-8455-beec8baab7a2","type":"message","user":"UEACRCY0Z","text":"該当ファイルを開いた時に以下のように出るので、vim 上では環境変数は設定されていると思います。\n```:echo $CGO_LDFLAGS\n-L/usr/local/Cellar/mecab/0.996/lib -lmecab -lstdc++```","ts":"1586830902.424100","edited":{"user":"UEACRCY0Z","ts":"1586831154.000000"},"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Od6lv"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"673c5b7d-0ce2-4ab5-b599-ba1198d618ad","type":"message","user":"UAZ33BKV2","text":"うーん","ts":"1586831183.424400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"oMSh"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"b43a6c3c-5edb-4175-9dd8-4984afde7ad3","type":"message","user":"U03C6TEAZ","text":"job_start は env 引き継ぐはずなんだけどなー。","ts":"1586831339.424700","team":"T03C4RC8V","reactions":[{"name":"naruhodo","count":1,"users":["UEACRCY0Z"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"DjR"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"bf09d3b6-9b0f-46c1-af98-8b5e2d8e1f00","type":"message","user":"U03C6TEAZ","text":"この `$CGO_LDFLAGS` は vim が起動するよりも(lspが起動するよりも)前で設定されていると思っていいですか？","ts":"1586831903.425400","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"aQXm"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"d7fc08c5-125e-4940-b451-48636db7de1e","type":"message","user":"U03C6TEAZ","text":"vim-lsp から env を渡してもなさそう。","ts":"1586832033.427000","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"jHmMN"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"45992d16-28d7-40e6-ad77-25b3fddf0b59","type":"message","user":"UEACRCY0Z","text":"はい。ただ、普通は発生しない事象のようなのでぼくの環境がおかしい気がしてきました。\n再度環境を見直してみます。","ts":"1586832071.427700","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"7VFI"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"9e56e9aa-7cee-4021-86ee-4d7dc434c322","type":"message","user":"UEACRCY0Z","text":"すみません。勘違いをしていました。\n\n以下だと動作せず、\n\n```Plug 'mattn/vim-lsp-settings'```\n以下だと動きました。\n\n```if executable('gopls')\n    au User lsp_setup call lsp#register_server({\n        \\ 'name': 'gopls',\n        \\ 'cmd': {server_info-&gt;['gopls']},\n        \\ 'whitelist': ['go'],\n        \\ })\n    autocmd BufWritePre *.go LspDocumentFormatSync\nendif```\n`vim-lsp-settings` が上と同等だと勘違いしていました。\n環境変数関係なさそうです。失礼しました。","ts":"1586835078.430400","thread_ts":"1586835078.430400","edited":{"user":"UEACRCY0Z","ts":"1586835470.000000"},"reply_count":3,"replies":[{"user":"U8R597E9H","ts":"1586835956.438400"},{"user":"UEACRCY0Z","ts":"1586836037.439300"},{"user":"UEACRCY0Z","ts":"1586836424.440100"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"2=CHq"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"4733119c-6a38-42ad-bb5d-90610ae1d83d","type":"message","user":"UAZ33BKV2","text":"うーん? なんでしょうね(定義はほとんど同じはず)\nvim-lsp-settingsで入れたgoplsもあって、そっちが古い、とか?","ts":"1586835321.431100","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"S94af"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"9cb1c57d-1b8a-452d-8cb5-701c2dc25286","type":"message","user":"U03C6TEAZ","text":"vim-lsp-settings の場合 gopls は servers/gopls/gopls に置いてあるのが動くんですが、それが原因なのかなぁ。","ts":"1586835415.431900","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"X6Mf+"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"e25e0f88-b8eb-4589-8058-357509032fe1","type":"message","user":"U8R597E9H","text":"Plug ‘mattn/vim-lsp-settings’\n↑ こうじゃないでしょうか？（これはただの書き間違いかな？）","ts":"1586835438.432600","thread_ts":"1586835438.432600","reply_count":2,"replies":[{"user":"UEACRCY0Z","ts":"1586835460.433300"},{"user":"U8R597E9H","ts":"1586835489.433700"}],"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Z3W9"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"6c489deb-f71e-4a55-b9a1-3eb3b0ec00af","type":"message","user":"UEACRCY0Z","text":"すみません、タイポです","ts":"1586835460.433300","thread_ts":"1586835438.432600","parent_user_id":"U8R597E9H","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"CITA"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"97a27a5b-b7ee-4e5e-a1d4-2a63038af0a5","type":"message","user":"U8R597E9H","text":"おお。。。では、mattn/vim-lsp-settings 状態でも動いていなかったということですね。","ts":"1586835489.433700","thread_ts":"1586835438.432600","parent_user_id":"U8R597E9H","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"3ua"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"c1931125-498f-4c78-baf3-88f8aa17c201","type":"message","user":"UEACRCY0Z","text":"cgo 使っていないようなプロジェクトだと `Plug 'mattn/vim-lsp-settings'` でも期待通りに動作するんですけどね。\nとりあえず、ぼくの環境が問題のようなのでできるだけ環境をシンプルにして再現する条件を探してみます。\nありがとうございました。","ts":"1586835716.437200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"TRa8"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"ab3e550b-81ee-4828-a080-6c62db43d99d","type":"message","user":"U8R597E9H","text":"違いがあるとしたら root_uri を指定してるかどうかくらいですかねえ。。。","ts":"1586835750.437700","team":"T03C4RC8V","reactions":[{"name":"eyes","count":1,"users":["UEACRCY0Z"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"5awj"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"aa139b11-aca5-4113-a683-7adff72ab54e","type":"message","user":"U8R597E9H","text":"後者の設定に `      \\ ‘root_uri’: {server_info-&gt;lsp#utils#path_to_uri(lsp#utils#find_nearest_parent_file_directory(lsp#utils#get_buffer_path(), ‘go.mod’))},\n` を追加したら動かなくなるかどうか気になりました。","ts":"1586835956.438400","thread_ts":"1586835078.430400","parent_user_id":"UEACRCY0Z","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"wWppO"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"de6024f0-7b6b-4f85-9a07-f9ab8f593fcf","type":"message","user":"UEACRCY0Z","text":"なるほど！\n確かに問題のプロジェクトの配置はちょっと変則的でした。\nシンプルな構成の Go のプロジェクトも作って試してみます。","ts":"1586836022.439200","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"X4eN"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"95c0bd97-dbd3-4635-a3d9-2da4900180a0","type":"message","user":"UEACRCY0Z","text":"了解です","ts":"1586836037.439300","thread_ts":"1586835078.430400","parent_user_id":"UEACRCY0Z","team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"k2il"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"},{"client_msg_id":"d3098746-192d-4cf7-aa0c-823f40876d6a","type":"message","user":"UEACRCY0Z","text":"以下のような設定してみました。動作しました。\n```if executable('gopls')\n    au User lsp_setup call lsp#register_server({\n        \\ 'name': 'gopls',\n        \\ 'cmd': {server_info-&gt;['gopls']},\n        \\ 'root_uri': {server_info-&gt;lsp#utils#path_to_uri(lsp#utils#find_nearest_parent_file_directory(lsp#utils#get_buffer_path(), 'go.mod'))},\n        \\ 'whitelist': ['go'],\n        \\ })\n    autocmd BufWritePre *.go LspDocumentFormatSync\nendif```\n","ts":"1586836424.440100","thread_ts":"1586835078.430400","subtype":"thread_broadcast","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"eQfJ"}],"root":{"client_msg_id":"9e56e9aa-7cee-4021-86ee-4d7dc434c322","type":"message","user":"UEACRCY0Z","text":"すみません。勘違いをしていました。\n\n以下だと動作せず、\n\n```Plug 'mattn/vim-lsp-settings'```\n以下だと動きました。\n\n```if executable('gopls')\n    au User lsp_setup call lsp#register_server({\n        \\ 'name': 'gopls',\n        \\ 'cmd': {server_info-&gt;['gopls']},\n        \\ 'whitelist': ['go'],\n        \\ })\n    autocmd BufWritePre *.go LspDocumentFormatSync\nendif```\n`vim-lsp-settings` が上と同等だと勘違いしていました。\n環境変数関係なさそうです。失礼しました。","ts":"1586835078.430400","thread_ts":"1586835078.430400","edited":{"user":"UEACRCY0Z","ts":"1586835470.000000"},"reply_count":3,"team":"T03C4RC8V","replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"2=CHq"}]}},{"client_msg_id":"9e3ff6dc-368a-4a36-896d-17df99a04a89","type":"message","user":"UNJ2DANJC","text":"go.modと.gitの階層が違うとなんかおかしくなりそうな予感","ts":"1586836440.440700","thread_ts":"1586836440.440700","edited":{"user":"UNJ2DANJC","ts":"1586836464.000000"},"reply_count":1,"replies":[{"user":"UAZ33BKV2","ts":"1586917066.441800"}],"team":"T03C4RC8V","reactions":[{"name":"eyes","count":1,"users":["UEACRCY0Z"]}],"replace_original":false,"delete_original":false,"blocks":[{"type":"rich_text","block_id":"Nb/w"}],"source_team":"T03C4RC8V","user_team":"T03C4RC8V"}]
